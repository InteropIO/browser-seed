/*! For license information please see main.3f836378.js.LICENSE.txt */
(()=>{var e={664:function(e,t,n){e.exports=function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var i=function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)};function r(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))}function o(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function s(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}var a={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function c(e){return e.type===a.TIMESTAMP?"timestamp":e.type===a.NUMBER?"number":e.type===a.STRING?"string":e.type===a.OBJECT?"object":"unknown"}function u(e){return e.constructor===Date?"timestamp":"number"===typeof e?"number":"string"===typeof e?"string":"object"===typeof e?"object":"string"}function d(e){var t={},n=c(e);if("object"===n){var i=Object.keys(e.value).reduce((function(t,n){var i=u(e.value[n]);if("object"===i){var r=l(e.value[n]);t[n]={type:"object",description:"",context:{},composite:r}}else t[n]={type:i,description:"",context:{}};return t}),{});t.composite=i}return t.name=h(e.path.join("/")+"/"+e.name),t.type=n,t.description=e.description,t.context={},t}function l(e){return Object.keys(e).reduce((function(t,n){var i=u(e[n]);return t[n]="object"===i?{type:"object",description:"",context:{},composite:l(e[n])}:{type:i,description:"",context:{}},t}),{})}function h(e){return"undefined"!==typeof e&&e.length>0&&"/"!==e[0]?"/"+e:e}function p(e){return"timestamp"===c(e)?Date.now():f(e.value)}function f(e){return"object"!==typeof e?e:Object.keys(e).reduce((function(t,n){var i=e[n];return"object"===typeof i&&i.constructor!==Date?t[n]=f(i):i.constructor===Date?t[n]=new Date(i).getTime():i.constructor===Boolean?t[n]=i.toString():t[n]=i,t}),{})}function g(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?g(t):t)}),[])}function m(e){return e.sort((function(e,t){return e.state?t.state?t.state-e.state:-1:1}))[0]}function v(e){var t="";return e.forEach((function(e,n,i){var r=e.path.join(".");n===i.length-1?t+=r+"."+e.name+": "+e.description:t+=r+"."+e.name+": "+e.description+","})),t.length>100?t.slice(0,100)+"...":t}function y(e){var t=g(e.root.getAggregateState()),n=m(t);return{description:v(t),value:n.state}}function w(e,t){var n,s,a=this;if(!e||"object"!==typeof e)throw new Error("Connection is required parameter");var c=function(i){var r;n=new Promise((function(e){r=e})),(s=e.domain("metrics")).onJoined((function(e){!e&&r&&(r(),r=void 0);var t={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};s.send(t),e&&u(i)})),s.join({system:t.system,service:t.service,instance:t.instance})},u=function(e){l(e.root)},l=function(e){f(e),e.metrics.forEach((function(e){m(e)})),e.subSystems.forEach((function(e){l(e)}))},f=function(e){return r(a,void 0,void 0,(function(){var t,i;return o(this,(function(r){switch(r.label){case 0:return void 0===e.parent?[2]:[4,n];case 1:return r.sent(),t={name:h(e.path.join("/")+"/"+e.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},i={type:"define",metrics:[t]},s.send(i),[2]}}))}))},g=function(t,i){return r(a,void 0,void 0,(function(){var r,a,c;return o(this,(function(o){switch(o.label){case 0:return[4,n];case 1:return o.sent(),r={type:"publish",values:[{name:h(t.path.join("/")+"/"+t.name+"/State"),value:{Description:i.description,Value:i.state},timestamp:Date.now()}]},s.send(r),a=y(t),c={type:"publish",peer_id:e.peerId,values:[{name:"/State",value:{Description:a.description,Value:a.value},timestamp:Date.now()}]},s.send(c),[2]}}))}))},m=function(e){return r(a,void 0,void 0,(function(){var t,i,r;return o(this,(function(o){switch(o.label){case 0:return t=b(e),[4,n];case 1:return o.sent(),i=d(t),r={type:"define",metrics:[i]},s.send(r),"undefined"!==typeof t.value&&w(t),[2]}}))}))},v=function(e){return r(a,void 0,void 0,(function(){var t;return o(this,(function(i){switch(i.label){case 0:return t=b(e),[4,n];case 1:return i.sent(),w(t),[2]}}))}))},w=function(e){if(_()){var t=p(e),n={type:"publish",values:[{name:h(e.path.join("/")+"/"+e.name),value:t,timestamp:Date.now()}]};return s.sendFireAndForget(n)}return Promise.resolve()},b=function(e){var t=i({},e);return"object"===typeof e.value&&null!==e.value&&(t.value=i({},e.value)),t},_=function(){var e;try{return(null!==(e=t.canUpdateMetric)&&void 0!==e?e:function(){return!0})()}catch(ss){return!0}};return{init:c,createSystem:f,updateSystem:g,createMetric:m,updateMetric:v}}var b={validate:function(e,t,n){if(null===e||"object"!==typeof e)throw new Error("Missing definition");if(null===t||"object"!==typeof t)throw new Error("Missing parent");if(null===n||"object"!==typeof n)throw new Error("Missing transport")}},_=function(){function e(e,t,n,i,r){this.definition=e,this.system=t,this.transport=n,this.value=i,this.type=r,this.path=[],b.validate(e,t,n),this.path=t.path.slice(0),this.path.push(t.name),this.name=e.name,this.description=e.description,n.createMetric(this)}return Object.defineProperty(e.prototype,"repo",{get:function(){var e;return null===(e=this.system)||void 0===e?void 0:e.repo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return"".concat(this.system.path,"/").concat(name)},enumerable:!1,configurable:!0}),e.prototype.update=function(e){return this.value=e,this.transport.updateMetric(this)},e}(),I=function(e){function n(t,n,i,r){return e.call(this,t,n,i,r,a.NUMBER)||this}return t(n,e),n.prototype.incrementBy=function(e){this.update(this.value+e)},n.prototype.increment=function(){this.incrementBy(1)},n.prototype.decrement=function(){this.incrementBy(-1)},n.prototype.decrementBy=function(e){this.incrementBy(-1*e)},n}(_),C=function(e){function n(t,n,i,r){return e.call(this,t,n,i,r,a.OBJECT)||this}return t(n,e),n.prototype.update=function(e){return this.mergeValues(e),this.transport.updateMetric(this)},n.prototype.mergeValues=function(e){var t=this;return Object.keys(this.value).forEach((function(n){"undefined"!==typeof e[n]&&(t.value[n]=e[n])}))},n}(_),S=function(e){function n(t,n,i,r){return e.call(this,t,n,i,r,a.STRING)||this}return t(n,e),n}(_),k=function(e){function n(t,n,i,r){return e.call(this,t,n,i,r,a.TIMESTAMP)||this}return t(n,e),n.prototype.now=function(){this.update(new Date)},n}(_);function x(e,t,n,i,r){if(!t)throw new Error("Repository is required");if(!n)throw new Error("Transport is required");var o=n,s=e,c=r||"",u=t,d=i,l=E(i),h={},p=P(l,"/")+e,f=t.root,g=[],m=[];function v(e,t){if(!e||0===e.length)throw new Error("name is required");var n=g.filter((function(t){return t.name===e}));if(n.length>0)return n[0];var i=x(e,u,o,R,t);return g.push(i),i}function y(e,t){h={state:e,description:t},o.updateSystem(R,h)}function w(e,t){return A(e,a.STRING,t,(function(e){return new S(e,R,o,t)}))}function b(e,t){return A(e,a.NUMBER,t,(function(e){return new I(e,R,o,t)}))}function _(e,t){return A(e,a.OBJECT,t,(function(e){return new C(e,R,o,t)}))}function T(e,t){return A(e,a.TIMESTAMP,t,(function(e){return new k(e,R,o,t)}))}function A(e,t,n,i){var r={name:""};r="string"===typeof e?{name:e}:e;var o=m.filter((function(e){return e.name===r.name}));if(o.length>0){var s=o[0];if(s.type!==t)throw new Error("A metric named ".concat(r.name," is already defined with different type."));return"undefined"!==typeof n&&s.update(n).catch((function(){})),s}var a=i(r);return m.push(a),a}function E(e){if(!e||!e.parent)return[];var t=E(e.parent);return t.push(e.name),t}function P(e,t){return e&&e.length>0?e.join(t):""}function M(){var e=[];return Object.keys(h).length>0&&e.push({name:s,path:l,state:h.state,description:h.description}),g.forEach((function(t){var n=t.getAggregateState();n.length>0&&e.push.apply(e,n)})),e}var R={get name(){return s},get description(){return c},get repo(){return u},get parent(){return d},path:l,id:p,root:f,get subSystems(){return g},get metrics(){return m},subSystem:v,getState:function(){return h},setState:y,stringMetric:w,timestampMetric:T,objectMetric:_,numberMetric:b,getAggregateState:M};return o.createSystem(R),R}var T=function(){function e(e,t){t.init(this),this.root=x("",this,t),this.addSystemMetrics(this.root,e.clickStream||void 0===e.clickStream)}return e.prototype.addSystemMetrics=function(e,t){if("undefined"!==typeof navigator&&e.stringMetric("UserAgent",navigator.userAgent),t&&"undefined"!==typeof document){var n=e.subSystem("ClickStream"),i=function(e){var t;if(e.target){var i=e.target,r=i&&null!==(t=i.getAttribute("class"))&&void 0!==t?t:"";n.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:r,id:i.id,type:"<"+i.tagName.toLowerCase()+">",href:i.href||""}})}};n.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",i):document.attachEvent("onclick",i)}e.stringMetric("StartTime",(new Date).toString());var r=e.stringMetric("StartURL",""),o=e.stringMetric("AppName","");if("undefined"!==typeof window){if("undefined"!==typeof window.location){var s=window.location.href;r.update(s)}"undefined"!==typeof window.glue42gd&&o.update(window.glue42gd.appName)}},e}(),A=function(){function e(){}return e.prototype.init=function(e){},e.prototype.createSystem=function(e){return Promise.resolve()},e.prototype.updateSystem=function(e,t){return Promise.resolve()},e.prototype.createMetric=function(e){return Promise.resolve()},e.prototype.updateMetric=function(e){return Promise.resolve()},e}(),E=function(){function e(e,t,n){this.api=e,this.lastCount=0,this.initialPublishTimeout=1e4,this.publishInterval=6e4,this.initialPublishTimeout=null!==t&&void 0!==t?t:this.initialPublishTimeout,this.publishInterval=null!==n&&void 0!==n?n:this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}return e.prototype.scheduleCollection=function(){var e=this;setTimeout((function(){e.collect(),setInterval((function(){e.collect()}),e.publishInterval)}),this.initialPublishTimeout)},e.prototype.collect=function(){try{this.collectMemory(),this.collectEntries()}catch(os){}},e.prototype.collectMemory=function(){var e=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:e.totalJSHeapSize,usedJSHeapSize:e.usedJSHeapSize}))},e.prototype.collectEntries=function(){var e=window.performance.getEntries();if(!(e.length<=this.lastCount)){this.lastCount=e.length;var t=e.map((function(e){return e.toJSON()}));this.system.stringMetric("entries",JSON.stringify(t))}},e}(),P=function(e){var t;t=e.connection&&"object"===typeof e.connection?w(e.connection,e):new A;var n=new T(e,t).root;e.disableAutoAppSystem||(n=n.subSystem("App"));var i=R(n);return M(i,e.pagePerformanceMetrics),i};function M(e,t){var n,i;if("undefined"!==typeof window){var r=null===(i=null===(n=null===window||void 0===window?void 0:window.glue42gd)||void 0===n?void 0:n.metrics)||void 0===i?void 0:i.pagePerformanceMetrics;r&&(t=r),(null===t||void 0===t?void 0:t.enabled)&&new E(e,t.initialPublishTimeout,t.publishInterval)}}function R(e){var t,n=e.subSystem("reporting"),i={name:"features"},r=function(e,r,o){if("undefined"===typeof e||""===e)throw new Error("name is mandatory");if("undefined"===typeof r||""===r)throw new Error("action is mandatory");if("undefined"===typeof o||""===o)throw new Error("payload is mandatory");t?t.update({name:e,action:r,payload:o}):t=n.objectMetric(i,{name:e,action:r,payload:o})};return e.featureMetric=r,e}var N="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{};function O(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function j(e){if(e&&e.errorHandling&&"function"!==typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"===typeof e.errorHandling&&e.errorHandling,n={};function i(e,t,i){var r=n[e];return r||(r=[],n[e]=r),r.push(t),i&&setTimeout((function(){i.forEach((function(i){var r;if(null===(r=n[e])||void 0===r?void 0:r.includes(t))try{Array.isArray(i)?t.apply(void 0,i):t.apply(void 0,[i])}catch(s){o(s,e)}}))}),0),function(){var i=n[e];i&&(0===(i=i.reduce((function(e,n,i){return n===t&&e.length===i||e.push(n),e}),[])).length?delete n[e]:n[e]=i)}}function r(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var r=n[e];if(!r||0===r.length)return[];var s=[];return r.forEach((function(n){try{var i=n.apply(void 0,t);s.push(i)}catch(r){s.push(void 0),o(r,e)}})),s}function o(n,i){var r=n instanceof Error?n:new Error(n);if(t)t(r);else{var o='[ERROR] callback-registry: User callback for key "'+i+'" failed: '+r.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}function s(){n={}}function a(e){n[e]&&delete n[e]}return{add:i,execute:r,clear:s,clearKey:a}}j.default=j;var D=j,F=function(){function e(e,t){var n=this;this.registry=D(),this.gw=e.facade,this.gw.connect((function(e,t){n.messageHandler(t)})).then((function(e){n.client=e}))}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return this.client?(this.client.send(e),Promise.resolve(void 0)):Promise.reject("not connected")},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"in-memory"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),W=function(){function e(e,t){var n=this;this.logger=t,this.registry=D(),this.worker=new SharedWorker(e),this.worker.port.onmessage=function(e){n.messageHandler(e.data)}}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return this.worker.port.postMessage(e),Promise.resolve()},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"shared-worker"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),L=function(){function e(){}return e.isNode=function(){if("undefined"!==typeof e._isNode)return e._isNode;if("undefined"!==typeof window)return e._isNode=!1,!1;try{e._isNode="[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){e._isNode=!1}return e._isNode},e}(),U=function(){function e(){var e=this;this.rejected=!1,this.resolved=!1,this.promise=new Promise((function(t,n){e.resolve=function(n){e.resolved=!0,t(n)},e.reject=function(t){e.rejected=!0,n(t)}}))}return e.delay=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Object.defineProperty(e.prototype,"ended",{get:function(){return this.rejected||this.resolved},enumerable:!1,configurable:!0}),e}(),q={};function B(){return q}function G(e){var t=q[e];if(t)return t;var n=[];function i(){return(new Date).getTime()}var r,o,s=i();function a(){return c("end",r=i()),o=r-s}function c(e,t){var r=null!==t&&void 0!==t?t:i(),o=0;n.length>0&&(o=r-n[n.length-1].time),n.push({name:e,time:r,diff:o})}c("start",s);var u={get startTime(){return s},get endTime(){return r},get period(){return o},stop:a,mark:c,marks:n};return q[e]=u,u}var H=L.isNode()?null:window.WebSocket,z=function(){function e(e,t){if(this.startupTimer=G("connection"),this._running=!0,this._registry=D(),this.wsRequests=[],this.settings=e,this.logger=t,!this.settings.ws)throw new Error("ws is missing")}return e.prototype.onMessage=function(e){return this._registry.add("onMessage",e)},e.prototype.send=function(e,t){var n=this;return new Promise((function(t,i){n.waitForSocketConnection((function(){var r;try{null===(r=n.ws)||void 0===r||r.send(e),t()}catch(o){i(o)}}),i)}))},e.prototype.open=function(){var e=this;return this.logger.info("opening ws..."),this._running=!0,new Promise((function(t,n){e.waitForSocketConnection(t,n)}))},e.prototype.close=function(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()},e.prototype.onConnectedChanged=function(e){return this._registry.add("onConnectedChanged",e)},e.prototype.name=function(){return this.settings.ws},e.prototype.reconnect=function(){var e;null===(e=this.ws)||void 0===e||e.close();var t=new U;return this.waitForSocketConnection((function(){t.resolve()})),t.promise},e.prototype.waitForSocketConnection=function(e,t){var n;t=null!==t&&void 0!==t?t:function(){},this._running?1!==(null===(n=this.ws)||void 0===n?void 0:n.readyState)?(this.wsRequests.push({callback:e,failed:t}),this.wsRequests.length>1||this.openSocket()):e():t("wait for socket on ".concat(this.settings.ws," failed - socket closed by user"))},e.prototype.openSocket=function(e,t){return r(this,void 0,void 0,(function(){var n=this;return o(this,(function(i){switch(i.label){case 0:if(this.startupTimer.mark("opening-socket"),void 0===e&&(e=this.settings.reconnectInterval),"undefined"===typeof t&&(t=this.settings.reconnectAttempts),void 0!==t){if(0===t)return this.notifyForSocketState("wait for socket on ".concat(this.settings.ws," failed - no more retries left")),[2];this.logger.debug("will retry ".concat(t," more times (every ").concat(e," ms)"))}i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.initiateSocket()];case 2:return i.sent(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState(),[3,4];case 3:return i.sent(),setTimeout((function(){var i=void 0===t?void 0:t-1;n.openSocket(e,i)}),e),[3,4];case 4:return[2]}}))}))},e.prototype.initiateSocket=function(){var e=this,t=new U;return this.logger.debug("initiating ws to ".concat(this.settings.ws,"...")),this.ws=new H(this.settings.ws||""),this.ws.onerror=function(n){var i="";try{i=JSON.stringify(n)}catch(s){var r=new WeakSet,o=function(e,t){if("object"===typeof t&&null!==t){if(r.has(t))return;r.add(t)}return t};i=JSON.stringify(n,o)}t.reject("error"),e.notifyStatusChanged(!1,i)},this.ws.onclose=function(n){e.logger.info("ws closed ".concat(n)),t.reject("closed"),e.notifyStatusChanged(!1)},this.ws.onopen=function(){var n;e.startupTimer.mark("ws-opened"),e.logger.info("ws opened ".concat(null===(n=e.settings.identity)||void 0===n?void 0:n.application)),t.resolve(),e.notifyStatusChanged(!0)},this.ws.onmessage=function(t){e._registry.execute("onMessage",t.data)},t.promise},e.prototype.notifyForSocketState=function(e){this.wsRequests.forEach((function(t){e?t.failed&&t.failed(e):t.callback()})),this.wsRequests=[]},e.prototype.notifyStatusChanged=function(e,t){this._registry.execute("onConnectedChanged",e,t)},e}(),V={},J={get exports(){return V},set exports(e){V=e}},K={},$={get exports(){return K},set exports(e){K=e}},Q=1;function Y(){return(Q=(9301*Q+49297)%233280)/233280}function X(e){Q=e}var Z,ee,te,ne={nextValue:Y,seed:X},ie="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function re(){te=!1}function oe(e){if(e){if(e!==Z){if(e.length!==ie.length)throw new Error("Custom alphabet for shortid must be "+ie.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+ie.length+" unique characters. These characters were not unique: "+t.join(", "));Z=e,re()}}else Z!==ie&&(Z=ie,re())}function se(e){return oe(e),Z}function ae(e){ne.seed(e),ee!==e&&(re(),ee=e)}function ce(){Z||oe(ie);for(var e,t=Z.split(""),n=[],i=ne.nextValue();t.length>0;)i=ne.nextValue(),e=Math.floor(i*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function ue(){return te||(te=ce())}function de(e){return ue()[e]}function le(){return Z||ie}var he,pe={get:le,characters:se,seed:ae,lookup:de,shuffled:ue},fe="object"===typeof window&&(window.crypto||window.msCrypto);he=fe&&fe.getRandomValues?function(e){return fe.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t};var ge=function(e,t,n){for(var i=(2<<Math.log(t.length-1)/Math.LN2)-1,r=-~(1.6*i*n/t.length),o="";;)for(var s=e(r),a=r;a--;)if((o+=t[s[a]&i]||"").length===+n)return o},me=pe,ve=he,ye=ge;function we(e){for(var t,n=0,i="";!t;)i+=ye(ve,me.get(),1),t=e<Math.pow(16,n+1),n++;return i}var be,_e,Ie=we,Ce=1567752802062,Se=7;function ke(e){var t="",n=Math.floor(.001*(Date.now()-Ce));return n===_e?be++:(be=0,_e=n),t+=Ie(Se),t+=Ie(e),be>0&&(t+=Ie(be)),t+=Ie(n)}var xe=ke,Te=pe;function Ae(e){return!(!e||"string"!==typeof e||e.length<6)&&!new RegExp("[^"+Te.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)}var Ee=Ae;(function(e){var t=pe,n=xe,i=Ee,r=0;function o(n){return t.seed(n),e.exports}function s(t){return r=t,e.exports}function a(e){return void 0!==e&&t.characters(e),t.shuffled()}function c(){return n(r)}e.exports=c,e.exports.generate=c,e.exports.seed=o,e.exports.worker=s,e.exports.characters=a,e.exports.isValid=i})($),function(e){e.exports=K}(J);var Pe=O(V);function Me(e,t,n,i,r){null==e&&(e="global"),i=i||["success"],r=r||["error"];var o,s=!1,a=!1,c=!1,u=D();t.disconnected(f),t.loggedIn(g),t.on("success",(function(e){return w(e)})),t.on("error",(function(e){return y(e)})),t.on("result",(function(e){return w(e)})),i&&i.forEach((function(e){t.on(e,(function(e){return w(e)}))})),r&&r.forEach((function(e){t.on(e,(function(e){return y(e)}))}));var d={};function l(t){return o=t,new Promise((function(i,r){var o;s?i({}):("global"===e?o=c?Promise.resolve({}):Promise.reject("not connected to gateway"):(n.debug("joining domain ".concat(e)),o=_({type:"join",destination:e,domain:"global",options:t})),o.then((function(){p(),i({})})).catch((function(t){n.debug("error joining "+e+" domain: "+JSON.stringify(t)),r(t)})))}))}function h(){return"global"===e?Promise.resolve():(n.debug("stopping session "+e+"..."),a=!1,_({type:"leave",destination:e,domain:"global"}).then((function(){s=!1,u.execute("onLeft")})).catch((function(){s=!1,u.execute("onLeft")})))}function p(){n.debug("did join "+e),s=!0;var t=a;a=!1,u.execute("onJoined",t)}function f(){c=!1,n.debug("connection is down"),s=!1,a=!0,u.execute("onLeft",{disconnected:!0})}function g(){c=!0,a&&(n.debug("connection is now up - trying to reconnect..."),l(o))}function m(e){return s&&e(!1),u.add("onJoined",e)}function v(e){return s||e(),u.add("onLeft",e)}function y(t){if(e===t.domain){var n=t.request_id;if(n){var i=d[n];i&&i.error(t)}}}function w(t){if(t.domain===e){var n=t.request_id;if(n){var i=d[n];i&&i.success(t)}}}function b(){return Pe()}function _(i,r,o){o=o||{},i.request_id=i.request_id||b(),i.domain=i.domain||e,o.skipPeerId||(i.peer_id=t.peerId);var s=i.request_id;return new Promise((function(e,a){d[s]={success:function(t){delete d[s],t._tag=r,e(t)},error:function(e){n.warn("GW error - ".concat(JSON.stringify(e)," for request ").concat(JSON.stringify(i))),delete d[s],e._tag=r,a(e)}},t.send(i,o).catch((function(e){d[s].error({err:e})}))}))}function I(n){return n.request_id=n.request_id?n.request_id:b(),n.domain=n.domain||e,n.peer_id=t.peerId,t.send(n)}return{join:l,leave:h,onJoined:m,onLeft:v,send:_,sendFireAndForget:I,on:function(i,r){t.on(i,(function(t){if(t.domain===e)try{r(t)}catch(i){n.error("Callback  failed: ".concat(i," \n ").concat(i.stack," \n msg was: ").concat(JSON.stringify(t)),i)}}))},loggedIn:function(e){return t.loggedIn(e)},connected:function(e){return t.connected(e)},disconnected:function(e){return t.disconnected(e)},get peerId(){return t.peerId},get domain(){return e}}}var Re=function(){function e(e,t,n){var i=this;this.connection=e,this.settings=t,this.logger=n,this.protocolVersion=3,this.datePrefix="#T42_DATE#",this.datePrefixLen=this.datePrefix.length,this.dateMinLen=this.datePrefixLen+1,this.datePrefixFirstChar=this.datePrefix[0],this.registry=D(),this._isLoggedIn=!1,this.shouldTryLogin=!0,this.initialLogin=!0,this.initialLoginAttempts=3,this.sessions=[],e.disconnected((function(){i.handleDisconnected()})),this.ping()}return Object.defineProperty(e.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!1,configurable:!0}),e.prototype.processStringMessage=function(e){var t=this,n=JSON.parse(e,(function(e,n){if("string"!==typeof n)return n;if(n.length<t.dateMinLen)return n;if(n[0]!==t.datePrefixFirstChar)return n;if(n.substring(0,t.datePrefixLen)!==t.datePrefix)return n;try{var i=parseInt(n.substring(t.datePrefixLen,n.length),10);return isNaN(i)?n:new Date(i)}catch(r){return n}}));return{msg:n,msgType:n.type}},e.prototype.createStringMessage=function(e){var t=Date.prototype.toJSON;try{var n=this.datePrefix;return Date.prototype.toJSON=function(){return n+this.getTime()},JSON.stringify(e)}finally{Date.prototype.toJSON=t}},e.prototype.processObjectMessage=function(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}},e.prototype.createObjectMessage=function(e){return e},e.prototype.login=function(e,t){return r(this,void 0,void 0,(function(){var n,i,r,s,a,c,u,d,l,h;return o(this,(function(o){switch(o.label){case 0:if(this.logger.debug("logging in..."),this.loginConfig=e,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0,n={},this.connection.gatewayToken=e.gatewayToken,!e.gatewayToken)return[3,5];if(!t)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.getNewGWToken()];case 2:return d=o.sent(),e.gatewayToken=d,[3,4];case 3:return i=o.sent(),this.logger.warn("failed to get GW token when reconnecting ".concat((null===i||void 0===i?void 0:i.message)||i)),[3,4];case 4:return n.method="gateway-token",n.token=e.gatewayToken,this.connection.gatewayToken=e.gatewayToken,[3,10];case 5:return"sspi"!==e.flowName?[3,9]:(n.provider="win",n.method="access-token",e.flowCallback&&e.sessionId?(r=n,[4,e.flowCallback(e.sessionId,null)]):[3,7]);case 6:return r.token=o.sent().data.toString("base64"),[3,8];case 7:throw new Error("Invalid SSPI config");case 8:return[3,10];case 9:if(e.token)n.method="access-token",n.token=e.token;else if(e.username)n.method="secret",n.login=e.username,n.secret=e.password;else{if(!e.provider)throw new Error("invalid auth message"+JSON.stringify(e));n.provider=e.provider,n.providerContext=e.providerContext}o.label=10;case 10:s={type:"hello",identity:this.settings.identity,authentication:n},e.sessionId&&(s.request_id=e.sessionId),this.globalDomain=Me("global",this.connection,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]),a={skipPeerId:!0},this.initialLogin&&(a.retryInterval=this.settings.reconnectInterval,a.maxRetries=this.settings.reconnectAttempts),o.label=11;case 11:o.trys.push([11,19,20,21]),c=void 0,o.label=12;case 12:return[4,this.globalDomain.send(s,void 0,a)];case 13:return"authentication-request"!==(u=o.sent()).type?[3,16]:(d=Buffer.from(u.authentication.token,"base64"),e.flowCallback&&e.sessionId?(l=s.authentication,[4,e.flowCallback(e.sessionId,d)]):[3,15]);case 14:l.token=o.sent().data.toString("base64"),o.label=15;case 15:return s.request_id=e.sessionId,[3,12];case 16:if("welcome"===u.type)return c=u,[3,18];throw"error"===u.type?new Error("Authentication failed: "+u.reason):new Error("Unexpected message type during authentication: "+u.type);case 17:return[3,12];case 18:return this.initialLogin=!1,this.logger.debug("login successful with peerId "+c.peer_id),this.connection.peerId=c.peer_id,this.connection.resolvedIdentity=c.resolved_identity,this.connection.availableDomains=c.available_domains,c.options&&(this.connection.token=c.options.access_token,this.connection.info=c.options.info),this.setLoggedIn(!0),[2,c.resolved_identity];case 19:throw h=o.sent(),this.logger.error("error sending hello message - "+(h.message||h.msg||h.reason||h),h),h;case 20:return e&&e.flowCallback&&e.sessionId&&e.flowCallback(e.sessionId,null),[7];case 21:return[2]}}))}))},e.prototype.logout=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer),e=this.sessions.map((function(e){e.leave()})),[4,Promise.all(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this._isLoggedIn&&e(),this.registry.add("onLoggedIn",e)},e.prototype.domain=function(e,t,n,i){var r=this.sessions.filter((function(t){return t.domain===e}))[0];return r||(r=Me(e,this.connection,t,n,i),this.sessions.push(r)),r},e.prototype.handleDisconnected=function(){var e=this;if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.connection.login(this.loginConfig,!0).catch((function(){setTimeout(e.handleDisconnected.bind(e),e.settings.reconnectInterval||1e3)}))}},e.prototype.setLoggedIn=function(e){this._isLoggedIn=e,this._isLoggedIn&&this.registry.execute("onLoggedIn")},e.prototype.ping=function(){var e=this;this.shouldTryLogin&&(this._isLoggedIn&&this.connection.send({type:"ping"}),this.pingTimer=setTimeout((function(){e.ping()}),3e4))},e.prototype.authToken=function(){var e={type:"create-token"};return this.globalDomain?this.globalDomain.send(e).then((function(e){return e.token})):Promise.reject(new Error("no global domain session"))},e.prototype.getNewGWToken=function(){if(void 0!==typeof window){var e=window.glue42gd;if(e)return e.getGWToken()}return Promise.reject(new Error("not running in GD"))},e}(),Ne=function(){function e(e){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var t=0,n=e;t<n.length;t++){var i=n[t];this.specs[i.name]=i,this.specsNames.push(i.name)}}return e.prototype.init=function(e){var t=this;this.connection=e;for(var n=0,i=this.specsNames;n<i.length;n++)for(var r=i[n],o=function(n){var i=s.subsRefCount[n];if(i||(i=0),i+=1,s.subsRefCount[n]=i,i>1)return"continue";var r=e.on(n,(function(e){return t.processMessage(n,e)}));s.subs[n]=r},s=this,a=0,c=this.specs[r].types;a<c.length;a++)o(c[a])},e.prototype.processMessage=function(e,t){if(!this.isDone&&t)for(var n=0,i=this.specsNames;n<i.length;n++){var r=i[n];if(-1!==this.specs[r].types.indexOf(e)){var o=this.messages[r]||[];this.messages[r]=o,o.push(t)}}},e.prototype.drain=function(e,t){var n;t&&(this.messages[e]||[]).forEach(t),delete this.messages[e];for(var i=0,r=this.specs[e].types;i<r.length;i++){var o=r[i];this.subsRefCount[o]-=1,this.subsRefCount[o]<=0&&(null===(n=this.connection)||void 0===n||n.off(this.subs[o]),delete this.subs[o],delete this.subsRefCount[o])}delete this.specs[e],this.specs.length||(this.isDone=!0)},e}(),Oe=function(e,t,n){return new Promise((function(i,r){var o=setTimeout((function(){var e=n||"Promise timeout hit: ".concat(t);r(e)}),t);new Promise(e).then((function(e){clearTimeout(o),i(e)})).catch((function(e){clearTimeout(o),r(e)}))}))},je=function(){function e(e,t,n){this.settings=e,this.logger=t,this.identity=n,this.iAmConnected=!1,this.parentReady=!1,this.rejected=!1,this.children=[],this.extContentAvailable=!1,this.extContentConnecting=!1,this.extContentConnected=!1,this.parentInExtMode=!1,this.webNamespace="g42_core_web",this.parentPingTimeout=5e3,this.connectionRequestTimeout=7e3,this.defaultTargetString="*",this.registry=D(),this.messages={connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:function(){}},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:this.handleClientUnload.bind(this)},manualUnload:{name:"manualUnload",handle:this.handleManualUnload.bind(this)},extConnectionResponse:{name:"extConnectionResponse",handle:this.handleExtConnectionResponse.bind(this)},extSetupRequest:{name:"extSetupRequest",handle:this.handleExtSetupRequest.bind(this)},gatewayDisconnect:{name:"gatewayDisconnect",handle:this.handleGatewayDisconnect.bind(this)},gatewayInternalConnect:{name:"gatewayInternalConnect",handle:this.handleGatewayInternalConnect.bind(this)}},this.extContentAvailable=!!window.glue42ext,this.setUpMessageListener(),this.setUpUnload(),this.setupPlatformUnloadListener(),this.parentType=window.name.includes("#wsp")?"workspace":void 0}return e.prototype.manualSetReadyState=function(){this.iAmConnected=!0,this.parentReady=!0},Object.defineProperty(e.prototype,"transportWindowId",{get:function(){return this.publicWindowId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"communicationId",{get:function(){return this._communicationId},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){if(this.extContentConnected)return[2,window.postMessage({glue42ExtOut:e},this.defaultTargetString)];if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");return this.port.postMessage(e),[2]}))}))},Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.send=function(){return Promise.reject("not supported")},e.prototype.onConnectedChanged=function(e){return this.registry.add("onConnectedChanged",e)},e.prototype.open=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.logger.debug("opening a connection to the web platform gateway."),[4,this.connect()];case 1:return e.sent(),this.notifyStatusChanged(!0),[2]}}))}))},e.prototype.close=function(){var e,t,n={glue42core:{type:this.messages.gatewayDisconnect.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};return null===(t=this.port)||void 0===t||t.postMessage(n),this.parentReady=!1,this.notifyStatusChanged(!1,"manual reconnection"),Promise.resolve()},e.prototype.name=function(){return"web-platform"},e.prototype.reconnect=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.close()];case 1:return e.sent(),[2,Promise.resolve()]}}))}))},e.prototype.initiateInternalConnection=function(){var e=this;return new Promise((function(t,n){e.logger.debug("opening an internal web platform connection"),e.port=e.settings.port,e.iAmConnected?e.logger.warn("cannot open a new connection, because this client is currently connected"):(e.port.onmessage=function(i){var r,o;if(!e.iAmConnected||(null===(r=i.data)||void 0===r?void 0:r.glue42core)){var s=null===(o=i.data)||void 0===o?void 0:o.glue42core;s&&(s.type===e.messages.gatewayInternalConnect.name&&s.success&&(e.publicWindowId=e.settings.windowId,e.identity&&e.publicWindowId&&(e.identity.windowId=e.publicWindowId,e.identity.instance=e.publicWindowId),t()),s.type===e.messages.gatewayInternalConnect.name&&s.error&&n(s.error))}else e.registry.execute("onMessage",i.data)},e.port.postMessage({glue42core:{type:e.messages.gatewayInternalConnect.name}}))}))},e.prototype.initiateRemoteConnection=function(e){var t=this;return Oe((function(n,i){var r;t.connectionResolve=n,t.connectionReject=i,t.myClientId=null!==(r=t.myClientId)&&void 0!==r?r:Pe();var o=t.getMyWindowId()||Pe(),s={glue42core:{type:t.messages.connectionRequest.name,clientId:t.myClientId,clientType:"child",bridgeInstanceId:o,selfAssignedWindowId:t.selfAssignedWindowId}};if(t.logger.debug("sending connection request"),t.extContentConnecting)return s.glue42core.clientType="child",s.glue42core.bridgeInstanceId=t.myClientId,s.glue42core.parentWindowId=t.parentWindowId,window.postMessage(s,t.defaultTargetString);if(!e)throw new Error("Cannot send a connection request, because no glue target was specified!");e.postMessage(s,t.defaultTargetString)}),this.connectionRequestTimeout,"The connection to the target glue window timed out")},e.prototype.isParentCheckSuccess=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e];case 1:return t.sent(),[2,{success:!0}];case 2:return t.sent(),[2,{success:!1}];case 3:return[2]}}))}))},e.prototype.setUpMessageListener=function(){var e=this;this.settings.port?this.logger.debug("skipping generic message listener, because this is an internal client"):window.addEventListener("message",(function(t){var n,i=null===(n=t.data)||void 0===n?void 0:n.glue42core;if(i&&!e.rejected)if(e.checkMessageTypeValid(i.type)){var r=i.type;e.logger.debug("received valid glue42core message of type: ".concat(r)),e.messages[r].handle(t)}else e.logger.error("cannot handle the incoming glue42 core message, because the type is invalid: ".concat(i.type))}))},e.prototype.setUpUnload=function(){var e=this;this.settings.port?this.logger.debug("skipping unload event listener, because this is an internal client"):window.addEventListener("beforeunload",(function(){var t,n;if(!e.extContentConnected){var i={glue42core:{type:e.messages.clientUnload.name,data:{clientId:e.myClientId,ownWindowId:null===(t=e.identity)||void 0===t?void 0:t.windowId}}};e.parent&&e.parent.postMessage(i,e.defaultTargetString),null===(n=e.port)||void 0===n||n.postMessage(i)}}))},e.prototype.handlePlatformReady=function(e){this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve&&(this.parentPingResolve(),delete this.parentPingResolve),this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval),this.parent=e.source,this.parentType=window.name.includes("#wsp")?"workspace":"window"},e.prototype.handleConnectionAccepted=function(e){var t,n=null===(t=e.data)||void 0===t?void 0:t.glue42core;return this.myClientId===n.clientId?this.handleAcceptanceOfMyRequest(n):this.handleAcceptanceOfGrandChildRequest(n,e)},e.prototype.handleAcceptanceOfMyRequest=function(e){var t=this;if(this.logger.debug("handling a connection accepted signal targeted at me."),this.isPreferredActivated=e.isPreferredActivated,this.extContentConnecting)return this.processExtContentConnection(e);if(e.port){if(this.publicWindowId=this.getMyWindowId(),this.identity&&(this.identity.windowId=this.publicWindowId,this.identity.instance=this.identity.instance?this.identity.instance:this.publicWindowId||Pe()),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),this._communicationId=e.communicationId,this.port=e.port,this.port.onmessage=function(e){return t.registry.execute("onMessage",e.data)},this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve;this.logger.error("unable to call the connection resolve, because no connection promise was found")}else this.logger.error("cannot set up my connection, because I was not provided with a port")},e.prototype.processExtContentConnection=function(e){var t=this;if(this.logger.debug("handling a connection accepted signal targeted at me for extension content connection."),this.extContentConnecting=!1,this.extContentConnected=!0,this.publicWindowId=this.parentWindowId||this.myClientId,this.extContentConnecting&&this.identity&&(this.identity.windowId=this.publicWindowId),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),window.addEventListener("message",(function(e){var n,i=null===(n=e.data)||void 0===n?void 0:n.glue42ExtInc;i&&t.registry.execute("onMessage",i)})),this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve},e.prototype.handleAcceptanceOfGrandChildRequest=function(e,t){if(this.extContentConnecting||this.extContentConnected)this.logger.debug("cannot process acceptance of a grandchild, because I am connected to a content script");else{this.logger.debug("handling a connection accepted signal targeted at a grandchild: ".concat(e.clientId));var n=this.children.find((function(t){return t.grandChildId===e.clientId}));n?(n.connected=!0,this.logger.debug("the grandchild connection for ".concat(e.clientId," is set up, forwarding the success message and the gateway port")),e.parentWindowId=this.publicWindowId,n.source.postMessage(t.data,n.origin,[e.port])):this.logger.error("cannot handle connection accepted for grandchild: ".concat(e.clientId,", because there is no grandchild with this id"))}},e.prototype.handleConnectionRejected=function(){this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),this.connectionReject&&(this.connectionReject("The platform connection was rejected. Most likely because this window was not created by a glue API call"),delete this.connectionReject)},e.prototype.handleConnectionRequest=function(e){if(this.extContentConnecting)this.logger.debug("This connection request event is targeted at the extension content");else{var t=e.source,n=e.data.glue42core;if(!n.clientType||"grandChild"!==n.clientType)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source was not opened by a glue API call");if(!n.clientId)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source did not provide a valid id");if(!this.parent)return this.rejectConnectionRequest(t,e.origin,"Cannot forward the connection request, because no direct connection to the platform was found");this.logger.debug("handling a connection request for a grandchild: ".concat(n.clientId)),this.children.push({grandChildId:n.clientId,source:t,connected:!1,origin:e.origin}),this.logger.debug("grandchild: ".concat(n.clientId," is prepared, forwarding connection request to the platform")),this.parent.postMessage(e.data,this.defaultTargetString)}},e.prototype.handleParentPing=function(e){if(this.parentReady)if(this.iAmConnected){var t={glue42core:{type:this.messages.parentReady.name}};this.extContentConnected&&(t.glue42core.extMode={windowId:this.myClientId});var n=e.source;this.logger.debug("responding to a parent ping with a ready message"),n.postMessage(t,e.origin)}else this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");else this.logger.debug("my parent is not ready, I am ignoring the parent ping")},e.prototype.setupPlatformUnloadListener=function(){var e=this;this.onMessage((function(t){"platformUnload"===t.type&&(e.logger.debug("detected a web platform unload"),e.parentReady=!1,e.notifyStatusChanged(!1,"Gateway unloaded"))}))},e.prototype.handleManualUnload=function(){var e,t,n={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};if(this.extContentConnected)return window.postMessage({glue42ExtOut:n},this.defaultTargetString);null===(t=this.port)||void 0===t||t.postMessage(n)},e.prototype.handleClientUnload=function(e){var t=e.data.glue42core,n=null===t||void 0===t?void 0:t.data.clientId;n?this.children.find((function(e){return e.grandChildId===n}))?(this.logger.debug("handling grandchild unload for id: ".concat(n)),this.children=this.children.filter((function(e){return e.grandChildId!==n}))):this.logger.warn("cannot process grand child unload, because this client is unaware of this grandchild"):this.logger.warn("cannot process grand child unload, because the provided id was not valid")},e.prototype.handlePlatformPing=function(){},e.prototype.notifyStatusChanged=function(e,t){this.iAmConnected=e,this.registry.execute("onConnectedChanged",e,t)},e.prototype.checkMessageTypeValid=function(e){return"string"===typeof e&&!!this.messages[e]},e.prototype.rejectConnectionRequest=function(e,t,n){this.rejected=!0,this.logger.error(n);var i={glue42core:{type:this.messages.connectionRejected.name}};e.postMessage(i,t)},e.prototype.requestConnectionPermissionFromExt=function(){var e=this;return this.waitForContentScript().then((function(){return Oe((function(t,n){e.extConnectionResolve=t,e.extConnectionReject=n;var i={glue42core:{type:"extSetupRequest"}};e.logger.debug("permission request to the extension content script was sent"),window.postMessage(i,e.defaultTargetString)}),e.parentPingTimeout,"Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection timed out")}))},e.prototype.handleExtConnectionResponse=function(e){var t;if(!(null===(t=e.data)||void 0===t?void 0:t.glue42core).approved)return this.extConnectionReject?this.extConnectionReject("Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection was rejected"):void 0;this.extConnectionResolve&&(this.extConnectionResolve(),delete this.extConnectionResolve),this.extContentConnecting=!0,this.parentType="extension",this.logger.debug("The extension connection was approved, proceeding.")},e.prototype.handleExtSetupRequest=function(){},e.prototype.handleGatewayDisconnect=function(){},e.prototype.handleGatewayInternalConnect=function(){},e.prototype.waitForContentScript=function(){var e;return(null===(e=window.glue42ext)||void 0===e?void 0:e.content)?Promise.resolve():Oe((function(e){window.addEventListener("Glue42EXTReady",(function(){e()}))}),this.connectionRequestTimeout,"The content script was available, but was never heard to be ready")},e.prototype.connect=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.settings.port?[4,this.initiateInternalConnection()]:[3,2];case 1:return e.sent(),this.logger.debug("internal web platform connection completed"),[2];case 2:return this.logger.debug("opening a client web platform connection"),[4,this.findParent()];case 3:return e.sent(),[4,this.initiateRemoteConnection(this.parent)];case 4:return e.sent(),this.logger.debug("the client is connected"),[2]}}))}))},e.prototype.findParent=function(){var e;return r(this,void 0,void 0,(function(){var t,n,i,r;return o(this,(function(o){switch(o.label){case 0:if(t="Cannot initiate glue, because this window was not opened or created by a glue client",n=this.getPossibleParentsInWindow(window),i=this.getPossibleParentsOutsideWindow(null===(e=window.top)||void 0===e?void 0:e.opener,window.top),!(r=new Set(s(s([],n,!0),i,!0))).size&&!this.extContentAvailable)throw new Error(t);return r.size||!this.extContentAvailable?[3,2]:[4,this.requestConnectionPermissionFromExt()];case 1:case 4:return o.sent(),[2];case 2:return[4,this.isParentCheckSuccess(this.confirmParent(Array.from(r)))];case 3:if(o.sent().success)return this.logger.debug("The default parent was found!"),[2];if(!this.extContentAvailable)throw new Error(t);return[4,this.requestConnectionPermissionFromExt()]}}))}))},e.prototype.getPossibleParentsInWindow=function(e){return e&&e!==e.top?s([e.parent],this.getPossibleParentsInWindow(e.parent),!0):[]},e.prototype.getPossibleParentsOutsideWindow=function(e,t){return e&&t&&e!==t?s(s([e],this.getPossibleParentsInWindow(e),!0),this.getPossibleParentsOutsideWindow(e.opener,e),!0):[]},e.prototype.confirmParent=function(e){var t=this,n="Cannot initiate glue, because this window was not opened or created by a glue client",i=Oe((function(n){t.parentPingResolve=n;var i={glue42core:{type:t.messages.platformPing.name}};t.parentPingInterval=setInterval((function(){e.forEach((function(e){e.postMessage(i,t.defaultTargetString)}))}),1e3)}),this.parentPingTimeout,n);return i.catch((function(){t.parentPingInterval&&(clearInterval(t.parentPingInterval),delete t.parentPingInterval)})),i},e.prototype.getMyWindowId=function(){var e;return"workspace"===this.parentType?window.name.substring(0,window.name.indexOf("#wsp")):window===window.top?(null===(e=window.name)||void 0===e?void 0:e.includes("g42"))?window.name:(this.selfAssignedWindowId=this.selfAssignedWindowId||"g42-".concat(Pe()),this.selfAssignedWindowId):void 0},e}(),De=function(e,t){var n=e;return function(){0===--n&&t()}},Fe=function(){function e(e){void 0===e&&(e=0),this.minSequenceInterval=e,this.queue=[],this.isExecutingQueue=!1}return e.prototype.enqueue=function(e){var t=this;return new Promise((function(n,i){t.queue.push({action:e,resolve:n,reject:i}),t.executeQueue()}))},e.prototype.executeQueue=function(){return r(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(i){switch(i.label){case 0:if(this.isExecutingQueue)return[2];this.isExecutingQueue=!0,i.label=1;case 1:if(!this.queue.length)return[3,7];if(!(e=this.queue.shift()))return this.isExecutingQueue=!1,[2];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,e.action()];case 3:return t=i.sent(),e.resolve(t),[3,5];case 4:return n=i.sent(),e.reject(n),[3,5];case 5:return[4,this.intervalBreak()];case 6:return i.sent(),[3,1];case 7:return this.isExecutingQueue=!1,[2]}}))}))},e.prototype.intervalBreak=function(){var e=this;return new Promise((function(t){return setTimeout(t,e.minSequenceInterval)}))},e}(),We=function(){function e(e,t){if(this.settings=e,this.logger=t,this.messageHandlers={},this.ids=1,this.registry=D(),this._connected=!1,this.isTrace=!1,this._swapTransport=!1,this._switchInProgress=!1,this._transportSubscriptions=[],this._sequelizer=new Fe,(e=e||{}).reconnectAttempts=e.reconnectAttempts||10,e.reconnectInterval=e.reconnectInterval||1e3,e.inproc)this.transport=new F(e.inproc,t.subLogger("inMemory"));else if(e.sharedWorker)this.transport=new W(e.sharedWorker,t.subLogger("shared-worker"));else if(e.webPlatform)this.transport=new je(e.webPlatform,t.subLogger("web-platform"),e.identity);else{if(void 0===e.ws)throw new Error("No connection information specified");this.transport=new z(e,t.subLogger("ws"))}this.isTrace=t.canPublish("trace"),t.debug("starting with ".concat(this.transport.name()," transport")),this.protocol=new Re(this,e,t.subLogger("protocol"));var n=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),i=this.transport.onMessage(this.handleTransportMessage.bind(this));this._transportSubscriptions.push(n),this._transportSubscriptions.push(i),this._defaultTransport=this.transport}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;return null===(e=this.protocol)||void 0===e?void 0:e.protocolVersion},enumerable:!1,configurable:!0}),e.prototype.switchTransport=function(e){return r(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){return[2,this._sequelizer.enqueue((function(){return r(t,void 0,void 0,(function(){var t,n,i;return o(this,(function(r){switch(r.label){case 0:if(!e||"object"!==typeof e)throw new Error("Cannot switch transports, because the settings are missing or invalid.");if("undefined"===typeof e.type)throw new Error("Cannot switch the transport, because the type is not defined");return this.logger.trace("Starting transport switch with settings: ".concat(JSON.stringify(e))),t="secondary"===e.type?this.getNewSecondaryTransport(e):this._defaultTransport,this._targetTransport=t,this._targetAuth="secondary"===e.type?this.getNewSecondaryAuth(e):this._defaultAuth,n=this.verifyConnection(),this._swapTransport=!0,this._switchInProgress=!0,this.logger.trace("The new transport has been set, closing the current transport"),[4,this.transport.close()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,n];case 3:return r.sent(),i=this.transport===t,this.logger.info("The reconnection after the switch was completed. Was the switch a success: ".concat(i)),this._switchInProgress=!1,[2,{success:i}];case 4:return r.sent(),this.logger.info("The reconnection after the switch timed out, reverting back to the default transport."),this.switchTransport({type:"default"}),this._switchInProgress=!1,[2,{success:!1}];case 5:return[2]}}))}))}))]}))}))},e.prototype.onLibReAnnounced=function(e){return this.registry.add("libReAnnounced",e)},e.prototype.setLibReAnnounced=function(e){this.registry.execute("libReAnnounced",e)},e.prototype.send=function(e,t){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){var n=this.protocol.createObjectMessage(e);return this.isTrace&&this.logger.trace(">> ".concat(JSON.stringify(n))),this.transport.sendObject(n,t)}var i=this.protocol.createStringMessage(e);return this.isTrace&&this.logger.trace(">> ".concat(i)),this.transport.send(i,t)},e.prototype.on=function(e,t){e=e.toLowerCase(),void 0===this.messageHandlers[e]&&(this.messageHandlers[e]={});var n=this.ids++;return this.messageHandlers[e][n]=t,{type:e,id:n}},e.prototype.off=function(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.protocol.isLoggedIn},enumerable:!1,configurable:!0}),e.prototype.connected=function(e){var t=this;return this.protocol.loggedIn((function(){var n=t.transport.name();e(n)}))},e.prototype.disconnected=function(e){return this.registry.add("disconnected",e)},e.prototype.login=function(e,t){return r(this,void 0,void 0,(function(){var n,i,r;return o(this,(function(o){switch(o.label){case 0:this._defaultAuth||(this._defaultAuth=e),this._swapTransport&&(this.logger.trace("Detected a transport swap, swapping transports"),n=this.transportSwap(),e=null!==n&&void 0!==n?n:e),this.logger.trace("Starting login for transport: ".concat(this.transport.name()," and auth ").concat(JSON.stringify(e))),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.transport.open()];case 2:return o.sent(),this.logger.trace("Transport: ".concat(this.transport.name()," opened, logging in")),G("connection").mark("transport-opened"),[4,this.protocol.login(e,t)];case 3:return i=o.sent(),this.logger.trace("Logged in with identity: ".concat(JSON.stringify(i))),G("connection").mark("protocol-logged-in"),[2,i];case 4:throw r=o.sent(),this._switchInProgress&&(this.logger.trace("An error while logging in after a transport swap, preparing a default swap."),this.prepareDefaultSwap()),new Error(r);case 5:return[2]}}))}))},e.prototype.logout=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.protocol.logout()];case 1:return e.sent(),[4,this.transport.close()];case 2:return e.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this.protocol.loggedIn(e)},e.prototype.domain=function(e,t,n){return this.protocol.domain(e,this.logger.subLogger("domain=".concat(e)),t,n)},e.prototype.authToken=function(){return this.protocol.authToken()},e.prototype.reconnect=function(){return this.transport.reconnect()},e.prototype.distributeMessage=function(e,t){var n=this,i=this.messageHandlers[t.toLowerCase()];void 0!==i&&Object.keys(i).forEach((function(t){var r=i[t];if(void 0!==r)try{r(e)}catch(o){try{n.logger.error("Message handler failed with ".concat(o.stack),o)}catch(s){console.log("Message handler failed",o)}}}))},e.prototype.handleConnectionChanged=function(e){this._connected!==e&&(this._connected=e,e?(this.settings.replaySpecs&&this.settings.replaySpecs.length&&(this.replayer=new Ne(this.settings.replaySpecs),this.replayer.init(this)),this.registry.execute("connected")):this.registry.execute("disconnected"))},e.prototype.handleTransportMessage=function(e){var t;t="string"===typeof e?this.protocol.processStringMessage(e):this.protocol.processObjectMessage(e),this.isTrace&&this.logger.trace("<< ".concat(JSON.stringify(t))),this.distributeMessage(t.msg,t.msgType)},e.prototype.verifyConnection=function(){var e=this;return Oe((function(t){var n,i=De(2,(function(){n&&n(),t()}));n=e.onLibReAnnounced((function(e){return"interop"===e.name||"contexts"===e.name?i():void 0}))}),1e4,"Transport switch timed out waiting for all libraries to be re-announced")},e.prototype.getNewSecondaryTransport=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.url))throw new Error("Missing secondary transport URL.");return new z(Object.assign({},this.settings,{ws:e.transportConfig.url,reconnectAttempts:1}),this.logger.subLogger("ws-secondary"))},e.prototype.getNewSecondaryAuth=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.auth))throw new Error("Missing secondary transport auth information.");return e.transportConfig.auth},e.prototype.transportSwap=function(){if(this._swapTransport=!1,this._targetTransport&&this._targetAuth){this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport=this._targetTransport;var e=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),t=this.transport.onMessage(this.handleTransportMessage.bind(this));return this._transportSubscriptions.push(e),this._transportSubscriptions.push(t),this._targetAuth}this.logger.warn("Error while switching transports - either the target transport or auth is not defined: transport defined -> ".concat(!!this._defaultTransport,", auth defined -> ").concat(!!this._targetAuth,". Staying on the current one."))},e.prototype.prepareDefaultSwap=function(){var e=this;this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport.close().catch((function(t){return e.logger.warn("Error closing the ".concat(e.transport.name()," transport after a failed connection attempt: ").concat(JSON.stringify(t)))})),this._targetTransport=this._defaultTransport,this._targetAuth=this._defaultAuth,this._swapTransport=!0},e}(),Le=["trace","debug","info","warn","error","off"],Ue=function(){function e(e,t,n){this.name=e,this.parent=t,this.subLoggers=[],this.logFn=console,this.customLogFn=!1,this.name=e,this.path=t?"".concat(t.path,".").concat(e):e,this.loggerFullName="[".concat(this.path,"]"),this.includeTimeAndLevel=!n,n&&(this.logFn=n,this.customLogFn=!0)}return e.prototype.subLogger=function(t){var n=this.subLoggers.filter((function(e){return e.name===t}))[0];if(void 0!==n)return n;Object.keys(this).forEach((function(e){if(e===t)throw new Error("This sub logger name is not allowed.")}));var i=new e(t,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(i),i},e.prototype.publishLevel=function(e){var t;return e&&(this._publishLevel=e),this._publishLevel||(null===(t=this.parent)||void 0===t?void 0:t.publishLevel())},e.prototype.consoleLevel=function(e){var t;return e&&(this._consoleLevel=e),this._consoleLevel||(null===(t=this.parent)||void 0===t?void 0:t.consoleLevel())},e.prototype.log=function(e,t,n){this.publishMessage(t||"info",e,n)},e.prototype.trace=function(e){this.log(e,"trace")},e.prototype.debug=function(e){this.log(e,"debug")},e.prototype.info=function(e){this.log(e,"info")},e.prototype.warn=function(e){this.log(e,"warn")},e.prototype.error=function(e,t){this.log(e,"error")},e.prototype.canPublish=function(e,t){return Le.indexOf(e)>=Le.indexOf(t||this.consoleLevel()||"trace")},e.prototype.publishMessage=function(t,n,i){var r=this.loggerFullName;if("error"===t&&!i){var o=new Error;o.stack&&(n=n+"\n"+o.stack.split("\n").slice(3).join("\n"))}if(this.canPublish(t,this.publishLevel())){var s=e.Interop;if(s)try{s.methods({name:e.InteropMethodName}).length>0&&s.invoke(e.InteropMethodName,{msg:"".concat(n),logger:r,level:t})}catch(os){}}if(this.canPublish(t)){var a="";if(this.includeTimeAndLevel){var c=new Date,u="".concat(c.getHours(),":").concat(c.getMinutes(),":").concat(c.getSeconds(),":").concat(c.getMilliseconds());a="[".concat(u,"] [").concat(t,"] ")}var d="".concat(a).concat(r,": ").concat(n);switch(t){case"trace":this.logFn.debug(d);break;case"debug":this.logFn.debug?this.logFn.debug(d):this.logFn.log(d);break;case"info":this.logFn.info(d);break;case"warn":this.logFn.warn(d);break;case"error":this.logFn.error(d,i)}}},e.InteropMethodName="T42.AppLogger.Log",e}(),qe="create-context",Be="created",Ge="destroyed",He="context-created",ze="context-added",Ve="subscribe-context",Je="subscribed-context",Ke="unsubscribe-context",$e="destroy-context",Qe="context-destroyed",Ye="update-context",Xe="context-updated",Ze="joined",et={get name(){return"context"},get types(){return[qe,Be,Ge,He,ze,Ve,Je,Ke,$e,Qe,Ye,Xe,Ze]}},tt="6.1.0";function nt(e,t,n){var i,r,o,s,a;if(L.isNode()){var c={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}._GD_STARTING_CONTEXT_;if(c)try{a=JSON.parse(c)}catch(y){}}function u(){var i,r,o,s,c,u,d,h,p,f,g,m=e.gateway,v=null!==(i=null===m||void 0===m?void 0:m.protocolVersion)&&void 0!==i?i:3,y=null===m||void 0===m?void 0:m.reconnectInterval,w=null===m||void 0===m?void 0:m.reconnectAttempts,b="ws://localhost:8385",_=null===m||void 0===m?void 0:m.ws,I=null===m||void 0===m?void 0:m.sharedWorker,C=null===m||void 0===m?void 0:m.inproc,S=null!==(r=null===m||void 0===m?void 0:m.webPlatform)&&void 0!==r?r:void 0;n&&(_=n.gwURL),L.isNode()&&a&&a.gwURL&&(_=a.gwURL),_||I||C||(_=b);var k=l(),x=k;"undefined"!==typeof n?(h=n.windowId,p=n.pid,n.env&&(f=n.env.env,g=n.env.region),x=null!==(o=n.application)&&void 0!==o?o:"glue-app",d=n.appInstanceId):L.isNode()?(p=process.pid,a&&(f=a.env,g=a.region,d=a.instanceId)):"undefined"!==typeof(null===window||void 0===window?void 0:window.glue42electron)&&(h=null===window||void 0===window?void 0:window.glue42electron.instanceId,p=null===window||void 0===window?void 0:window.glue42electron.pid,f=null===window||void 0===window?void 0:window.glue42electron.env,g=null===window||void 0===window?void 0:window.glue42electron.region,x=null!==(s=null===window||void 0===window?void 0:window.glue42electron.application)&&void 0!==s?s:"glue-app",d=null===window||void 0===window?void 0:window.glue42electron.instanceId);var T=null!==(u=null===(c=e.gateway)||void 0===c?void 0:c.replaySpecs)&&void 0!==u?u:[];T.push(et);var A={application:x,applicationName:k,windowId:h,instance:d,process:p,region:g,environment:f,api:t.version||tt};return e.identity&&(A=Object.assign(A,e.identity)),{identity:A,reconnectInterval:y,ws:_,sharedWorker:I,webPlatform:S,inproc:C,protocolVersion:v,reconnectAttempts:w,replaySpecs:T}}function d(){return"undefined"===typeof e.contexts||"boolean"===typeof e.contexts&&e.contexts?{reAnnounceKnownContexts:!0}:"object"===typeof e.contexts&&Object.assign({},{reAnnounceKnownContexts:!0},e.contexts)}function l(){if(e.application)return e.application;if(n)return n.applicationName;if("undefined"!==typeof window&&"undefined"!==typeof window.glue42electron)return window.glue42electron.application;var t=Pe();return L.isNode()?a?a.applicationConfig.name:"NodeJS"+t:"undefined"!==typeof window&&"undefined"!==typeof document?document.title+" (".concat(t,")"):t}function h(){var t,n,i;return"string"===typeof e.auth?{token:e.auth}:e.auth?e.auth:L.isNode()&&a&&a.gwToken?{gatewayToken:a.gwToken}:(null===(t=e.gateway)||void 0===t?void 0:t.webPlatform)||(null===(n=e.gateway)||void 0===n?void 0:n.inproc)||(null===(i=e.gateway)||void 0===i?void 0:i.sharedWorker)?{username:"glue42",password:"glue42"}:void 0}function p(){var t,i,r,o=e.logger,s="warn";return o||(o=s),n&&(r=n.consoleLogLevel),"string"===typeof o?{console:null!==r&&void 0!==r?r:o,publish:s}:{console:null!==(t=null!==r&&void 0!==r?r:o.console)&&void 0!==t?t:s,publish:null!==(i=o.publish)&&void 0!==i?i:s}}var f=u(),g=l();if("undefined"!==typeof window){var m=window,v=m.htmlContainer?"".concat(m.htmlContainer.containerName,".").concat(m.htmlContainer.application):null===(i=null===m||void 0===m?void 0:m.glue42gd)||void 0===i?void 0:i.application;v&&(g=v)}return{bus:null!==(r=e.bus)&&void 0!==r&&r,application:g,auth:h(),logger:p(),connection:f,metrics:null===(o=e.metrics)||void 0===o||o,contexts:d(),version:t.version||tt,libs:null!==(s=t.libs)&&void 0!==s?s:[],customLogger:e.customLogger}}var it=function(){function e(e,t,n,i){this.updateCallbacks={},this.contextId=e,this.name=t,this.isAnnounced=n,this.activityId=i,this.context={}}return e.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},e.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},e}(),rt={};!function(e,t){var n=200,i="__lodash_hash_undefined__",r=9007199254740991,o="[object Arguments]",s="[object Array]",a="[object Boolean]",c="[object Date]",u="[object Error]",d="[object Function]",l="[object GeneratorFunction]",h="[object Map]",p="[object Number]",f="[object Object]",g="[object Promise]",m="[object RegExp]",v="[object Set]",y="[object String]",w="[object Symbol]",b="[object WeakMap]",_="[object ArrayBuffer]",I="[object DataView]",C="[object Float32Array]",S="[object Float64Array]",k="[object Int8Array]",x="[object Int16Array]",T="[object Int32Array]",A="[object Uint8Array]",E="[object Uint8ClampedArray]",P="[object Uint16Array]",M="[object Uint32Array]",R=/[\\^$.*+?()[\]{}|]/g,O=/\w*$/,j=/^\[object .+?Constructor\]$/,D=/^(?:0|[1-9]\d*)$/,F={};F[o]=F[s]=F[_]=F[I]=F[a]=F[c]=F[C]=F[S]=F[k]=F[x]=F[T]=F[h]=F[p]=F[f]=F[m]=F[v]=F[y]=F[w]=F[A]=F[E]=F[P]=F[M]=!0,F[u]=F[d]=F[b]=!1;var W="object"==typeof N&&N&&N.Object===Object&&N,L="object"==typeof self&&self&&self.Object===Object&&self,U=W||L||Function("return this")(),q=t&&!t.nodeType&&t,B=q&&e&&!e.nodeType&&e,G=B&&B.exports===q;function H(e,t){return e.set(t[0],t[1]),e}function z(e,t){return e.add(t),e}function V(e,t){for(var n=-1,i=e?e.length:0;++n<i&&!1!==t(e[n],n,e););return e}function J(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}function K(e,t,n,i){var r=-1,o=e?e.length:0;for(i&&o&&(n=e[++r]);++r<o;)n=t(n,e[r],r,e);return n}function $(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}function Q(e,t){return null==e?void 0:e[t]}function Y(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}function X(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}function Z(e,t){return function(n){return e(t(n))}}function ee(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var te=Array.prototype,ne=Function.prototype,ie=Object.prototype,re=U["__core-js_shared__"],oe=function(){var e=/[^.]+$/.exec(re&&re.keys&&re.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),se=ne.toString,ae=ie.hasOwnProperty,ce=ie.toString,ue=RegExp("^"+se.call(ae).replace(R,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),de=G?U.Buffer:void 0,le=U.Symbol,he=U.Uint8Array,pe=Z(Object.getPrototypeOf,Object),fe=Object.create,ge=ie.propertyIsEnumerable,me=te.splice,ve=Object.getOwnPropertySymbols,ye=de?de.isBuffer:void 0,we=Z(Object.keys,Object),be=xt(U,"DataView"),_e=xt(U,"Map"),Ie=xt(U,"Promise"),Ce=xt(U,"Set"),Se=xt(U,"WeakMap"),ke=xt(Object,"create"),xe=Dt(be),Te=Dt(_e),Ae=Dt(Ie),Ee=Dt(Ce),Pe=Dt(Se),Me=le?le.prototype:void 0,Re=Me?Me.valueOf:void 0;function Ne(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Oe(){this.__data__=ke?ke(null):{}}function je(e){return this.has(e)&&delete this.__data__[e]}function De(e){var t=this.__data__;if(ke){var n=t[e];return n===i?void 0:n}return ae.call(t,e)?t[e]:void 0}function Fe(e){var t=this.__data__;return ke?void 0!==t[e]:ae.call(t,e)}function We(e,t){return this.__data__[e]=ke&&void 0===t?i:t,this}function Le(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Ue(){this.__data__=[]}function qe(e){var t=this.__data__,n=ot(t,e);return!(n<0)&&(n==t.length-1?t.pop():me.call(t,n,1),!0)}function Be(e){var t=this.__data__,n=ot(t,e);return n<0?void 0:t[n][1]}function Ge(e){return ot(this.__data__,e)>-1}function He(e,t){var n=this.__data__,i=ot(n,e);return i<0?n.push([e,t]):n[i][1]=t,this}function ze(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Ve(){this.__data__={hash:new Ne,map:new(_e||Le),string:new Ne}}function Je(e){return kt(this,e).delete(e)}function Ke(e){return kt(this,e).get(e)}function $e(e){return kt(this,e).has(e)}function Qe(e,t){return kt(this,e).set(e,t),this}function Ye(e){this.__data__=new Le(e)}function Xe(){this.__data__=new Le}function Ze(e){return this.__data__.delete(e)}function et(e){return this.__data__.get(e)}function tt(e){return this.__data__.has(e)}function nt(e,t){var i=this.__data__;if(i instanceof Le){var r=i.__data__;if(!_e||r.length<n-1)return r.push([e,t]),this;i=this.__data__=new ze(r)}return i.set(e,t),this}function it(e,t){var n=Ut(e)||Lt(e)?$(e.length,String):[],i=n.length,r=!!i;for(var o in e)!t&&!ae.call(e,o)||r&&("length"==o||Rt(o,i))||n.push(o);return n}function rt(e,t,n){var i=e[t];ae.call(e,t)&&Wt(i,n)&&(void 0!==n||t in e)||(e[t]=n)}function ot(e,t){for(var n=e.length;n--;)if(Wt(e[n][0],t))return n;return-1}function st(e,t){return e&&It(t,Kt(t),e)}function at(e,t,n,i,r,s,a){var c;if(i&&(c=s?i(e,r,s,a):i(e)),void 0!==c)return c;if(!Vt(e))return e;var u=Ut(e);if(u){if(c=Et(e),!t)return _t(e,c)}else{var h=At(e),p=h==d||h==l;if(Gt(e))return pt(e,t);if(h==f||h==o||p&&!s){if(Y(e))return s?e:{};if(c=Pt(p?{}:e),!t)return Ct(e,st(c,e))}else{if(!F[h])return s?e:{};c=Mt(e,h,at,t)}}a||(a=new Ye);var g=a.get(e);if(g)return g;if(a.set(e,c),!u)var m=n?St(e):Kt(e);return V(m||e,(function(r,o){m&&(r=e[o=r]),rt(c,o,at(r,t,n,i,o,e,a))})),c}function ct(e){return Vt(e)?fe(e):{}}function ut(e,t,n){var i=t(e);return Ut(e)?i:J(i,n(e))}function dt(e){return ce.call(e)}function lt(e){return!(!Vt(e)||Ot(e))&&(Ht(e)||Y(e)?ue:j).test(Dt(e))}function ht(e){if(!jt(e))return we(e);var t=[];for(var n in Object(e))ae.call(e,n)&&"constructor"!=n&&t.push(n);return t}function pt(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}function ft(e){var t=new e.constructor(e.byteLength);return new he(t).set(new he(e)),t}function gt(e,t){var n=t?ft(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function mt(e,t,n){return K(t?n(X(e),!0):X(e),H,new e.constructor)}function vt(e){var t=new e.constructor(e.source,O.exec(e));return t.lastIndex=e.lastIndex,t}function yt(e,t,n){return K(t?n(ee(e),!0):ee(e),z,new e.constructor)}function wt(e){return Re?Object(Re.call(e)):{}}function bt(e,t){var n=t?ft(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function _t(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}function It(e,t,n,i){n||(n={});for(var r=-1,o=t.length;++r<o;){var s=t[r],a=i?i(n[s],e[s],s,n,e):void 0;rt(n,s,void 0===a?e[s]:a)}return n}function Ct(e,t){return It(e,Tt(e),t)}function St(e){return ut(e,Kt,Tt)}function kt(e,t){var n=e.__data__;return Nt(t)?n["string"==typeof t?"string":"hash"]:n.map}function xt(e,t){var n=Q(e,t);return lt(n)?n:void 0}Ne.prototype.clear=Oe,Ne.prototype.delete=je,Ne.prototype.get=De,Ne.prototype.has=Fe,Ne.prototype.set=We,Le.prototype.clear=Ue,Le.prototype.delete=qe,Le.prototype.get=Be,Le.prototype.has=Ge,Le.prototype.set=He,ze.prototype.clear=Ve,ze.prototype.delete=Je,ze.prototype.get=Ke,ze.prototype.has=$e,ze.prototype.set=Qe,Ye.prototype.clear=Xe,Ye.prototype.delete=Ze,Ye.prototype.get=et,Ye.prototype.has=tt,Ye.prototype.set=nt;var Tt=ve?Z(ve,Object):$t,At=dt;function Et(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&ae.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Pt(e){return"function"!=typeof e.constructor||jt(e)?{}:ct(pe(e))}function Mt(e,t,n,i){var r=e.constructor;switch(t){case _:return ft(e);case a:case c:return new r(+e);case I:return gt(e,i);case C:case S:case k:case x:case T:case A:case E:case P:case M:return bt(e,i);case h:return mt(e,i,n);case p:case y:return new r(e);case m:return vt(e);case v:return yt(e,i,n);case w:return wt(e)}}function Rt(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||D.test(e))&&e>-1&&e%1==0&&e<t}function Nt(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function Ot(e){return!!oe&&oe in e}function jt(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ie)}function Dt(e){if(null!=e){try{return se.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Ft(e){return at(e,!0,!0)}function Wt(e,t){return e===t||e!==e&&t!==t}function Lt(e){return Bt(e)&&ae.call(e,"callee")&&(!ge.call(e,"callee")||ce.call(e)==o)}(be&&At(new be(new ArrayBuffer(1)))!=I||_e&&At(new _e)!=h||Ie&&At(Ie.resolve())!=g||Ce&&At(new Ce)!=v||Se&&At(new Se)!=b)&&(At=function(e){var t=ce.call(e),n=t==f?e.constructor:void 0,i=n?Dt(n):void 0;if(i)switch(i){case xe:return I;case Te:return h;case Ae:return g;case Ee:return v;case Pe:return b}return t});var Ut=Array.isArray;function qt(e){return null!=e&&zt(e.length)&&!Ht(e)}function Bt(e){return Jt(e)&&qt(e)}var Gt=ye||Qt;function Ht(e){var t=Vt(e)?ce.call(e):"";return t==d||t==l}function zt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function Vt(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Jt(e){return!!e&&"object"==typeof e}function Kt(e){return qt(e)?it(e):ht(e)}function $t(){return[]}function Qt(){return!1}e.exports=Ft}({get exports(){return rt},set exports(e){rt=e}},rt);var ot=rt;function st(e,t,n){try{if((null===n||void 0===n?void 0:n.canPublish("trace"))&&(null===n||void 0===n||n.trace("applying context delta ".concat(JSON.stringify(t)," on context ").concat(JSON.stringify(e)))),!t)return e;if(t.reset)return e=i({},t.reset);if(e=at(e,void 0),t.commands){for(var r=0,o=t.commands;r<o.length;r++){var s=o[r];"remove"===s.type?ht(e,s.path):"set"===s.type&&dt(e,s.value,s.path)}return e}var a=t.added,c=t.updated,u=t.removed;return a&&Object.keys(a).forEach((function(t){e[t]=a[t]})),c&&Object.keys(c).forEach((function(t){ct(t,e,c)})),u&&u.forEach((function(t){delete e[t]})),e}catch(d){return null===n||void 0===n||n.error("error applying context delta ".concat(JSON.stringify(t)," on context ").concat(JSON.stringify(e)),d),e}}function at(e,t){return ot(e)}var ct=function(e,t,n){var i=n[e];if(void 0===i)return t;var r=t[e];return r&&i?"string"===typeof r||"number"===typeof r||"boolean"===typeof r||"string"===typeof i||"number"===typeof i||"boolean"===typeof i||Array.isArray(r)||Array.isArray(i)?(t[e]=i,t):(t[e]=Object.assign({},r,i),t):(t[e]=i,t)};function ut(e,t){if(e===t)return!0;if(!(e instanceof Object)||!(t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n]){if("object"!==typeof e[n])return!1;if(!ut(e[n],t[n]))return!1}}for(var n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}function dt(e,t,n){var i,r=n.split(".");for(i=0;i<r.length-1;i++)e[r[i]]||(e[r[i]]={}),"object"!==typeof e[r[i]]&&(e[r[i]]={}),e=e[r[i]];e[r[i]]=t}function lt(e,t){return Object.keys(t).every((function(n){return"object"===typeof t[n]?lt((null===e||void 0===e?void 0:e[n])||{},t[n]||{}):t[n]===(null===e||void 0===e?void 0:e[n])}))}function ht(e,t){var n,i=t.split(".");for(n=0;n<i.length-1;n++){if(!e[i[n]])return;e=e[i[n]]}delete e[i[n]]}var pt,ft=function(){function e(e){var t,n=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._creationPromises={},this._contextNameToId={},this._contextIdToName={},this._protocolVersion=void 0,this._contextsTempCache={},this._contextsSubscriptionsCache=[],this._connection=e.connection,this._logger=e.logger,this._trackAllContexts=e.trackAllContexts,this._reAnnounceKnownContexts=e.reAnnounceKnownContexts,this._gw3Session=this._connection.domain("global",[He,Je,Qe,Xe]),this._gw3Session.disconnected(this.resetState.bind(this)),this._gw3Session.onJoined((function(e){if(e)return n._reAnnounceKnownContexts?void n.reInitiateState().then((function(){return n._connection.setLibReAnnounced({name:"contexts"})})):n._connection.setLibReAnnounced({name:"contexts"})})),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(t=this._connection.replayer)||void 0===t||t.drain(et.name,(function(e){var t=e.type;t&&(t===He||t===ze||t===Be?n.handleContextCreatedMessage(e):t===Je||t===Xe||t===Ze?n.handleContextUpdatedMessage(e):t!==Qe&&t!==Ge||n.handleContextDestroyedMessage(e))}))}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;if(!this._protocolVersion){var t=this._connection.availableDomains.find((function(e){return"context"===e.uri}));this._protocolVersion=null!==(e=null===t||void 0===t?void 0:t.version)&&void 0!==e?e:1}return this._protocolVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this.protocolVersion>=2},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){for(var e=0,t=this._gw3Subscriptions;e<t.length;e++){var n=t[e];this._connection.off(n)}for(var i in this._gw3Subscriptions.length=0,this._contextNameToData)this._contextNameToId.hasOwnProperty(i)&&delete this._contextNameToData[i]},e.prototype.createContext=function(e,t){var n=this;return e in this._creationPromises||(this._creationPromises[e]=this._gw3Session.send({type:qe,domain:"global",name:e,data:t,lifetime:"retained"}).then((function(i){n._contextNameToId[e]=i.context_id,n._contextIdToName[i.context_id]=e;var r=n._contextNameToData[e]||new it(i.context_id,e,!0,void 0);return r.isAnnounced=!0,r.name=e,r.contextId=i.context_id,r.context=i.data||at(t),r.hasReceivedSnapshot=!0,n._contextNameToData[e]=r,delete n._creationPromises[e],i.context_id}))),this._creationPromises[e]},e.prototype.all=function(){var e=this;return Object.keys(this._contextNameToData).filter((function(t){return e._contextNameToData[t].isAnnounced}))},e.prototype.update=function(e,t){var n;return r(this,void 0,void 0,(function(){var i,r,s,a=this;return o(this,(function(o){switch(o.label){case 0:return t&&(t=at(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:o.sent(),o.label=2;case 2:return(i=this._contextNameToData[e])&&i.isAnnounced?(r=i.context,i.hasCallbacks()?[3,4]:[4,this.get(i.name)]):[2,this.createContext(e,t)];case 3:r=o.sent(),o.label=4;case 4:return s=2===this.protocolVersion?this.calculateContextDeltaV2(r,t):this.calculateContextDeltaV1(r,t),Object.keys(s.added).length||Object.keys(s.updated).length||s.removed.length||(null===(n=s.commands)||void 0===n?void 0:n.length)?[2,this._gw3Session.send({type:Ye,domain:"global",context_id:i.contextId,delta:s},{},{skipPeerId:!1}).then((function(e){a.handleUpdated(i,s,{updaterId:e.peer_id})}))]:[2,Promise.resolve()]}}))}))},e.prototype.set=function(e,t){return r(this,void 0,void 0,(function(){var n,i=this;return o(this,(function(r){switch(r.label){case 0:return t&&(t=at(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:r.sent(),r.label=2;case 2:return(n=this._contextNameToData[e])&&n.isAnnounced?[2,this._gw3Session.send({type:Ye,domain:"global",context_id:n.contextId,delta:{reset:t}},{},{skipPeerId:!1}).then((function(e){i.handleUpdated(n,{reset:t,added:{},removed:[],updated:{}},{updaterId:e.peer_id})}))]:[2,this.createContext(e,t)]}}))}))},e.prototype.setPath=function(e,t,n){return this.setPathSupported?this.setPaths(e,[{path:t,value:n}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")},e.prototype.setPaths=function(e,t){return r(this,void 0,void 0,(function(){var n,i,r,s,a,c,u,d,l=this;return o(this,(function(o){switch(o.label){case 0:return this.setPathSupported?(t&&(t=at(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2]):[2,Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later")];case 1:o.sent(),o.label=2;case 2:if(!(n=this._contextNameToData[e])||!n.isAnnounced){for(i={},r=0,s=t;r<s.length;r++)d=s[r],dt(i,d.value,d.path);return[2,this.createContext(e,i)]}for(a=[],c=0,u=t;c<u.length;c++)null===(d=u[c]).value?a.push({type:"remove",path:d.path}):a.push({type:"set",path:d.path,value:d.value});return[2,this._gw3Session.send({type:Ye,domain:"global",context_id:n.contextId,delta:{commands:a}},{},{skipPeerId:!1}).then((function(e){l.handleUpdated(n,{added:{},removed:[],updated:{},commands:a},{updaterId:e.peer_id})}))]}}))}))},e.prototype.get=function(e){var t;return r(this,void 0,void 0,(function(){var n,i,r=this;return o(this,(function(o){switch(o.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:o.sent(),o.label=2;case 2:return(n=this._contextNameToData[e])&&n.isAnnounced?!n||n.hasCallbacks()&&n.hasReceivedSnapshot?(i=null!==(t=null===n||void 0===n?void 0:n.context)&&void 0!==t?t:{},[2,Promise.resolve(at(i))]):[2,new Promise((function(t){r.subscribe(e,(function(e,n,i,o){r.unsubscribe(o),t(e)}))}))]:[2,Promise.resolve({})]}}))}))},e.prototype.subscribe=function(e,t,n){return r(this,void 0,void 0,(function(){var i,r,s,a,c=this;return o(this,(function(o){switch(o.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:o.sent(),o.label=2;case 2:return i="undefined"===typeof n?this._nextCallbackSubscriptionNumber:n,"undefined"===typeof n&&(this._nextCallbackSubscriptionNumber+=1),this._contextsSubscriptionsCache.every((function(e){return e.subKey!==c._nextCallbackSubscriptionNumber}))&&this._contextsSubscriptionsCache.push({contextName:e,subKey:i,callback:t}),(r=this._contextNameToData[e])&&r.isAnnounced?(s=r.hasCallbacks(),r.updateCallbacks[i]=t,s||r.joinedActivity||r.context&&r.sentExplicitSubscription?(r.hasReceivedSnapshot&&(a=at(r.context),t(a,a,[],i)),[2,Promise.resolve(i)]):[2,this.sendSubscribe(r).then((function(){return i}))]):(r=r||new it(void 0,e,!1,void 0),this._contextNameToData[e]=r,r.updateCallbacks[i]=t,[2,Promise.resolve(i)])}}))}))},e.prototype.unsubscribe=function(e){this._contextsSubscriptionsCache=this._contextsSubscriptionsCache.filter((function(t){return t.subKey!==e}));for(var t=0,n=Object.keys(this._contextNameToData);t<n.length;t++){var i=n[t],r=this._contextNameToData[i];if(!r)return;var o=r.hasCallbacks();delete r.updateCallbacks[e],r.isAnnounced&&o&&!r.hasCallbacks()&&r.sentExplicitSubscription&&this.sendUnsubscribe(r),r.isAnnounced||r.hasCallbacks()||delete this._contextNameToData[i]}},e.prototype.destroy=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:n.sent(),n.label=2;case 2:return(t=this._contextNameToData[e])?[2,this._gw3Session.send({type:$e,domain:"global",context_id:t.contextId}).then((function(e){}))]:[2,Promise.reject("context with ".concat(e," does not exist"))]}}))}))},e.prototype.handleUpdated=function(e,t,n){var i=e.context;e.context=st(e.context,t,this._logger),e.hasReceivedSnapshot=!0,this._contextNameToData[e.name]!==e||ut(i,e.context)||this.invokeUpdateCallbacks(e,t,n)},e.prototype.subscribeToContextCreatedMessages=function(){for(var e=0,t=[ze,He,Be];e<t.length;e++){var n=t[e],i=this._connection.on(n,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(i)}},e.prototype.handleContextCreatedMessage=function(e){var t=this,n=e.type;n===Be?(this._contextNameToId[e.activity_id]=e.context_id,this._contextIdToName[e.context_id]=e.activity_id):n===ze&&(this._contextNameToId[e.name]=e.context_id,this._contextIdToName[e.context_id]=e.name);var i=this._contextIdToName[e.context_id];if(!i)throw new Error("Received created event for context with unknown name: "+e.context_id);if(!this._contextNameToId[i])throw new Error("Received created event for context with unknown id: "+e.context_id);var r=this._contextNameToData[i];if(r){if(r.isAnnounced)return;if(!r.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");r.isAnnounced=!0,r.contextId=e.context_id,r.activityId=e.activity_id,r.sentExplicitSubscription||this.sendSubscribe(r)}else this._contextNameToData[i]=r=new it(e.context_id,i,!0,e.activity_id),this._trackAllContexts&&this.subscribe(i,(function(){})).then((function(e){return t._systemContextsSubKey=e}))},e.prototype.subscribeToContextUpdatedMessages=function(){for(var e=0,t=[Xe,Je,Ze];e<t.length;e++){var n=t[e],i=this._connection.on(n,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(i)}},e.prototype.handleContextUpdatedMessage=function(e){var t=e.type,n=e.context_id,i=this._contextNameToData[this._contextIdToName[n]],r=!i||!i.isAnnounced;if(t===Ze)i||(i=this._contextNameToData[e.activity_id]||new it(n,e.activity_id,!0,e.activity_id)),this._contextNameToData[e.activity_id]=i,this._contextIdToName[n]=e.activity_id,this._contextNameToId[e.activity_id]=n,i.contextId=n,i.isAnnounced=!0,i.activityId=e.activity_id,i.joinedActivity=!0;else if(!i||!i.isAnnounced)return void(t===Je?((i=i||new it(n,e.name,!0,void 0)).sentExplicitSubscription=!0,this._contextNameToData[e.name]=i,this._contextIdToName[n]=e.name,this._contextNameToId[e.name]=n):this._logger.error("Received 'update' for unknown context: ".concat(n)));var o=i.context;if(i.hasReceivedSnapshot=!0,t===Je)i.context=e.data||{};else if(t===Ze)i.context=e.context_snapshot||{};else{if(t!==Xe)throw new Error("Unrecognized context update message "+t);i.context=st(i.context,e.delta,this._logger)}!r&&ut(i.context,o)&&t!==Je||this.invokeUpdateCallbacks(i,e.delta,{updaterId:e.updater_id})},e.prototype.invokeUpdateCallbacks=function(e,t,n){if((t=t||{added:{},updated:{},reset:{},removed:[]}).commands){t.added=t.updated=t.reset={},t.removed=[];for(var i=0,r=t.commands;i<r.length;i++){var o=r[i];"remove"===o.type?(-1===o.path.indexOf(".")&&t.removed.push(o.path),dt(t.updated,null,o.path)):"set"===o.type&&dt(t.updated,o.value,o.path)}}for(var s in e.updateCallbacks)if(e.updateCallbacks.hasOwnProperty(s))try{(0,e.updateCallbacks[s])(at(e.context),at(Object.assign({},t.added||{},t.updated||{},t.reset||{})),t.removed,parseInt(s,10),n)}catch(a){this._logger.debug("callback error: "+JSON.stringify(a))}},e.prototype.subscribeToContextDestroyedMessages=function(){for(var e=0,t=[Qe,Ge];e<t.length;e++){var n=t[e],i=this._connection.on(n,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(i)}},e.prototype.handleContextDestroyedMessage=function(e){var t,n;if(e.type===Ge){if(n=e.activity_id,!(t=this._contextNameToId[n]))return void this._logger.error("Received 'destroyed' for unknown activity: ".concat(e.activity_id))}else if(t=e.context_id,!(n=this._contextIdToName[t]))return void this._logger.error("Received 'destroyed' for unknown context: ".concat(e.context_id));delete this._contextIdToName[t],delete this._contextNameToId[n];var i=this._contextNameToData[n];delete this._contextNameToData[n],i&&i.isAnnounced||this._logger.error("Received 'destroyed' for unknown context: ".concat(t))},e.prototype.sendSubscribe=function(e){return e.sentExplicitSubscription=!0,this._gw3Session.send({type:Ve,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.sendUnsubscribe=function(e){return e.sentExplicitSubscription=!1,this._gw3Session.send({type:Ke,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.calculateContextDeltaV1=function(e,t){var n={added:{},updated:{},removed:[],reset:void 0};if(e)for(var i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];-1===Object.keys(t).indexOf(o)||null===t[o]||ut(e[o],t[o])||(n.updated[o]=t[o])}for(var s=0,a=Object.keys(t);s<a.length;s++)o=a[s],e&&-1!==Object.keys(e).indexOf(o)?null===t[o]&&n.removed.push(o):null!==t[o]&&(n.added[o]=t[o]);return n},e.prototype.calculateContextDeltaV2=function(e,t){for(var n,i,r={added:{},updated:{},removed:[],reset:void 0,commands:[]},o=0,s=Object.keys(t);o<s.length;o++){var a=s[o];null!==t[a]?ut(e?e[a]:null,t[a])||null===(n=r.commands)||void 0===n||n.push({type:"set",path:a,value:t[a]}):null===(i=r.commands)||void 0===i||i.push({type:"remove",path:a})}return r},e.prototype.resetState=function(){for(var e=this,t=0,n=this._gw3Subscriptions;t<n.length;t++){var i=n[t];this._connection.off(i)}this._systemContextsSubKey&&(this.unsubscribe(this._systemContextsSubKey),delete this._systemContextsSubKey),this._gw3Subscriptions=[],this._contextNameToId={},this._contextIdToName={},delete this._protocolVersion,this._contextsTempCache=Object.keys(this._contextNameToData).reduce((function(t,n){return t[n]=e._contextNameToData[n].context,t}),{}),this._contextNameToData={}},e.prototype.reInitiateState=function(){var e;return r(this,void 0,void 0,(function(){var t,n,i,r,s,a,c=this;return o(this,(function(o){switch(o.label){case 0:return this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(e=this._connection.replayer)||void 0===e||e.drain(et.name,(function(e){var t=e.type;t&&(t===He||t===ze||t===Be?c.handleContextCreatedMessage(e):t===Je||t===Xe||t===Ze?c.handleContextUpdatedMessage(e):t!==Qe&&t!==Ge||c.handleContextDestroyedMessage(e))})),[4,Promise.all(this._contextsSubscriptionsCache.map((function(e){return c.subscribe(e.contextName,e.callback,e.subKey)})))];case 1:return o.sent(),[4,this.flushQueue()];case 2:for(i in o.sent(),t=this._contextsTempCache,n=[],t)n.push(i);r=0,o.label=3;case 3:return r<n.length?(i=n[r])in t?(s=i,"object"!==typeof this._contextsTempCache[s]||0===Object.keys(this._contextsTempCache[s]).length?[3,6]:(a=this._contextsTempCache[s],this._logger.info("Re-announcing known context: ".concat(s)),[4,this.flushQueue()])):[3,6]:[3,7];case 4:return o.sent(),[4,this.update(s,a)];case 5:o.sent(),o.label=6;case 6:return r++,[3,3];case 7:return this._contextsTempCache={},this._logger.info("Contexts are re-announced"),[2]}}))}))},e.prototype.flushQueue=function(){return new Promise((function(e){return setTimeout((function(){return e()}),0)}))},e}(),gt=function(){function e(e){this._bridge=new ft(e)}return e.prototype.all=function(){return this._bridge.all()},e.prototype.update=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.update(e,t)},e.prototype.set=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.set(e,t)},e.prototype.setPath=function(e,t,n){return this.checkName(e),this.checkPath(t),""===t?(this.checkData(n),this.set(e,n)):this._bridge.setPath(e,t,n)},e.prototype.setPaths=function(e,t){if(this.checkName(e),!Array.isArray(t))throw new Error("Please provide the paths as an array of PathValues!");for(var n=0,i=t;n<i.length;n++){var r=i[n],o=r.path,s=r.value;this.checkPath(o),""===o&&this.checkData(s)}return this._bridge.setPaths(e,t)},e.prototype.subscribe=function(e,t){var n=this;if(this.checkName(e),"function"!==typeof t)throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(e,(function(e,i,r,o,s){return t(e,i,r,(function(){return n._bridge.unsubscribe(o)}),s)})).then((function(e){return function(){n._bridge.unsubscribe(e)}}))},e.prototype.get=function(e){return this.checkName(e),this._bridge.get(e)},e.prototype.ready=function(){return Promise.resolve(this)},e.prototype.destroy=function(e){return this.checkName(e),this._bridge.destroy(e)},Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this._bridge.setPathSupported},enumerable:!1,configurable:!0}),e.prototype.checkName=function(e){if("string"!==typeof e||""===e)throw new Error("Please provide the name as a non-empty string!")},e.prototype.checkPath=function(e){if("string"!==typeof e)throw new Error("Please provide the path as a dot delimited string!")},e.prototype.checkData=function(e){if("object"!==typeof e)throw new Error("Please provide the data as an object!")},e}();function mt(e,t,n){return"function"!==typeof t&&"function"!==typeof n?e:("function"!==typeof t?t=function(){}:"function"!==typeof n&&(n=function(){}),e.then(t,n))}function vt(e,t,n){var i;void 0===e&&(e=0);var r=function(){i&&clearTimeout(i)};return t.then((function(){r()})).catch((function(){r()})),new Promise((function(t,r){i=setTimeout((function(){return r(n)}),e)}))}!function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(pt||(pt={}));var yt=function(){function e(e,t,n,i){this.protocol=e,this.repo=t,this.instance=n,this.configuration=i}return e.prototype.subscribe=function(e,t,n,i,r){var o=this,s=function(e,n,i,s){var a;t.methodResponseTimeout=null!==(a=t.methodResponseTimeout)&&void 0!==a?a:t.waitTimeoutMs,o.protocol.client.subscribe(n,t,e,i,s,r)};return mt(new Promise((function(n,i){var r,a=function(e){n(e)},c=function(e){i(e)};if(e)if((r="string"===typeof e?{name:e}:e).name){void 0===t&&(t={});var u=t.target;if(void 0===u&&(u="best"),"string"!==typeof u||"all"===u||"best"===u){void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=t.method_response_timeout,void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=o.configuration.methodResponseTimeout)),void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=t.wait_for_method_timeout,void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=o.configuration.waitTimeoutMs));var d=500,l=0,h=o.getServerMethodsByFilterAndTarget(r,u);if(h.length>0)s(h,h[0].methods[0],a,c);else{var p=function(){if(u&&t.waitTimeoutMs)if(l+=d,(h=o.getServerMethodsByFilterAndTarget(r,u)).length>0){var n=h[0].methods[0];s(h,n,a,c)}else l>=t.waitTimeoutMs?s(h,"string"===typeof e?{name:e}:e,a,c):setTimeout(p,d)};setTimeout(p,d)}}else i(new Error('"'.concat(u,'" is not a valid target. Valid targets are "all", "best", or an instance.')))}else i("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");else i("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.")})),n,i)},e.prototype.servers=function(e){var t=void 0===e?void 0:i({},e);return this.getServers(t).map((function(e){return e.server.instance}))},e.prototype.methods=function(e){return e="string"===typeof e?{name:e}:i({},e),this.getMethods(e)},e.prototype.methodsForInstance=function(e){return this.getMethodsForInstance(e)},e.prototype.methodAdded=function(e){return this.repo.onMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.repo.onMethodRemoved(e)},e.prototype.serverAdded=function(e){return this.repo.onServerAdded(e)},e.prototype.serverRemoved=function(e){return this.repo.onServerRemoved((function(t,n){e(t,n)}))},e.prototype.serverMethodAdded=function(e){return this.repo.onServerMethodAdded((function(t,n){e({server:t,method:n})}))},e.prototype.serverMethodRemoved=function(e){return this.repo.onServerMethodRemoved((function(t,n){e({server:t,method:n})}))},e.prototype.invoke=function(e,t,n,s,a,c){return r(this,void 0,void 0,(function(){var u,d=this;return o(this,(function(l){return u=function(){return r(d,void 0,void 0,(function(){var r,a,c,u,d,l,h,p,f,g,m,v,y=this;return o(this,(function(o){switch(o.label){case 0:if(!(r="string"===typeof e?{name:e}:i({},e)).name)return[2,Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.")];if(t||(t={}),n||(n="best"),"string"===typeof n&&"all"!==n&&"best"!==n&&"skipMine"!==n)return[2,Promise.reject(new Error('"'.concat(n,'" is not a valid target. Valid targets are "all" and "best".')))];if(s||(s={}),void 0===s.methodResponseTimeoutMs&&(s.methodResponseTimeoutMs=s.method_response_timeout,void 0===s.methodResponseTimeoutMs&&(s.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),void 0===s.waitTimeoutMs&&(s.waitTimeoutMs=s.wait_for_method_timeout,void 0===s.waitTimeoutMs&&(s.waitTimeoutMs=this.configuration.waitTimeoutMs)),void 0!==s.waitTimeoutMs&&"number"!==typeof s.waitTimeoutMs)return[2,Promise.reject(new Error('"'.concat(s.waitTimeoutMs,'" is not a valid number for "waitTimeoutMs" ')))];if("object"!==typeof t)return[2,Promise.reject(new Error("The method arguments must be an object. method: ".concat(r.name)))];if(0!==(a=this.getServerMethodsByFilterAndTarget(r,n)).length)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.tryToAwaitForMethods(r,n,s)];case 2:return a=o.sent(),[3,4];case 3:return o.sent(),c=i(i({},r),{getServers:function(){return[]},supportsStreaming:!1,objectTypes:null!==(g=r.objectTypes)&&void 0!==g?g:[],flags:null!==(v=null===(m=r.flags)||void 0===m?void 0:m.metadata)&&void 0!==v?v:{}}),u={method:c,called_with:t,message:"Can not find a method matching ".concat(JSON.stringify(e)," with server filter ").concat(JSON.stringify(n)),executed_by:void 0,returned:void 0,status:void 0},[2,Promise.reject(u)];case 4:return d=s.methodResponseTimeoutMs,l=s,h=a.map((function(e){var n=Pe(),i=e.methods[0],r=e.server,o=y.protocol.client.invoke(n,i,t,r,l);return Promise.race([o,vt(d,o,{invocationId:n,message:"Invocation timeout (".concat(d," ms) reached for method name: ").concat(null===i||void 0===i?void 0:i.name,", target instance: ").concat(JSON.stringify(r.instance),", options: ").concat(JSON.stringify(l)),status:pt.Error})])})),[4,Promise.all(h)];case 5:return p=o.sent(),f=this.getInvocationResultObj(p,r,t),p.every((function(e){return e.status===pt.Error}))?[2,Promise.reject(f)]:[2,f]}}))}))},[2,mt(u(),a,c)]}))}))},e.prototype.getInvocationResultObj=function(e,t,n){var i=e.filter((function(e){return e.status===pt.Success})).reduce((function(e,i){return e=s(s([],e,!0),[{executed_by:i.instance,returned:i.result,called_with:n,method:t,message:i.message,status:i.status}],!1)}),[]),r=e.filter((function(e){return e.status===pt.Error})).reduce((function(e,i){return e=s(s([],e,!0),[{executed_by:i.instance,called_with:n,name:t.name,message:i.message}],!1)}),[]),o=e[0];return{method:t,called_with:n,returned:o.result,executed_by:o.instance,all_return_values:i,all_errors:r,message:o.message,status:o.status}},e.prototype.tryToAwaitForMethods=function(e,t,n){var i=this;return new Promise((function(r,o){if(0!==n.waitTimeoutMs)var s=500,a=0,c=setInterval((function(){a+=s;var u=i.getServerMethodsByFilterAndTarget(e,t);if(u.length>0)clearInterval(c),r(u);else if(a>=(n.waitTimeoutMs||1e4))return clearInterval(c),void o()}),s);else o()}))},e.prototype.filterByTarget=function(e,t){var n=this;if("string"!==typeof e)return(Array.isArray(e)?e:[e]).reduce((function(e,i){var r=t.filter((function(e){return n.instanceMatch(i,e.server.instance)}));return e.concat(r)}),[]);if("all"===e)return s([],t,!0);if("best"===e){var i=t.find((function(e){return e.server.instance.isLocal}));if(i)return[i];if(void 0!==t[0])return[t[0]]}else if("skipMine"===e)return t.filter((function(e){return e.server.instance.peerId!==n.instance.peerId}));return[]},e.prototype.instanceMatch=function(e,t){return this.containsProps(e,t)},e.prototype.methodMatch=function(e,t){return this.containsProps(e,t)},e.prototype.containsProps=function(e,t){return Object.keys(e).filter((function(t){return void 0!==e[t]&&null!==e[t]&&"function"!==typeof e[t]&&"object_types"!==t&&"display_name"!==t&&"id"!==t&&"gatewayId"!==t&&"identifier"!==t&&"_"!==t[0]})).every((function(n){var i,r=e[n],o=t[n];switch(n){case"objectTypes":i=(r||[]).every((function(e){return(o||[]).includes(e)}));break;case"flags":i=lt(o||{},r||{});break;default:i=String(r).toLowerCase()===String(o).toLowerCase()}return i}))},e.prototype.getMethods=function(e){var t=this;return void 0===e?this.repo.getMethods():this.repo.getMethods().filter((function(n){return t.methodMatch(e,n)}))},e.prototype.getMethodsForInstance=function(e){var t=this,n=this.repo.getServers().filter((function(n){return t.instanceMatch(e,n.instance)}));if(0===n.length)return[];var i={};return 1===n.length?i=n[0].methods:n.forEach((function(e){Object.keys(e.methods).forEach((function(t){var n=e.methods[t];i[n.identifier]=n}))})),Object.keys(i).map((function(e){return i[e]}))},e.prototype.getServers=function(e){var t=this,n=this.repo.getServers();return void 0===e?n.map((function(e){return{server:e,methods:[]}})):n.reduce((function(n,i){var r=Object.values(i.methods).filter((function(n){return t.methodMatch(e,n)}));return r.length>0&&n.push({server:i,methods:r}),n}),[])},e.prototype.getServerMethodsByFilterAndTarget=function(e,t){var n=this.getServers(e);return this.filterByTarget(t,n)},e}(),wt=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.subscription=n}return Object.defineProperty(e.prototype,"stream",{get:function(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instance",{get:function(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance},enumerable:!1,configurable:!0}),e.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},e.prototype.push=function(e){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,e)},e}(),bt=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.requestContext=n,this.arguments=n.arguments,this.instance=n.instance}return e.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},e.prototype.acceptOnBranch=function(e){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,e)},e.prototype.reject=function(e){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,e)},e}(),_t=function(){function e(e,t){var n=this;this.protocol=e,this.server=t,e.server.onSubRequest((function(e,t){return n.handleSubRequest(e,t)})),e.server.onSubAdded((function(e,t){return n.handleSubAdded(e,t)})),e.server.onSubRemoved((function(e,t){return n.handleSubRemoved(e,t)}))}return e.prototype.handleSubRequest=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionRequestHandler){var n=new bt(this.protocol,t,e);t.streamCallbacks.subscriptionRequestHandler(n)}},e.prototype.handleSubAdded=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionAddedHandler){var n=new wt(this.protocol,t,e);t.streamCallbacks.subscriptionAddedHandler(n)}},e.prototype.handleSubRemoved=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionRemovedHandler){var n=new wt(this.protocol,t,e);t.streamCallbacks.subscriptionRemovedHandler(n)}},e}(),It=function(){function e(e,t,n){this.key=e,this.protocol=t,this.repoMethod=n}return e.prototype.subscriptions=function(){var e=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map((function(t){return new wt(e.protocol,e.repoMethod,t)}))},e.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},e.prototype.push=function(e){this.protocol.server.pushData(this.repoMethod,e,[this.key])},e}(),Ct=function(){function e(e,t,n){this._protocol=e,this._repoMethod=t,this._server=n,this.name=this._repoMethod.definition.name}return e.prototype.branches=function(e){var t=this,n=this._protocol.server.getBranchList(this._repoMethod);return e?n.indexOf(e)>-1?new It(e,this._protocol,this._repoMethod):void 0:n.map((function(e){return new It(e,t._protocol,t._repoMethod)}))},e.prototype.branch=function(e){return this.branches(e)},e.prototype.subscriptions=function(){var e=this;return this._protocol.server.getSubscriptionList(this._repoMethod).map((function(t){return new wt(e._protocol,e._repoMethod,t)}))},Object.defineProperty(e.prototype,"definition",{get:function(){var e,t=this._repoMethod.definition;return{accepts:t.accepts,description:t.description,displayName:t.displayName,name:t.name,objectTypes:t.objectTypes,returns:t.returns,supportsStreaming:t.supportsStreaming,flags:null===(e=t.flags)||void 0===e?void 0:e.metadata}},enumerable:!1,configurable:!0}),e.prototype.close=function(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)},e.prototype.push=function(e,t){if("string"!==typeof t&&!Array.isArray(t)&&void 0!==t)throw new Error("invalid branches should be string or string array");if("object"!==typeof e)throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,e,t)},e.prototype.updateRepoMethod=function(e){this._repoMethod=e},e}(),St=function(){function e(e,t){this.protocol=e,this.serverRepository=t,this.invocations=0,this.currentlyUnregistering={},this.streaming=new _t(e,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return e.prototype.createStream=function(e,t,n,r,o){var s=this;return mt(new Promise((function(n,r){if(e){var a;if(!(a="string"===typeof e?{name:""+e}:i({},e)).name)return r("The \u201cname\u201d property is required for the \u201cstreamDefinition\u201d object and must be unique. Stream definition: ".concat(JSON.stringify(a)));if(s.serverRepository.getList().some((function(e){return e.definition.name===a.name})))return r('A stream with the name "'.concat(a.name,'" already exists! Please, provide a unique name for the stream.'));a.supportsStreaming=!0,t||(t={}),"function"!==typeof t.subscriptionRequestHandler&&(t.subscriptionRequestHandler=function(e){e.accept()});var c=s.serverRepository.add({definition:a,streamCallbacks:t,protocolState:{}});s.protocol.server.createStream(c).then((function(){var e;o?(e=o,o.updateRepoMethod(c)):e=new Ct(s.protocol,c,s),c.stream=e,n(e)})).catch((function(e){c.repoId&&s.serverRepository.remove(c.repoId),r(e)}))}else r("The stream name must be unique! Please, provide either a unique string for a stream name to \u201cglue.interop.createStream()\u201d or a \u201cmethodDefinition\u201d object with a unique \u201cname\u201d property for the stream.")})),n,r)},e.prototype.register=function(e,t){var n=this;if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");if("function"!==typeof t)return Promise.reject("The second parameter must be a callback function. Method: ".concat("string"===typeof e?e:e.name));var i=function(e,i){return r(n,void 0,void 0,(function(){var n,r,s;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),(n=t(e.args,e.instance))&&"function"===typeof n.then?[4,n]:[3,2];case 1:return r=o.sent(),i(void 0,r),[3,3];case 2:i(void 0,n),o.label=3;case 3:return[3,5];case 4:return s=o.sent(),i(null!==s&&void 0!==s?s:"",null!==s&&void 0!==s?s:""),[3,5];case 5:return[2]}}))}))};return i.userCallback=t,this.registerCore(e,i)},e.prototype.registerAsync=function(e,t){if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");if("function"!==typeof t)return Promise.reject("The second parameter must be a callback function. Method: ".concat("string"===typeof e?e:e.name));var n=function(e,n){try{var i=!1,r=function(e){i||n(void 0,e),i=!0},o=function(e){i||(e||(e=""),n(e,e)),i=!0},s=t(e.args,e.instance,r,o);s&&"function"===typeof s.then&&s.then(r).catch(o)}catch(a){n(a,void 0)}};return n.userCallbackAsync=t,this.registerCore(e,n)},e.prototype.unregister=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,i;return o(this,(function(r){switch(r.label){case 0:return void 0===e?[2,Promise.reject("Please, provide either a unique string for a name or an object containing a \u201cname\u201d property.")]:"function"!==typeof e?[3,2]:[4,this.unregisterWithPredicate(e,t)];case 1:case 3:return r.sent(),[2];case 2:return void 0===(n="string"===typeof e?{name:e}:e).name?[2,Promise.reject("Method name is required. Cannot find a method if the method name is undefined!")]:(i=this.serverRepository.getList().find((function(e){return e.definition.name===n.name&&(e.definition.supportsStreaming||!1)===t})))?[4,this.removeMethodsOrStreams([i])]:[2,Promise.reject('Method with a name "'.concat(n.name,'" does not exist or is not registered by your application!'))]}}))}))},e.prototype.unregisterWithPredicate=function(e,t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(i){switch(i.label){case 0:return(n=this.serverRepository.getList().filter((function(t){return e(t.definition)})).filter((function(e){return(e.definition.supportsStreaming||!1)===t})))&&0!==n.length?[4,this.removeMethodsOrStreams(n)]:[2,Promise.reject("Could not find a ".concat(t?"stream":"method"," matching the specified condition!"))];case 1:return i.sent(),[2]}}))}))},e.prototype.removeMethodsOrStreams=function(e){var t=this,n=[];return e.forEach((function(e){var i=t.protocol.server.unregister(e).then((function(){e.repoId&&t.serverRepository.remove(e.repoId)}));n.push(i),t.addAsCurrentlyUnregistering(e.definition.name,i)})),Promise.all(n)},e.prototype.addAsCurrentlyUnregistering=function(e,t){return r(this,void 0,void 0,(function(){var n,i=this;return o(this,(function(r){return n=new Promise((function(e){return setTimeout(e,5e3)})),this.currentlyUnregistering[e]=Promise.race([t,n]).then((function(){delete i.currentlyUnregistering[e]})),[2]}))}))},e.prototype.registerCore=function(e,t){return r(this,void 0,void 0,(function(){var n,r,s,a=this;return o(this,(function(o){switch(o.label){case 0:return(n="string"===typeof e?{name:""+e}:i({},e)).name?(r=this.currentlyUnregistering[n.name])?[4,r]:[3,2]:[2,Promise.reject("Please, provide a (unique) string value for the \u201cname\u201d property in the \u201cmethodDefinition\u201d object: ".concat(JSON.stringify(e)))];case 1:o.sent(),o.label=2;case 2:return this.serverRepository.getList().some((function(e){return e.definition.name===n.name}))?[2,Promise.reject('A method with the name "'.concat(n.name,'" already exists! Please, provide a unique name for the method.'))]:n.supportsStreaming?[2,Promise.reject("When you create methods with \u201cglue.interop.register()\u201d or \u201cglue.interop.registerAsync()\u201d the property \u201csupportsStreaming\u201d cannot be \u201ctrue\u201d. If you want \u201c".concat(n.name,"\u201d to be a stream, please use the \u201cglue.interop.createStream()\u201d method."))]:(s=this.serverRepository.add({definition:n,theFunction:t,protocolState:{}}),[2,this.protocol.server.register(s).catch((function(e){throw(null===s||void 0===s?void 0:s.repoId)&&a.serverRepository.remove(s.repoId),e}))])}}))}))},e.prototype.onMethodInvoked=function(e,t,n){var i=this;e&&e.theFunction&&e.theFunction(n,(function(n,r){if(void 0!==n&&null!==n)if(n.message&&"string"===typeof n.message)n=n.message;else if("string"!==typeof n)try{n=JSON.stringify(n)}catch(o){n="un-stringifyable error in onMethodInvoked! Top level prop names: ".concat(Object.keys(n))}r?("object"!==typeof r||Array.isArray(r))&&(r={_value:r}):r={},i.protocol.server.methodInvocationResult(e,t,n,r)}))},e}(),kt=function(){function e(e,t,n){var i=this;this.wrapped={},this.wrapped.getMethods=function(){return e.methodsForInstance(this)},this.wrapped.getStreams=function(){return e.methodsForInstance(this).filter((function(e){return e.supportsStreaming}))},t&&this.refreshWrappedObject(t),n&&(n.loggedIn((function(){i.refresh(n)})),this.refresh(n))}return e.prototype.unwrap=function(){return this.wrapped},e.prototype.refresh=function(e){if(e){var t=null===e||void 0===e?void 0:e.resolvedIdentity,n=Object.assign({},null!==t&&void 0!==t?t:{},{peerId:null===e||void 0===e?void 0:e.peerId});this.refreshWrappedObject(n)}},e.prototype.refreshWrappedObject=function(e){var t,n,i,r,o=this;Object.keys(e).forEach((function(t){o.wrapped[t]=e[t]})),this.wrapped.user=e.user,this.wrapped.instance=e.instance,this.wrapped.application=null!==(t=e.application)&&void 0!==t?t:Pe(),this.wrapped.applicationName=e.applicationName,this.wrapped.pid=null!==(i=null!==(n=e.pid)&&void 0!==n?n:e.process)&&void 0!==i?i:Math.floor(1e10*Math.random()),this.wrapped.machine=e.machine,this.wrapped.environment=e.environment,this.wrapped.region=e.region,this.wrapped.windowId=e.windowId,this.wrapped.isLocal=null===(r=e.isLocal)||void 0===r||r,this.wrapped.api=e.api,this.wrapped.service=e.service,this.wrapped.peerId=e.peerId},e}(),xt=function(e){return i(i({},e),{flags:e.flags.metadata||{}})},Tt=function(){function e(e,t){this.logger=e,this.API=t,this.servers={},this.methodsCount={},this.callbacks=D();var n=this.API.instance.peerId;this.myServer={id:n,methods:{},instance:this.API.instance,wrapper:this.API.unwrappedInstance},this.servers[n]=this.myServer}return e.prototype.addServer=function(e,t){this.logger.debug("adding server ".concat(t));var n=this.servers[t];if(n)return n.id;var i=new kt(this.API,e),r={id:t,methods:{},instance:i.unwrap(),wrapper:i};return this.servers[t]=r,this.callbacks.execute("onServerAdded",r.instance),t},e.prototype.removeServerById=function(e,t){var n=this,i=this.servers[e];i?(this.logger.debug("removing server ".concat(e)),Object.keys(i.methods).forEach((function(t){n.removeServerMethod(e,t)})),delete this.servers[e],this.callbacks.execute("onServerRemoved",i.instance,t)):this.logger.warn("not aware of server ".concat(e,", my state ").concat(JSON.stringify(Object.keys(this.servers))))},e.prototype.addServerMethod=function(e,t){var n,i=this.servers[e];if(!i)throw new Error("server does not exists");if(!i.methods[t.id]){var r=this.createMethodIdentifier(t),o=this,s={identifier:r,gatewayId:t.id,name:t.name,displayName:t.display_name,description:t.description,version:t.version,objectTypes:t.object_types||[],accepts:t.input_signature,returns:t.result_signature,supportsStreaming:"undefined"!==typeof t.flags&&t.flags.streaming,flags:null!==(n=t.flags)&&void 0!==n?n:{},getServers:function(){return o.getServersByMethod(r)}};s.object_types=s.objectTypes,s.display_name=s.displayName,s.version=s.version,i.methods[t.id]=s;var a=xt(s);return this.methodsCount[r]||(this.methodsCount[r]=0,this.callbacks.execute("onMethodAdded",a)),this.methodsCount[r]=this.methodsCount[r]+1,this.callbacks.execute("onServerMethodAdded",i.instance,a),s}},e.prototype.removeServerMethod=function(e,t){var n=this.servers[e];if(!n)throw new Error("server does not exists");var i=n.methods[t];delete n.methods[t];var r=xt(i);this.methodsCount[i.identifier]=this.methodsCount[i.identifier]-1,0===this.methodsCount[i.identifier]&&this.callbacks.execute("onMethodRemoved",r),this.callbacks.execute("onServerMethodRemoved",n.instance,r)},e.prototype.getMethods=function(){return this.extractMethodsFromServers(Object.values(this.servers)).map(xt)},e.prototype.getServers=function(){return Object.values(this.servers).map(this.hideServerMethodSystemFlags)},e.prototype.onServerAdded=function(e){var t=this.callbacks.add("onServerAdded",e),n=this.getServers().map((function(e){return e.instance}));return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onMethodAdded=function(e){var t=this.callbacks.add("onMethodAdded",e),n=this.getMethods();return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onServerMethodAdded=function(e){var t=this.callbacks.add("onServerMethodAdded",e),n=!1,i=this.getServers();return setTimeout((function(){i.forEach((function(t){var i=t.methods;Object.keys(i).forEach((function(r){n||e(t.instance,i[r])}))}))}),0),function(){n=!0,t()}},e.prototype.onMethodRemoved=function(e){return this.callbacks.add("onMethodRemoved",e)},e.prototype.onServerRemoved=function(e){return this.callbacks.add("onServerRemoved",e)},e.prototype.onServerMethodRemoved=function(e){return this.callbacks.add("onServerMethodRemoved",e)},e.prototype.getServerById=function(e){return this.hideServerMethodSystemFlags(this.servers[e])},e.prototype.reset=function(){var e,t=this;Object.keys(this.servers).forEach((function(e){t.removeServerById(e,"reset")})),this.servers=((e={})[this.myServer.id]=this.myServer,e),this.methodsCount={}},e.prototype.createMethodIdentifier=function(e){var t,n,i=null!==(t=e.input_signature)&&void 0!==t?t:"",r=null!==(n=e.result_signature)&&void 0!==n?n:"";return(e.name+i+r).toLowerCase()},e.prototype.getServersByMethod=function(e){var t=[];return Object.values(this.servers).forEach((function(n){Object.values(n.methods).forEach((function(i){i.identifier===e&&t.push(n.instance)}))})),t},e.prototype.returnUnsubWithDelayedReplay=function(e,t,n){var i=!1;return setTimeout((function(){t.forEach((function(e){i||n(e)}))}),0),function(){i=!0,e()}},e.prototype.hideServerMethodSystemFlags=function(e){var t={};return Object.entries(e.methods).forEach((function(e){var n=e[0],i=e[1];t[n]=xt(i)})),i(i({},e),{methods:t})},e.prototype.extractMethodsFromServers=function(e){return Object.values(e).reduce((function(e,t){return s(s([],e,!0),Object.values(t.methods),!0)}),[])},e}(),At=function(){function e(){this.nextId=0,this.methods=[]}return e.prototype.add=function(e){return e.repoId=String(this.nextId),this.nextId+=1,this.methods.push(e),e},e.prototype.remove=function(e){if("string"!==typeof e)return new TypeError("Expecting a string");this.methods=this.methods.filter((function(t){return t.repoId!==e}))},e.prototype.getById=function(e){if("string"===typeof e)return this.methods.find((function(t){return t.repoId===e}))},e.prototype.getList=function(){return this.methods.map((function(e){return e}))},e.prototype.length=function(){return this.methods.length},e.prototype.reset=function(){this.methods=[]},e}(),Et="onSubscriptionRequest",Pt="onSubscriptionAdded",Mt="onSubscriptionRemoved",Rt=function(){function e(e,t,n){var i=this;this.session=e,this.repository=t,this.serverRepository=n,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=D(),this.nextStreamId=0,e.on("add-interest",(function(e){i.handleAddInterest(e)})),e.on("remove-interest",(function(e){i.handleRemoveInterest(e)}))}return e.prototype.acceptRequestOnBranch=function(e,t,n){if("string"!==typeof n&&(n=""),"object"!==typeof t.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(t.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var i=this.getStreamId(t,n),r=e.msg.subscription_id,o={id:r,arguments:e.arguments,instance:e.instance,branchKey:n,streamId:i,subscribeMsg:e.msg};t.protocolState.subscriptionsMap[r]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:r,stream_id:i}),this.callbacks.execute(Pt,o,t)},e.prototype.rejectRequest=function(e,t,n){"string"!==typeof n&&(n=""),this.sendSubscriptionFailed("Subscription rejected by user. "+n,e.msg.subscription_id)},e.prototype.pushData=function(e,t,n){var i=this;if("object"===typeof e&&Array.isArray(e.protocolState.branchKeyToStreamIdMap)){if("object"!==typeof t)throw new Error("Invalid arguments. Data must be an object.");"string"===typeof n?n=[n]:(!Array.isArray(n)||n.length<=0)&&(n=[]),e.protocolState.branchKeyToStreamIdMap.filter((function(e){return!n||0===n.length||n.indexOf(e.key)>=0})).map((function(e){return e.streamId})).forEach((function(e){var n={type:"publish",stream_id:e,data:t};i.session.sendFireAndForget(n)}))}},e.prototype.pushDataToSingle=function(e,t,n){if("object"!==typeof n)throw new Error("Invalid arguments. Data must be an object.");var i={type:"post",subscription_id:t.id,data:n};this.session.sendFireAndForget(i)},e.prototype.closeSingleSubscription=function(e,t){e.protocolState.subscriptionsMap&&delete e.protocolState.subscriptionsMap[t.id];var n={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(n),t.instance,this.callbacks.execute(Mt,t,e)},e.prototype.closeMultipleSubscriptions=function(e,t){var n=this;if("object"===typeof e&&"object"===typeof e.protocolState.subscriptionsMap&&e.protocolState.subscriptionsMap){var i=e.protocolState.subscriptionsMap,r=Object.keys(i).map((function(e){return i[e]}));"string"===typeof t&&(r=r.filter((function(e){return e.branchKey===t}))),r.forEach((function(e){delete i[e.id];var t={type:"drop-subscription",subscription_id:e.id,reason:"Server dropping all subscriptions on stream_id: "+e.streamId};n.session.sendFireAndForget(t)}))}},e.prototype.getSubscriptionList=function(e,t){if("object"!==typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var n=e.protocolState.subscriptionsMap,i=Object.keys(n).map((function(e){return n[e]}));return"string"!==typeof t?i:i.filter((function(e){return e.branchKey===t}))},e.prototype.getBranchList=function(e){if("object"!==typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var t=e.protocolState.subscriptionsMap,n=Object.keys(t).map((function(e){return t[e]})),i=[];return n.forEach((function(e){var t="";"object"===typeof e&&"string"===typeof e.branchKey&&(t=e.branchKey),-1===i.indexOf(t)&&i.push(t)})),i},e.prototype.onSubAdded=function(e){this.onSubscriptionLifetimeEvent(Pt,e)},e.prototype.onSubRequest=function(e){this.onSubscriptionLifetimeEvent(Et,e)},e.prototype.onSubRemoved=function(e){this.onSubscriptionLifetimeEvent(Mt,e)},e.prototype.handleRemoveInterest=function(e){var t=this.serverRepository.getById(e.method_id);if("string"===typeof e.subscription_id&&"object"===typeof t&&t.protocolState.subscriptionsMap&&"object"===typeof t.protocolState.subscriptionsMap[e.subscription_id]){var n=t.protocolState.subscriptionsMap[e.subscription_id];delete t.protocolState.subscriptionsMap[e.subscription_id],this.callbacks.execute(Mt,n,t)}},e.prototype.onSubscriptionLifetimeEvent=function(e,t){this.callbacks.add(e,t)},e.prototype.getNextStreamId=function(){return this.nextStreamId+++""},e.prototype.handleAddInterest=function(e){var t=this.repository.getServerById(e.caller_id).instance,n={msg:e,arguments:e.arguments_kv||{},instance:t},i=this.serverRepository.getById(e.method_id);if(void 0!==i)i.protocolState.subscriptionsMap&&i.protocolState.subscriptionsMap[e.subscription_id]?this.sendSubscriptionFailed("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id):this.callbacks.execute(Et,n,i);else{var r="No method with id "+e.method_id+" on this server.";this.sendSubscriptionFailed(r,e.subscription_id)}},e.prototype.sendSubscriptionFailed=function(e,t){var n={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:e,request_id:t};this.session.sendFireAndForget(n)},e.prototype.getStreamId=function(e,t){if("string"!==typeof t&&(t=""),!e.protocolState.branchKeyToStreamIdMap)throw new Error("streaming ".concat(e.definition.name," method without protocol state"));var n=e.protocolState.branchKeyToStreamIdMap.filter((function(e){return e.key===t}))[0],i=n?n.streamId:void 0;return"string"===typeof i&&""!==i||(i=this.getNextStreamId(),e.protocolState.branchKeyToStreamIdMap.push({key:t,streamId:i})),i},e}(),Nt=function(){function e(e,t,n,i){var r=this;this.session=e,this.clientRepository=t,this.serverRepository=n,this.logger=i,this.callbacks=D(),this.streaming=new Rt(e,t,n),this.session.on("invoke",(function(e){return r.handleInvokeMessage(e)}))}return e.prototype.createStream=function(e){return e.protocolState.subscriptionsMap={},e.protocolState.branchKeyToStreamIdMap=[],this.register(e,!0)},e.prototype.register=function(e,t){var n,i=this,r=e.definition,o=Object.assign({},{metadata:null!==(n=r.flags)&&void 0!==n?n:{}},{streaming:t||!1}),s={type:"register",methods:[{id:e.repoId,name:r.name,display_name:r.displayName,description:r.description,version:r.version,flags:o,object_types:r.objectTypes||r.object_types,input_signature:r.accepts,result_signature:r.returns,restrictions:void 0}]};return this.session.send(s,{methodId:e.repoId}).then((function(){i.logger.debug("registered method "+e.definition.name+" with id "+e.repoId)})).catch((function(t){throw i.logger.warn("failed to register method ".concat(e.definition.name," with id ").concat(e.repoId," - ").concat(JSON.stringify(t))),t}))},e.prototype.onInvoked=function(e){this.callbacks.add("onInvoked",e)},e.prototype.methodInvocationResult=function(e,t,n,i){var r;r=n||""===n?{type:"error",request_id:t,reason_uri:"agm.errors.client_error",reason:n,context:i,peer_id:void 0}:{type:"yield",invocation_id:t,peer_id:this.session.peerId,result:i,request_id:void 0},this.session.sendFireAndForget(r)},e.prototype.unregister=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t={type:"unregister",methods:[e.repoId]},[4,this.session.send(t)];case 1:return n.sent(),[2]}}))}))},e.prototype.getBranchList=function(e){return this.streaming.getBranchList(e)},e.prototype.getSubscriptionList=function(e,t){return this.streaming.getSubscriptionList(e,t)},e.prototype.closeAllSubscriptions=function(e,t){this.streaming.closeMultipleSubscriptions(e,t)},e.prototype.pushData=function(e,t,n){this.streaming.pushData(e,t,n)},e.prototype.pushDataToSingle=function(e,t,n){this.streaming.pushDataToSingle(e,t,n)},e.prototype.closeSingleSubscription=function(e,t){this.streaming.closeSingleSubscription(e,t)},e.prototype.acceptRequestOnBranch=function(e,t,n){this.streaming.acceptRequestOnBranch(e,t,n)},e.prototype.rejectRequest=function(e,t,n){this.streaming.rejectRequest(e,t,n)},e.prototype.onSubRequest=function(e){this.streaming.onSubRequest(e)},e.prototype.onSubAdded=function(e){this.streaming.onSubAdded(e)},e.prototype.onSubRemoved=function(e){this.streaming.onSubRemoved(e)},e.prototype.handleInvokeMessage=function(e){var t=e.invocation_id,n=e.caller_id,i=e.method_id,r=e.arguments_kv,o=this.serverRepository.getList().filter((function(e){return e.repoId===i}))[0];if(void 0!==o){var s={args:r,instance:this.clientRepository.getServerById(n).instance};this.callbacks.execute("onInvoked",o,t,s)}},e}(),Ot=function(){function e(e,t){this.repository=e,this.subscriptionData=t}return Object.defineProperty(e.prototype,"requestArguments",{get:function(){return this.subscriptionData.params.arguments||{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"servers",{get:function(){var e=this;return this.subscriptionData.trackedServers.filter((function(e){return e.subscriptionId})).map((function(t){return e.repository.getServerById(t.serverId).instance}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverInstance",{get:function(){return this.servers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stream",{get:function(){return this.subscriptionData.method},enumerable:!1,configurable:!0}),e.prototype.onData=function(e){if("function"!==typeof e)throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(e),1===this.subscriptionData.handlers.onData.length&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach((function(t){e(t)}))},e.prototype.onClosed=function(e){if("function"!==typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(e)},e.prototype.onFailed=function(e){},e.prototype.onConnected=function(e){if("function"!==typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(e)},e.prototype.close=function(){this.subscriptionData.close()},e.prototype.setNewSubscription=function(e){this.subscriptionData=e},e}(),jt=function(){function e(e){this.config=e,this.cache=[],this.timeoutIds=[]}return e.prototype.add=function(e){var t=this,n=Pe();this.cache.push({id:n,element:e});var i=setTimeout((function(){var e=t.cache.findIndex((function(e){return e.id===n}));e<0||t.cache.splice(e,1)}),this.config.ELEMENT_TTL_MS);this.timeoutIds.push(i)},e.prototype.flush=function(){var e=this.cache.map((function(e){return e.element}));return this.timeoutIds.forEach((function(e){return clearInterval(e)})),this.cache=[],this.timeoutIds=[],e},e}(),Dt="awaitingAccept",Ft="subscribed",Wt="Subscription failed.",Lt="Subscription rejected.",Ut="ServerInitiated",qt="ClientInitiated",Bt=function(){function e(e,t,n){var i=this;this.session=e,this.repository=t,this.logger=n,this.subscriptionsList={},this.timedCache=new jt({ELEMENT_TTL_MS:1e4}),this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(e){var t=e._tag,n=t.subLocalKey,r=i.subscriptionsList[n];if("object"===typeof r&&(r.trackedServers=r.trackedServers.filter((function(e){return e.serverId!==t.serverId})),r.trackedServers.length<=0)){if(clearTimeout(r.timeoutId),r.status===Dt){var o="string"===typeof e.reason&&""!==e.reason?' Publisher said "'+e.reason+'".':" No reason given.",s="object"===typeof r.params.arguments?JSON.stringify(r.params.arguments):"{}";r.error({message:Lt+o+" Called with:"+s,called_with:r.params.arguments,method:r.method})}else r.status===Ft&&i.callOnClosedHandlers(r);delete i.subscriptionsList[n]}},this.handleSubscribed=function(e){var t=e._tag.subLocalKey,n=i.subscriptionsList[t];if("object"===typeof n){var r=e._tag.serverId,o=n.trackedServers.filter((function(e){return e.serverId===r}))[0];if("object"===typeof o){o.subscriptionId=e.subscription_id,i.subscriptionIdToLocalKeyMap[e.subscription_id]=t;var s=n.status===Dt;if(n.status=Ft,s){var a=!1,c=n.subscription;c?(c.setNewSubscription(n),n.success(c),a=!0):(c=new Ot(i.repository,n),n.subscription=c,n.success(c));for(var u=0,d=n.handlers.onConnected;u<d.length;u++){var l=d[u];try{l(c.serverInstance,a)}catch(h){}}}}}},this.handleEventData=function(e){var t=i.subscriptionIdToLocalKeyMap[e.subscription_id];if("undefined"!==typeof t){var n=i.subscriptionsList[t];if("object"===typeof n){var r=n.trackedServers.filter((function(t){return t.subscriptionId===e.subscription_id}));if(1===r.length){var o=e.oob,s=r[0].serverId,a=function(){return{data:e.data,server:i.repository.getServerById(s).instance,requestArguments:n.params.arguments,message:void 0,private:o}},c=n.handlers.onData,u=n.queued.data;c.length>0?c.forEach((function(e){"function"===typeof e&&e(a())})):u.push(a())}}}},this.handleSubscriptionCancelled=function(e){var t=i.subscriptionIdToLocalKeyMap[e.subscription_id];if("undefined"!==typeof t){var n=i.subscriptionsList[t];if("object"===typeof n){var r=n.trackedServers.length-1;n.trackedServers=n.trackedServers.filter((function(t){return t.subscriptionId!==e.subscription_id||(n.queued.closers.push(t.serverId),!1)})),n.trackedServers.length===r&&(n.trackedServers.length<=0&&(i.timedCache.add(n),clearTimeout(n.timeoutId),i.callOnClosedHandlers(n),delete i.subscriptionsList[t]),delete i.subscriptionIdToLocalKeyMap[e.subscription_id])}}},e.on("subscribed",this.handleSubscribed),e.on("event",this.handleEventData),e.on("subscription-cancelled",this.handleSubscriptionCancelled)}return e.prototype.subscribe=function(e,t,n,i,r,o){var s=this;if(0!==n.length){var a=this.getNextSubscriptionLocalKey(),c=this.registerSubscription(a,e,t,i,r,t.methodResponseTimeout||1e4,o);"object"===typeof c?n.forEach((function(n){var i=n.server.id,r=n.methods.find((function(t){return t.name===e.name}));if(r){c.trackedServers.push({serverId:i,subscriptionId:void 0});var o={type:"subscribe",server_id:i,method_id:r.gatewayId,arguments_kv:t.arguments};s.session.send(o,{serverId:i,subLocalKey:a}).then((function(e){return s.handleSubscribed(e)})).catch((function(e){return s.handleErrorSubscribing(e)}))}else s.logger.error("can not find method ".concat(e.name," for target ").concat(n.server.id))})):r({method:e,called_with:t.arguments,message:Wt+" Unable to register the user callbacks."})}else r({method:e,called_with:t.arguments,message:Wt+" No available servers matched the target params."})},e.prototype.drainSubscriptions=function(){var e=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},e},e.prototype.drainSubscriptionsCache=function(){return this.timedCache.flush()},e.prototype.getNextSubscriptionLocalKey=function(){var e=this.nextSubLocalKey;return this.nextSubLocalKey+=1,e},e.prototype.registerSubscription=function(e,t,n,i,r,o,s){var a=this,c={localKey:e,status:Dt,method:t,params:n,success:i,error:r,trackedServers:[],handlers:{onData:(null===s||void 0===s?void 0:s.handlers.onData)||[],onClosed:(null===s||void 0===s?void 0:s.handlers.onClosed)||[],onConnected:(null===s||void 0===s?void 0:s.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:function(){return a.closeSubscription(e)},subscription:null===s||void 0===s?void 0:s.subscription};return s||(n.onData&&c.handlers.onData.push(n.onData),n.onClosed&&c.handlers.onClosed.push(n.onClosed),n.onConnected&&c.handlers.onConnected.push(n.onConnected)),this.subscriptionsList[e]=c,c.timeoutId=setTimeout((function(){if(void 0!==a.subscriptionsList[e]){var i=a.subscriptionsList[e];i.status===Dt?(r({method:t,called_with:n.arguments,message:Wt+" Subscription attempt timed out after "+o+" ms."}),delete a.subscriptionsList[e]):i.status===Ft&&i.trackedServers.length>0&&(i.trackedServers=i.trackedServers.filter((function(e){return"undefined"!==typeof e.subscriptionId})),delete i.timeoutId,i.trackedServers.length<=0&&(a.callOnClosedHandlers(i),delete a.subscriptionsList[e]))}}),o),c},e.prototype.callOnClosedHandlers=function(e,t){var n,i=e.queued.closers.length,r=i>0?e.queued.closers[i-1]:null;void 0!==r&&"string"===typeof r&&(n=this.repository.getServerById(r).instance),e.handlers.onClosed.forEach((function(i){"function"===typeof i&&i({message:t||Ut,requestArguments:e.params.arguments||{},server:n,stream:e.method})}))},e.prototype.closeSubscription=function(e){var t=this,n=this.subscriptionsList[e];"object"===typeof n&&(n.trackedServers.forEach((function(e){"undefined"!==typeof e.subscriptionId&&(n.queued.closers.push(e.serverId),t.session.sendFireAndForget({type:"unsubscribe",subscription_id:e.subscriptionId,reason_uri:"",reason:qt}),delete t.subscriptionIdToLocalKeyMap[e.subscriptionId])})),n.trackedServers=[],this.callOnClosedHandlers(n,qt),delete this.subscriptionsList[e])},e}(),Gt=function(){function e(e,t,n){var i=this;this.session=e,this.repository=t,this.logger=n,e.on("peer-added",(function(e){return i.handlePeerAdded(e)})),e.on("peer-removed",(function(e){return i.handlePeerRemoved(e)})),e.on("methods-added",(function(e){return i.handleMethodsAddedMessage(e)})),e.on("methods-removed",(function(e){return i.handleMethodsRemovedMessage(e)})),this.streaming=new Bt(e,t,n)}return e.prototype.subscribe=function(e,t,n,i,r,o){this.streaming.subscribe(e,t,n,i,r,o)},e.prototype.invoke=function(e,t,n,i){var r=this,o=i.id,s={type:"call",server_id:o,method_id:t.gatewayId,arguments_kv:n};return this.session.send(s,{invocationId:e,serverId:o}).then((function(e){return r.handleResultMessage(e)})).catch((function(e){return r.handleInvocationError(e)}))},e.prototype.drainSubscriptions=function(){return this.streaming.drainSubscriptions()},e.prototype.drainSubscriptionsCache=function(){return this.streaming.drainSubscriptionsCache()},e.prototype.handlePeerAdded=function(e){var t=e.new_peer_id,n=e.identity,i=!e.meta||e.meta.local,r=Number(n.process),o={machine:n.machine,pid:isNaN(r)?n.process:r,instance:n.instance,application:n.application,applicationName:n.applicationName,environment:n.environment,region:n.region,user:n.user,windowId:n.windowId,peerId:t,api:n.api,isLocal:i};this.repository.addServer(o,t)},e.prototype.handlePeerRemoved=function(e){var t=e.removed_id,n=e.reason;this.repository.removeServerById(t,n)},e.prototype.handleMethodsAddedMessage=function(e){var t=this,n=e.server_id;e.methods.forEach((function(e){t.repository.addServerMethod(n,e)}))},e.prototype.handleMethodsRemovedMessage=function(e){var t=this,n=e.server_id,i=e.methods,r=this.repository.getServerById(n);Object.keys(r.methods).forEach((function(e){var o=r.methods[e];i.indexOf(o.gatewayId)>-1&&t.repository.removeServerMethod(n,e)}))},e.prototype.handleResultMessage=function(e){var t=e._tag.invocationId,n=e.result,i=e._tag.serverId;return{invocationId:t,result:n,instance:this.repository.getServerById(i).instance,status:pt.Success,message:""}},e.prototype.handleInvocationError=function(e){if(this.logger.debug("handle invocation error ".concat(JSON.stringify(e))),"_tag"in e){var t=e._tag.invocationId,n=e._tag.serverId,i=this.repository.getServerById(n),r=e.reason;return{invocationId:t,result:e.context,instance:i.instance,status:pt.Error,message:r}}return{invocationId:"",message:e.message,status:pt.Error,error:e}},e}();function Ht(e,t,n,i,s,a){var c,u=s.logger.subLogger("gw3-protocol"),d=new Promise((function(e){c=e})),l=t.domain("agm",["subscribed"]),h=new Nt(l,n,i,u.subLogger("server")),p=new Gt(l,n,u.subLogger("client"));function f(){return r(this,void 0,void 0,(function(){var e,t,n,r,s,c,d,l,h,f,g;return o(this,(function(o){switch(o.label){case 0:for(u.info("reconnected - will replay registered methods and subscriptions"),p.drainSubscriptionsCache().forEach((function(e){var t=e.method,n=Object.assign({},e.params);u.info("trying to soft-re-subscribe to method ".concat(t.name,", with params: ").concat(JSON.stringify(n))),a.client.subscribe(t,n,void 0,void 0,e).then((function(){return u.info("soft-subscribing to method ".concat(t.name," DONE"))})).catch((function(e){return u.warn("subscribing to method ".concat(t.name," failed: ").concat(JSON.stringify(e),"}"))}))})),e=[],t=p.drainSubscriptions(),n=function(t){var n=t.method,i=Object.assign({},t.params);u.info("trying to re-subscribe to method ".concat(n.name,", with params: ").concat(JSON.stringify(i))),e.push(a.client.subscribe(n,i,void 0,void 0,t).then((function(){return u.info("subscribing to method ".concat(n.name," DONE"))})))},r=0,s=t;r<s.length;r++)c=s[r],n(c);for(d=i.getList(),i.reset(),l=function(t){var n=t.definition;u.info("re-publishing method ".concat(n.name)),t.stream?e.push(a.server.createStream(n,t.streamCallbacks,void 0,void 0,t.stream).then((function(){return u.info("subscribing to method ".concat(n.name," DONE"))}))):t.theFunction&&t.theFunction.userCallback?e.push(a.register(n,t.theFunction.userCallback).then((function(){return u.info("subscribing to method ".concat(n.name," DONE"))}))):t.theFunction&&t.theFunction.userCallbackAsync&&e.push(a.registerAsync(n,t.theFunction.userCallbackAsync).then((function(){return u.info("subscribing to method ".concat(n.name," DONE"))}))),u.info("re-publishing method ".concat(n.name," DONE"))},h=0,f=d;h<f.length;h++)g=f[h],l(g);return[4,Promise.all(e)];case 1:return o.sent(),u.info("Interop is re-announced"),[2]}}))}))}function g(){c&&(c({client:p,server:h}),c=void 0)}return l.onJoined((function(i){n.addServer(e,t.peerId),i?f().then((function(){return t.setLibReAnnounced({name:"interop"})})).catch((function(e){return u.warn("Error while re-announcing interop: ".concat(JSON.stringify(e)))})):g()})),l.onLeft((function(){n.reset()})),l.join(),d}var zt=function(){function e(e){var t=this;if("undefined"===typeof e)throw new Error("configuration is required");if("undefined"===typeof e.connection)throw new Error("configuration.connections is required");var n,i=e.connection;if("number"!==typeof e.methodResponseTimeout&&(e.methodResponseTimeout=3e4),"number"!==typeof e.waitTimeoutMs&&(e.waitTimeoutMs=3e4),this.unwrappedInstance=new kt(this,void 0,i),this.instance=this.unwrappedInstance.unwrap(),this.clientRepository=new Tt(e.logger.subLogger("cRep"),this),this.serverRepository=new At,3!==i.protocolVersion)throw new Error("protocol ".concat(i.protocolVersion," not supported"));n=Ht(this.instance,i,this.clientRepository,this.serverRepository,e,this),this.readyPromise=n.then((function(n){return t.protocol=n,t.client=new yt(t.protocol,t.clientRepository,t.instance,e),t.server=new St(t.protocol,t.serverRepository),t}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.serverRemoved=function(e){return this.client.serverRemoved(e)},e.prototype.serverAdded=function(e){return this.client.serverAdded(e)},e.prototype.serverMethodRemoved=function(e){return this.client.serverMethodRemoved(e)},e.prototype.serverMethodAdded=function(e){return this.client.serverMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.client.methodRemoved(e)},e.prototype.methodAdded=function(e){return this.client.methodAdded(e)},e.prototype.methodsForInstance=function(e){return this.client.methodsForInstance(e)},e.prototype.methods=function(e){return this.client.methods(e)},e.prototype.servers=function(e){return this.client.servers(e)},e.prototype.subscribe=function(e,t,n,i){return this.client.subscribe(e,t,n,i)},e.prototype.createStream=function(e,t,n,i){return this.server.createStream(e,t,n,i)},e.prototype.unregister=function(e){return this.server.unregister(e)},e.prototype.registerAsync=function(e,t){return this.server.registerAsync(e,t)},e.prototype.register=function(e,t){return this.server.register(e,t)},e.prototype.invoke=function(e,t,n,i,r,o){return this.client.invoke(e,t,n,i,r,o)},e.prototype.waitForMethod=function(e){var t=new U,n=this.client.methodAdded((function(i){i.name===e&&(n(),t.resolve(i))}));return t.promise},e}(),Vt=["subscribed","success"],Jt=function(){function e(e,t){var n=this;this.publish=function(e,t,i){var r=i||{},o=r.routingKey,s=r.target,a=n.removeEmptyValues({type:"publish",topic:e,data:t,peer_id:n.peerId,routing_key:o,target_identity:s});n.session.send(a)},this.subscribe=function(e,t,i){return new Promise((function(r,o){var s=i||{},a=s.routingKey,c=s.target,u=n.removeEmptyValues({type:"subscribe",topic:e,peer_id:n.peerId,routing_key:a,source:c});n.session.send(u).then((function(i){var o=i.subscription_id;n.subscriptions.push({subscription_id:o,topic:e,callback:t,source:c}),r({unsubscribe:function(){return n.session.send({type:"unsubscribe",subscription_id:o,peer_id:n.peerId}),n.subscriptions=n.subscriptions.filter((function(e){return e.subscription_id!==o})),Promise.resolve()}})})).catch((function(e){return o(e)}))}))},this.watchOnEvent=function(){n.session.on("event",(function(e){var t=e.data,i=e.subscription_id,r=e["publisher-identity"],o=n.subscriptions.find((function(e){return e.subscription_id===i}));o&&(o.source?n.keysMatch(o.source,r)&&o.callback(t,o.topic,r):o.callback(t,o.topic,r))}))},this.connection=e,this.logger=t,this.peerId=e.peerId,this.subscriptions=[],this.session=e.domain("bus",Vt),this.readyPromise=this.session.join(),this.readyPromise.then((function(){n.watchOnEvent()}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.removeEmptyValues=function(e){var t={};return Object.keys(e).forEach((function(n){void 0!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t},e.prototype.keysMatch=function(e,t){var n=Object.keys(e),i=!0;return n.forEach((function(n){e[n]!==t[n]&&(i=!1)})),i},e}(),Kt=function(e,t){var n,i,s,a,c,u,d,l,h,p="object"===typeof window?null!==(n=window.iodesktop)&&void 0!==n?n:window.glue42gd:void 0,f="object"===typeof window&&null!==(i=window.gdPreloadPromise)&&void 0!==i?i:Promise.resolve(),g=G("glue"),m=nt(e=e||{},t=t||{},p),v={};function y(e,t,n){(h=c.canPublish("trace"))&&c.trace("registering ".concat(e," module"));var i=function(){t.initTime=n.stop(),t.initEndTime=n.endTime,t.marks=n.marks,h&&c.trace("".concat(e," is ready - ").concat(n.endTime-n.startTime))};t.initStartTime=n.startTime,t.ready?t.ready().then((function(){i()})):i(),Array.isArray(e)||(e=[e]),e.forEach((function(e){v[e]=t,Kt[e]=t}))}function w(){var e=G("connection");s=new We(m.connection,c.subLogger("connection"));var t=Promise.resolve(m.auth);return m.connection&&!m.auth&&(p?t=p.getGWToken().then((function(e){return{gatewayToken:e}})):"undefined"!==typeof window&&(null===window||void 0===window?void 0:window.glue42electron)?"string"===typeof window.glue42electron.gwToken&&(t=Promise.resolve({gatewayToken:window.glue42electron.gwToken})):t=Promise.reject("You need to provide auth information")),t.then((function(t){var n;if(e.mark("auth-promise-resolved"),"[object Object]"!==Object.prototype.toString.call(t))throw new Error("Invalid auth object - "+JSON.stringify(t));return n=t,s.login(n)})).then((function(){return y("connection",s,e),m})).catch((function(e){throw s&&s.logout(),e}))}function b(){var e,t=G("logger");return(c=new Ue("".concat(null===(e=m.connection.identity)||void 0===e?void 0:e.application),void 0,m.customLogger)).consoleLevel(m.logger.console),c.publishLevel(m.logger.publish),c.canPublish("debug")&&c.debug("initializing glue..."),y("logger",c,t),Promise.resolve(void 0)}function _(){var e,t,n,i,r,o=G("metrics"),a=m.metrics,d=null===p||void 0===p?void 0:p.getMetricsPublishingEnabled,l=m.connection.identity,h=d||function(){return!0},f=null!==(e="boolean"!==typeof a&&a.disableAutoAppSystem)&&void 0!==e&&e;return y("metrics",u=P({connection:a?s:void 0,logger:c.subLogger("metrics"),canUpdateMetric:h,system:"Glue42",service:null!==(n=null!==(t=null===l||void 0===l?void 0:l.service)&&void 0!==t?t:null===p||void 0===p?void 0:p.applicationName)&&void 0!==n?n:m.application,instance:null!==(r=null!==(i=null===l||void 0===l?void 0:l.instance)&&void 0!==i?i:null===l||void 0===l?void 0:l.windowId)&&void 0!==r?r:Pe(),disableAutoAppSystem:f,pagePerformanceMetrics:"boolean"!==typeof a?null===a||void 0===a?void 0:a.pagePerformanceMetrics:void 0}),o),Promise.resolve()}function I(){var e=G("interop"),t={connection:s,logger:c.subLogger("interop")};return a=new zt(t),Ue.Interop=a,y(["interop","agm"],a,e),Promise.resolve()}function C(){var e=m.activities&&3===s.protocolVersion;if(m.contexts||e){var t=G("contexts");return y("contexts",d=new gt({connection:s,logger:c.subLogger("contexts"),trackAllContexts:"object"===typeof m.contexts&&m.contexts.trackAllContexts,reAnnounceKnownContexts:"object"===typeof m.contexts&&m.contexts.reAnnounceKnownContexts}),t),d}var n=s.replayer;n&&n.drain(et.name)}function S(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){return m.bus?(e=G("bus"),y("bus",l=new Jt(s,c.subLogger("bus")),e),[2,Promise.resolve()]):[2,Promise.resolve()]}))}))}function k(e){try{return e.forEach((function(e){x(e.name,e.create)})),Promise.resolve()}catch(t){return Promise.reject(t)}}function x(e,t){var n=G(e),i=t(v);i&&y(e,i,n)}function T(){var e=Object.keys(v).map((function(e){var t=v[e];return t.ready?t.ready():Promise.resolve()}));return Promise.all(e)}function A(){var n=function(e){a&&a.invoke("T42.ACS.Feedback",e,"best")},i={coreVersion:tt,version:m.version};g.stop();var r={feedback:n,info:i,logger:c,interop:a,agm:a,connection:s,metrics:u,contexts:d,bus:l,version:m.version,userConfig:e,done:function(){return null===c||void 0===c||c.info("done called by user..."),s.logout()}};if(r.performance={get glueVer(){return m.version},get glueConfig(){return JSON.stringify(e)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var e=B();return Object.keys(e).map((function(t){var n=e[t];return{name:t,duration:n.endTime-n.startTime,marks:n.marks,startTime:n.startTime,endTime:n.endTime}}))}},Object.keys(v).forEach((function(e){var t=v[e];r[e]=t})),r.config={},Object.keys(m).forEach((function(e){r.config[e]=m[e]})),t&&t.extOptions&&Object.keys(t.extOptions).forEach((function(e){r.config[e]=null===t||void 0===t?void 0:t.extOptions[e]})),(null===t||void 0===t?void 0:t.enrichGlue)&&t.enrichGlue(r),p&&p.updatePerfData&&p.updatePerfData(r.performance),r.agm){var o=function(e,t,n){return function(){return r.logger.warn("glue.js - 'glue.agm.".concat(t,"' method is deprecated, use 'glue.interop.").concat(n,"' instead.")),e.apply(r.agm,arguments)}},h=r.agm;h.method_added=o(r.agm.methodAdded,"method_added","methodAdded"),h.method_removed=o(r.agm.methodRemoved,"method_removed","methodRemoved"),h.server_added=o(r.agm.serverAdded,"server_added","serverAdded"),h.server_method_aded=o(r.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),h.server_method_removed=o(r.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return r}function E(){return r(this,void 0,void 0,(function(){var t,n,i;return o(this,(function(r){switch(r.label){case 0:if(t="T42.ACS.RegisterInstance",!L.isNode()||"undefined"!==typeof{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}._GD_STARTING_CONTEXT_||"undefined"===typeof(null===e||void 0===e?void 0:e.application))return[3,4];if(!(a.methods({name:t}).length>0))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,a.invoke(t,{appName:null===e||void 0===e?void 0:e.application,pid:process.pid})];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),i=n,c.error("Cannot register as an instance: ".concat(JSON.stringify(i.message))),[3,4];case 4:return[2]}}))}))}return f.then(b).then(w).then((function(){return Promise.all([_(),I(),C(),S()])})).then((function(){return a.readyPromise})).then((function(){return E()})).then((function(){return k(m.libs||[])})).then(T).then(A).catch((function(e){return Promise.reject({err:e,libs:v})}))};"undefined"!==typeof window&&(window.IOConnectCore=Kt),Kt.version=tt,Kt.default=Kt;class $t{constructor(e){this._id=e}get id(){return this._id}_update(e){if(e._id!==this._id)throw Error("Can not update from entity with different id.");this._updateCore(e)}_updateCore(e){}_beforeDelete(e){}}function Qt(e){return"number"===typeof e}function Yt(e){return"string"===typeof e}function Xt(e){return"object"===typeof e&&null!==e}function Zt(e){return Array.isArray?Array.isArray(e):"[object Array]"===toString.call(e)}function en(e){return"undefined"===typeof e}function tn(e){return null===e||"undefined"===typeof e}function nn(e){return"string"!==typeof e||!e||0===e.length||/^\s*$/.test(e)}function rn(e){return!0===e||!1===e||"[object Boolean]"===toString.call(e)}function on(e){return!!(e&&e.constructor&&e.call&&e.apply)}function sn(e,t){for(let n=0;n<e.length;n++)if(t(e[n],n))return!0;return!1}function an(e,t){"undefined"!==typeof e&&t(e)}function cn(e,t,n){if("function"!==typeof t&&"function"!==typeof n)return e;"function"!==typeof t?t=()=>{}:"function"!==typeof n&&(n=()=>{}),e.then(t,n)}class un extends $t{constructor(e,t,n,i){super(e),this._name=e,this._description=i,this._ownerWindow=t,this._helperWindows=n||[]}get name(){return this._name}get description(){return this._description}get helperWindows(){return this._helperWindows.map((e=>this.covertToWindowDef(e)))}get ownerWindow(){return this.covertToWindowDef(this._ownerWindow)}initiate(e,t,n){return this._manager.initiate(this._name,e,t,n)}_updateCore(e){super._updateCore(e),an(e._description,(e=>this._description=e)),an(e._ownerWindow,(e=>this._ownerWindow=e)),an(e._helperWindows,(e=>this._helperWindows=e))}covertToWindowDef(e){var t,n;return{type:null===(t=null===e||void 0===e?void 0:e.id)||void 0===t?void 0:t.type,name:null===(n=null===e||void 0===e?void 0:e.id)||void 0===n?void 0:n.name}}}class dn extends $t{constructor(e,t){super(e),this._name=e,this._appByWindowTypeGetter=t}get name(){return this._name}get config(){return this._appByWindowTypeGetter(this._name)}get windows(){return this._manager.getWindows({type:this._name})}create(e,t){const n=Object.assign({type:this.name,name:this.name,isIndependent:!1},t);return this._manager.createWindow(e,n)}}class ln{constructor(e,t){this.entity=e,this.context=t}}class hn{constructor(e){this.type=e}}class pn extends hn{constructor(e,t){super(gn.StatusChange),this.newStatus=e,this.oldStatus=t}}class fn extends hn{constructor(e,t,n){super(gn.ActivityContextChange),this.context="string"===typeof e?JSON.parse(e):e,this.updated=t,this.removed=n}}class gn{}gn.Added="added",gn.Removed="removed",gn.Updated="updated",gn.Closed="closed",gn.StatusChange="statusChange",gn.ActivityContextChange="activityContextUpdate",gn.ActivityWindowEvent="activityWindowEvent",gn.ActivityWindowJoinedActivity="joined",gn.ActivityWindowLeftActivity="left";class mn{}mn.Created="created",mn.Started="started",mn.Destroyed="destroyed";class vn{constructor(e){this._activity=e}register(e,t){this._ensureHasAgm(),vn.AGM.register(e,t)}servers(){return this._ensureHasAgm(),tn(this._activity)?[]:this._activity.windows.map((e=>e.instance))}methods(){if(this._ensureHasAgm(),tn(this._activity))return[];const e=this._activity.windows,t=[],n=[];return e.forEach((e=>{this.methodsForWindow(e).forEach((e=>{-1===t.indexOf(e.name)&&(t.push(e.name),n.push(e))}))})),n}methodsForWindow(e){return this._ensureHasAgm(),e.instance?vn.AGM.methodsForInstance(e.instance):[]}invoke(e,t,n,i,r,o){this._ensureHasAgm();const s=this.servers();if(tn(n)&&(n="activity.all"),Yt(n))if("activity.all"===n);else{if("activity.best"!==n){if("all"===n||"best"===n)return cn(vn.AGM.invoke(e,t,n,i),r,o);throw new Error("Invalid invoke target "+n)}{const t=s.filter((t=>vn.AGM.methodsForInstance(t).filter((t=>t.name===e)).length>0));t.length>0&&t[0]}}else if(Zt(n)){if(n.length>=0){const e=n[0];if(this._isInstance(e))n.map((e=>e));else{if(!this._isActivityWindow(e))throw new Error("Unknown target object");n.map((e=>e.instance))}}}else if(this._isInstance(n));else{if(!this._isActivityWindow(n))throw new Error("Unknown target object");n.instance}throw new Error("Not implemented")}unregister(e){return this._ensureHasAgm(),vn.AGM.unregister(e)}createStream(e,t,n){this._ensureHasAgm(),vn.AGM.createStream(e,{subscriptionAddedHandler:t,subscriptionRemovedHandler:n,subscriptionRequestHandler:void 0})}subscribe(e,t,n){return this._ensureHasAgm(),vn.AGM.subscribe(e,t)}_ensureHasAgm(){if(tn(vn.AGM))throw new Error("Agm should be configured to be used in activity")}_isInstance(e){return void 0!==e.application}_isActivityWindow(e){return void 0!==e.instance}}class yn{constructor(e,t,n){this._manager=e,this._ownerActivityId=t,this._state=n}get ownerId(){return this._state.ownerId}get windowIds(){return this._state.windowIds}get frameColor(){return this._state.frameColor}get context(){return this._state.context}get tag(){return this._state.tag}detach(e){e=e||{};const t={};return Object.keys(this._state).forEach((e=>{t[e]=this._state[e]})),t.context=e.context||t.context,t.frameColor=e.frameColor||t.frameColor,this._manager.detachActivities(this._ownerActivityId,t)}}const wn=e=>{setTimeout(e,0)};function bn(e,t){if(!on(t))return e;e.then((e=>{wn((()=>{t(null,e)}))}),(e=>{wn((()=>{t(e,null)}))}))}class _n extends $t{constructor(e,t,n,i,r){super(e),this._id=e,this._actType=t,this._status=n,this._context=i,this._ownerId=r,this._agm=new vn(this)}get type(){if(this._manager)return this._manager.getActivityType(this._actType)}get context(){return this._context}get status(){return this._status}get owner(){return this._ownerId?this._manager.getWindows({id:this._ownerId})[0]:null}get windows(){return this._manager.getWindows({activityId:this._id})}get agm(){return this._agm}addWindow(e,t){return this._manager.addWindowToActivity(this,e,t)}createWindow(e,t){return this._manager.createWindow(this,e,t)}createStackedWindows(e,t,n){return this._manager.createStackedWindows(this,e,t,n)}leave(e,t){return this._manager.leaveWindowFromActivity(this,e,t)}getWindowsByType(e){const t={activityId:this._id,type:e};return this._manager.getWindows(t)}setContext(e,t){return this._manager.setActivityContext(this,e,t)}updateContext(e,t){return this._manager.updateActivityContext(this,e,t)}onStatusChange(e){return this._manager.subscribeActivityEvents(((t,n,i)=>{t.id===this.id&&e(t,n,i)}))}onWindowEvent(e){return this._manager.subscribeWindowEvents(((t,n,i)=>{t.id===this.id&&e(t,n,i)}))}onContextChanged(e){this._manager.subscribeActivityContextChanged(((t,n,i,r)=>{t.id===this.id&&e(n,i,r,t)}));try{e(this.context,this.context,[],this)}catch(t){return}}stop(){this._manager.stopActivity(this)}clone(e){return this._manager.clone(this,e)}attach(e,t){let n;return n="string"===typeof e?e:e.id,this._manager.attachActivities(n,this.id,t)}onActivityAttached(e){this._manager.subscribeActivitiesAttached(((t,n,i)=>{t===this._id&&e(i)}))}onDetached(e){this._manager.subscribeActivitiesDetached(((t,n,i)=>{n.id===this._id&&e(t,i)}))}_updateCore(e){super._updateCore(e),an(e._actType,(e=>this._actType=e)),an(e._context,(e=>this._context=e)),an(e._ownerId,(e=>this._ownerId=e)),!e._status||this._status&&this._status.state===e._status.state||(this._status=e._status)}_updateDescriptors(e){this._attached=e.map((e=>new yn(this._manager,this._id,e)))}get attached(){return this._attached}setFrameColor(e,t){return bn(new Promise(((t,n)=>{let i=this.windows.length;0===i&&t(this),this.windows.forEach((n=>{n.underlyingWindow.setFrameColor(e,(()=>{i--,i<=0&&t(this)}))})),setTimeout((()=>{i>0&&n(this.id+" - timed out waiting for setFrameColor with"+e)}),5e3)})),t)}getFrameColor(){return this.windows&&0!==this.windows.length?this.windows[0].underlyingWindow.frameColor:""}}class In{}In.Trace="trace",In.Debug="debug",In.Info="info",In.Warn="warn",In.Error="error";class Cn{static GetNamed(e){return new Cn(e)}static Get(e){return new Cn(Cn.GetTypeName(e))}constructor(e){this._name=e,tn(Cn.GlueLogger)||(this._glueLogger=Cn.GlueLogger.subLogger(e))}trace(e){tn(this._glueLogger)?Cn.Level===In.Trace&&console.info(this._getMessage(e,In.Trace)):this._glueLogger.trace(e)}debug(e){tn(this._glueLogger)?Cn.Level!==In.Debug&&Cn.Level!==In.Trace||console.info(this._getMessage(e,In.Debug)):this._glueLogger.debug(e)}info(e){tn(this._glueLogger)?Cn.Level!==In.Debug&&Cn.Level!==In.Trace&&Cn.Level!==In.Info||console.info(this._getMessage(e,In.Info)):this._glueLogger.info(e)}warn(e){tn(this._glueLogger)?Cn.Level!==In.Debug&&Cn.Level!==In.Trace&&Cn.Level!==In.Info&&Cn.Level!==In.Warn||console.info(this._getMessage(e,In.Info)):this._glueLogger.warn(e)}error(e){tn(this._glueLogger)?(console.error(this._getMessage(e,In.Error)),console.trace()):this._glueLogger.error(e)}_getMessage(e,t){return"["+t+"] "+this._name+" - "+e}static GetTypeName(e){const t=/function (.{1,})\(/.exec(e.constructor.toString());return t&&t.length>1?t[1]:""}}Cn.Level=In.Info;class Sn extends $t{constructor(e,t,n,i,r,o,s,a){super(e),this._logger=Cn.Get("window"),this._type=n,this._activityId=i,this._name=t,this._instance=r,this._isIndependent=o,this._windowGetter=s,this._hcWindowId=a}getBounds(){return this._manager.getWindowBounds(this.id)}get name(){return this._name}get isIndependent(){return this._isIndependent}get type(){if(this._manager)return this._manager.getWindowType(this._type)}get activity(){if(!en(this._activityId))return this._manager.getActivityById(this._activityId)}get isOwner(){const e=this.activity;return!en(e)&&e.owner.id===this.id}setVisible(e,t){return this._manager.setWindowVisibility(this.id,e)}activate(e){return this._manager.activateWindow(this.id,e)}setBounds(e,t){return this._manager.setWindowBounds(this.id,e,t)}close(){return this._manager.closeWindow(this.id)}get instance(){return this._instance}get underlyingWindow(){const e=this._windowGetter();return e||{id:this._hcWindowId}}onActivityJoined(e){this._subscribeForActivityWindowEvent(gn.ActivityWindowJoinedActivity,e)}onActivityRemoved(e){this._subscribeForActivityWindowEvent(gn.ActivityWindowLeftActivity,e)}_updateCore(e){an(e._activityId,(e=>this._activityId=e)),an(e._isIndependent,(e=>this._isIndependent=e)),an(e._hcWindowId,(e=>this._hcWindowId=e)),an(e._type,(e=>this._type=e)),an(e._name,(e=>this._name=e)),tn(e._instance)||(this._instance=e._instance)}_subscribeForActivityWindowEvent(e,t){this._manager.subscribeWindowEvents(((n,i,r)=>{i.id===this.id&&r===e&&t(n)}))}_beforeDelete(e){this._hcWindowId=e._hcWindowId}}class kn{constructor(e,t,n){this.state=e,this.message=t,this.time=n}getState(){return this.state}getMessage(){return this.message}getTime(){return this.time}}const xn="error",Tn="add-types",An="types-added",En="remove-types",Pn="types-removed",Mn="created",Rn="destroyed",Nn="initiated",On="join-activity",jn="joined",Dn="activity-joined",Fn="leave-activity",Wn="left",Ln="merge",Un="split",qn="owner-changed",Bn="add-peer-factories",Gn="peer-factories-added",Hn="remove-peer-factories",zn="peer-factories-removed",Vn="create",Jn="create-peer",Kn="peer-requested",$n="ready",Qn="peer-created",Yn="destroy",Xn="dispose-peer",Zn="destroy-peer";class ei{static activityTypeGwMessageEntityToActivityType(e,t){const n=e=>new dn(e,void 0);return new un(e.name,e.owner_type&&n(e.owner_type),e.helper_types&&e.helper_types.map(n),t)}static peerFactoryGwMessageEntityToWindowType(e){return new dn(e.peer_type,(e=>{}))}static activityGwMessageToActivity(e,t){const n=void 0!==e.owner?e.owner.peer_id:e.owner_id;return new _n(e.activity_id,e.activity_type,t,e.context_snapshot,n)}static activityToActivityStatusChangeEvent(e){return new ln(e,new pn(e.status,void 0))}constructor(e){if(this._activityChangeCallbacks=[],this._activityTypeStatusChangeCallbacks=[],this._activityWindowChangeCallbacks=[],this._windowTypeStatusChangeCallbacks=[],this._peerIdAndFactoryIdToPeerType={},this._peerFactoriesRegisteredByUs={},this._gw3Subscriptions=[],this._contextSubscriptions={},this._activityTypesInitiatedFromMe={},this._config=e,this._connection=e.connection,this._logger=e.logger,this._contexts=e.contexts,this._windows=e.windows,this._sessionJoinedPromise=new Promise((e=>{this._sessionJoinedPromiseResolve=e})),this._activityJoinedPromise=new Promise((e=>{this._activityJoinedPromiseResolve=e})),this._config.activityId||this._activityJoinedPromiseResolve({}),this._gw3Session=this._connection.domain("activity",["joined","initiated","peer-created","token"]),"undefined"!==typeof window){const e=window.glue42gd;e&&e.activityInfo&&("function"===typeof e.addRefreshHandler&&e.addRefreshHandler(((t,n)=>{this._gw3Session.send({type:"reload"}).then((i=>{if(i.token){try{e.setGWToken(i.token)}catch(r){return void n(r.message||r)}t()}else n("Expected gateway token for refreshing.")}),n)})),e&&"function"===typeof e.addWillNavigateHandler&&e.addWillNavigateHandler(((t,n)=>{this._gw3Session.send({type:"reload"}).then((i=>{if(i.token){try{e.setGWToken(i.token)}catch(r){return void n(r.message||r)}t()}else n("Expected gateway token for refreshing.")}),n)})))}}get bridgeType(){return"GW3"}init(){this.forwardActivityTypeMessagesToStatusEventHandlers(),this.subscribe(Mn,this.handleActivityCreatedMessage),this.subscribe(Rn,this.handleActivityDestroyedMessage),this.forwardActivityMessagesToStatusEventHandlers(),this.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers(),this.forwardPeerFactoryMessagesToStatusEventHandlers(),this.forwardPeerFactoryMessagesToPeerFactoryRequests(),this.subscribe(Gn,this.handlePeerFactoriesAdded),this.subscribe(zn,this.handlePeerFactoriesRemoved),this.forwardActivityWindowMessagesToEventHandlers(),this.subscribe(Xn,(()=>{if("dispose"!==this._config.disposeRequestHandling){if("exit"===this._config.disposeRequestHandling){if(this._windows&&"undefined"!==typeof this._windows.my())return void this._windows.my().close();if("undefined"!==typeof window&&"function"===typeof window.close)return void window.close();if("undefined"!==typeof process&&"function"===typeof process.exit)return void process.exit()}}else this.dispose()})),this._gw3Session.onJoined((()=>{"trackMyOnly"===this._config.mode||"trackMyTypeAndInitiatedFromMe"===this._config.mode?this._sessionJoinedPromiseResolve(this):this._gw3Session.send({type:"subscribe",activity_types:"trackAll"===this._config.mode?[]:"trackTypes"===this._config.mode?this._config.typesToTrack:[]}).then((()=>{this._sessionJoinedPromiseResolve(this)}))})),this._gw3Session.join()}dispose(){this._gw3Subscriptions.forEach((e=>e&&this._connection.off(e))),this._gw3Subscriptions.length=0}ready(){return Promise.all([this._sessionJoinedPromise,this._activityJoinedPromise])}initReady(){return this._sessionJoinedPromise}onActivityTypeStatusChange(e){this._activityTypeStatusChangeCallbacks.push(e)}registerActivityType(e,t,n,i,r){const o={};o.name=e;const s=e=>({type:e.type,name:e.name,configuration:e});return o.owner_type=s(t),o.helper_types=n.map(s),this._gw3Session.send({type:Tn,types:[o]}).then((()=>{const e=ei.activityTypeGwMessageEntityToActivityType(o,r);return this.invokeCallbacks(this._activityTypeStatusChangeCallbacks,new ln(e,new hn(gn.Added)),Tn),e}))}unregisterActivityType(e){return this._gw3Session.send({type:En,types:[e]}).then((()=>{const t=new un(e,void 0,void 0,void 0);this.invokeCallbacks(this._activityTypeStatusChangeCallbacks,new ln(t,new hn(gn.Removed)),Tn)}))}onWindowTypeStatusChange(e){this._windowTypeStatusChangeCallbacks.push(e)}registerWindowFactory(e,t,n){if(this._peerFactoriesRegisteredByUs[e])return Promise.reject(new Error("Factory for windowType ".concat(e," already registered.")));this._peerFactoriesRegisteredByUs[e]=t;const i={id:e,peer_type:e,configuration:n};return this._gw3Session.send({type:Bn,factories:[i]}).then((()=>{this.invokeCallbacks(this._windowTypeStatusChangeCallbacks,new ln(ei.peerFactoryGwMessageEntityToWindowType(i),new hn(gn.Added)),Bn)})).catch((()=>{delete this._peerFactoriesRegisteredByUs[e]}))}unregisterWindowFactory(e){return this._peerFactoriesRegisteredByUs[e]?(delete this._peerFactoriesRegisteredByUs[e],this._gw3Session.send({type:Hn,factory_ids:[e]}).then((()=>{this.invokeCallbacks(this._windowTypeStatusChangeCallbacks,new ln(new dn(e,void 0),new hn(gn.Removed)),Bn)}))):Promise.reject(new Error("Factory for windowType ".concat(e," not registered.")))}onActivityStatusChange(e){this._activityChangeCallbacks.push(e)}initiateActivity(e,t,n){const i={type:Vn,activity_type:e,initial_context:t};return this.isOverrideTypeDefinition(n)?i.types_override={owner_type:{type:n.owner.type,name:n.owner.name,configuration:n.owner},helper_types:n.helpers&&n.helpers.map((e=>({type:e.type,name:e.name,configuration:e})))}:i.configuration=n&&n.map((e=>({type:e.type,name:e.name,configuration:e}))),this.sendCreateAndMapResultingMessagesToPromise(i,Nn,((e,t)=>e.request_id===t),Mn,((e,t,n)=>e.activity_id===n.activity_id),Rn,((e,t,n)=>e.activity_id===n.activity_id),(e=>e.activity_id),null).then((t=>"trackMyTypeAndInitiatedFromMe"!==this._config.mode||this._activityTypesInitiatedFromMe[e]?t:(this._activityTypesInitiatedFromMe[e]=!0,this._gw3Session.send({type:"subscribe",activity_types:[e]}).then((()=>t)))))}stopActivity(e){return this._gw3Session.send({type:Yn,activity_id:e.id,reason_uri:"com.tick42.glue.activity.constants.destroyReason.general",reason:"Destroying activity"}).then((e=>!0))}updateActivityContext(e,t,n,i){if(n)return this._contexts.set(e.id,t);i=i||[];for(const r of i)t[r]=null;return this._contexts.update(e.id,t)}announceWindow(e,t){throw new Error("Invalid operation 'announceWindow' for GW3 protocol")}registerWindow(e,t,n){let i="undefined"!==typeof this._connection.gatewayToken;const r=this._connection.peerId;if("undefined"!==typeof window){const e=window.glue42gd;e&&(i="undefined"!==typeof e.activityInfo)}return i&&this._gw3Session.send({type:$n}),this.invokeCallbacks(this._activityWindowChangeCallbacks,new ln(new Sn(r,t,e,void 0,this.getAgmInstance(r),n,this.generateWindowGetter(r),void 0),new hn(gn.Added)),"register window"),Promise.resolve(r)}onActivityWindowChange(e){this._activityWindowChangeCallbacks.push(e)}createWindow(e,t){t.layout||(t.left||t.width||t.height||t.top)&&(t.layout={mode:"pixels",cellSize:1});const n=n=>{if(e)return this.joinActivity(e,n,t.name).then((()=>n))};return this.sendCreateAndMapResultingMessagesToPromise({type:Jn,peer_type:t.type,peer_name:t.name||t.type,configuration:t,activity_id:e},void 0,void 0,Qn,((e,t)=>e.request_id===t),void 0,void 0,(e=>e.created_id),n).then(n)}closeWindow(e){return this._gw3Session.send({type:Zn,destroy_peer_id:e}).then((e=>{}))}getAnnouncementInfo(){let e=this._config.activityId||this._config.announcementInfo&&this._config.announcementInfo.activityId,t=this._config.announcementInfo&&this._config.announcementInfo.activityWindowType,n=this._config.announcementInfo&&this._config.announcementInfo.activityWindowIndependent,i=this._config.announcementInfo&&this._config.announcementInfo.activityWindowName;if("undefined"!==typeof window&&"undefined"!==typeof window.location&&window.location.search&&"function"===typeof URLSearchParams){const r=new URLSearchParams(location.search.slice(1));t=t||r.get("t42PeerType"),t=t||r.get("t42ActivityWindowType"),"undefined"===typeof n&&(n=r.get("t42ActivityWindowIndependent")),i=i||r.get("t42ActivityWindowName"),e=e||r.get("t42ActivityId")}return t=t||"unknown",n=n||!1,i=i||this._connection.peerId,{activityWindowId:void 0,activityId:e,activityWindowType:t,activityWindowIndependent:n,activityWindowName:i}}joinActivity(e,t,n){const i=n&&{name:n}||{};return this._gw3Session.send({type:On,target_id:t,activity_id:e,...i}).then((()=>{this.invokeCallbacks(this._activityWindowChangeCallbacks,new ln(new Sn(t,void 0,void 0,e,this.getAgmInstance(t),void 0,this.generateWindowGetter(t),void 0),new hn(gn.ActivityWindowJoinedActivity)),"activity joined - ActivityWindow"),this.invokeCallbacks(this._activityChangeCallbacks,new ln(new _n(e,void 0,new kn("created",void 0,void 0),void 0,void 0),new hn(gn.Updated)),"activity joined - Activity")}))}leaveActivity(e,t){return this._gw3Session.send({type:Fn,target_id:t,activity_id:e}).then((()=>{this.invokeCallbacks(this._activityWindowChangeCallbacks,new ln(new Sn(t,void 0,void 0,null,this.getAgmInstance(t),void 0,this.generateWindowGetter(t),void 0),new hn(gn.ActivityWindowLeftActivity)),"activity left - ActivityWindow"),this.invokeCallbacks(this._activityChangeCallbacks,new ln(new _n(e,void 0,new kn("created",void 0,void 0),void 0,void 0),new hn(gn.Updated)),"activity left - Activity")}))}getActivityTypes(){return Promise.resolve([])}getWindowTypes(){return Promise.resolve([])}getActivities(){return Promise.resolve([])}getActivityWindows(){return Promise.resolve([])}createStackedWindows(e,t,n){}getWindowBounds(e){}setWindowBounds(e,t){}activateWindow(e,t){}setWindowVisibility(e,t){}cloneActivity(e,t){}attachActivities(e,t,n){return this._gw3Session.send({type:Ln,into:t,merge:e})}detachActivities(e,t){return this._gw3Session.send({type:Un,from:e}).then((()=>""))}onActivitiesAttached(e){}onActivitiesDetached(e){}onActivityAttachedDescriptorsRefreshed(e){}getAttachedDescriptors(){return Promise.resolve([])}getRandomRequestId(){return this._connection.peerId+":"+Math.floor(1e9*Math.random())}forwardAddedAndRemovedMessagesToEventHandler(e,t,n,i){const r=e=>t=>new ln(t,new hn(e?gn.Added:gn.Removed));return[e&&this.forwardMessageToEventHandler(e,(e=>n(e,!0)),r(!0),i),t&&this.forwardMessageToEventHandler(t,(e=>n(e,!1)),r(!1),i)].filter((e=>e))}forwardMessageToEventHandler(e,t,n,i){return this.subscribe(e,(e=>{t(e).forEach((t=>i.forEach((i=>i(n(t,e))))))}))}sendCreateAndMapResultingMessagesToPromise(e,t,n,i,r,o,s,a,c){const u=this.getRandomRequestId();let d,l;const h=new Promise(((e,t)=>{d=e,l=t}));let p,f,g,m,v=null;const y=()=>{this.dropSubscription(p),c||this.dropSubscription(f),this.dropSubscription(g),this.dropSubscription(m)};p=t&&this.subscribe(t,(e=>{n(e,u)&&(v=e,this.dropSubscription(p))}));let w=!1;f=this.subscribe(i,(e=>{r(e,u,v)&&(w?c&&c(a(e)):(w=!0,d(a(e))))})),g=o&&this.subscribe(o,(e=>{s(e,u,v)&&l(e)})),m=o&&this.subscribe(xn,(e=>{e.request_id===u&&l(e)})),e.request_id=u;const b=this._gw3Session.send(e).then((()=>h));return b.then(y,y),b}peerFactoryIdAndOwnerIdToWindowType(e,t){const n=this._peerIdAndFactoryIdToPeerType[t+":"+e];return n?new dn(n,void 0):null}subscribe(e,t){const n=this._connection.on(e,(e=>t.bind(this)(e)));return this._gw3Subscriptions.push(n),n}dropSubscription(e){e&&(this._connection.off(e),delete this._gw3Subscriptions[this._gw3Subscriptions.indexOf(e)])}invokeCallbacks(e,t,n){e.forEach((e=>{try{e(t)}catch(i){this._logger.error("Error in ".concat(n||t.context.type," callback: ")+JSON.stringify(i))}}))}handleActivityCreatedMessage(e){e.context_id?this._contextSubscriptions[e.activity_id]||this.subscribeToContext(e):this._logger.error("Activity created with unknown context_id: "+e.activity_id)}async subscribeToContext(e){const t=e.activity_id;this._contextSubscriptions[t]=await this._contexts.subscribe(t,((e,n,i)=>{const r=new ln(new _n(t,void 0,void 0,e,void 0),new fn(e,n,i));this.invokeCallbacks(this._activityChangeCallbacks,r,"context updated")}))}handleActivityDestroyedMessage(e){const t=this._contextSubscriptions[e.activity_id];"function"===typeof t&&t(),delete this._contextSubscriptions[e.activity_id]}handlePeerFactoriesAdded(e){e.factories.forEach((t=>{this._peerIdAndFactoryIdToPeerType[e.owner_id+":"+t.id]=t.peer_type}))}handlePeerFactoriesRemoved(e){e.factory_ids.forEach((t=>{delete this._peerIdAndFactoryIdToPeerType[e.owner_id+":"+t]}))}forwardActivityTypeMessagesToStatusEventHandlers(){this.forwardAddedAndRemovedMessagesToEventHandler(An,Pn,((e,t)=>t?e.types.map((e=>ei.activityTypeGwMessageEntityToActivityType(e,void 0))):e.types.map((e=>new un(e.name,void 0,void 0,void 0)))),this._activityTypeStatusChangeCallbacks)}forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers(){for(const e of[Mn,jn,qn])this.forwardMessageToEventHandler(e,(e=>[e.owner||{...e,type:e.peer_type,name:e.peer_name,peer_id:e.owner_id}].concat(e.participants||[]).map((t=>new Sn(t.peer_id,t.name,t.type,e.activity_id,this.getAgmInstance(t.peer_id),void 0,this.generateWindowGetter(t.peer_id),void 0)))),((e,t)=>new ln(e,new hn(gn.ActivityWindowJoinedActivity))),this._activityWindowChangeCallbacks)}forwardActivityMessagesToStatusEventHandlers(){for(const e of[Mn,jn])this.forwardMessageToEventHandler(e,(e=>[ei.activityGwMessageToActivity(e,new kn("started","",new Date))]),((e,t)=>ei.activityToActivityStatusChangeEvent(e)),this._activityChangeCallbacks);this.forwardMessageToEventHandler(Rn,(e=>[ei.activityGwMessageToActivity(e,new kn("destroyed",e.reason,new Date))]),((e,t)=>ei.activityToActivityStatusChangeEvent(e)),this._activityChangeCallbacks),this.forwardMessageToEventHandler(Nn,(e=>[ei.activityGwMessageToActivity(e,new kn("created","",new Date))]),((e,t)=>ei.activityToActivityStatusChangeEvent(e)),this._activityChangeCallbacks),this.forwardMessageToEventHandler(qn,(e=>[ei.activityGwMessageToActivity(e,new kn("created","",new Date))]),((e,t)=>ei.activityToActivityStatusChangeEvent(e)),this._activityChangeCallbacks)}forwardPeerFactoryMessagesToStatusEventHandlers(){this.forwardAddedAndRemovedMessagesToEventHandler(Gn,zn,((e,t)=>t?e.factories.map(ei.peerFactoryGwMessageEntityToWindowType):e.factory_ids.map((t=>this.peerFactoryIdAndOwnerIdToWindowType(t,e.owner_id))).filter((e=>null!=e))),this._windowTypeStatusChangeCallbacks)}forwardPeerFactoryMessagesToPeerFactoryRequests(){this.subscribe(Kn,(e=>{const t=this._peerFactoriesRegisteredByUs[e.peer_factory];if(t)try{const n=e.configuration||{};n.gateway_token=n.gateway_token||e.gateway_token,n.peer_factory=n.peer_factory||e.peer_factory;const i=t({activityId:e.activity&&e.activity.id,activityType:e.activity&&e.activity.type,type:e.configuration&&e.configuration.type,gwToken:n.gateway_token,configuration:n});i&&i.then&&i.catch&&i.catch((t=>this._gw3Session.send({type:xn,request_id:e.request_id,reason:t&&(t.message||JSON.stringify(t))})))}catch(n){this._gw3Session.send({type:xn,request_id:e.request_id,reason:n&&(n.message||JSON.stringify(n))})}else this._gw3Session.send({type:xn,request_id:e.request_id,reason:"Unknown peer factory ".concat(e.peer_factory)})}))}forwardActivityWindowMessagesToEventHandlers(){for(const e of[Dn,jn])this.subscribe(e,(t=>{const n=e===Dn?t.joined_id:t.peer_id,i=e===Dn?t.joined_type:t.peer_type,r=e===Dn?t.joined_name:t.peer_name,o=new Sn(n,r,i,t.activity_id,this.getAgmInstance(n),void 0,this.generateWindowGetter(n),void 0);this._contextSubscriptions[t.activity_id]?e===jn&&this._activityJoinedPromiseResolve({}):this.subscribeToContext(t).then((()=>{e===jn&&this._activityJoinedPromiseResolve({})})),this.invokeCallbacks(this._activityWindowChangeCallbacks,new ln(o,new hn(gn.ActivityWindowJoinedActivity)),e)}));this.subscribe(Wn,(e=>{const t=new Sn(e.left_id,void 0,void 0,null,this.getAgmInstance(e.left_id),void 0,this.generateWindowGetter(e.left_id),void 0);this.invokeCallbacks(this._activityWindowChangeCallbacks,new ln(t,new hn(gn.ActivityWindowLeftActivity)),Wn)})),this.forwardAddedAndRemovedMessagesToEventHandler(Qn,void 0,(e=>[new Sn(e.created_id,void 0,void 0,void 0,void 0,void 0,this.generateWindowGetter(e.created_id),void 0)]),this._activityWindowChangeCallbacks)}getAgmInstance(e){return this._config.agm.servers().find((t=>t.peerId===e||t.windowId===e))}generateWindowGetter(e){return()=>{const t=this.getAgmInstance(e);if(!t)return;const n=t.windowId;return this._config.windows.list().filter((e=>e.id===n))[0]}}isOverrideTypeDefinition(e){return"undefined"!==typeof e&&!!e.owner}}class ti{constructor(e,t){this._myAttached=[],this._myDetached=[],this._myAttachedTo=[],this._myDetachedFrom=[],this._myActivityFrameColorChanged=[],this._myActivityJoinedCallbacks=[],this._myActivityRemovedCallbacks=[],this._myContextUpdateCallbacks=[],this._logger=Cn.Get(this),this._m=e,e.ready().then((e=>{e.subscribeActivityContextChanged(this._subscribeMyContextChanged.bind(this)),e.subscribeWindowEvents(this._subscribeMyWindowEvent.bind(this)),e.subscribeActivitiesAttached(this._subscribeActivitiesAttached.bind(this)),e.subscribeActivitiesDetached(this._subscribeActivitiesDetached.bind(this)),t&&t.onWindowFrameColorChanged(this._subscribeWindowFrameColorChanged.bind(this))}))}get window(){if(tn(this._w)){const e=this._m.announcedWindows;e.length>0&&(this._w=e[0])}return this._w}get activity(){const e=this.window;if(!tn(e))return e.activity}createWindow(e){return this._m.createWindow(this.activity,e)}createStackedWindows(e,t){return this._m.createStackedWindows(this.activity,e,t)}get context(){const e=this.activity;return en(e)?{}:e.context}updateContext(e,t){const n=this.activity;return en(n)?new Promise(((e,t)=>{t("Not in activity")})):n.updateContext(e,t)}setContext(e,t){const n=this.activity;return en(n)?new Promise(((e,t)=>{t("Not in activity")})):n.setContext(e,t)}onActivityJoined(e){this._myActivityJoinedCallbacks.push(e);const t=this.window;tn(t)||tn(t.activity)||e(t.activity)}onActivityLeft(e){this._myActivityRemovedCallbacks.push(e)}onContextChanged(e){this._myContextUpdateCallbacks.push(e);const t=this.window;if(tn(t))return;const n=t.activity;tn(n)||e(n.context,n.context,[],n)}clone(e,t){const n=this.activity;return this._m.clone(n,e,t)}attach(e,t){let n;return n="string"===typeof e?e:e.id,this._m.attachActivities(n,this.activity.id,t)}onActivityAttached(e){this._myAttached.push(e)}onActivityDetached(e){this._myDetached.push(e)}onAttachedToActivity(e){this._myAttachedTo.push(e)}onDetachedFromActivity(e){this._myDetachedFrom.push(e)}get attached(){return this.activity?this.activity.attached:[]}setFrameColor(e,t){return this.activity?this.activity.setFrameColor(e,t):Promise.resolve(null)}getFrameColor(){return this.activity?this.activity.getFrameColor():""}onFrameColorChanged(e){this._myActivityFrameColorChanged.push(e)}_subscribeMyContextChanged(e,t,n,i){const r=this.window;if(tn(r))return;const o=r.activity;tn(o)||e.id===o.id&&this._notifyMyContextChanged(e,t,n,i)}_subscribeMyWindowEvent(e,t,n){tn(this.window)||this.window.id===t.id&&(n===gn.ActivityWindowJoinedActivity?(this._notifyMyWindowEvent(e,this._myActivityJoinedCallbacks),this._notifyMyContextChanged(e,e.context,null,null)):n===gn.ActivityWindowLeftActivity&&this._notifyMyWindowEvent(e,this._myActivityRemovedCallbacks))}_notifyMyWindowEvent(e,t){t.forEach((t=>{try{t(e,event)}catch(n){this._logger.warn("error in user callback "+n)}}))}_notifyMyContextChanged(e,t,n,i){n=n||{},i=i||[],this._myContextUpdateCallbacks.forEach((r=>{try{r(t,n,i,e)}catch(o){this._logger.warn("error in user callback "+o)}}))}_notifyAttached(e){this._myAttached.forEach((t=>{try{t(e)}catch(n){this._logger.warn("error in user callback "+n)}}))}_notifyDetached(e){this._myDetached.forEach((t=>{try{t(e)}catch(n){this._logger.warn("error in user callback "+n)}}))}_notifyAttachedTo(e){this._myAttachedTo.forEach((t=>{try{t(this.activity,e)}catch(n){this._logger.warn("error in user callback "+n)}}))}_notifyDetachedFrom(e,t,n){this._myDetachedFrom.forEach((i=>{try{i(e,t,n)}catch(r){this._logger.warn("error in user callback "+r)}}))}_subscribeActivitiesAttached(e,t){const n=this.window;if(tn(n))return;const i=n.activity;tn(i)||e.id===i.id&&(t.windowIds.indexOf(n.id)>=0?this._notifyAttachedTo(t):this._notifyAttached(t))}_subscribeActivitiesDetached(e,t,n){const i=this.window;if(tn(i))return;const r=i.activity;tn(r)||(t.id===r.id&&this._notifyDetached(n),e.id===r.id&&this._notifyDetachedFrom(e,t,n))}_subscribeWindowFrameColorChanged(e){const t=this.activity;t&&t.owner&&t.owner.underlyingWindow.id===e.id&&this._myActivityFrameColorChanged.forEach((t=>{t(e.frameColor)}))}}class ni{constructor(e,t){if(this._logger=Cn.Get("ReadyMarker ["+e+"]"),this._logger.debug("Initializing ready marker for '"+e+"' with "+t+" signals to wait"),t<=0)throw new Error("Invalid signal number. Should be > 0");this._signals=t,this._callbacks=[],this._name=e}setCallback(e){this.isSet()?e(void 0):this.isError()?e(this._error):this._callbacks.push(e)}signal(e){if(this._logger.debug("Signaled - "+e+" - signals left "+(this._signals-1)),this._signals--,this._signals<0)throw new Error("Error in ready marker '"+this._name+" - signals are "+this._signals);this.isSet()&&this._callbacks.forEach((e=>{e(void 0)}))}error(e){this._error=e,this._callbacks.forEach((t=>{t(e)}))}isSet(){return!this.isError()&&0===this._signals}isError(){return!en(this._error)}getError(){return this._error}}class ii{constructor(e){this._items={},this._listeners=[],this._processNew=e}addOne(e){this.add([e])}add(e){e.forEach((e=>{this.process(new ln(e,new hn(gn.Added)))}))}process(e){const t=e.context,n=t.type,i=e.entity;if(n===gn.StatusChange&&!t.oldStatus){const e=this._items[i.id];e&&(t.oldStatus=e.status)}n===gn.StatusChange&&t.oldStatus&&t.newStatus&&t.oldStatus.state===t.newStatus.state&&(t.type=gn.Updated),"undefined"===typeof htmlContainer&&(n===gn.ActivityWindowJoinedActivity&&this._items[i.id]&&this._items[i.id].activity&&(t.type=gn.Updated),n===gn.ActivityWindowLeftActivity&&this._items[i.id]&&!this._items[i.id].activity&&(t.type=gn.Updated));const r=this._updateInternalCollections(i,n,t);return this._notifyListeners(r,t),r}get(){const e=[];for(const t in this._items)if(this._items.hasOwnProperty(t)){const n=this._items[t];e.push(n)}return e}getByName(e){for(const t in this._items)if(t===e)return this._items[t]}getOrWait(e){return new Promise((t=>{const n=i=>{i.id===e&&(t(i),this.unsubscribe(n))};this.subscribe(n);const i=this.getByName(e);if(i)return this.unsubscribe(n),void t(i)}))}subscribe(e){return this._listeners.push(e),Object.keys(this._items).forEach((t=>{const n=this._items[t];e(n,new hn(gn.Added.toString()))})),()=>{this.unsubscribe(e)}}unsubscribe(e){const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}_notifyListeners(e,t){this._listeners.forEach((n=>{try{n(e,t)}catch(i){return}}))}_updateInternalCollections(e,t,n){const i=e,r=t===gn.StatusChange&&i.status&&i.status.state===mn.Destroyed||t===gn.StatusChange&&n&&n.newStatus&&n.newStatus.state===mn.Destroyed,o=t===gn.Closed;if(t===gn.Removed&&"undefined"===typeof i.isIndependent||o||r){const t=this._items[e.id];return delete this._items[e.id],this._processNew(e),t&&e._beforeDelete(t),e}{const t=e.id;this._items.hasOwnProperty(t)?this._items[e.id]._update(e):(this._processNew(e),this._items[e.id]=e)}return this._items[e.id]}}class ri{get usingHc(){return"HC"===this._bridge.bridgeType}get announcedWindows(){return this._announcedWindows}set announcedWindows(e){throw new Error("not allowed")}constructor(e,t,n){this._logger=Cn.Get("activityManager"),this._announcedWindows=[],this._attachedCallbacks=[],this._detachedCallbacks=[],this._frameColorChangesCallbacks=[],this._windowHandlers=[],this._bridge=e,this._activityTypes=new ii((e=>this._grabEntity(e))),this._windowTypes=new ii((e=>this._grabEntity(e))),this._activities=new ii((e=>this._grabEntity(e))),this._windows=new ii((e=>this._grabEntity(e))),this._dataReadyMarker=new ni("Activity Manager Data",4),this._descriptorsMarker=new ni("Attached Activities Descriptors",1),t?(this._readyMarker=new ni("Activity Manager Announce",1),this._dataReadyMarker.setCallback((e=>{e&&this._readyMarker.error(e),this._descriptorsMarker.setCallback((e=>{e&&this._readyMarker.error(e),this._logger.debug("Auto announcing window"),this.announceWindow().then((e=>{this._announcedWindows.push(e),this._readyMarker.signal("Successfully announced window with id '"+e.id+"'")})).catch((e=>{this._logger.debug("Will not announce window - "+e),this._readyMarker.signal()}))})),this.refreshDescriptors()}))):this._readyMarker=this._dataReadyMarker,this._bridge.onActivitiesAttached((e=>{this._handleActivitiesAttached(e)})),this._bridge.onActivitiesDetached((e=>{this._handleActivitiesDetached(e)})),this._bridge.onActivityAttachedDescriptorsRefreshed((e=>{this._handleActivityDescriptorsRefreshed(e)})),n&&n.onWindowFrameColorChanged(this._handleWindowFrameColorChanged.bind(this)),this._bridge.init(),this._subscribeForData(),this._bridge.initReady().then((e=>{this._getInitialData()})).catch((e=>{console.log(e)}))}ready(e){const t=new Promise(((e,t)=>{this._readyMarker.setCallback((n=>{n?t(this._readyMarker.getError()):e(this)}))}));return bn(Promise.all([this._bridge.ready(),t]).then((()=>this)),e)}getActivityTypes(){return this._activityTypes.get()}getActivityType(e){return this._activityTypes.getByName(e)}registerActivityType(e,t,n,i,r,o){return bn(new Promise(((o,s)=>{if(tn(e))return void s("activityTypeName argument can not be undefined");if(!Yt(e))return void s("activityTypeName should be string");if(!tn(this.getActivityType(e)))return void s("Activity type '"+e+"' already exists");let a;if(en(t))return void s("Owner window type can not be undefined");a=Yt(t)?{type:t,name:"",isIndependent:!1,arguments:{}}:t;const c=[];if(!en(n)&&Zt(n))for(const e in n){const t=n[e];if(Yt(t)){const e={type:t,name:"",isIndependent:!1,arguments:{},relativeTo:"",relativeDirection:"",windowStyleAttributes:{}};c.push(e)}else c.push(t)}this._bridge.registerActivityType(e,a,c,i,r).then((e=>{this._grabEntity(e),o(e)})).catch((e=>{s(e)}))})),o)}unregisterActivityType(e,t){return bn(new Promise(((t,n)=>{const i=this.getActivityType(e);en(i)?n("Activity type '"+e+"' does not exists"):this._bridge.unregisterActivityType(e).then((()=>t(i)),n)})),t)}initiate(e,t,n,i){return bn(new Promise(((n,r)=>{en(this.getActivityType(e))?r("Activity type '"+e+"' does not exists"):this._bridge.initiateActivity(e,t,i).then((e=>{this._activities.getOrWait(e).then((e=>{n(e)})).catch((e=>r(e)))})).catch((e=>{r(e)}))})),n)}subscribeActivityTypeEvents(e){this._activityTypes.subscribe(((t,n)=>{e(t,n.type)}))}getWindowTypes(){return this._windowTypes.get()}getWindowType(e){return this._windowTypes.getByName(e)}registerWindowFactory(e,t,n){return bn(new Promise(((n,i)=>{if(tn(e))i("no windowType specified");else{if(Xt(e))e=e.getName();else if(!Yt(e))return void i("windowType should be string or object that has getName method");this._bridge.registerWindowFactory(e,t).then((e=>{n(e)})).catch((e=>{i(e)}))}})),n)}unregisterWindowFactory(e,t){return bn(new Promise(((t,n)=>{tn(e)?n("no windowType specified"):Yt(e)?this._bridge.unregisterWindowFactory(e).then((e=>{t(e)})).catch((e=>{n(e)})):n("windowType should be a string")})),t)}getActivities(e){let t=this._activities.get();if(t=t.filter((e=>e._ownerId)),!e)return t;let n=e;if(Yt(e))n=[e];else if(e instanceof un)n=[e.name];else if(!(e instanceof Array))throw new Error("Invalid input argument 'activityType' = "+e);return t.filter((e=>{const t=e.type;return sn(n,(e=>t.id===e.id))}))}getActivityById(e){return this._activities.getByName(e)}announceWindow(e,t){return new Promise(((n,i)=>{const r=this._bridge.getAnnouncementInfo();if(en(e)&&(e=r.activityWindowId),en(t)&&(t=r.activityWindowType),tn(t))throw new Error("Can not announce - unknown windowType");const o=r&&r.activityId;if(tn(e))this._logger.debug("Registering window with type:'"+t+"', name:'"+r.activityWindowName+"', ind.:'"+r.activityWindowIndependent+"'"),this._bridge.registerWindow(t,r.activityWindowName,r.activityWindowIndependent).then(this._windows.getOrWait.bind(this._windows)).then((e=>o?this._activities.getOrWait(o).then((t=>e)):e)).then((e=>{n(e)})).catch((e=>{this._logger.error(e)}));else{this._logger.debug("Announcing window with id '"+e+"' and type '"+t+"'");const r=this._windows.getByName(e);if(!tn(r))return this._logger.debug("Window with id '"+e+"' already announced - reusing the window"),void n(r);const o=(t,r,s)=>{e===r.id&&s===gn.ActivityWindowJoinedActivity&&(en(r.activity)&&i("UNDEFINED ACTIVITY"),this._logger.trace("Got joined event for id '"+e+"'"),n(r),this.unsubscribeWindowEvents(o))};this.subscribeWindowEvents(o),this._logger.trace("Waiting for joined event for id '"+e+"'"),this._bridge.announceWindow(t,e)}}))}subscribeWindowTypeEvents(e){this._windowTypes.subscribe(((t,n)=>{e(t,n.type)}))}subscribeActivityEvents(e){return this._activities.subscribe(((t,n)=>{if(n.type===gn.StatusChange){const i=n;e(t,i.newStatus,i.oldStatus)}if(n.type===gn.Removed||n.type===gn.StatusChange&&n.newStatus.getState()===mn.Destroyed)for(const e of this._windows.get())e.activity&&e.activity.id===t.id&&this._windows.process(new ln(e,new hn(gn.ActivityWindowLeftActivity)))}))}subscribeWindowEvents(e){const t=(t,n)=>{let i=n.type;i===gn.Added&&(i="opened"),e(t.activity,t,i)};return this._windowHandlers.push([e,t]),this._windows.subscribe(t)}unsubscribeWindowEvents(e){const t=this._windowHandlers.find((t=>t[0]===e));t&&(this._windowHandlers.splice(this._windowHandlers.indexOf(t),1),this._windows.unsubscribe(t[1]))}createWindow(e,t,n){return bn(new Promise(((n,i)=>{let r,o;if(tn(t)&&i("windowType is undefined"),Yt(t))r={type:t,name:"",isIndependent:!1,arguments:{}};else if(t instanceof dn)r={type:t.type||t.id,name:t.name||t.type||t.id,isIndependent:!1};else{const e=["url"],n={};Object.keys(t).forEach((i=>{-1===e.indexOf(i)&&(n[i]=t[i])})),r=n}if(!tn(r.relativeTo))if(o=r.relativeTo,"string"===typeof o){const e=this.getWindows({type:o});!tn(e)&&e.length>0&&(r.relativeTo=e[0].id)}else if(tn(o.type))tn(o.windowId)||(r.relativeTo=o.windowId);else{const e=this.getWindows({type:o.type});!tn(e)&&e.length>0&&(r.relativeTo=e[0].id)}this._bridge.createWindow(e&&e.id,r).then((t=>{this._logger.debug("Window created, waiting for window entity with id "+t);const i=(r,o)=>{r.id!==t||e&&!r.activity||(this._logger.debug("Got entity window with id "+t),n(r),this._windows.unsubscribe(i))};this._windows.subscribe(i)})).catch((e=>{i(e)}))})),n)}createStackedWindows(e,t,n,i){return bn(new Promise(((i,r)=>{tn(e)&&r("activity is undefined"),tn(t)&&r("relativeWindowTypes is undefined"),Array.isArray(t)||r("relativeWindowTypes has to be an array"),tn(n)&&(n=2e4);const o=[];t.forEach((e=>{let t,i;if(t=Yt(e)?{type:e,name:"",isIndependent:!1,arguments:{}}:e,t.stackedWindow=!0,t.timeout=n,!tn(t.relativeTo))if(i=t.relativeTo,tn(i.type)){if(!tn(i.windowId)){const e=this.getWindows({id:i.windowId});!tn(e)&&e.length>0&&(t.relativeTo=e[0].type.name)}}else t.relativeTo=i.type;o.push(t)}));const s=[];o.forEach((t=>s.push(this.createWindow(e,t)))),Promise.all(s).then(i).catch(r)})),i)}addWindowToActivity(e,t,n){const i=this._bridge.joinActivity(e.id,t.id).then((()=>t));return bn(i,n),i}leaveWindowFromActivity(e,t,n){const i=this._bridge.leaveActivity(e.id,t.id).then((()=>t));return bn(i,n),i}setActivityContext(e,t,n){return bn(new Promise(((n,i)=>{tn(e)&&i("activity can not be null"),this._bridge.updateActivityContext(e,t,!0).then((t=>{n(e)})).catch((e=>{i(e)}))})),n)}updateActivityContext(e,t,n){return bn(new Promise(((n,i)=>{tn(e)&&i("activity can not be null");const r=[];for(const e in t)t.hasOwnProperty(e)&&null===t[e]&&r.push(e);for(const e of r)delete t[e];this._bridge.updateActivityContext(e,t,!1,r).then((t=>{n(e)})).catch((e=>{i(e)}))})),n)}subscribeActivityContextChanged(e){this._activities.subscribe(((t,n)=>{if(n.type===gn.ActivityContextChange){const i=n;e(t,i.context,i.updated,i.removed)}}))}stopActivity(e,t){return bn(this._bridge.stopActivity(e),t)}getWindows(e){return en(e)?this._windows.get():en(e.id)?this._windows.get().filter((t=>{if(!en(e.type)&&t.type.id!==e.type)return!1;if(!en(e.name)&&t.name!==e.name)return!1;if(!en(e.activityId)){if(tn(t.activity))return!1;if(t.activity.id!==e.activityId)return!1}return!0})):[this._windows.getByName(e.id)]}getWindowBounds(e){return this._bridge.getWindowBounds(e)}setWindowBounds(e,t,n){return bn(new Promise(((n,i)=>{this._bridge.setWindowBounds(e,t).then((()=>n())).catch((e=>i(e)))})),n)}closeWindow(e){return this._bridge.closeWindow(e)}activateWindow(e,t){return this._bridge.activateWindow(e,t)}setWindowVisibility(e,t){return this._bridge.setWindowVisibility(e,t)}clone(e,t,n){return bn(new Promise(((n,i)=>{e||i("activity can not be null"),this._bridge.cloneActivity(e.id,t).then((e=>{this._activities.getOrWait(e).then((e=>{n(e)})).catch((e=>i(e)))})).catch((e=>i(e)))})),n)}attachActivities(e,t,n,i){return n=n||{},bn(new Promise(((i,r)=>{if(this._activities.getByName(e))return this._activities.getByName(t)?this._bridge.attachActivities(e,t,n).then((e=>{const t=e.to,n=e.descriptor,r=e.descriptors;this._activities.getOrWait(t).then((e=>{e._updateDescriptors(r);const t=e.attached.filter((e=>e.ownerId===n.ownerId))[0];i(t)}))})).catch((e=>{r(e)})):void r("can not find activity with id "+t);r("can not find activity with id "+e)})),i)}detachActivities(e,t,n){return bn(new Promise(((n,i)=>this._bridge.detachActivities(e,t).then((()=>{const e=void 0,t=void 0,r=void 0;this._activities.getOrWait(e).then((e=>{e._updateDescriptors(r),this._activities.getOrWait(t).then((e=>{n(e)}))})).catch((e=>i(e)))})).catch((e=>{i(e)})))),n)}subscribeActivitiesAttached(e){this._attachedCallbacks.push(e)}subscribeActivitiesDetached(e){this._detachedCallbacks.push(e)}subscribeActivityFrameColorChanged(e){this._frameColorChangesCallbacks.push(e)}_grabEntity(e){e._manager=this}_getInitialData(){this._logger.debug("Request initial data..."),this._bridge.getActivityTypes().then((e=>{this._activityTypes.add(e),this._dataReadyMarker.signal("Got act types")})).catch((e=>{this._logger.error(e),this._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity types -"+e)})),this._bridge.getWindowTypes().then((e=>{this._windowTypes.add(e),this._dataReadyMarker.signal("Got window types")})).catch((e=>{this._logger.error(e),this._dataReadyMarker.error("Can not initialize ActivityManager - error getting window types  "+e)})),this._bridge.getActivities().then((e=>{this._activities.add(e),this._dataReadyMarker.signal("Got activities")})).catch((e=>{this._logger.error(e),this._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity instances -"+e)})),this._bridge.getActivityWindows().then((e=>{this._windows.add(e),this._dataReadyMarker.signal("Got windows")})).catch((e=>{this._logger.error(e),this._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity windows -"+e)}))}_subscribeForData(){this._logger.debug("Subscribe for data..."),this._bridge.onActivityTypeStatusChange((e=>{this._activityTypes.process(e)})),this._bridge.onWindowTypeStatusChange((e=>{this._windowTypes.process(e)})),this._bridge.onActivityWindowChange((e=>{this._windows.process(e)})),this._bridge.onActivityStatusChange((e=>{this._activities.process(e)}))}_handleActivitiesAttached(e){const t=e.to,n=e.descriptor,i=e.descriptors;this._activities.getOrWait(t).then((e=>{e._updateDescriptors(i);const t=e.attached.filter((e=>e.ownerId===n.ownerId))[0];this._attachedCallbacks.forEach((n=>{try{n(e,t)}catch(i){return}}))}))}_handleActivitiesDetached(e){const t=e.oldActivityId,n=e.newActivityId,i=e.descriptors,r=e.descriptor;this._activities.getOrWait(t).then((e=>{e._updateDescriptors(i),this._activities.getOrWait(n).then((t=>{this._detachedCallbacks.forEach((n=>{try{n(t,e,r)}catch(i){return}}))}))}))}_handleActivityDescriptorsRefreshed(e){const t=e.id,n=e.descriptors,i=this._activities.getByName(t);i&&i._updateDescriptors(n)}refreshDescriptors(){this._bridge.getAttachedDescriptors().then((e=>{e&&Object.keys(e).forEach((t=>{const n=t,i=e[t],r=this._activities.getByName(n);r&&r._updateDescriptors(i)})),this._descriptorsMarker.signal("Successfully got descriptors")})).catch((e=>{this._descriptorsMarker.error("failed to get descriptors - "+e)}))}_handleWindowFrameColorChanged(e){if(!e.activityId)return;const t=this._activities.getByName(e.activityId);t&&t.owner&&t.owner.underlyingWindow.id===e.id&&this._frameColorChangesCallbacks.forEach((n=>{try{n(t,e.frameColor)}catch(i){return}}))}}class oi{constructor(e,t){this._m=e,this._my=t,this.activityTypes={get:this._getActivityTypesWrapper.bind(this),register:this._m.registerActivityType.bind(this._m),unregister:this._m.unregisterActivityType.bind(this._m),subscribe:this._m.subscribeActivityTypeEvents.bind(this._m),unsubscribe:void 0,initiate:this._m.initiate.bind(this._m)},this.windowTypes={get:this._getWindowTypesWrapper.bind(this),registerFactory:this._m.registerWindowFactory.bind(this._m),unregisterFactory:this._m.unregisterWindowFactory.bind(this._m),subscribe:this._m.subscribeWindowTypeEvents.bind(this._m),unsubscribe:void 0},this.windows={get:this._m.getWindows.bind(this._m),subscribe:this._m.subscribeWindowEvents.bind(this._m),announce:this._m.announceWindow.bind(this._m),unsubscribe:void 0,create:this._m.createWindow.bind(this._m)},this.instances={get:this._m.getActivities.bind(this._m),subscribe:this._m.subscribeActivityEvents.bind(this._m),unsubscribe:void 0}}onAttached(e){this._m.subscribeActivitiesAttached(e)}onDetached(e){this._m.subscribeActivitiesDetached(e)}onActivityFrameColorChanged(e){this._m.subscribeActivityFrameColorChanged(e)}_getActivityTypesWrapper(e){return en(e)?this._m.getActivityTypes():this._m.getActivityType(e)}_getWindowTypesWrapper(e){return en(e)?this._m.getWindowTypes():this._m.getWindowType(e)}}class si{constructor(e,t){this._mgr=e,this._my=t,this.all=new oi(e,t)}ready(e){return bn(new Promise(((e,t)=>{this._mgr.ready().then((()=>{e(this)})).catch((e=>{t(e)}))})),e)}get my(){return this._my}get aware(){return void 0!==this._my.window}get inActivity(){return this.aware&&void 0!==this._my.activity}get agm(){if(this.aware)return this.inActivity?this._my.activity.agm:new vn(null)}getAvailableFrameColors(){return[]}}class ai{static checkIsUsingGW3Implementation(e){return 3===e.protocolVersion}get api(){return this._api}set api(e){this._api=e}constructor(e){if(!e)throw new Error("config can not be null");let t;if(en(e.logLevel)||(Cn.Level=e.logLevel),tn(e.logger)||(Cn.GlueLogger=e.logger),this._isUsingHCImplementation=2===e.gdMajorVersion,this._isUsingGW3Implementation=ai.checkIsUsingGW3Implementation(e.connection),this._isUsingHCImplementation)throw new Error("GD2 not supported");if(!this._isUsingGW3Implementation)throw new Error("Unable to instantiate activity bridge implementation");if(t=new ei(e),!t)throw new Error("A bridge to native activity is needed to create activity lib.");vn.AGM=e.agm;const n=new ri(t,!e.disableAutoAnnounce,e.windows),i=new ti(n,e.windows);this._api=new si(n,i),this._readyPromise=n.ready().then((e=>this))}get isUsingHCImplementation(){return this._isUsingHCImplementation}get isUsingGW3Implementation(){return this._isUsingGW3Implementation}ready(e){return bn(this._readyPromise,e)}}const ci="T42.ACS.Shutdown",ui="T42.ACS.OnGDShutdown",di="T42.ACS.Restart",li="T42.ACS.GetConfigurationRegion",hi="T42.ACS.SetConfigurationRegion",pi="T42.ACS.GetUser",fi="T42.ACS.GetBranches",gi="T42.ACS.GetCurrentBranch",mi="T42.ACS.SetCurrentBranch",vi="T42.ACS.GetFunctionalEntitlement",yi="T42.ACS.CanI",wi="T42.ACS.StartApplication",bi="T42.ACS.StopApplication",_i="T42.ACS.ActivateApplication",Ii="T42.ACS.OnEvent",Ci="T42.ACS.GetApplications";function Si(e){if(e&&e.errorHandling&&"function"!==typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"===typeof e.errorHandling&&e.errorHandling,n={};function i(e,t,i){var r=n[e];return r||(r=[],n[e]=r),r.push(t),i&&setTimeout((function(){i.forEach((function(i){var r;if(null===(r=n[e])||void 0===r?void 0:r.includes(t))try{Array.isArray(i)?t.apply(void 0,i):t.apply(void 0,[i])}catch(s){o(s,e)}}))}),0),function(){var i=n[e];i&&(0===(i=i.reduce((function(e,n,i){return n===t&&e.length===i||e.push(n),e}),[])).length?delete n[e]:n[e]=i)}}function r(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var r=n[e];if(!r||0===r.length)return[];var s=[];return r.forEach((function(n){try{var i=n.apply(void 0,t);s.push(i)}catch(r){s.push(void 0),o(r,e)}})),s}function o(n,i){var r=n instanceof Error?n:new Error(n);if(t)t(r);else{var o='[ERROR] callback-registry: User callback for key "'+i+'" failed: '+r.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}function s(){n={}}function a(e){n[e]&&delete n[e]}return{add:i,execute:r,clear:s,clearKey:a}}Si.default=Si;var ki=Si;function xi(e){return e?Object.keys(e).map((t=>e[t])):[]}function Ti(e){let t;try{t=JSON.parse(JSON.stringify(e||{}))}catch(n){t={}}return t}function Ai(e,t){if(t.throwErrors&&"function"!==typeof e)throw new Error("Please provide the callback as a function!")}class Ei{constructor(e,t,n,i){this._appManager=e,this._name=t,this._agm=n,this._configuration=i,this._registry=ki(),e.onInstanceStarted((e=>{e.application&&e.application.name!==this._name||this._registry.execute("instanceStarted",e)})),e.onInstanceStopped((e=>{e.application&&e.application.name!==this._name||this._registry.execute("instanceStopped",e)})),e.onAppRemoved((e=>{e.name===this._name&&this._registry.execute("appRemoved",e)})),e.onAppChanged((e=>{e.name===this._name&&this._registry.execute("appChanged",e)})),e.onAppAvailable((e=>{e.name===this._name&&(this._props.IsReady=!0,this._registry.execute("appAvailable",e))})),e.onAppUnavailable((e=>{e.name===this._name&&(this._props.IsReady=!1,this._registry.execute("appUnavailable",e))}))}get name(){return this._name}get title(){return this._props.Title}get version(){return this._props.Version}get autoStart(){return this._props.AutoStart}get isShell(){return this._props.IsShell}get caption(){return this._props.Caption}get hidden(){return this._props.IsHidden}get container(){return this._props.ApplicationName}get activityType(){return this._props.ActivityType}get activityWindowType(){return this._props.ActivityWindowType}get windowSettings(){return this._props.Arguments?Ti(this._props.Arguments):{}}get allowMultiple(){return this._props.AllowMultiple}get available(){return this._props.IsReady||!0}get icon(){return this._props.Icon}get iconURL(){return this._props.IconUrl}get sortOrder(){return this._props.SortOrder}get userProperties(){return this._props.UserProperties?Ti(this._props.UserProperties):{}}get keywords(){return this._props.Keywords?this._props.Keywords:[]}get isActivity(){return void 0!==this._props.ActivityType&&""!==this._props.ActivityType}get configuration(){return{autoStart:this._props.AutoStart,caption:this._props.Caption,hidden:this._props.IsHidden,container:this._props.ApplicationName,activityType:this._props.ActivityType,allowMultiple:this._props.AllowMultiple}}get instances(){return this._appManager.instances().filter((e=>e.application.name===this._name))}get type(){return this._props.Type}get mode(){if(!this._props)return"unknown";if(this._props.Mode&&"string"===typeof this._props.Mode)return this._props.Mode.toLowerCase();if(this.isActivity)return"unknown";if(this._props.Arguments&&this._props.Arguments.mode&&"string"===typeof this._props.Arguments.mode)return this._props.Arguments.mode.toLowerCase();let e=this._props.WindowStyleAttributes;if(e){e=e.split(" ").join("");const t='mode:"',n=e.indexOf(t);if(-1!==n){const i=n+t.length,r=e.indexOf('"',i),o=e.substr(i,r-i);if(o&&"string"===typeof o)return o.toLowerCase()}}return"flat"}async getConfiguration(){return(await this._agm.invoke(Ci,{v2:{apps:[this._name]}})).returned.applications[0]}updateFromProps(e){this._props||(this._props={Name:e.Name}),Object.keys(e).forEach((t=>{this._props[t]=e[t]}))}start(e,t){return new Promise((async(n,i)=>{var r,o,s,a,c;const u=this._name;let d=6e4;if(tn(e))e={};else if((null===(r=this._configuration())||void 0===r?void 0:r.throwErrors)&&"object"!==typeof e||Array.isArray(e))return i(new Error('Invalid "context" parameter - must be an object.'));if(tn(t))t={};else if((null===(o=this._configuration())||void 0===o?void 0:o.throwErrors)&&"object"!==typeof t)return i(new Error('Invalid "options" parameter - must be an object.'));let l=null===(a=null!==(s=t.awaitInterop)&&void 0!==s?s:t.waitForAGMReady)||void 0===a||a;const h=e=>{let t;const r=setTimeout((()=>{t&&t(),i("timed out while waiting for instance id ".concat(e," for app ").concat(this.name))}),d),o=i=>{i.id===e&&(t&&(t(),t=void 0),clearTimeout(r),n(i))};t=l?this._appManager.onInstanceAgmServerReady(o):this._appManager.onInstanceStarted(o)};try{const i=(await this._agm.invoke(wi,{Name:u,Context:e,Options:t},"best",{methodResponseTimeoutMs:d})).returned;if("undefined"!==typeof i.timeout&&(d=1e3*i.timeout),"undefined"!==typeof i.waitForInterop&&"undefined"===typeof t.waitForAGMReady&&"undefined"===typeof t.awaitInterop&&(l=i.waitForInterop),i&&i.Id)if("startOnly"===this._appManager.mode){const e=this._appManager.handleInstanceStarted({ActivityId:void 0,IsActivityOwner:void 0,Context:void 0,Title:void 0,AgmServers:void 0,Id:i.Id,Name:i.Name});n(e)}else h(i.Id);else n(void 0)}catch(p){i(null!==(c=p.message)&&void 0!==c?c:p)}}))}onInstanceStarted(e){return Ai(e,this._configuration()),this._registry.add("instanceStarted",e)}onInstanceStopped(e){return Ai(e,this._configuration()),this._registry.add("instanceStopped",e)}onAvailable(e){return Ai(e,this._configuration()),this._props.IsReady&&setTimeout((()=>{this._registry.execute("appAvailable",this)}),0),this._registry.add("appAvailable",e)}onUnavailable(e){return Ai(e,this._configuration()),!1===this._props.IsReady&&setTimeout((()=>{this._registry.execute("appUnavailable",this)}),0),this._registry.add("appUnavailable",e)}onChanged(e){Ai(e,this._configuration()),this._registry.add("appChanged",e)}onRemoved(e){Ai(e,this._configuration()),this._registry.add("appRemoved",e)}}class Pi{constructor(e,t,n,i,r,o,s,a){this._id=e,this._appName=t,this._appManager=n,this._agm=i,this._activities=r,this._windows=o,this._configuration=a,this._registry=ki(),s||(this._unsubscribeInstanceStopped=this._appManager.onInstanceStopped((e=>{e.id===this._id&&this._registry.execute("stopped",e)})),this._unsubscribeInstanceAgmServerReady=this._appManager.onInstanceAgmServerReady((e=>{e.id===this._id&&this._registry.execute("agmReady",e)})))}get id(){return this._id}get application(){return this._appManager.application(this._appName)}get activity(){if(!this._activities)throw new Error("This method requires glue.activities library to be enabled.");return this._activities.all.instances.get().filter((e=>e.id===this._activityId))[0]}get isActivityOwner(){return this._isActivityOwner}get activityInstances(){return this._appManager.instances().filter((e=>"activity"!==e.application.type&&e.activityId&&e.activityId===this._activityId))}get activityOwnerInstance(){if(this._activityId)return this.activityInstances.filter((e=>null===e||void 0===e?void 0:e.isActivityOwner))[0]}get window(){if(!this._windows)throw new Error("This method requires glue.windows library to be enabled.");let e=this._windows.list().filter((e=>e.id===this._id))[0];return!e&&this._activities&&this.activity&&this.activityOwnerInstance&&(e=this.activityOwnerInstance.window),e}get context(){var e,t,n;return null!==(n=null!==(e=this._startUpContext)&&void 0!==e?e:null===(t=this.window)||void 0===t?void 0:t.context)&&void 0!==n?n:{}}get title(){return this._title}get isActivityInstance(){return this._isActivityInstance}get activityId(){return this._activityId}get inActivity(){return this._inActivity}get isSingleWindowApp(){return!this._inActivity}get agm(){return this._agmInstance}get interopInstance(){return this._agmInstance}onInteropReady(e){return Ai(e,this._configuration()),this._agmInstance&&setTimeout((()=>{this._registry.execute("agmReady",this)}),0),this._registry.add("agmReady",e)}onAgmReady(e){return this.onInteropReady(e)}onStopped(e){return Ai(e,this._configuration()),this._registry.add("stopped",e)}getWindow(){return new Promise(((e,t)=>{const n=this.window;if(n)return void e(n);const i=(n,i)=>{n&&t(n),i&&e(i),setTimeout((()=>{clearTimeout(r),o()}),0)},r=setTimeout((()=>{i(new Error("can not find a window with id ".concat(this._id)))}),3e4),o=this._windows.onWindowAdded((e=>{e.id===this._id&&i(void 0,e)}))}))}updateFromProps(e){this._startUpContext=e.Context,this._title=e.Title,this._isActivityInstance=!1,e.ActivityId&&""!==e.ActivityId&&(this._activityId=e.ActivityId,this._isActivityInstance=!0),this._isActivityOwner=e.IsActivityOwner,!this._activityId&&this._startUpContext&&this._startUpContext.activityId&&(this._activityId=this._startUpContext.activityId),this._inActivity=Boolean(this._activityId),this.updateAgmInstanceFromProps(e)}updateAgmInstanceFromProps(e){if(!e.AgmServers)return;const t=e.AgmServers;t&&t.length>0&&!tn(t[0])&&(this._agmInstance=t[0])}stop(){return new Promise(((e,t)=>{let n=this._id;this.isActivityOwner&&(n=this.activityId);const i=this._appManager.onInstanceStopped((t=>{t.id===n&&(i(),e())}));this._agm.invoke(bi,{Name:this._appName,Id:this._id}).then((()=>{"startOnly"===this._appManager.mode&&(this._appManager.handleInstanceStopped({Name:this._appName,Id:this.id}),e())})).catch((e=>t(e)))}))}activate(){return this._agm.invoke(_i,{Name:this._appName,Id:this._id})}done(){this._registry.clear(),this._unsubscribeInstanceAgmServerReady(),this._unsubscribeInstanceStopped()}getContext(){return Promise.resolve(this.context)}}class Mi{constructor(e,t,n,i,r,o,s){this.mode=e,this._agm=t,this._activities=n,this._windows=i,this._logger=r,this._gdMajorVersion=o,this._configuration=s,this._apps={},this._instances=[],this._registry=ki(),this.getConfigurations=async e=>{const t={v2:{apps:void 0}};return Array.isArray(e)&&(t.v2={apps:e}),(await this._agm.invoke(Ci,t)).returned.applications},this.application=e=>{var t;if((null===(t=this._configuration())||void 0===t?void 0:t.throwErrors)&&"string"!==typeof e)throw new Error('"name" must be string');return this._apps[e]},this.applications=()=>Object.keys(this._apps).map((e=>this._apps[e])),this.instances=()=>this._instances.map((e=>e)),this.getMyInstance=()=>{const e="undefined"!==typeof window&&window.glue42gd;if(!e){const e=this._agm.instance.instance;return this._instances.find((t=>t.id===e))}if(this._gdMajorVersion>=3){const t=e.appInstanceId;return this._instances.find((e=>e.id===t))}},this.getMyApplication=()=>{if(this._agm.instance)return this.application(this._agm.instance.application)},this.handleSnapshotAppsAdded=e=>{const t=this.applications();t.length>0&&t.forEach((t=>{const n=t.name;e.find((e=>e.Name===t.name))||this.handleAppRemoved({Name:n})})),e.forEach((e=>{t.find((t=>t.name===e.Name))||this.handleAppAdded(e)}))},this.handleSnapshotInstanceStarted=e=>{const t=this.instances();t.length>0&&t.forEach((t=>{const n=t.id;e.find((e=>e.Id===n))||this.handleInstanceStopped({Name:t.application.name,Id:n})})),e.forEach((e=>{t.find((t=>t.id===e.Id))||this.handleInstanceStarted(e)}))},this.handleAppAdded=e=>{const t=this._getAppId(e);this._logger.trace("adding app ".concat(t)),this._apps[t]=new Ei(this,t,this._agm,this._configuration);const n=this._updateAppFromProps(e);this._registry.execute("appAdded",n),this._registry.execute("appAvailable",n)},this.handleAppUpdated=e=>{const t=this._updateAppFromProps(e);this._registry.execute("appChanged",t)},this.handleAppRemoved=e=>{const t=this._getAppId(e);this._logger.trace("removing app ".concat(t));const n=this.application(t);this._instances=this._instances.filter((e=>e.application.name!==n.name)),delete this._apps[t],this._registry.execute("appRemoved",n)},this.handleAppReady=e=>{const t=this._getAppId(e),n=this._getAppOrThrow(t);n.updateFromProps(e),n.available?this._registry.execute("appAvailable",n):this._registry.execute("appUnavailable",n)},this.handleInstanceStarted=e=>{this._logger.trace("started app ".concat(e.Name," ").concat(e.Id));const t=this._getInstanceId(e),n=this._getInstanceAppName(e),i=new Pi(t,n,this,this._agm,this._activities,this._windows,!1,this._configuration);return this._updateInstanceFromProps(i,e),this._instances.push(i),this._registry.execute("instanceStarted",i),i},this.handleInstanceStopped=e=>{this._logger.trace("failed to start app ".concat(e.Name," ").concat(e.Id));const t=this._getInstanceId(e),n=this._getInstanceAppName(e),i=this._getInstanceOrThrow(t,n);this._instances=this._instances.filter((e=>!this._matchInstance(e,t,n))),this._registry.execute("instanceStopped",i),i.done()},this.handleInstanceAgmServerReady=e=>{const t=this._getInstanceId(e),n=this._getInstanceAppName(e),i=this._getInstanceOrThrow(t,n);i.updateAgmInstanceFromProps(e),this._registry.execute("instanceAgmServerReady",i)},this.handleInstanceStartFailed=e=>{const t=this._getInstanceId(e),n=this._getInstanceAppName(e),i=new Pi(t,n,void 0,void 0,void 0,void 0,!0,this._configuration);this._updateInstanceFromProps(i,e),this._registry.execute("instanceStartFailed",i)},this.handleInstanceUpdated=e=>{const t=this._getInstanceId(e),n=this._getInstanceAppName(e),i=this._getInstanceOrThrow(t,n);this._updateInstanceFromProps(i,e)},this.onInstanceStarted=e=>(Ai(e,this._configuration()),this._registry.add("instanceStarted",e,this._instances)),this.onInstanceStartFailed=e=>(Ai(e,this._configuration()),this._registry.add("instanceStartFailed",e)),this.onInstanceStopped=e=>(Ai(e,this._configuration()),this._registry.add("instanceStopped",e)),this.onInstanceUpdated=e=>(Ai(e,this._configuration()),this._registry.add("instanceChanged",e)),this.onInstanceAgmServerReady=e=>(Ai(e,this._configuration()),this._registry.add("instanceAgmServerReady",e)),this.onAppAdded=e=>(Ai(e,this._configuration()),this._registry.add("appAdded",e,Object.values(this._apps))),this.onAppRemoved=e=>(Ai(e,this._configuration()),this._registry.add("appRemoved",e)),this.onAppAvailable=e=>(Ai(e,this._configuration()),this._registry.add("appAvailable",e)),this.onAppUnavailable=e=>(Ai(e,this._configuration()),this._registry.add("appUnavailable",e)),this.onAppChanged=e=>(Ai(e,this._configuration()),this._registry.add("appChanged",e))}_getAppOrThrow(e){const t=this.application(e);if(!t)throw Error("app with id ".concat(e," not found"));return t}_getAppId(e){return e.Name}_matchInstance(e,t,n){return e.id===t&&e.application.name===n}_getInstanceByIdAndName(e,t){return this._instances.filter((n=>this._matchInstance(n,e,t)))[0]}_getInstanceOrThrow(e,t){const n=this._getInstanceByIdAndName(e,t);if(!n)throw Error("instance with id ".concat(e," not found"));return n}_getInstanceId(e){return e.Id}_getInstanceAppName(e){return e.Name}_updateAppFromProps(e){const t=this._getAppId(e);this._logger.trace("updating app with  + ".concat(t,", ").concat(JSON.stringify(e)));const n=this._getAppOrThrow(t);return n.updateFromProps(e),n}_updateInstanceFromProps(e,t){this._logger.trace("updating instance with "+this._getInstanceId(t)+" for app "+this._getInstanceAppName(t)),e.updateFromProps(t)}}function Ri(e,t,n){const i=e=>!!(e&&e.constructor&&e.call&&e.apply);return i(t)||i(n)?(i(t)?i(n)||(n=()=>{}):t=()=>{},e.then(t,n)):e}class Ni{constructor(e){this._agm=e,this._registry=ki(),this._isMethodRegistered=!1,this.handleBranchModified=e=>{this._registry.execute("branchChanged",e)},this.handleBranchesModified=e=>{this._registry.execute("branchesChanged",e)},this.getRegion=(e,t)=>Ri(this._agmInvoke(li,(e=>e.returned.Region)),e,t),this.getBranches=(e,t)=>Ri(this._agmInvoke(fi,(e=>{const t=e.returned.Branches;return Object.keys(t).map((e=>t[e]))})),e,t),this.getCurrentBranch=(e,t)=>Ri(this._agmInvoke(gi,(e=>e.returned.Branch),void 0),e,t),this.setRegion=(e,t,n)=>Ri(this._agmInvoke(hi,(e=>e.returned.ResultMessage),{Region:e}),t,n),this.setCurrentBranch=(e,t,n)=>Ri(this._agmInvoke(mi,(e=>e.returned.ResultMessage),{Branch:e}),t,n),this.currentUser=(e,t)=>Ri(this._agmInvoke(pi),e,t),this.getFunctionalEntitlement=(e,t,n)=>Ri(this._agmInvoke(vi,(e=>e.returned.Entitlement),{Function:e}),t,n),this.getFunctionalEntitlementBranch=(e,t,n,i)=>Ri(this._agmInvoke(vi,(e=>e.returned.Entitlement),{Function:e,Branch:t}),n,i),this.canI=(e,t,n)=>Ri(this._agmInvoke(yi,(e=>e.returned.Result),{Function:e}),t,n),this.canIBranch=(e,t,n,i)=>Ri(this._agmInvoke(yi,(e=>e.returned.Result),{Function:e,Branch:t}),n,i),this.onBranchesChanged=e=>this._registry.add("branchesChanged",e),this.onBranchChanged=e=>this._registry.add("branchChanged",e),this.exit=e=>this._agmInvoke(ci,null,e),this.onShuttingDown=e=>(this.registerMethod(),this._registry.add("onShuttingDown",e)),this.restart=e=>this._agmInvoke(di,null,e),this._agmInvoke=(e,t,n)=>(n=n||{},new Promise(((i,r)=>{const o=e=>r(e);this._agm.invoke(e,n).then((e=>{t||(t=e=>e.returned),i(t(e))})).catch(o)})))}registerMethod(){this._isMethodRegistered||(this._agm.register(ui,(async e=>{try{const t=await Promise.all(this._registry.execute("onShuttingDown",e));return{prevent:t.some((e=>e.prevent))}}catch(t){}})),this._isMethodRegistered=!0)}}function Oi(e,t){return new Promise(((n,i)=>{e.invoke(Ci,{skipIcon:!0}).then((e=>{var i;const r=e.returned,o=null!==(i=e.returned.configuration)&&void 0!==i?i:{};r||n(o);const s=r.applications;s||n(o),xi(s).map((e=>t.handleAppAdded(e))),n(o)})).catch((e=>i("Error getting application snapshot: ".concat(e.message))))}))}const ji="OnBranchChanged",Di="OnBranchesModified",Fi="OnApplicationAdded",Wi="OnApplicationRemoved",Li="OnApplicationChanged",Ui="OnApplicationReady",qi="OnApplicationStarted",Bi="OnApplicationAgmServerReady",Gi="OnApplicationUpdated",Hi="OnApplicationStopped",zi="OnApplicationStartFailed";function Vi(e,t,n,i){let r,o=!1;const s=()=>{let s,a;const c=new Promise(((e,t)=>{s=e,a=t}));return e.subscribe(Ii,{arguments:{skipIcon:i},waitTimeoutMs:1e4}).then((i=>{r=i,r.onData((i=>{var r;const a=i.data,c=null!==(r=a.configuration)&&void 0!==r?r:{},u=xi(a[Fi]);i.data.isSnapshot?t.handleSnapshotAppsAdded(u):u.forEach((e=>t.handleAppAdded(e))),xi(a[Li]).forEach((e=>t.handleAppUpdated(e))),xi(a[Wi]).forEach((e=>t.handleAppRemoved(e))),xi(a[Ui]).forEach((e=>t.handleAppReady(e)));const d=xi(a[qi]);if(i.data.isSnapshot?t.handleSnapshotInstanceStarted(d):d.forEach((e=>t.handleInstanceStarted(e))),xi(a[zi]).forEach((e=>t.handleInstanceStartFailed(e))),xi(a[Hi]).forEach((e=>t.handleInstanceStopped(e))),xi(a[Gi]).forEach((e=>t.handleInstanceUpdated(e))),xi(a[Bi]).forEach((e=>t.handleInstanceAgmServerReady(e))),xi(a[ji]).forEach((e=>n.handleBranchModified(e))),xi(a[Di]).forEach((e=>n.handleBranchesModified(e))),!o){o=!0;const n=u.some((t=>t.Name===e.instance.application)),i=d.some((t=>t.Id===e.instance.instance));if(n)if(i)s(c);else{const n=t.onInstanceStarted((t=>{t.id===e.instance.instance&&(n(),s(c))}))}else s(c)}})),r.onFailed((e=>a(e)))})).catch((e=>{var t;return a("Error subscribing for ".concat(Ii," stream. Err: ").concat(null!==(t=e.message)&&void 0!==t?t:JSON.stringify(e)))})),c};return{start:s,stop:()=>{r&&r.close()}}}const Ji="T42.ACS.InMemoryStoreCommand";class Ki{constructor(e){this.interop=e}import(e,t){if(!e||!Array.isArray(e))return Promise.reject("invalid apps argument - should be an array of application definitions");if(t&&"replace"!==t&&"merge"!==t)return Promise.reject("invalid mode argument - should be 'replace' or 'merge'");const n={command:"import",args:{apps:e,mode:t=null!==t&&void 0!==t?t:"replace"}};return this.interop.invoke(Ji,n).then((e=>e.returned))}export(){return this.interop.invoke(Ji,{command:"export"}).then((e=>e.returned.apps))}remove(e){if(!e||"string"!==typeof e)return Promise.reject("invalid app name, should be a string value");const t={command:"remove",args:{apps:[e]}};return this.interop.invoke(Ji,t).then((e=>e.returned))}clear(){const e={command:"clear"};return this.interop.invoke(Ji,e).then((e=>e.returned))}createAppDef(e,t){return t||(t="https://google.com"),{name:e,type:"window",title:e,details:{url:t}}}}var $i=e=>{if(!e)throw Error("config not set");if(!e.agm)throw Error("config.agm is missing");const t="startOnly",n="skipIcons",i="full",r=e.mode||t;if(r!==t&&r!==n&&r!==i)throw new Error("Invalid mode for appManager lib - ".concat(r," is not supported"));const o=e.activities,s=e.agm,a=e.logger,c=e.windows;let u={};const d=new Mi(r,s,o,c,a.subLogger("applications"),e.gdMajorVersion,(()=>u)),l=new Ni(s);let h;if(r===t)h=Oi(s,d);else{const e=Vi(s,d,l,r===n);h=e.start()}return{ready:()=>h.then((e=>{u=e})),applications:d.applications,application:d.application,getConfigurations:d.getConfigurations,onAppAdded:d.onAppAdded,onAppRemoved:d.onAppRemoved,onAppChanged:d.onAppChanged,onAppAvailable:d.onAppAvailable,onAppUnavailable:d.onAppUnavailable,instances:d.instances,get myInstance(){return d.getMyInstance()},get myApplication(){return d.getMyApplication()},onInstanceStarted:d.onInstanceStarted,onInstanceStopped:d.onInstanceStopped,onInstanceUpdated:d.onInstanceUpdated,onInstanceStartFailed:d.onInstanceStartFailed,getRegion:l.getRegion,getBranches:l.getBranches,getCurrentBranch:l.getCurrentBranch,getFunctionalEntitlement:l.getFunctionalEntitlement,getFunctionalEntitlementBranch:l.getFunctionalEntitlementBranch,setCurrentBranch:l.setCurrentBranch,setRegion:l.setRegion,currentUser:l.currentUser,canI:l.canI,canIBranch:l.canIBranch,onBranchesChanged:l.onBranchesChanged,exit:l.exit,restart:l.restart,onShuttingDown:l.onShuttingDown,inMemory:new Ki(s)}};function Qi(e,t){return e(t={exports:{}},t.exports),t.exports}var Yi=1;function Xi(){return(Yi=(9301*Yi+49297)%233280)/233280}function Zi(e){Yi=e}var er,tr,nr,ir={nextValue:Xi,seed:Zi},rr="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function or(){nr=!1}function sr(e){if(e){if(e!==er){if(e.length!==rr.length)throw new Error("Custom alphabet for shortid must be "+rr.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+rr.length+" unique characters. These characters were not unique: "+t.join(", "));er=e,or()}}else er!==rr&&(er=rr,or())}function ar(e){return sr(e),er}function cr(e){ir.seed(e),tr!==e&&(or(),tr=e)}function ur(){er||sr(rr);for(var e,t=er.split(""),n=[],i=ir.nextValue();t.length>0;)i=ir.nextValue(),e=Math.floor(i*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function dr(){return nr||(nr=ur())}function lr(e){return dr()[e]}var hr={characters:ar,seed:cr,lookup:lr,shuffled:dr},pr="object"===typeof window&&(window.crypto||window.msCrypto);function fr(){if(!pr||!pr.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return pr.getRandomValues(e),48&e[0]}var gr=fr;function mr(e,t){for(var n,i=0,r="";!n;)r+=e(t>>4*i&15|gr()),n=t<Math.pow(16,i+1),i++;return r}var vr=mr;function yr(e){var t=hr.shuffled();return{version:15&t.indexOf(e.substr(0,1)),worker:15&t.indexOf(e.substr(1,1))}}var wr,br,_r=yr,Ir=1459707606518,Cr=6;function Sr(e){var t="",n=Math.floor(.001*(Date.now()-Ir));return n===br?wr++:(wr=0,br=n),t+=vr(hr.lookup,Cr),t+=vr(hr.lookup,e),wr>0&&(t+=vr(hr.lookup,wr)),t+=vr(hr.lookup,n)}var kr=Sr;function xr(e){if(!e||"string"!==typeof e||e.length<6)return!1;for(var t=hr.characters(),n=e.length,i=0;i<n;i++)if(-1===t.indexOf(e[i]))return!1;return!0}var Tr=xr,Ar=Qi((function(e){var t=0;function n(t){return hr.seed(t),e.exports}function i(n){return t=n,e.exports}function r(e){return void 0!==e&&hr.characters(e),hr.shuffled()}function o(){return kr(t)}e.exports=o,e.exports.generate=o,e.exports.seed=n,e.exports.worker=i,e.exports.characters=r,e.exports.decode=_r,e.exports.isValid=Tr}));Ar.generate,Ar.seed,Ar.worker,Ar.characters,Ar.decode,Ar.isValid;var Er=Ar;const Pr="T42.JumpList.Action";class Mr{constructor(){this._groupActionCallbacks=new Map,this._registered=!1}init(e,t,n){this._executor=e,this._agm=t,this._logger=n,this.registerCallbackMethod()}setEnabled(e,t){const n={enabled:t};return this._executor.updateJumpList(e,n)}createCategory(e,t,n){this.validateActions(t,n);const i={category:{title:t,operation:"create",actions:this.toUpdateActions(e,"create",t,n)}};return this._executor.updateJumpList(e,i)}removeCategory(e,t){const n={category:{title:t,operation:"remove",actions:[]}};return this.manageActionCallback(e,n.category.operation,t),this._executor.updateJumpList(e,n)}createActions(e,t,n){this.validateActions(t,n);const i={category:{title:t,operation:"update",actions:this.toUpdateActions(e,"create",t,n)}};return this._executor.updateJumpList(e,i)}removeActions(e,t,n){const i={category:{title:t,operation:"update",actions:this.toUpdateActions(e,"remove",t,n)}};return this._executor.updateJumpList(e,i)}async getActions(e,t){const n=[],i=(await this.getJumpListSettings(e)).categories.find((e=>e.title===t));return i&&i.actions.forEach((e=>{const t=this.getActionCallback(e.callbackId);t&&(e.callback=t.callback),n.push({icon:e.icon,callback:e.callback,singleInstanceTitle:e.singleInstanceTitle,multiInstanceTitle:e.multiInstanceTitle})})),Promise.resolve(n)}getJumpListSettings(e){return this._executor.getJumpList(e)}toUpdateActions(e,t,n,i){return i.map((i=>{const r={icon:i.icon,callback:i.callback,callbackId:Er.generate(),singleInstanceTitle:i.singleInstanceTitle,multiInstanceTitle:i.multiInstanceTitle,operation:t};return this.manageActionCallback(e,t,n,r),r}))}manageActionCallback(e,t,n,i){var r;const o="".concat(n,"-").concat(e);if("create"===t)this._groupActionCallbacks.has(o)||this._groupActionCallbacks.set(o,[]),this._groupActionCallbacks.get(o).push({callbackId:i.callbackId,callback:i.callback});else if("remove"===t)if(i){let e=null!==(r=this._groupActionCallbacks.get(o))&&void 0!==r?r:[];e=e.filter((e=>e.callbackId!==i.callbackId)),0===e.length?this._groupActionCallbacks.delete(o):this._groupActionCallbacks.set(o,e)}else this._groupActionCallbacks.delete(o)}registerCallbackMethod(){if(!this._registered){this._registered=!0;try{this._agm.register(Pr,((e,t)=>{const n=this.getActionCallback(e.callbackId);if(n)try{n.callback()}catch(i){this._logger.error("Unable to execute user callback for jump list action!",i)}}))}catch(e){return this._logger.error("Unable to register method ".concat(Pr," for invoking jump list action callbacks!"),e),Promise.reject(e)}}}getActionCallback(e){let t;return[...this._groupActionCallbacks.values()].forEach((n=>{const i=n.find((t=>t.callbackId===e));i&&(t=i)})),t}validateActions(e,t){if(!(t&&t.length>0))throw new Error("Category '".concat(e,"' doesn't contain any actions!"));t.forEach((t=>{if(!t.singleInstanceTitle)throw new Error("Category '".concat(e,"' contains an action with undefined singleInstanceTitle!"));if(!t.multiInstanceTitle)throw new Error("Category '".concat(e,"' contains an action with undefined multiInstanceTitle!"));if(!t.callback)throw new Error("Category '".concat(e,"' contains an action with undefined callback function!"))}))}}var Rr=new Mr;class Nr{constructor(){this.waitForTimeoutInMilliseconds=6e4,this._windows={},this._pendingWindows={},this._pendingWindowsStates={},this._registry=ki()}init(e){this._logger=e}get(e){return this._windows[e]||this._pendingWindows[e]}getIfReady(e){return this._windows[e]}get list(){return this._windows}add(e){if(this._pendingWindows[e.API.id])return void this._logger.error("trying to add window with id ".concat(e.API.id," from windowStore, which already exists"));const t="remote"===e.API.windowType;this._pendingWindows[e.API.id]=e,this._pendingWindowsStates[e.API.id]={ready:!1,urlChanged:t},this._registry.execute("on-added",e)}remove(e){delete this._windows[e.API.id],delete this._pendingWindows[e.API.id],delete this._pendingWindowsStates[e.API.id],this._registry.execute("on-removed",e)}setReadyState(e){const t=this._pendingWindowsStates[e];"undefined"!==typeof t&&(t.ready=!0,t.urlChanged&&this.markReadyToShow(e))}setUrlChangedState(e){const t=this._pendingWindowsStates[e];"undefined"!==typeof t&&(t.urlChanged=!0,t.ready&&this.markReadyToShow(e))}setCompositionChangedState(e,t){"undefined"!==typeof this._pendingWindowsStates[e]&&!1===t&&this.markReadyToShow(e)}waitFor(e){return new Promise(((t,n)=>{let i;const r=setTimeout((()=>{i(),n("waitFor timed out.")}),this.waitForTimeoutInMilliseconds),o=this._windows[e];o?(clearTimeout(r),t(o)):i=this.onReadyWindow((n=>{n.API.id===e&&(clearTimeout(r),i(),t(n))}))}))}onReadyWindow(e){return this._registry.add("on-ready",e)}onAdded(e){return this._registry.add("on-added",e)}onRemoved(e){return this._registry.add("on-removed",e)}markReadyToShow(e){this._pendingWindows[e]&&(this._windows[e]=this._pendingWindows[e],delete this._pendingWindows[e],delete this._pendingWindowsStates[e]),this._registry.execute("on-ready",this._windows[e])}}var Or=new Nr;class jr{static getGDMajorVersion(){if("undefined"===typeof window)return-1;if(!window.glueDesktop)return-1;if(!window.glueDesktop.version)return-1;const e=Number(window.glueDesktop.version.substr(0,1));return isNaN(e)?-1:e}static callbackifyPromise(e,t,n){const i=e=>{let t=e;if(e instanceof Error&&(t=e.message),"function"!==typeof n)return Promise.reject(t);n(t)};try{return e().then((e=>("function"===typeof t&&t(e),e))).catch((e=>i(e)))}catch(r){return i(r)}}static getMonitor(e,t){return t.map((t=>{const{left:n,top:i,workingAreaWidth:r,workingAreaHeight:o}=t;return{monitor:t,totalOverlap:this.calculateTotalOverlap({left:n,top:i,width:r,height:o},e)}})).sort(((e,t)=>t.totalOverlap-e.totalOverlap))[0].monitor}static getDisplayCenterOfScreen(e,t,n){const i=e.width/t.scaleFactor,r=e.height/t.scaleFactor,o=t.workArea.left/n.scaleFactor,s=t.workArea.top/n.scaleFactor,a=t.workArea.width/t.scaleFactor,c=t.workArea.height/t.scaleFactor,u=Math.max((a-i)/2,0),d=Math.max((c-r)/2,0),l=Math.floor(o+u),h=Math.floor(s+d);return{left:l*n.scaleFactor,top:h*n.scaleFactor,width:e.width,height:e.height}}static isNode(){if("undefined"!==typeof jr._isNode)return jr._isNode;if("undefined"!==typeof window)return jr._isNode=!1,!1;try{jr._isNode="[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){jr._isNode=!1}return jr._isNode}static calculateTotalOverlap(e,t){const n=e.left,i=e.top,r=n+e.width,o=i+e.height,s=t.left,a=t.top,c=s+t.width,u=a+t.height;return Math.max(0,Math.min(r,c)-Math.max(n,s))*Math.max(0,Math.min(o,u)-Math.max(i,a))}}class Dr{constructor(e,t){this.windowId=e,this._categoryTitle=t.title}list(){return Rr.getActions(this.windowId,this._categoryTitle)}create(e){return Rr.createActions(this.windowId,this._categoryTitle,e)}remove(e){return Rr.removeActions(this.windowId,this._categoryTitle,e)}}class Fr{constructor(e){this.windowId=e}list(){return this.getCategories()}create(e,t){return Rr.createCategory(this.windowId,e,t)}remove(e){return Rr.removeCategory(this.windowId,e)}async find(e){return(await this.getCategories()).find((t=>t.title===e))}async getCategories(){const e=[];return(await Rr.getJumpListSettings(this.windowId)).categories.forEach((t=>{e.push({title:t.title,actions:new Dr(this.windowId,t)})})),e}}class Wr{constructor(e){this.windowId=e,this._categories=new Fr(e)}get categories(){return this._categories}async isEnabled(){return(await Rr.getJumpListSettings(this.windowId)).enabled}setEnabled(e){return Rr.setEnabled(this.windowId,e)}}var Lr=(e,t,n,i,r,o,s,a)=>{var c,u,d,l;const h=ki(),p=()=>{const e=s();if(!e)throw new Error("To use this method you need to enable channels API - set the channels property to true when initializing the Glue42 library");return e},f=e,g=t.name,m=t.mode;let v=t.bounds,y=t.url,w=t.title,b=null!==(c=t.context)&&void 0!==c?c:{},_=t.frameColor,I=t.focus,C=null!==(u=t.neighbours)&&void 0!==u?u:{},S=t.groupId,k=t.isGroupHeaderVisible,x=t.isTabHeaderVisible,T=null!==(d=t.isTabSelected)&&void 0!==d&&d,A=t.settings;const E=t.applicationName;let P,M=t.isVisible,R=t.isSticky,N=t.isCollapsed,O=t.state,j=t.tabGroupId,D=t.tabIndex,F=t.frameId,W=t.isLocked,L=null!==(l=t.frameButtons)&&void 0!==l?l:[],U=t.zoomFactor,q=t.placementSettings;const B=new Wr(e);function G(t,i){return"undefined"===typeof t||"function"===typeof t?jr.callbackifyPromise((()=>{if(!e)throw new Error("The window is already closed.");return n.close(hn)}),t,i):n.close(hn,t)}function H(e,t,i){if("function"===typeof t)return jr.callbackifyPromise((()=>{if(nn(e))throw new Error("The new URL must be a non-empty string.");return n.navigate(hn,e)}),t,i);if(nn(e))throw new Error("The new URL must be a non-empty string.");return n.navigate(hn,e,t)}function z(e,t,i){return jr.callbackifyPromise((()=>{if(!e||0===Object.keys(e).length||Object.keys(e).every((e=>!e)))throw new Error("Invalid style arguments: "+JSON.stringify(e));if(e&&void 0!==e.focus){if("boolean"!==typeof e.focus)throw new Error("Focus must be a boolean value. Currently, only `focus: true` is supported.");!1===e.focus&&console.warn("`focus: false` is not supported!")}if(e&&void 0!==e.hidden&&"boolean"!==typeof e.hidden)throw new Error("The `hidden` property must hold a boolean value.");for(const t of["minHeight","maxHeight","minWidth","maxWidth"]){const n=e,i=n[t];if(t in e){if(tn(i)){delete n[t];continue}if(!Qt(n[t]))throw new Error('"'.concat(t,'" must be a number'))}}return n.setStyle(hn,e)}),t,i)}function V(e,t,i){return jr.callbackifyPromise((()=>n.resetButtons(hn,e)),t,i)}function J(){return n.getButtons(hn)}function K(e,t,i){return jr.callbackifyPromise((()=>{if("string"===typeof e){if("always"!==e)throw new Error("`onTop` must hold a `always` value.")}else if("boolean"!==typeof e)throw new Error("`onTop` must hold a boolean or `always` value.");return n.setOnTop(hn,e)}),t,i)}function $(e,t,i){return jr.callbackifyPromise((()=>{if(!e||Object.keys(e).every((e=>void 0===e)))throw new Error("The properties of `constraints` cannot be null or undefined.");return n.setSizeConstraints(hn,e)}),t,i)}function Q(){return n.getSizeConstraints(hn)}function Y(e,t,i){return jr.callbackifyPromise((()=>{if(tn(e))throw new Error("`newTitle` must not be null or undefined.");return e===w?Promise.resolve(hn):n.setTitle(hn,e)}),t,i)}function X(e,t,i){return jr.callbackifyPromise((()=>{if("boolean"!==typeof e)throw new Error("`isSticky` must hold a boolean value.");return n.setSticky(hn,e)}),t,i)}function Z(e,t,i){return jr.callbackifyPromise((()=>{if(tn(e))throw new Error("The properties of `bounds` cannot be null or undefined.");return n.moveResize(hn,e)}),t,i)}function ee(e,t,i){return jr.callbackifyPromise((()=>{if("undefined"===typeof e||0===Object.keys(e).length)throw new Error("Button info is not available.");if(nn(e.buttonId))throw new Error("`buttonId` must not be null or undefined.");if(nn(e.imageBase64))throw new Error("`imageBase64` must not be null or undefined.");return n.addFrameButton(hn,e)}),t,i)}function te(e,t,i){return jr.callbackifyPromise((()=>{if(nn(e))throw new Error("`buttonId` must not be null or undefined.");return n.removeFrameButton(hn,e)}),t,i)}function ne(e,t){return jr.callbackifyPromise((()=>I?Promise.resolve(hn):n.activate(hn)),e,t)}function ie(e,t){return jr.callbackifyPromise((()=>I?Promise.resolve(hn):n.focus(hn)),e,t)}function re(e,t){return jr.callbackifyPromise((()=>n.maximizeRestore(hn)),e,t)}function oe(e,t){return jr.callbackifyPromise((()=>"maximized"===O?Promise.resolve(hn):n.maximize(hn)),e,t)}function se(e,t){return jr.callbackifyPromise((()=>"normal"===O?Promise.resolve(hn):n.restore(hn)),e,t)}function ae(e,t){return jr.callbackifyPromise((()=>"minimized"===O?Promise.resolve(hn):n.minimize(hn)),e,t)}function ce(e,t){return jr.callbackifyPromise((()=>N?Promise.resolve(hn):n.collapse(hn)),e,t)}function ue(e,t){return jr.callbackifyPromise((()=>N?n.expand(hn):Promise.resolve(hn)),e,t)}function de(e,t){return jr.callbackifyPromise((()=>n.toggleCollapse(hn)),e,t)}function le(e,t,i,r){return jr.callbackifyPromise((()=>{if(tn(e))throw new Error("A target window is not specified - ".concat("string"===typeof e?e:JSON.stringify(e)));if("string"===typeof e){const t=Or.get(e);if(!t)throw new Error('Invalid "target" parameter or no such window. Invoked with: '.concat(e));e=t.API}return"string"===typeof t&&(t={direction:t,autoAlign:!0}),n.snap(hn,e,t)}),i,r)}function he(e,t,i,r){return jr.callbackifyPromise((()=>{var i;const r='Invalid "tab" parameter - must be an object with an "id" property or a string. Invoked for source window with ID:';if(tn(e)){const t="".concat(r," ").concat("string"===typeof e?e:JSON.stringify(e));throw new Error(t)}let o;if("string"===typeof e){if(o=null===(i=Or.get(e))||void 0===i?void 0:i.API,tn(o)){const e="".concat(r," ").concat("string"===typeof o?o:JSON.stringify(o));throw new Error(e)}}else{if(tn(e.id))throw new Error(r);o=e}const s={};return tn(t)||("number"===typeof t?s.index=t:(s.selected=t.selected,s.index=t.index)),n.attachTab(hn,o,s)}),i,r)}function pe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return jr.callbackifyPromise((()=>{const t={};function i(e){return void 0!==e.relativeTo}return i(e)?("string"===typeof e.relativeTo?t.relativeTo=e.relativeTo:tn(e.relativeTo.id)||(t.relativeTo=e.relativeTo.id),tn(e.relativeDirection)||(t.relativeDirection=e.relativeDirection),tn(e.width)||(t.width=e.width),tn(e.height)||(t.height=e.height)):tn(e.bounds)||(t.bounds=e.bounds),tn(e.hideTabHeader)||(t.hideTabHeader=e.hideTabHeader),n.detachTab(hn,t)}),t,i)}function fe(e,t,i){return jr.callbackifyPromise((()=>n.setVisible(hn,e)),t,i)}async function ge(e){return e&&me(e),n.center(hn,e)}function me(e){if("object"!==typeof e)throw Error("display argument must be a valid display object");if(!e.workArea||!e.scaleFactor)throw Error("display argument is not a valid display object")}function ve(e){return n.showLoader(hn,e)}function ye(){return n.hideLoader(hn)}function we(e,t,i){return jr.callbackifyPromise((()=>{if(tn(e))throw new Error('"context" must not be null or undefined.');return n.updateContext(hn,e,!1)}),t,i)}function be(e,t){return jr.callbackifyPromise((()=>n.lock(hn)),e,t)}function _e(e,t){return jr.callbackifyPromise((()=>n.unlock(hn)),e,t)}function Ie(e,t){return jr.callbackifyPromise((()=>n.getIcon(hn)),e,t)}function Ce(e,t,i){return jr.callbackifyPromise((()=>{if(nn(e))throw new Error('"base64Image" must be a non-empty string.');return n.setIcon(hn,e)}),t,i)}function Se(e,t,i){return jr.callbackifyPromise((()=>{if(nn(e))throw new Error('"frameColor" must be a non-empty string');return n.setFrameColor(hn,e)}),t,i)}function ke(e,t,i){return jr.callbackifyPromise((()=>{if("boolean"!==typeof e)throw new Error('"toBeTabHeaderVisible" must hold a boolean value.');return n.setTabHeaderVisible(hn,e)}),t,i)}async function xe(e){if(nn(e))throw new Error('"'.concat(e,'" must not be null or undefined'));return n.setTabTooltip(hn,e)}async function Te(){return n.getTabTooltip(hn)}function Ae(e){return n.showPopup(hn,e)}function Ee(e){return n.createFlydown(hn.id,e)}function Pe(e){return n.setModalState(hn.id,e||!1)}function Me(e,t){return jr.callbackifyPromise((()=>n.zoomIn(hn)),e,t)}function Re(e,t){return jr.callbackifyPromise((()=>n.zoomOut(hn)),e,t)}function Ne(e,t,i){return jr.callbackifyPromise((()=>{if(isNaN(e))throw new Error("zoomFactor is not a number");return n.setZoomFactor(hn,e)}),t,i)}function Oe(){return n.showDevTools(hn)}function je(e){return n.capture(hn,e)}function De(e,t){const i={shouldFlash:!0,mode:"auto"};return"boolean"===typeof e&&(i.shouldFlash=e),"undefined"!==typeof t&&(i.mode=t),n.flash(hn,i)}function Fe(e){const t={shouldFlash:!0};return"boolean"===typeof e&&(t.shouldFlash=e),n.flashTab(hn,t)}function We(e){return n.print(hn,e)}function Le(e){return n.printToPDF(hn,e)}function Ue(t){return new Promise(((i,r)=>{const o=gt(((t,n,r)=>{e===t.id&&(o(),i(hn))}));n.ungroup(hn,t).catch((e=>{o(),r(e)}))}))}function qe(e){return n.place(hn,e)}function Be(e){return n.refresh(hn,e)}function Ge(e,t){return n.download(hn,e,t)}function He(e){return n.configureWindow(hn,e)}function ze(){return n.getWindowConfiguration(hn)}function Ve(e){if(!on(e))throw new Error("callback should be a function");return e(hn.title,hn),Ct("onTitleChanged",e)}function Je(t){if(!on(t))throw new Error("callback should be a function");return void 0===e&&t(hn),h.add("onClose",t)}function Ke(e){return Ct("onUrlChanged",e)}function $e(e){return Ct("onFrameButtonAdded",e)}function Qe(e){return Ct("onFrameButtonRemoved",e)}function Ye(e){return Ct("onFrameButtonClicked",e)}function Xe(e){if(!on(e))throw new Error("callback should be a function");return N&&e(hn),h.add("collapsed",e)}function Ze(e){if(!on(e))throw new Error("callback should be a function");return N||e(hn),h.add("expanded",e)}function et(e){return"maximized"===O?Ct("maximized",e,[hn]):Ct("maximized",e)}function tt(e){return"minimized"===O?Ct("minimized",e,[hn]):Ct("minimized",e)}function nt(e){return"normal"===O?Ct("normal",e,[hn]):Ct("normal",e)}function it(e){return Ct("attached",e)}function rt(e){return Ct("detached",e)}function ot(e){return Ct("visibility-changed",e)}function st(e){return Ct("context-updated",e)}function at(e){return Ct("lock-changed",e)}function ct(e){return Ct("bounds-changed",e)}function ut(e){return Ct("focus-changed",e)}function dt(e){return Ct("sticky-changed",e)}function lt(e){return Ct("frame-color-changed",e)}function ht(e){return Ct("tab-header-visibility-changed",e)}function pt(e){return Ct("window-attached",e)}function ft(e){return Ct("window-detached",e)}function gt(e){return Ct("group-changed",e)}function mt(e){return Ct("tab-selection-changed",e)}function vt(e){if(!on(e))throw new Error("callback must be a function");const t=(t,n,i)=>{const r=e(i);(null===r||void 0===r?void 0:r.then)?r.then(t).catch(n):t()};return n.onClosing(t,hn)}function yt(e){if(!on(e))throw new Error("callback must be a function");const t=(t,n,i)=>{const r=e(i);(null===r||void 0===r?void 0:r.then)?r.then(t).catch(n):t()};return n.onRefreshing(t,hn)}function wt(e){if(!on(e))throw new Error("callback must be a function");const t=(t,n,i,r)=>{const o=e(r);(null===o||void 0===o?void 0:o.then)?o.then(t).catch(n):t()};return n.onNavigating(t,hn)}function bt(e){return Ct("zoom-factor-changed",e)}function _t(e){return Ct("placementSettingsChanged",e)}function It(e){return Ct("neighbours-changed",e)}function Ct(e,t,n){if(!on(t))throw new Error("callback must be a function");return h.add(e,t,n)}function St(){return n.goBack(hn)}function kt(){return n.goForward(hn)}function xt(e){return n.startDrag(hn,e)}function Tt(e){if((null===e||void 0===e?void 0:e.timerDuration)&&isNaN(null===e||void 0===e?void 0:e.timerDuration))throw new Error("timerDuration must be a number");if((null===e||void 0===e?void 0:e.showTimer)&&"boolean"!==typeof(null===e||void 0===e?void 0:e.showTimer))throw new Error("showTimer must be a boolean");return n.showDialog(hn,e)}function At(e){y=e.url,w=e.title,b=e.context||{},v=e.bounds,_=e.frameColor,I=e.focus,C=e.neighbours||{},S=e.groupId,k=e.isGroupHeaderVisible,x=e.isTabHeaderVisible,T=e.isTabSelected,A=e.settings,M=e.isVisible,R=e.isSticky,N=e.isCollapsed,O=e.state,j=e.tabGroupId,F=e.frameId,W=e.isLocked,U=e.zoomFactor,q=e.placementSettings}function Et(e){w=e,n.finished.finally((()=>{h.execute("onTitleChanged",e,hn)}))}function Pt(e){y=e,h.execute("onUrlChanged",e,hn)}function Mt(e){e!==M&&(M=e,h.execute("visibility-changed",hn))}function Rt(e){A=e,h.execute("settings-changed",hn)}function Nt(e){b=e,h.execute("context-updated",b,hn)}function Ot(){void 0!==e&&(h.execute("onClose",hn),e=void 0)}function jt(e){const t=["buttonId","imageBase64","order","tooltip"].reduce(((t,n)=>(t[n]=e[n],t)),{});-1===L.map((e=>e.buttonId)).indexOf(e.buttonId)&&L.push(t),h.execute("onFrameButtonAdded",t,hn)}function Dt(e){let t;L=L.reduce(((n,i)=>(i.buttonId===e?t=i:n.push(i),n)),[]),void 0!==t&&h.execute("onFrameButtonRemoved",t,hn)}function Ft(e){const t=L.filter((t=>t.buttonId===e.buttonId));t.length>0&&h.execute("onFrameButtonClicked",t[0],hn)}async function Wt(e){"collapsed"===e?N=!0:"expanded"===e?N=!1:O=e,await n.finished,h.execute(e,hn)}function Lt(e){W=e,h.execute("lock-changed",hn)}function Ut(e){v.top===e.top&&v.left===e.left&&v.width===e.width&&v.height===e.height||(v=e,h.execute("bounds-changed",hn))}function qt(e){I=e,h.execute("focus-changed",hn)}function Bt(e){R=e,h.execute("sticky-changed",e,hn)}function Gt(e){_=e,h.execute("frame-color-changed",hn)}function Ht(e,t,n){j=e,F=t,x=n,h.execute("frame-attached",hn)}function zt(e){C=e.neighbors||{},D=e.index,h.execute("neighbours-changed",C,hn)}function Vt(e){k=e}function Jt(e){x!==e&&(x=e,h.execute("tab-header-visibility-changed",hn))}async function Kt(t,i){let r;t===e?(T=!0,r=hn):(T=!1,r=Or.get(t)?Or.get(t).API:void 0);const o=Or.get(i)?Or.get(i).API:void 0;await n.finished,h.execute("tab-selection-changed",r,o,hn)}async function $t(e,t,i,r,o){j=e,x=i,F=t,"undefined"!==typeof r&&(W=r),await n.finished,o.forEach((e=>{e.Events.handleWindowAttached(hn)})),h.execute("attached",hn)}function Yt(e){h.execute("window-attached",e)}async function Xt(e,t){j=void 0,T=!1,"undefined"!==typeof e&&(W=e),await n.finished,t.forEach((e=>{e.Events.handleWindowDetached(hn)})),h.execute("detached",hn)}function Zt(e){h.execute("window-detached",e)}function en(e){U=e,h.execute("zoom-factor-changed",hn)}function rn(e){let t;const n=e;if(n.display){const e=o();if(e){const i=n.display-1;t=new Promise(((t,n)=>{e.all().then((e=>{const n=e.find((e=>e.index===i));t(n)})).catch(n)}))}else t=Promise.resolve(void 0)}else t=Promise.resolve(void 0);t.then((e=>{n.display=e,q=n,h.execute("placementSettingsChanged",hn)}))}function sn(e,t){P=e,S=null===e||void 0===e?void 0:e.id,tn(e)||tn(t)||h.execute("group-changed",hn,e,t)}function an(){const e=Or.list;return"tab"!==m.toLowerCase()?[]:Object.keys(e).reduce(((t,n)=>{const i=e[n];return i&&i.API.tabGroupId&&"undefined"!==typeof i.API.tabGroupId&&"undefined"!==typeof hn.tabGroupId&&i.API.tabGroupId===hn.tabGroupId&&t.push(i.API),t}),[]).sort(((e,t)=>{if(e.tabIndex!==t.tabIndex){if(-1===e.tabIndex)return Number.MAX_SAFE_INTEGER;if(-1===t.tabIndex)return Number.MIN_SAFE_INTEGER}return e.tabIndex-t.tabIndex}))}function cn(e){return e.reduce(((e,t)=>{const n=Or.get(t);return n&&e.push(n.API),e}),[])}function un(e){const t=C[e];if("undefined"!==typeof t)return cn(t)}function dn(){var t;if(E)return E;if(b._APPLICATION_NAME)return b._APPLICATION_NAME;if(b&&b._t42&&b._t42.application)return b._t42.application;const n=ln();if(n&&n.applicationName)return n.applicationName;const i=r();if(i){const n=i.instances().find((t=>e===t.id));if(n)return null===(t=n.application)||void 0===t?void 0:t.name}}function ln(){if("undefined"!==typeof window&&window.glue42gd&&window.glue42gd.getWindowInfo){const t=window.glue42gd.getWindowInfo(e);return t||void 0}}const hn={get id(){return f},get name(){return g},get application(){const e=r(),t=dn();if(t&&e)return e.application(t)},get hostInstance(){return n.hostInstance},get interopInstance(){const e=a.servers().find((e=>e.windowId===this.id));if(e)return e;{const e=dn();if(e)return{application:e}}},get agmInstance(){return hn.interopInstance},get url(){return y},get title(){return w},get windowStyleAttributes(){return A},get settings(){return A},get tabGroupId(){return"tab"===m.toLowerCase()?j:void 0},get tabIndex(){return"tab"===m.toLowerCase()?D:void 0},get frameId(){return F},get frameButtons(){return L.sort(((e,t)=>e.order-t.order))},get mode(){return m},get state(){return O},get isCollapsed(){return N},get isVisible(){return M},get isLocked(){return W},get context(){return b},get bounds(){return v},get minHeight(){return A.minHeight},get maxHeight(){return A.maxHeight},get minWidth(){return A.minWidth},get maxWidth(){return A.maxWidth},get isFocused(){return I},get frameColor(){return _},get opened(){return void 0!==hn.id},get group(){return P},get groupId(){return S},get isSticky(){return R},get topNeighbours(){return un("top")},get leftNeighbours(){return un("left")},get rightNeighbours(){return un("right")},get bottomNeighbours(){return un("bottom")},get isGroupHeaderVisible(){return k},get activityId(){if(b._t42)return b._t42.activityId;const e=ln();return e?e.activityId:void 0},get activityWindowId(){if(b._t42)return b._t42.activityWindowId;const e=ln();return e?e.activityWindowId:void 0},get windowType(){return t.windowType||"electron"},get zoomFactor(){return U},get screen(){if("undefined"!==typeof window&&window.glue42gd)return jr.getMonitor(hn.bounds,window.glue42gd.monitors)},get placementSettings(){return Object.assign({},q)},get jumpList(){return B},maximize:oe,restore:se,minimize:ae,maximizeRestore:re,collapse:ce,expand:ue,toggleCollapse:de,focus:ie,activate:ne,moveResize:Z,setTitle:Y,setStyle:z,setOnTop:K,resetButtons:V,getButtons:J,setSizeConstraints:$,getSizeConstraints:Q,navigate:H,addFrameButton:ee,removeFrameButton:te,setVisible:fe,show:()=>fe(!0),hide:()=>fe(!1),center:ge,close:G,snap:le,showLoader:ve,hideLoader:ye,updateContext:we,lock:be,unlock:_e,getIcon:Ie,setIcon:Ce,setFrameColor:Se,setTabTooltip:xe,getTabTooltip:Te,attachTab:he,detachTab:pe,setTabHeaderVisible:ke,showPopup:Ae,createFlydown:Ee,setModalState:Pe,setZoomFactor:Ne,zoomIn:Me,zoomOut:Re,showDevTools:Oe,capture:je,flash:De,flashTab:Fe,setSticky:X,print:We,printToPDF:Le,place:qe,ungroup:Ue,refresh:Be,goBack:St,goForward:kt,download:Ge,configure:He,getConfiguration:ze,getChannel:async()=>{var e;return null===(e=(await p().getWindowsWithChannels({windowIds:[f]}))[0])||void 0===e?void 0:e.channel},startDrag:xt,showDialog:Tt,onClose:Je,onUrlChanged:Ke,onTitleChanged:Ve,onFrameButtonAdded:$e,onFrameButtonRemoved:Qe,onFrameButtonClicked:Ye,onCollapsed:Xe,onExpanded:Ze,onMinimized:tt,onMaximized:et,onNormal:nt,onAttached:it,onDetached:rt,onVisibilityChanged:ot,onContextUpdated:st,onLockingChanged:at,onBoundsChanged:ct,onFrameColorChanged:lt,onFocusChanged:ut,onStickyChanged:dt,onGroupChanged:gt,onWindowAttached:pt,onWindowDetached:ft,onTabSelectionChanged:mt,onTabHeaderVisibilityChanged:ht,onClosing:vt,onRefreshing:yt,onZoomFactorChanged:bt,onPlacementSettingsChanged:_t,onNeighboursChanged:It,onNavigating:wt,get tabs(){return an()},get isTabHeaderVisible(){return x},get isTabSelected(){return T},getURL:()=>Promise.resolve(y),getTitle:()=>Promise.resolve(w),getBounds:()=>Promise.resolve(v),getContext:()=>Promise.resolve(b),setContext(e){if(tn(e))throw new Error('"context" must not be null or undefined, set to empty object if you want to clear it out.');return n.updateContext(hn,e,!0)},getDisplay:()=>o().getByWindowId(e),resizeTo:(e,t)=>Z({width:e,height:t}),moveTo:(e,t)=>Z({top:e,left:t}),async getParentWindow(){var e;const t=A.parentInstanceId;if(t)return null===(e=Or.list[t])||void 0===e?void 0:e.API},getChildWindows:async()=>Object.keys(Or.list).map((e=>Or.list[e].API)).filter((t=>t.settings.parentInstanceId===e)),joinChannel:t=>p().join(t,e),leaveChannel:()=>p().leave(e)};return{API:hn,Events:{handleUpdate:At,handleWindowClose:Ot,handleWindowChangeState:Wt,handleTitleChanged:Et,handleVisibilityChanged:Mt,handleUrlChanged:Pt,handleWindowSettingsChanged:Rt,handleContextUpdated:Nt,handleFrameIsLockedChanged:Lt,handleBoundsChanged:Ut,handleFocusChanged:qt,handleFrameButtonAdded:jt,handleFrameButtonRemoved:Dt,handleFrameButtonClicked:Ft,handleFrameColorChanged:Gt,handleFrameAttached:Ht,handleFrameSelectionChanged:Kt,handleCompositionChanged:zt,handleGroupHeaderVisibilityChanged:Vt,handleTabHeaderVisibilityChanged:Jt,handleGroupChanged:sn,handleAttached:$t,handleDetached:Xt,handleWindowAttached:Yt,handleWindowDetached:Zt,handleZoomFactorChanged:en,handleIsStickyChanged:Bt,handlePlacementSettingsChanged:rn}}};function Ur(e,t){const n=Or.list;return Object.keys(n).reduce(((i,r)=>{const o=n[r];return o.API.tabGroupId===t&&o.API.id!==e&&i.push(o),i}),[])}function qr(e){return!(e&&!Object.keys(e).every((t=>void 0===e[t])))}class Br{constructor(){this.GroupMethodName="T42.Group.Execute",this.WndMethodName="T42.Wnd.Execute",this._registry=ki(),this._finished=Promise.resolve(),this.unsubCallbacks={}}get hostInstance(){return this.agmTarget}get finished(){return this._finished}get configuration(){return this._configuration}init(e,t){this.agm=e,this.agmTarget=t,this._registry.add("event",(e=>{"Closed"===e.type&&Object.keys(this.unsubCallbacks).forEach((t=>{t.startsWith(e.windowId)&&delete this.unsubCallbacks[t]}))}))}setConfiguration(e){this._configuration=e}handleEvent(e){this._registry.execute("event",e)}async open(e){let t;this._finished=new Promise((e=>{t=e}));try{const t=await this.agm.invoke("T42.Wnd.Create",e,this.agmTarget);if(void 0===t.returned)throw new Error("failed to execute T42.Wnd.Create - unknown reason");const n=t.returned.id,i=await Or.waitFor(n);return this.configuration&&!this.configuration.windowAvailableOnURLChanged||setTimeout((()=>{"electron"===i.API.windowType&&i.Events.handleUrlChanged(i.API.url)}),0),i.API}catch(n){throw n}finally{t()}}async close(e,t){const n=await this.execute("close",{windowId:e.id,options:t},"Closed");return t?n.closed:e}async navigate(e,t,n){return await this.execute("navigate",{windowId:e.id,options:{url:t,urlLoadOptions:n}},"UrlChanged"),e}async setStyle(e,t){var n;const i=[],r=e=>i.push(e);if(tn(t.focus)||e.isFocused||r(e.focus()),!tn(t.hidden)){const n=!t.hidden;r(e.setVisible(n))}if(tn(t.onTop)||r(e.setOnTop(t.onTop)),!nn(t.tabTooltip)||!nn(t.tabToolTip)){const i=null!==(n=t.tabTooltip)&&void 0!==n?n:t.tabToolTip;r(e.setTabTooltip(i))}nn(t.tabTitle)||r(this.execute("setTabTitle",{windowId:e.id,options:{tabTitle:t.tabTitle}}));const o={minHeight:t.minHeight,minWidth:t.minWidth,maxHeight:t.maxHeight,maxWidth:t.maxWidth};!qr(o)&&r(e.setSizeConstraints(o));const s={allowClose:t.allowClose,allowCollapse:t.allowCollapse,allowLockUnlock:t.allowLockUnlock,allowMaximize:t.allowMaximize,allowMinimize:t.allowMinimize};return!qr(s)&&r(e.resetButtons(s)),await Promise.all(i),e}async setSizeConstraints(e,t){return await this.execute("setSizeConstraints",{windowId:e.id,options:t}),e}async getSizeConstraints(e){return await this.execute("getSizeConstraints",{windowId:e.id})}async setTabTooltip(e,t){return await this.execute("setTabTooltip",{windowId:e.id,options:{tabTooltip:t}}),e}async getTabTooltip(e){return(await this.execute("getTabTooltip",{windowId:e.id})).tabTooltip}async resetButtons(e,t){return await this.execute("resetButtons",{windowId:e.id,options:t}),e}async getButtons(e){return await this.execute("getButtons",{windowId:e.id})}async setOnTop(e,t){return await this.execute("setOnTop",{windowId:e.id,options:{onTop:t}}),e}async setTitle(e,t){const n={windowId:e.id,options:{title:t}};return await this.execute("setTitle",n,"TitleChanged"),e}async setSticky(e,t){const n={windowId:e.id,options:{isSticky:t}};return await this.execute("setSticky",n),e}async moveResize(e,t){return"undefined"!==typeof window&&window.glueDesktop.versionNum<31200?new Promise((async(n,i)=>{const r=this.areBoundsEqual(t,e);let o=!1;const s=()=>{o||(o=!0,c&&(c(),c=void 0),n(e),a&&(clearTimeout(a),a=void 0))};let a,c;r||(c=e.onBoundsChanged((e=>{this.areBoundsEqual(t,e)&&s()})));try{await this.execute("moveResize",{windowId:e.id,options:{bounds:t}})}catch(u){return void i(u)}r?s():a=setTimeout((()=>{s()}),1e3)})):(await this.execute("moveResize",{windowId:e.id,options:{bounds:t}}),e)}async addFrameButton(e,t){return await this.execute("addButton",{windowId:e.id,options:t},"ButtonAdded"),e}async removeFrameButton(e,t){return await this.execute("removeButton",{windowId:e.id,options:t},"ButtonRemoved"),e}async activate(e){let t;try{const n=new Promise(((n,i)=>{t=e.onFocusChanged((()=>{n()}))}));return await Promise.all([this.execute("activate",{windowId:e.id},"FocusChanged"),n]),e}catch(n){throw n}finally{t&&t()}}async focus(e){let t;try{const n=new Promise(((n,i)=>{t=e.onFocusChanged((()=>{n()}))}));return await Promise.all([this.execute("focus",{windowId:e.id},"FocusChanged"),n]),e}catch(n){throw n}finally{t&&t()}}async maximizeRestore(e){return await this.execute("maximizeRestore",{windowId:e.id},"StateChanged"),e}async maximize(e){return await this.execute("maximize",{windowId:e.id},"StateChanged"),e}async restore(e){return await this.execute("restore",{windowId:e.id},"StateChanged"),e}async minimize(e){return await this.execute("minimize",{windowId:e.id},"StateChanged"),e}async collapse(e){return await this.execute("collapse",{windowId:e.id},"StateChanged"),e}async expand(e){return await this.execute("expand",{windowId:e.id},"StateChanged"),e}async toggleCollapse(e){return await this.execute("toggleCollapse",{windowId:e.id},"StateChanged"),e}async snap(e,t,n){const i={targetWindowId:t.id};return i.snappingEdge=n.direction,i.autoAlign=n.autoAlign,await this.execute("snap",{windowId:e.id,options:i},"CompositionChanged","CompositionChanged-".concat(t.id)),e}async attachTab(e,t,n){return await this.execute("attachTab",{windowId:e.id,options:{index:n,sourceWindowId:t.id,targetWindowId:e.id}},"WindowFrameAdded-".concat(t.id),"WindowFrameRemoved-".concat(t.id)),e}async detachTab(e,t){const n=["WindowFrameRemoved","WindowFrameAdded"];return tn(null===t||void 0===t?void 0:t.relativeTo)?n.push("BoundsChanged"):(n.push("CompositionChanged"),n.push("CompositionChanged-".concat(t.relativeTo))),await this.execute("detachTab",{windowId:e.id,options:t},...n),e}async setVisible(e){let t;return t=arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?"hide":"show",await this.execute(t,{windowId:e.id},"VisibilityChanged"),e}async center(e,t){return await this.execute("center",{windowId:e.id,options:t}),e}async showLoader(e,t){return await this.execute("showLoadingAnimation",{windowId:e.id,options:t}),e}async hideLoader(e){return await this.execute("hideLoadingAnimation",{windowId:e.id}),e}async updateContext(e,t,n){let i;try{const r=this.swapUndefinedToNull(t),o=new Promise(((t,n)=>{i=e.onContextUpdated((()=>{t()}))}));return await Promise.all([this.execute("updateContext",{windowId:e.id,context:r,replace:n}),o]),e}catch(r){throw r}finally{i&&i()}}async lock(e){return await this.execute("lockUnlock",{windowId:e.id,options:{lock:!0}},"FrameIsLockedChanged"),e}async unlock(e){return await this.execute("lockUnlock",{windowId:e.id,options:{lock:!1}},"FrameIsLockedChanged"),e}async getIcon(e){return(await this.execute("getIcon",{windowId:e.id,options:{}})).icon}async setIcon(e,t){return await this.execute("setIcon",{windowId:e.id,options:{dataURL:t}}),e}async setFrameColor(e,t){return await this.execute("setFrameColor",{windowId:e.id,options:{frameColor:t}},"FrameColorChanged"),e}async setTabHeaderVisible(e,t){return await this.execute("setTabHeaderVisible",{windowId:e.id,options:{toShow:t}},"TabHeaderVisibilityChanged"),e}async showPopup(e,t){if(!t)throw new Error("The options object is not valid!");const n={...t};n.targetLocation||(n.targetLocation="bottom");const i={...n,popupBounds:n.size,targetId:e.id,popupId:n.windowId};return await this.execute("showPopupWindow",{windowId:e.id,options:i}),e}async createFlydown(e,t){if(!t)throw new Error("The options object is not valid!");const n={...t};n.horizontalOffset||(n.horizontalOffset=0),n.verticalOffset||(n.verticalOffset=0);const i=this.reformatFlydownOptions(e,n);return this.execute("setFlydownArea",{windowId:e,options:i}).then((()=>{const e=i.zones.map((e=>e.id));return i.zones.forEach((e=>{let n="function"===typeof e.flydownSize?e.flydownSize:()=>e.flydownSize;t.size instanceof Function&&e.flydownSize&&(n=async(n,i)=>{let r;return t.size instanceof Function&&(r=await t.size(n,i)),e.flydownSize instanceof Function&&e.flydownSize!==t.size?await e.flydownSize(n,i)||r:r||e.flydownSize}),this._registry.clearKey("".concat(i.targetId,"_").concat(e.id)),this._registry.add("".concat(i.targetId,"_").concat(e.id),n)})),{destroy:()=>this.clearFlydownArea(i.targetId,e),options:n}}))}async setModalState(e,t){return this.execute("setModalState",{windowId:e,options:{isModal:t}})}async handleFlydownBoundsRequested(e,t){const n=()=>t.cancel=!0,i={zoneId:t.flydownId,flydownWindowBounds:t.flydownWindowBounds,flydownWindowId:t.flydownWindowId},r=await Promise.all(this._registry.execute("".concat(e,"_").concat(t.flydownId),i,n));if(1===r.length){const e={height:0,width:0,top:0,left:0},n="object"!==typeof r[0]||Array.isArray(r[0])?e:r[0];return{...t,flydownWindowBounds:n}}}async handleOnEventRequested(e,t){var n;const i=null!==(n=this.unsubCallbacks[e])&&void 0!==n?n:[];let r=!1;const o=[];return await Promise.all(i.map((e=>new Promise(((n,i)=>{e((()=>{n()}),(()=>{i()}),(e=>{r=!0,o.push(e)}),t)}))))),{prevented:r,preventArgs:o}}async zoomIn(e){return await this.execute("zoomIn",{windowId:e.id}),e}async zoomOut(e){return await this.execute("zoomOut",{windowId:e.id}),e}async setZoomFactor(e,t){return await this.execute("setZoomFactor",{windowId:e.id,options:{zoomFactor:t}}),e}async showDevTools(e){return await this.execute("showDevTools",{windowId:e.id}),e}async capture(e,t){return(await this.execute("captureScreenshot",{windowId:e.id,options:{...t}})).data}async captureGroup(e,t){return(await this.execute("captureGroupScreenshot",{windowId:e[0],options:{groupWindowIds:e,...t}})).data}async flash(e,t){return await this.execute("flash",{windowId:e.id,options:{...t}}),e}async flashTab(e,t){return await this.execute("flashTab",{windowId:e.id,options:{...t}}),e}async configure(e,t){return this.execute("configure",{windowId:e,options:{...t}})}async print(e,t){return await this.execute("print",{windowId:e.id,options:{...t}}),e}async printToPDF(e,t){return(await this.execute("printToPDF",{windowId:e.id,options:{...t}})).filePath}async place(e,t){const n={...t};return t.display&&"current"!==t.display||(n.display=await e.getDisplay()),n.display&&"string"!==typeof n.display&&"number"!==typeof n.display&&(n.display=n.display.index+1),this.execute("place",{windowId:e.id,options:{...n}})}async refresh(e,t){return await this.execute("refresh",{windowId:e.id,options:{ignoreCache:t}}),e}async download(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n.enableDownloadBar=!n.silent;const i=await this.execute("downloadURL",{windowId:e.id,options:{url:t,options:n}});return{url:t,path:i.fullPath,size:i.fileSize}}async configureWindow(e,t){return await this.execute("configureWindow",{windowId:e.id,options:t}),e}async getWindowConfiguration(e){return await this.execute("getWindowConfiguration",{windowId:e.id})}async startDrag(e,t){return await this.execute("startDrag",{windowId:e.id,options:t}),e}showDialog(e,t){return new Promise(((n,i)=>{const r=Er.generate(),o=this._registry.add("event",(t=>{if("DialogResult"===t.type&&t.windowId===e.id&&t.data.token===r){o();const e=t.data;"status"in e&&("failed"===e.status?i(e.message):"successful"===e.status&&n(e.result))}}));this.execute("showDialog",{windowId:e.id,options:Object.assign({},{...t},{token:r})})}))}async execute(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this.executeCore(this.WndMethodName,e,t,...i)}async executeGroup(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this.executeCore(this.GroupMethodName,e,t,...i)}async ungroup(e,t){const n={windowId:e.id,options:t};return await this.execute("ungroup",n),e}async updateJumpList(e,t){const n={windowId:e,options:t};await this.execute("updateJumplist",n)}async getJumpList(e){const t={windowId:e};return await this.execute("getJumplist",t)}onClosing(e,t){const n="undefined"!==typeof window&&window.glue42gd;return n&&"electron"===t.windowType?n.addCloseHandler(e,t.id):this.nonWindowHandlers(e,t.id,"OnClosing")}onRefreshing(e,t){const n="undefined"!==typeof window&&window.glue42gd;return n&&"electron"===t.windowType?n.addRefreshHandler(e,t.id):this.nonWindowHandlers(e,t.id,"OnRefreshing")}onNavigating(e,t){const n="undefined"!==typeof window&&window.glue42gd;return n&&"electron"===t.windowType?n.addWillNavigateHandler(e,t.id):this.nonWindowHandlers(e,t.id,"OnNavigating")}async goBack(e){await this.execute("goBack",{windowId:e.id})}async goForward(e){await this.execute("goForward",{windowId:e.id})}nonWindowHandlers(e,t,n){const i="".concat(t,"-").concat(n),r=()=>{if(this.unsubCallbacks[i]){const t=this.unsubCallbacks[i];this.unsubCallbacks[i]=t.filter((t=>t!==e))}0===this.unsubCallbacks[i].length&&this.execute(n,{windowId:t,options:{unsubscribe:!0}})};if(this.unsubCallbacks[i])return this.unsubCallbacks[i].push(e),r;this.unsubCallbacks[i]=[e];const o={windowId:t};return this.execute(n,o),r}reformatFlydownOptions(e,t){const n=(e,n)=>{if(t[n]&&(void 0===e[n]||null===e[n])){const i=t[n];e[n]=i}},i=t.zones.map((e=>(n(e,"windowId"),n(e,"targetLocation"),!t.size||void 0!==e.flydownSize&&null!==e.flydownSize||(e.flydownSize=t.size),e.flydownBounds=e.flydownSize,e.flydownId=e.windowId,e.targetLocation||(e.targetLocation="bottom"),e)));return{...t,zones:i,targetId:e,flydownBounds:t.size,flydownActiveArea:t.activeArea}}clearFlydownArea(e,t){return this.execute("clearFlydownWindowArea",{windowId:e,options:{}}).then((()=>{t.forEach((t=>{this._registry.clearKey("".concat(e,"_").concat(t))}))}))}executeWithoutToken(e){const t=[];for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];const o=null===i||void 0===i?void 0:i.filter((e=>!tn(e))).map((n=>new Promise((i=>{const[r,o=e.windowId]=n.split("-");t.push(this._registry.add("event",(e=>{e.type===r&&e.windowId===o&&i()})))})))),s=new Promise(((t,n)=>{this.agm.invoke("T42.Wnd.Execute",e,this.agmTarget).then((e=>{e.returned&&e.returned.errorMsg?n(e):t(e.returned)})).catch((e=>n(e)))}));return Promise.all([s,...o]).then((e=>e[0])).finally((()=>{t.forEach((e=>e()))}))}async executeCore(e,t,n){const i={...n,command:t};let r;this._finished=new Promise((e=>{r=e}));try{if("undefined"!==typeof window&&window.glueDesktop.versionNum<31200){for(var o=arguments.length,s=new Array(o>3?o-3:0),a=3;a<o;a++)s[a-3]=arguments[a];return await this.executeWithoutToken(i,...s)}return await this.executeWithToken(e,i)}finally{r()}}async executeWithToken(e,t){let n;try{const i=Er.generate(),r=new Promise((e=>{n=this._registry.add("event",(t=>{t.token===i&&e()}))})),o=new Promise(((n,r)=>{t.token=i,this.agm.invoke(e,t,this.agmTarget).then((e=>{e.returned&&e.returned.errorMsg?r(e):n(e.returned)})).catch((e=>{r(e)}))}));return(await Promise.all([o,r]))[0]}catch(i){throw i}finally{n&&n()}}areBoundsEqual(e,t){const n=t.bounds,i=t.settings;let r=e.height,o=e.width;e.height<i.minHeight&&(r=i.minHeight),e.height>i.maxHeight&&(r=i.maxHeight),e.width<i.minWidth&&(o=i.minWidth),e.width>i.maxWidth&&(o=i.maxWidth);const s=!r||n.height===r,a=!o||n.width===o,c=!e.left||n.left===e.left,u=!e.top||n.top===e.top;return s&&a&&c&&u}swapUndefinedToNull(e){try{const t={};for(const n of Object.keys(e)){let i=e[n];"undefined"===typeof i&&(i=null),t[n]=i}return t}catch{return e}}}var Gr=new Br;class Hr{constructor(e,t,n,i,r,o){this._registry=ki(),this._waitTimeout=1e4,this._agm=e,this._logger=t.subLogger("gd-env"),this._windowId=o,this._appManagerGetter=n,this._displayAPIGetter=i,this._channelsAPIGetter=r}init(){return new Promise(((e,t)=>{this._agm.register("T42.Wnd.OnEventWithResponse",((e,t)=>this.respondToEvent(e))),new Promise(((n,i)=>{this._agm.subscribe("T42.Wnd.OnEvent",{waitTimeoutMs:this._waitTimeout,target:"best",arguments:{withConfig:!0},onData:t=>{if("Configuration"===t.data.type)return this._configuration=t.data,void Gr.setConfiguration(this._configuration);this.updateWindow(t.data,e),Gr.handleEvent(t.data)},onConnected:e=>{this._agmInstance=e,Gr.init(this._agm,this._agmInstance)}}).catch((e=>{var n;const i="".concat(null===(n=null===e||void 0===e?void 0:e.method)||void 0===n?void 0:n.name," - ").concat(JSON.stringify(null===e||void 0===e?void 0:e.called_with)," - ").concat(null===e||void 0===e?void 0:e.message);t(new Error(i))}))}))}))}get executor(){return Gr}open(e,t,n){n=n||{};const i={...n};return void 0!==i.relativeTo&&"string"!==typeof i.relativeTo&&(i.relativeTo=i.relativeTo.id||""),i.name=e,i.url=t,i.windowState=n.windowState||n.state,delete i.state,this.executor.open(i)}createFlydown(e,t){return this.executor.createFlydown(e,t)}async showPopup(e,t){const n=Or.get(e);await this.executor.showPopup(n.API,t)}tabAttached(e){return this._registry.add("tab-attached",e)}tabDetached(e){return this._registry.add("tab-detached",e)}onWindowFrameColorChanged(e){return this._registry.add("frame-color-changed",e)}onEvent(e){return this._registry.add("window-event",e)}my(){return this._windowId}execute(e,t,n){return this._agm.invoke("T42.Wnd.Execute",{command:e,options:n,windowId:t})}onCompositionChanged(e){return this._registry.add("composition-changed",e)}onGroupHeaderVisibilityChanged(e){return this._registry.add("group-header-changed",e)}onGroupVisibilityChanged(e){return this._registry.add("group-visibility-changed",e)}onGroupStateChanged(e){return this._registry.add("group-state-changed",e)}onWindowGotFocus(e){return this._registry.add("got-focus",e)}onWindowLostFocus(e){return this._registry.add("lost-focus",e)}respondToEvent(e){return"ShowFlydownBoundsRequested"===e.type?this.executor.handleFlydownBoundsRequested(e.data.windowId,e.data):"OnClosing"===e.type||"OnRefreshing"===e.type||"OnNavigating"===e.type?this.executor.handleOnEventRequested(e.data.callbackId,e.data.args):Promise.reject("There isn't a handler for ".concat(e.type))}updateWindow(e,t){var n;const i=this.getExtendedStreamEvent(e);if("Snapshot"===e.type)return e.windows.forEach((e=>{const t=Or.get(e.id);if(t)t.Events.handleUpdate(this.mapToWindowConstructorOptions(e));else{const t=this.createWindow(e.id,e);Or.markReadyToShow(t.API.id)}this._registry.execute("window-event",i)})),void t(this);if("CommandExecuted"===e.type)return void this._registry.execute("window-event",i);if("Created"===e.type){const t=e,n=this.createWindow(t.windowId,t.data||{});return Or.setReadyState(n.API.id),void this._registry.execute("window-event",i)}if("OnGroupVisibilityChanged"===e.type){const t=e;return this._registry.execute("group-visibility-changed",t.data),void this._registry.execute("window-event",e)}if("OnGroupStateChanged"===e.type){const t=e;return this._registry.execute("group-state-changed",t.data),void this._registry.execute("window-event",e)}const r=Or.get(e.windowId);if(!r)return void this._logger.error("received update for unknown window. Stream:', ".concat(JSON.stringify(e,null,4)));const o=r.API,s=r.Events;if("BoundsChanged"===e.type){const t=e;s.handleBoundsChanged(t.data)}if("UrlChanged"===e.type){const t=e;Or.setUrlChangedState(t.windowId),s.handleUrlChanged(t.data)}if("TitleChanged"===e.type){const t=e;s.handleTitleChanged(t.data)}if("IsStickyChanged"===e.type){const t=e;s.handleIsStickyChanged(t.data)}if("VisibilityChanged"===e.type&&s.handleVisibilityChanged(e.data),"ContextChanged"===e.type&&s.handleContextUpdated(e.data),"StateChanged"===e.type&&s.handleWindowChangeState(e.data),"FrameColorChanged"===e.type&&(s.handleFrameColorChanged(e.data),this._registry.execute("frame-color-changed",o)),"CompositionChanged"===e.type){const t=e;s.handleCompositionChanged(t.data),Or.setCompositionChangedState(t.data.windowId,null===(n=this._configuration)||void 0===n?void 0:n.windowAvailableOnURLChanged),this._registry.execute("composition-changed",t.data)}if("GroupHeaderVisibilityChanged"===e.type){const t=e;s.handleGroupHeaderVisibilityChanged(t.data.groupHeaderVisible),this._registry.execute("group-header-changed",t.data)}if("FocusChanged"===e.type){const t=e;this.focusChanged(s,o,t.data)}if("WindowFrameChanged"===e.type&&(s.handleFrameAttached(e.data.frameId,e.data.frameId,e.data.isTabHeaderVisible),this._registry.execute("frame-changed")),"WindowFrameAdded"===e.type){const t=Ur(o.id,e.data.frameId),n=e.data;s.handleAttached(n.frameId,n.frameId,n.isTabHeaderVisible,n.isLocked,t).then((async()=>{t.length>0&&(await Gr.finished,this._registry.execute("tab-attached",o,e.data.frameId,e.data.isTabHeaderVisible))}))}if("WindowFrameRemoved"===e.type){const t=o.tabGroupId,n=Ur(o.id,t);s.handleDetached(e.data.isLocked,n).then((async()=>{n.length>0&&(await Gr.finished,this._registry.execute("tab-detached",o,e.data.frameId,o.tabGroupId))}))}"TabHeaderVisibilityChanged"===e.type&&s.handleTabHeaderVisibilityChanged(e.data.isTabHeaderVisible),"FrameSelectionChanged"===e.type&&s.handleFrameSelectionChanged(e.data.newWindowId,e.data.prevWindowId),"ButtonClicked"===e.type&&s.handleFrameButtonClicked(e.data),"ButtonAdded"===e.type&&s.handleFrameButtonAdded(e.data),"ButtonRemoved"===e.type&&s.handleFrameButtonRemoved(e.data),"WindowZoomFactorChanged"===e.type&&s.handleZoomFactorChanged(e.data),"Closed"===e.type&&(Or.remove(r),s.handleWindowClose()),"FrameIsLockedChanged"===e.type&&s.handleFrameIsLockedChanged(e.data),"PlacementSettingsChanged"===e.type&&s.handlePlacementSettingsChanged(e.data),this._registry.execute("window-event",i)}createWindow(e,t){const n=Lr(e,this.mapToWindowConstructorOptions(t),Gr,this._logger,this._appManagerGetter,this._displayAPIGetter,this._channelsAPIGetter,this._agm);return Or.add(n),n}async focusChanged(e,t,n){e.handleFocusChanged(n),await Or.waitFor(t.id),n?this._registry.execute("got-focus",t):this._registry.execute("lost-focus",t)}mapToWindowConstructorOptions(e){return{name:e.name,context:e.context,bounds:e.bounds,url:e.url,title:e.title,isVisible:e.isVisible,focus:e.isFocused,state:e.state,frameColor:e.frameColor,groupId:e.groupId,neighbours:e.neighbors,isFocused:e.isFocused,isGroupHeaderVisible:e.groupHeaderVisible,isCollapsed:e.isCollapsed,tabGroupId:e.frameId,frameId:e.frameId,mode:e.mode,isTabHeaderVisible:e.isTabHeaderVisible,isTabSelected:e.isActiveTab,settings:e.settings,windowType:e.windowType,zoomFactor:e.zoomFactor,isLocked:e.isLocked,placementSettings:e.placementSettings,isSticky:e.isSticky,tabIndex:e.tabIndex,frameButtons:e.frameButtons,jumpListOptions:e.jumpList,applicationName:e.applicationName}}getExtendedStreamEvent(e){try{if(!e.windowId)return e;const t=Or.get(e.windowId);if(!t)return e;const n={state:e.type,windowName:t.API.name,...e};return"WindowFrameAdded"===n.state&&(n.state="TabAttached"),"StateChanged"===n.state&&(n.state=n.data.charAt(0).toUpperCase()+n.data.slice(1)),"ButtonAdded"===n.state&&(n.state="FrameButtonAdded"),"ButtonRemoved"===n.state&&(n.state="FrameButtonRemoved"),n}catch(t){return e}}}var zr=(e,t,n,i,r,o)=>{const s=t;if(2===o)throw s.trace("running in HC"),new Error("GD2 not supported");return o>=3?(s.trace("running in GD 3"),new Hr(e,s,n,i,r,window.glue42gd.windowId).init()):new Hr(e,s,n,i,r).init()},Vr=(e,t)=>{const n=ki(),i=[];let r=!1,o=!0;async function s(e){if(-1===i.indexOf(e)){i.push(e);const r=Or.get(e);r.Events.handleGroupChanged(I,void 0),await t.finished,n.execute("window-added",I,r.API)}}async function a(e){const r=i.indexOf(e.API.id);-1!==r&&(i.splice(r,1),e.Events.handleGroupChanged(void 0,I),await t.finished,n.execute("window-removed",I,e.API))}function c(e,t,n){let i;"string"===typeof e?i=e:tn(e)||(i=e.id);const r=g(i);if(r)return"function"===typeof t&&t(r),r;"function"===typeof n&&n("No window with ID: ".concat(i))}function u(e){const t=f();return"function"===typeof e&&e(t),t}async function d(e,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];return await t.execute(e,n,...r),I}function l(e){n.execute("header-visibility-changed",I)}function h(e){o=e,n.execute("group-visibility-changed",I)}function p(e){r=e}function f(){const e=[];return i.forEach((t=>{const n=g(t);"undefined"!==typeof n&&e.push(n)})),e}function g(e){return Or.get(e)?Or.get(e).API:void 0}function m(){return void 0===f().find((e=>!e.isGroupHeaderVisible))}function v(){return r}function y(e){return n.add("header-visibility-changed",e)}function w(e){return n.add("window-added",e)}function b(e){return n.add("window-removed",e)}function _(e){if(!e)throw new Error("Callback argument is required");if(e&&"function"!==typeof e)throw new Error("Callback argument must be a function");return n.add("group-visibility-changed",e)}const I={id:e,get windows(){return u()},find:c,get isHeaderVisible(){return m()},get isHibernated(){return v()},get isVisible(){return o},showHeader:(e,t)=>jr.callbackifyPromise((()=>d("setGroupHeaderVisibility",{windowId:i[0],options:{toShow:!0}},...i.map((e=>"GroupHeaderVisibilityChanged-".concat(e))))),e,t),hideHeader:(e,t)=>jr.callbackifyPromise((()=>d("setGroupHeaderVisibility",{windowId:i[0],options:{toShow:!1}},...i.map((e=>"GroupHeaderVisibilityChanged-".concat(e))))),e,t),getTitle:async()=>(await t.execute("getGroupTitle",{windowId:i[0]})).title,setTitle:async e=>{if(nn(e))throw new Error("`title` must not be null or undefined.");return d("setGroupTitle",{windowId:i[0],options:{title:e}})},capture:e=>t.captureGroup(i,e),maximize:(e,t)=>jr.callbackifyPromise((()=>d("maximizeGroup",{windowId:i[0]},...i.map((e=>"StateChanged-".concat(e))))),e,t),restore:(e,t)=>jr.callbackifyPromise((()=>d("restoreGroup",{windowId:i[0]},...i.map((e=>"StateChanged-".concat(e))))),e,t),show:n=>{if(!tn(n)&&!rn(n))throw new Error("Activate flag must be a boolean!");return n=!!tn(n)||n,t.executeGroup("showGroup",{groupId:e,options:{activate:n}})},hide:()=>t.executeGroup("hideGroup",{groupId:e}),onHeaderVisibilityChanged:y,onWindowAdded:w,onWindowRemoved:b,onVisibilityChanged:_};return{groupAPI:I,groupInternal:{get windows(){return i},addWindow:s,removeWindow:a,handleGroupHeaderVisibilityChanged:l,handleGroupVisibilityChanged:h,handleGroupHibernateChanged:p}}},Jr=(e,t)=>{const n=ki(),i={};let r=-1;const o=Or.list;function s(){return c(e.my())}function a(e){const t=Object.keys(i).map((e=>{if(i[e])return i[e].groupAPI}));return"function"===typeof e&&e(t),t}function c(e,t,n){let r;"string"===typeof e?r=e:tn(e)||(r=e.id);const o=Object.values(i).find((e=>e.groupAPI.windows.filter((e=>e.id===r)).length));if(o)return"function"===typeof t&&t(o.groupAPI),o.groupAPI;"function"===typeof n&&n("Cannot find the group of the window.")}function u(e){return e?new Promise(((t,n)=>{const r=i[e];if(r)t(r.groupAPI);else{const n=h((i=>{i.id===e&&(n(),t(i))}))}})):Promise.reject("groupId must be defined")}async function d(e,t){if(!tn(t)&&!rn(t))throw new Error("Activate flag must be a boolean!");t=!!tn(t)||t,await Gr.executeGroup("resumeGroup",{groupId:e,options:{activate:t}})}async function l(e){return await Gr.executeGroup("hibernateGroup",{groupId:e}),e}function h(e){return n.add("group-added",e)}function p(e){return n.add("group-removed",e)}function f(e){return n.add("window-moved",e)}function g(e){if(!e)throw new Error("Callback argument is required");if(e&&"function"!==typeof e)throw new Error("Callback argument must be a function");return n.add("group-hibernated",e)}function m(e){if(!e)throw new Error("Callback argument is required");if(e&&"function"!==typeof e)throw new Error("Callback argument must be a function");return n.add("group-resumed",e)}function v(t){if(i.hasOwnProperty(t))return i[t];{const r=Vr(t,e.executor);i[t]=r;const o=r.groupAPI;return n.execute("group-added",o),r}}function y(e){const t=e.groupAPI;0===t.windows.length&&(delete i[t.id],n.execute("group-removed",t))}function w(e,t){const n=v(e);return n.groupInternal.addWindow(t),n}function b(e,t){e&&(e.groupInternal.removeWindow(t),y(e))}function _(e){const t=e.groupId,n=e.windowId,i=Or.get(n);if(!i)return;const r=C(i.API);tn(t)?b(r,i):!tn(r)||tn(t)?r.groupAPI.id!==t&&I(i,r.groupAPI.id,t):w(t,i.API.id)}function I(e,t,r){const o=e.API.id,s=i[t];b(s,e);const a=w(r,o);e.Events.handleGroupChanged(a.groupAPI,s.groupAPI),n.execute("window-moved",o,t,r)}function C(e){let t;return"string"===typeof e?t=e:tn(e)||(t=e.id),Object.values(i).find((e=>e.groupInternal.windows.filter((e=>e===t)).length))}return Object.keys(o).forEach((e=>{const t=o[e],n=t.API.groupId,i=t.API.id;nn(n)||w(n,i)})),Or.onRemoved((e=>{b(C(e.API),e)})),e.onCompositionChanged((e=>{_(e)})),e.onGroupHeaderVisibilityChanged((e=>{const t=c(e.windowId);if("undefined"!==typeof t){const n=i[t.id];-1===r&&(r=t.windows.length),r--,0===r&&(r=-1,n.groupInternal.handleGroupHeaderVisibilityChanged(e))}})),e.onGroupVisibilityChanged((e=>{const t=i[e.groupId];t&&t.groupInternal.handleGroupVisibilityChanged(e.visible)})),e.onGroupStateChanged((e=>{const t=i[e.groupId];"hibernated"===e.state?(t&&t.groupAPI&&t.groupInternal.handleGroupHibernateChanged(!0),n.execute("group-hibernated",e.groupId)):"resumed"===e.state&&(t&&t.groupAPI&&t.groupInternal.handleGroupHibernateChanged(!1),n.execute("group-resumed",t.groupAPI))})),{groupsAPI:{get my(){return s()},list:a,findGroupByWindow:c,waitForGroup:u,onGroupAdded:h,onGroupRemoved:p,hibernate:l,resume:d,onHibernated:g,onResumed:m},groupsEvents:{onWindowMoved:f}}},Kr=(e,t,n,i,r,o)=>{const s=ki(),a=t;let c,u;Or.init(a);const d=new Promise(((t,s)=>{zr(e,a,n,i,r,o).then((n=>{u=n,c=Jr(n),Rr.init(n.executor,e,a),t()})).catch((e=>{const t="Timed out waiting for connection to Glue42 Enterprise: Error: ".concat(e.message);a.error(t,e),s(new Error(t))}))}));function l(){return d}function h(){const e=Or.getIfReady(u.my());return e?e.API:void 0}function p(e,t,n,i,r){return jr.callbackifyPromise((()=>{if(nn(e))throw new Error("The window name is missing.");if(nn(t))throw new Error("The window URL is missing.");if(!tn(n)){const e=n;for(const t of["minHeight","maxHeight","minWidth","maxWidth","width","height","top","left"])if(t in e){const n=e[t];if(tn(n)){delete e[t];continue}if(!Qt(n)){const e="".concat(t," must be a number");throw new Error(e)}if(("width"===e[t]||"height"===e[t])&&n<=0){const e="".concat(t," must be a positive number");throw new Error(e)}}}return u.open(e,t,n)}),i,r)}function f(e,t,n){const i=Or.list,r=Object.keys(i).reduce(((t,n)=>{var r;const o=i[n];return(null===(r=null===o||void 0===o?void 0:o.API)||void 0===r?void 0:r.name)===e&&t.push(o.API),t}),[]);if(r[0])return"function"===typeof t&&t(r[0]),r[0];"function"===typeof n&&n("There is no window with name:"+e)}function g(e,t,n){const i=Or.list,r=Object.keys(i).reduce(((t,n)=>{const r=i[n];return"undefined"!==typeof r&&r.API.id===e&&t.push(r.API),t}),[]);if(r[0])return"function"===typeof t&&t(r[0]),r[0];"function"===typeof n&&n("There is no window with such id:"+e)}function m(e){const t=Or.list,n=Object.keys(t).map((e=>t[e].API));if("function"!==typeof e)return n;e(n)}function v(e){const t=h(),n=t?t.id:"";return Gr.configure(n,e)}function y(e){return s.add("window-added",e)}function w(e){return s.add("window-removed",e)}function b(e){let t,n=!1;return d.then((()=>{n||(t=u.tabAttached(e))})),()=>{n=!0,t&&t()}}function _(e){let t,n=!1;return d.then((()=>{n||(t=u.tabDetached(e))})),()=>{n=!0,t&&t()}}function I(e){let t,n=!1;return d.then((()=>{n||(t=u.onWindowFrameColorChanged(e))})),()=>{n=!0,t&&t()}}function C(e){let t,n=!1;return d.then((()=>{n||(t=u.onWindowGotFocus(e))})),()=>{n=!0,t&&t()}}function S(e){let t,n=!1;return d.then((()=>{n||(t=u.onWindowLostFocus(e))})),()=>{n=!0,t&&t()}}function k(e){let t,n=!1;return d.then((()=>{n||(t=u.onEvent(e))})),()=>{n=!0,t&&t()}}function x(e,t){return u.createFlydown(e,t)}function T(e,t){return u.showPopup(e,t)}function A(e){s.execute("window-added",e.API)}function E(e){s.execute("window-removed",e.API)}return Or.onReadyWindow(A),Or.onRemoved(E),{my:h,open:p,find:f,findById:g,list:m,ready:l,onWindowAdded:y,windowAdded:y,onWindowRemoved:w,windowRemoved:w,onTabAttached:b,onTabDetached:_,onWindowFrameColorChanged:I,get groups(){return c.groupsAPI},onWindowGotFocus:C,onWindowLostFocus:S,onEvent:k,createFlydown:x,showPopup:T,configure:v}};class $r{constructor(){this.layouts=[]}removeWhere(e){this.layouts=this.layouts.filter(e)}removeAll(){this.layouts=[]}add(e){this.layouts.push(e)}get all(){return this.layouts}where(e){return this.layouts.filter(e)}first(e){return this.where(e)[0]}}var Qr=new $r;const Yr="T42.HC.GetSaveContext";class Xr{constructor(e,t,n,i){this.config=e,this.activitiesGetter=t,this.callbacks=n,this.logger=i,this.interop=e.agm,this.registerRequestMethods()}onSaveRequested(e){return this.callbacks.add("saveRequested",e)}isActivityOwner(){if("undefined"!==typeof htmlContainer){const e=htmlContainer.getContext();return e&&e._t42&&e._t42.activityIsOwner}const e=this.activitiesGetter();if(!e)return!1;if(!e.inActivity)return!1;const t=e.my.window,n=e.my.activity;return!(!n&&!t)&&n.owner.id===t.id}registerRequestMethods(){this.interop.register(Yr,(e=>{const t=this.callbacks.execute("saveRequested",e);(null===t||void 0===t?void 0:t.length)>1&&this.logger.warn('Multiple subscriptions for "glue.layouts.onSaveRequested" - only the first one will be used');const n=t[0],i=this.config.autoSaveWindowContext;if("boolean"===typeof i&&i)return{autoSaveWindowContext:i};if(Array.isArray(i)&&i.length>0)return{autoSaveWindowContext:i};const r={windowContext:null===n||void 0===n?void 0:n.windowContext,activityContext:void 0};return this.isActivityOwner()&&(r.activityContext=null===n||void 0===n?void 0:n.activityContext),r}))}}function Zr(e){if(!e)return e;if(Array.isArray(e))return e.map((e=>Zr(e)));if("string"===typeof e||"number"===typeof e||"boolean"===typeof e)return e;const t={};return Object.keys(e).reduce(((t,n)=>{var i;const r=Zr(e[n]);let o=n;return(null===(i=n[0])||void 0===i?void 0:i.toLowerCase())!==n[0]&&(o=n[0].toLowerCase()+n.substr(1)),t[o]=r,t}),t)}class eo{constructor(e){this.name=e.name,this.type=e.type,this.components=e.components,this.context=e.context,this.metadata=e.metadata,this.version=e.version,this.displays=e.displays}}const to="T42.ACS.Command";class no{constructor(e,t,n,i){this.config=e,this.stream=t,this.callbacks=n,this.isRegisterMethodForLayoutModified=!1,this.appManager=e.appManager,this.provider=new Xr(e,e.activityGetter,n,i),t.subscribe()}async setDefaultGlobal(e){const t="SelectDefaultLayout";await this.invokeMethodCore(t,{name:e})}async clearDefaultGlobal(){const e="DeselectDefaultLayout";this.invokeMethodCore(e)}async getDefaultGlobal(){const e="GetDefaultLayout",t=(await this.invokeMethodCore(e)).returned;if(t)return this.isSlimMode()?t:this.list().find((e=>e.name===t.name&&"Global"===e.type))}ready(){return"fullWaitSnapshot"===this.config.mode?this.stream.gotSnapshot:this.stream.ready}save(e){return new Promise(((t,n)=>{var i,r;if(this.verifyNotSlimMode(),tn(e))return n(new Error("layout is required"));if(nn(e.name))return n(new Error("layout.name argument is required"));nn(e.type)&&(e.type="Global"),nn(e.activityId)||(e.type="Activity");const o={name:e.name,type:e.type,context:null!==(i=e.context)&&void 0!==i?i:{},metadata:null!==(r=e.metadata)&&void 0!==r?r:{},options:{}};if("Activity"===e.type){let t=e.activityId;if(!t){if(!this.appManager.myInstance.inActivity)return n(new Error("Current application is not in activity. Cannot save activity layout for it."));t=this.appManager.myInstance.activityId}o.activityId=t}else{if("Global"!==e.type)return n(new Error("layout type ".concat(e.type," is not supported")));Array.isArray(e.ignoreInstances)&&(o.options.ignoreInstances=e.ignoreInstances),Array.isArray(e.instances)&&(o.options.instances=e.instances)}this.invokeMethodAndTrack("SaveLayout",o,t,n)}))}restore(e){return new Promise(((t,n)=>{var i,r,o;if(this.verifyNotSlimMode(),tn(e))return n(new Error("options argument is required"));if(nn(e.name))return n(new Error("options.name argument is required"));if(nn(e.type)&&(e.type="Global"),nn(e.activityIdToJoin)||(e.type="Activity"),"Activity"===e.type){if(tn(e.setActivityContext)&&(e.setActivityContext=!0),"boolean"!==typeof e.setActivityContext)return n(new Error("`setActivityContext` must hold a boolean value."));e.activityIdToJoin=null!==(i=e.activityIdToJoin)&&void 0!==i?i:this.appManager.myInstance.activityId}if(tn(e.closeRunningInstance)||(e.closeRunningInstances=e.closeRunningInstance),tn(e.closeRunningInstances)&&(e.closeRunningInstances=!0),!rn(e.closeRunningInstances))return n(new Error("`closeRunningInstances` must hold a boolean value."));if(tn(e.closeMe)&&(e.closeMe=e.closeRunningInstances),!rn(e.closeMe))return n(new Error("`closeMe` must hold a boolean value."));if(!tn(e.context)&&!Xt(e.context))return n(new Error("`context` must hold an object value."));if(!tn(e.timeout)&&"number"!==typeof e.timeout)return n(new Error("`timeout` must hold an number value."));e.context=null!==(r=e.context)&&void 0!==r?r:{};const s={activityToJoin:e.activityIdToJoin,setActivityContext:e.setActivityContext,ignoreActivityWindowTypes:e.ignoreActivityWindowTypes,reuseExistingWindows:e.reuseWindows,closeRunningInstances:e.closeRunningInstances,excludeFromClosing:e.closeMe?[]:[null===(o=this.appManager.myInstance)||void 0===o?void 0:o.id]},a={type:e.type,name:e.name,context:e.context,options:s};e.timeout&&(a.timeout=e.timeout),this.invokeMethodAndTrack("RestoreLayout",a,t,n,!0)}))}remove(e,t){return new Promise(((n,i)=>{if(this.verifyNotSlimMode(),!t)return i(new Error("name argument is required"));if(!e)return i(new Error("type argument is required"));const r={type:e,name:t};this.invokeMethodAndTrack("RemoveLayout",r,n,i)}))}list(){return this.verifyNotSlimMode(),Qr.all}import(e,t){return new Promise(((n,i)=>{if(this.verifyNotSlimMode(),!tn(t)&&"merge"!==t&&"replace"!==t)return i(new Error("".concat(t,' is not supported - only "merge" and "replace"')));if(!Array.isArray(e))return i(new Error("layouts arguments is not an array"));const r={mode:t||"replace",layouts:e};this.invokeMethodAndTrack("ImportLayouts",r,n,i,!0)}))}export(e){return new Promise(((t,n)=>{const i=n=>{let i=this.getObjectValues(n.Layouts).map((e=>new eo(Zr(e))));e&&(i=i.filter((t=>t.type===e))),t(i)};this.invokeMethodAndTrack("ExportLayouts",{},i,n,!0)}))}rename(e,t){return new Promise(((n,i)=>{if(this.verifyNotSlimMode(),!e)return i(new Error("layout argument is required"));if(!e.name)return i(new Error("name argument is required"));if(!e.type)return i(new Error("type argument is required"));const r={type:e.type,oldName:e.name,newName:t};this.invokeMethodAndTrack("RenameLayout",r,n,i)}))}updateMetadata(e){return new Promise(((t,n)=>{if(!e)return n(new Error("layout argument is required"));if(!e.name)return n(new Error("name argument is required"));if(!e.type)return n(new Error("type argument is required"));if(!e.metadata)return n(new Error("metadata argument is required"));const i={name:e.name,type:e.type,metadata:e.metadata};this.invokeMethodAndTrack("UpdateMetadata",i,t,n,!0)}))}hibernate(e,t){return new Promise(((n,i)=>{if(!e)return i(new Error("name cannot be empty"));const r={name:e,type:"Global",context:(t=t||{}).context||{},metadata:t.metadata||{}};this.invokeMethodAndTrack("HibernateLayout",r,n,i,!0)}))}resume(e,t,n){return new Promise(((i,r)=>{if(!e)return r(new Error("name cannot be empty"));const o={name:e,type:"Global",context:t,...n};this.invokeMethodAndTrack("ResumeLayout",o,i,r,!0)}))}async getCurrentLayout(){const e="GetCurrentLayout";let t=(await this.invokeMethodCore(e)).returned.layout;if(t)return this.isSlimMode()||(t=this.list().find((e=>e.name===t.name&&e.type===t.type))),t}onAdded(e){const t=this.callbacks.add("added",e);return Qr.all.length>0&&Qr.all.forEach((t=>{try{e(t)}catch(n){}})),t}onRemoved(e){return this.callbacks.add("removed",e)}onChanged(e){return this.callbacks.add("changed",e)}onRestored(e){return this.callbacks.add("restored",e)}onRenamed(e){return this.callbacks.add("renamed",e)}onEvent(e){return this.stream.onEvent(e)}onSaveRequested(e){return this.provider.onSaveRequested(e)}onLayoutModified(e){return!1===this.isRegisterMethodForLayoutModified&&(this.isRegisterMethodForLayoutModified=!0,this.registerMethodForLayoutModified()),this.callbacks.add("layout-modified",e)}updateAppContextInCurrent(e){return new Promise(((t,n)=>{if(e&&"object"!==typeof e)return n(new Error("context must be an object"));const i={context:e=null!==e&&void 0!==e?e:{}};this.invokeMethodAndTrack("UpdateLayoutComponentContext",i,t,n,!0)}))}updateDefaultContext(e){return new Promise(((t,n)=>{if(e&&"object"!==typeof e)return n(new Error("context must be an object"));const i={context:e=null!==e&&void 0!==e?e:{}};this.invokeMethodAndTrack("UpdateDefaultContext",i,t,n,!0)}))}async get(e,t){const n=this.list().find((n=>n.name===e&&n.type===t));if(!n)throw new Error("cannot find layout with name=".concat(e," and type=").concat(t));return n}async getAll(e){return this.list().filter((t=>e===t.type))}async forceRefresh(){const e="RefreshLayouts";await this.invokeMethodCore(e)}isSlimMode(){return"slim"===this.config.mode}verifyNotSlimMode(){if(this.isSlimMode())throw Error("Operation not allowed in slim mode. Run in full mode.")}async registerMethodForLayoutModified(){await this.config.agm.register("T42.ACS.LayoutModified",((e,t)=>{this.callbacks.execute("layout-modified",e)}))}invokeMethodAndTrack(e,t,n,i,r){let o,s=r;const a=Er();t.token=a;const c=()=>{s&&o&&n(o)},u=12e4;r||this.stream.waitFor(a,u).then((()=>{s=!0,c()})).catch((e=>{i(e)}));const d=t=>{if(!t.returned)return i(new Error("No result from method "+e));if(t.returned.status&&"Success"!==t.returned.status&&"PartialSuccess"!==t.returned.status){if("string"===typeof t.returned)return i(new Error(t.returned));if("object"===typeof t.returned)return t.returned.status&&t.returned.failed?i(new Error("".concat(t.returned.status,": ").concat(JSON.stringify(t.returned.failed)))):i(new Error(t.returned))}o=t.returned,c()};this.invokeMethodCore(e,t,"best",{methodResponseTimeoutMs:u}).then(d).catch((e=>i(e)))}async invokeMethodCore(e,t,n,i){return this.isCommandMethodPresent()?await this.config.agm.invoke(to,{command:e,data:t},n,i):await this.config.agm.invoke("T42.ACS.".concat(e),t,n,i)}getObjectValues(e){return e?Object.keys(e).map((t=>e[t])):[]}isCommandMethodPresent(){return this.config.agm.methods().some((e=>e.name===to))}}class io{constructor(e,t){this.agm=e,this.callbacks=t,this.StreamName="T42.ACS.OnLayoutEvent",this.ready=new Promise(((e,t)=>{this.resolveReady=e,this.rejectReady=t})),this.gotSnapshot=new Promise(((e,t)=>{this.resolveGotSnapshot=e,this.rejectGotSnapshot=t}))}subscribe(e){const t=e=>this.getObjectValues(e).map((e=>Zr(e)));this.checkForLayoutEventMethod()?this.agm.subscribe(this.StreamName,{waitTimeoutMs:1e4}).then((e=>{e.onData((e=>{const n=e.data;n.IsSnapshot&&this.resolveGotSnapshot(),this.addLayouts(t(n.OnLayoutAdded),n.IsSnapshot),this.removeLayouts(t(n.OnLayoutRemoved)),this.changeLayouts(t(n.OnLayoutChanged)),this.renameLayouts(t(n.OnLayoutRenamed)),this.restoredLayout(t(n.OnLayoutRestored)),this.callbacks.execute("streamEvent",n)})),e.onFailed((e=>{const t='Can not subscribe to "'.concat(this.StreamName,'" stream - ').concat(JSON.stringify(e));this.rejectReady(t),this.rejectGotSnapshot(t)})),this.resolveReady()})).catch((e=>{const t='Error subscribing to "'.concat(this.StreamName,'" stream - ').concat(JSON.stringify(e));this.rejectReady(t),this.rejectGotSnapshot(t)})):(e&&this.resolveReady(),setTimeout((()=>{this.subscribe(!0)}),500))}onEvent(e){return this.callbacks.add("streamEvent",e)}waitFor(e,t){return t||(t=3e4),new Promise(((n,i)=>{let r=!1;const o=this.onEvent((t=>{t.Token===e&&(r=!0,o(),n())}));setTimeout((()=>{r||i("timed out")}),t)}))}checkForLayoutEventMethod(){try{return-1!==this.agm.methods().map((e=>e.name)).indexOf(this.StreamName)}catch(e){return!1}}addLayouts(e,t){if(!e)return;const n=e=>{const t=new eo(e);Qr.add(t),this.callbacks.execute("added",t)};e.forEach((e=>{t&&Qr.first((t=>this.compareLayouts(t,e)))||n(e)}))}removeLayouts(e){e&&e.forEach((e=>{Qr.removeWhere((t=>!this.compareLayouts(t,e))),this.callbacks.execute("removed",e)}))}changeLayouts(e){e&&e.forEach((e=>{Qr.removeWhere((t=>!this.compareLayouts(t,e))),Qr.add(new eo(e)),this.callbacks.execute("changed",e)}))}renameLayouts(e){e&&e.forEach((e=>{const t=Qr.first((t=>this.compareLayouts(t,{type:e.type,name:e.oldName})));if(!t)throw Error("received rename event for unknown layout with type ".concat(e.type," and name ").concat(e.oldName));t.name=e.newName,this.callbacks.execute("renamed",t)}))}compareLayouts(e,t){return e.name===t.name&&e.type===t.type}getObjectValues(e){return e?Object.keys(e).map((t=>e[t])):[]}restoredLayout(e){e&&e.forEach((e=>{const t=Qr.first((t=>this.compareLayouts(t,{type:e.type,name:e.name})));this.callbacks.execute("restored",t)}))}}function ro(e){if(!e.agm)throw Error("config.agm is required");if(!e.logger)throw Error("config.logger is required");e.mode=e.mode||"slim";const t=e.logger,n=ki();let i;return e.mode,i=new io(e.agm,n),new no(e,i,n,t)}const oo="T42.Displays.Command",so="T42.Displays.OnEvent";class ao{constructor(e,t){this._agm=e,this._logger=t,this._registry=ki(),this._registered=!1,this.all=async()=>(await this.callGD(co.GetAll,{})).map(this.decorateDisplay),this.get=async e=>{const t=await this.callGD(co.Get,{id:e});return this.decorateDisplay(t)},this.getPrimary=async()=>(await this.all()).find((e=>e.isPrimary)),this.capture=async e=>await this.callGD(co.Capture,{...e}),this.captureAll=async e=>await this.callGD(co.CaptureAll,{...e}),this.getMousePosition=async()=>await this.callGD(co.GetMousePosition),this.callGD=async(e,t)=>(await this._agm.invoke(oo,{options:{...t},command:e})).returned.data,this.decorateDisplay=e=>{const t={...e,capture:t=>this.capture({id:e.id,size:t})},n=t.workArea;return n.x=n.left,n.y=t.workArea.top,t}}getByWindowId(e){return this.callGD(co.GetByWindowId,{id:e})}onDisplayChanged(e){return this.register(),this._registry.add("on-display-changed",e)}register(){this._registered||(this._registered=!0,this._agm.register(so,((e,t)=>{const n=e.event,i=e.data;"display-changed"===n?this._registry.execute("on-display-changed",i.displays.map(this.decorateDisplay)):this._logger.warn("unknown event - ".concat(n))})))}}var co;let uo,lo;!function(e){e.Capture="capture",e.CaptureAll="captureAll",e.GetAll="getAll",e.Get="get",e.GetByWindowId="getByWindowId",e.GetMousePosition="getMousePosition"}(co||(co={}));const ho="T42.Channels.Announce";async function po(e,t){uo=e,"undefined"!==typeof window&&window.glue42gd&&(lo=window.glue42gd.windowId),lo&&(await uo.register("T42.Channels.Command",(e=>{const n=e.command;if(!n)throw new Error("missing command argument");if("join"!==n){if("leave"!==n){if("get"===n)return{id:t.current()};throw new Error("unknown command ".concat(n))}t.leaveNoSelectorSwitch()}else{const n=e.channel;if(!n)throw new Error("missing argument id");t.joinNoSelectorSwitch(n)}})),await uo.invoke("T42.Channels.Announce",{swId:lo,instance:uo.instance.instance}))}async function fo(e,t){uo.invoke("T42.Channels.Announce",{swId:null!==t&&void 0!==t?t:lo,command:"switchChannel",data:{newChannel:e}})}async function go(e){return(await uo.invoke(ho,{command:"getChannelsInfo",data:{filter:e}})).returned}async function mo(e,t,n){await uo.invoke(ho,{command:e,data:{id:t,color:n}})}const vo="___channel___",yo="latest_fdc3_type";class wo{constructor(e){this.contexts=e}subscribe(e){this.callback=e}subscribeFor(e,t){if(!this.isChannel(e))return Promise.reject(new Error("Channel with name: ".concat(e," doesn't exist!")));const n=this.createContextName(e);return this.contexts.subscribe(n,((e,n,i,r,o)=>{t(e.data,e,null===o||void 0===o?void 0:o.updaterId)}))}async switchChannel(e){this.unsubscribe();const t=this.createContextName(e);this.unsubscribeFunc=await this.contexts.subscribe(t,((e,t,n,i,r)=>{this.callback&&this.callback(e.data,e,null===r||void 0===r?void 0:r.updaterId)}))}leave(){this.callback&&this.callback({},void 0),this.unsubscribe()}all(){return this.contexts.all().filter((e=>e.startsWith(vo))).map((e=>e.substr(vo.length)))}async getContextData(e){if(!this.isChannel(e))throw new Error("A channel with name: ".concat(e," doesn't exist!"));const t=this.createContextName(e),n=await this.contexts.get(t);if(n[yo]){const{latest_fdc3_type:e,...t}=n;return t}return n}updateChannel(e,t){const n=this.createContextName(e);return this.contexts.update(n,t)}updateData(e,t){const n=this.createContextName(e),i=this.getFDC3Type(t);if(this.contexts.setPathSupported){const e=Object.keys(t).map((e=>({path:"data."+e,value:t[e]})));return i&&e.push({path:yo,value:i}),this.contexts.setPaths(n,e)}return i&&(t[yo]=i),this.contexts.update(n,{data:t})}isChannel(e){return this.all().some((t=>t===e))}async remove(e){if(!this.isChannel(e))throw new Error("A channel with name: ".concat(e," doesn't exist!"));const t=this.createContextName(e);await this.contexts.destroy(t)}unsubscribe(){this.unsubscribeFunc&&this.unsubscribeFunc()}createContextName(e){return vo+e}getFDC3Type(e){const t=Object.keys(e).filter((e=>0===e.indexOf("fdc3_")));if(0!==t.length){if(t.length>1)throw new Error("FDC3 does not support updating of multiple context keys");return t[0].split("_").slice(1).join("_")}}}class bo{constructor(e,t,n,i){this.shared=e,this.interop=t,this.getWindows=n,this.logger=i,this.subsKey="subs",this.changedKey="changed",this.isInitialJoin=!0,this.registry=ki(),this.pendingReplays={},this.shared.subscribe(this.handler.bind(this)),"undefined"!==typeof window&&"undefined"!==typeof window.glue42gd&&(this.currentContext=window.glue42gd.initialChannel,this.currentContext&&this.joinNoSelectorSwitch(this.currentContext))}subscribe(e){if("function"!==typeof e)throw new Error("Please provide the callback as a function!");const t=Er();if(this.pendingReplays[t]=!0,this.lastUpdate){let n=Object.assign({},this.lastUpdate);setTimeout((()=>{this.pendingReplays[t]&&(this.lastUpdate&&(n=this.lastUpdate),e(n.context.data,n.context,n.updaterId)),delete this.pendingReplays[t]}),0)}const n=this.registry.add(this.subsKey,e);return()=>{this.pendingReplays[t]=!1,n()}}async subscribeFor(e,t){if("string"!==typeof e)throw new Error("Please provide the name as a string!");if("function"!==typeof t)throw new Error("Please provide the callback as a function!");return await this.shared.subscribeFor(e,t)}async publish(e,t){if("object"!==typeof e)throw new Error("Please provide the data as an object!");if(t){if("string"!==typeof t)throw new Error("Please provide the name as a string!");return this.shared.isChannel(t)?this.shared.updateData(t,e):Promise.reject(new Error("A channel with name: ".concat(t," doesn't exist!")))}if(!this.currentContext)throw new Error("Not joined to any channel!");return this.shared.updateData(this.currentContext,e)}all(){const e=this.shared.all();return Promise.resolve(e)}async list(){const e=await this.all();return await Promise.all(e.map((e=>this.get(e))))}get(e){return"string"!==typeof e?Promise.reject(new Error("Please provide the channel name as a string!")):this.shared.getContextData(e)}getMy(){return this.currentContext?this.get(this.currentContext):Promise.resolve(void 0)}async join(e,t){return t?fo(e,t):this.joinCore(e)}async joinNoSelectorSwitch(e){return this.joinCore(e,!1)}leave(e){return e?fo(void 0,e):this.leaveCore()}leaveNoSelectorSwitch(){return this.leaveCore(!1)}current(){return this.currentContext}my(){return this.current()}changed(e){if("function"!==typeof e)throw new Error("Please provide the callback as a function!");return this.current()&&setTimeout((()=>{e(this.current())}),0),this.registry.add(this.changedKey,e)}onChanged(e){return this.changed(e)}async add(e){if("object"!==typeof e)throw new Error("Please provide the info as an object!");if("undefined"===typeof e.name)throw new Error("info.name is missing!");if("string"!==typeof e.name)throw new Error("Please provide the info.name as a string!");if("undefined"===typeof e.meta)throw new Error("info.meta is missing!");if("object"!==typeof e.meta)throw new Error("Please provide the info.meta as an object!");if("undefined"===typeof e.meta.color)throw new Error("info.meta.color is missing!");if("string"!==typeof e.meta.color)throw new Error("Please provide the info.meta.color as a string!");const t={name:e.name,meta:e.meta||{},data:e.data||{}};return await this.shared.updateChannel(e.name,t),await mo("addChannel",e.name,e.meta.color),t}async remove(e){if("string"!==typeof e)throw new Error("Please provide the channel name as a string!");await this.shared.remove(e),await mo("removeChannel",e)}async getWindowsOnChannel(e){if("string"!==typeof e)throw new Error("Please provide the channel name as a string!");return(await this.getWindowsWithChannels({channels:[e]})).map((e=>e.window))}async getWindowsWithChannels(e){try{const t=await go(e),n=this.getWindows();if(null===t||void 0===t?void 0:t.windows)return t.windows.map((e=>({window:n.findById(e.windowId),channel:e.channel,application:e.application})))}catch(t){this.logger.error("Error getting all channel enabled windows. This method is available since Glue42 3.12",t)}return[]}handler(e,t,n){t||n?(this.lastUpdate={context:t,updaterId:n},this.pendingReplays={},this.registry.execute(this.subsKey,e,t,n)):this.lastUpdate=void 0}async joinCore(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("string"!==typeof e)throw new Error("Please provide the channel name as a string!");if(!this.isInitialJoin&&e===this.currentContext)return;this.isInitialJoin=!1;const n=e=>this.shared.all().includes(e);if(!n(e)){const t=new Promise(((t,i)=>{const r=setInterval((()=>{n(e)&&(clearTimeout(o),clearInterval(r),t())}),100),o=setTimeout((()=>(clearInterval(r),i(new Error("A channel with name: ".concat(e," doesn't exist!"))))),3e3)}));await t}this.currentContext=e,this.lastUpdate=void 0,await this.shared.switchChannel(e),t&&fo(e),this.registry.execute(this.changedKey,e)}leaveCore(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.currentContext=void 0,this.registry.execute(this.changedKey,void 0),this.shared.leave(),e&&fo(),Promise.resolve()}}function _o(e,t,n,i){const r=new wo(e),o=new bo(r,t,n,i),s=po(t,o);return{subscribe:o.subscribe.bind(o),subscribeFor:o.subscribeFor.bind(o),publish:o.publish.bind(o),all:o.all.bind(o),list:o.list.bind(o),get:o.get.bind(o),join:o.join.bind(o),leave:o.leave.bind(o),current:o.current.bind(o),my:o.my.bind(o),changed:o.changed.bind(o),onChanged:o.onChanged.bind(o),add:o.add.bind(o),remove:o.remove.bind(o),getWindowsOnChannel:o.getWindowsOnChannel.bind(o),getWindowsWithChannels:o.getWindowsWithChannels.bind(o),getMy:o.getMy.bind(o),ready:async()=>{await Promise.all([e.ready(),s])}}}const Io="T42.Hotkeys.Command",Co="T42.Hotkeys.Invoke",So="register",ko="unregister",xo="unregisterAll";class To{constructor(e){this.agm=e,this.registry=ki(),this.firstHotkey=!0,this.hotkeys=new Map}async register(e,t){if("undefined"===typeof e)throw new Error("Hotkey parameter missing");if("string"===typeof e)e={hotkey:e};else{if(!e.hotkey)throw new Error("Info's hotkey parameter missing");e={hotkey:e.hotkey,description:e.description}}const n=this.formatHotkey(e.hotkey);if(this.hotkeys.has(n))throw new Error("Shortcut for ".concat(n," already registered"));this.firstHotkey&&(this.firstHotkey=!1,await this.registerInvokeAGMMethod()),this.registry.add(n,t),await this.agm.invoke(Io,{command:So,hotkey:n,description:e.description}),this.hotkeys.set(n,e)}async unregister(e){if("undefined"===typeof e)throw new Error("hotkey parameter missing");if("string"!==typeof e)throw new Error("hotkey parameter must be string");const t=this.formatHotkey(e);await this.agm.invoke(Io,{command:ko,hotkey:t}),this.hotkeys.delete(t),this.registry.clearKey(t)}async unregisterAll(){await this.agm.invoke(Io,{command:xo}),this.hotkeys.clear(),this.registry.clear()}isRegistered(e){const t=this.formatHotkey(e);return this.hotkeys.has(t)}registerInvokeAGMMethod(){return this.agm.register(Co,(e=>{const t=e.key.toLowerCase(),n=this.hotkeys.get(t);this.registry.execute(t,n)}))}formatHotkey(e){if(e)return e.replace(/\s/g,"").toLowerCase()}}function Ao(e){const t=new To(e);return{register:t.register.bind(t),unregister:t.unregister.bind(t),unregisterAll:t.unregisterAll.bind(t),isRegistered:t.isRegistered.bind(t),ready:()=>Promise.resolve()}}var Eo="6.0.2",Po=e=>{function t(e,t,i){if("boolean"===typeof e&&!e)return;const r=n(e,t,i);return"undefined"!==typeof r?"object"===typeof e?(e.mode=r,e):{mode:r}:void 0}function n(e,t,i){return"object"===typeof e?n(e.mode,t,i).toString():"undefined"===typeof e?"boolean"!==typeof t||t?"boolean"===typeof t&&t?"undefined"===typeof i?t:i:"undefined"===typeof t?void 0:t:void 0:"boolean"===typeof e?e?"undefined"===typeof i?t:i:void 0:e}const i=!0,r="startOnly",o=!jr.isNode()&&"trackMyTypeAndInitiatedFromMe",s="trackMyTypeAndInitiatedFromMe",a="slim",c=a,u="boolean"===typeof e.exposeAPI||"boolean"===typeof e.exposeGlue;return{layouts:t(e.layouts,a,c),activities:t(e.activities,o,s),appManager:t(e.appManager,i,r),windows:t(e.windows,!0,!0),channels:t(e.channels,!1,!0),displays:t(e.displays,!0,!0),exposeAPI:u||!0}};class Mo{constructor(e){this.options=e,this.callbacks=ki(),this.actions=e.actions,this.body=e.body,this.badge=e.badge,this.data=e.data,this.dir=e.dir,this.icon=e.icon,this.image=e.image,this.lang=e.lang,this.renotify=e.renotify,this.requireInteraction=e.requireInteraction,this.silent=e.silent,this.tag=e.tag,this.timestamp=e.timestamp,this.title=e.title}close(){throw new Error("Method not implemented.")}addEventListener(e,t,n){this.callbacks.add(e,t)}removeEventListener(e,t,n){}dispatchEvent(e){return this.callbacks.execute(e.type,e),!0}}class Ro{constructor(e,t){this.interop=e,this.onStreamEvent=t}onVisibilityChanged(e){return this.onStreamEvent("on-panel-visibility-changed",e)}toggle(){return this.interop.invoke("T42.Notifications.Show")}show(){return this.interop.invoke("T42.Notifications.Show",{show:!0})}hide(){return this.interop.invoke("T42.Notifications.Hide")}async isVisible(){return(await this.interop.invoke("T42.Notifications.Execute",{command:"isPanelVisible"})).returned.panelVisible}toAPI(){return{onVisibilityChanged:this.onVisibilityChanged.bind(this),toggle:this.toggle.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),isVisible:this.isVisible.bind(this)}}}const No=0;class Oo{constructor(e,t){this.interop=e,this.logger=t,this.NotificationsSubscribeStream="T42.GNS.Subscribe.Notifications",this.NotificationsCounterStream="T42.Notifications.Counter",this.RaiseNotificationMethodName="T42.GNS.Publish.RaiseNotification",this.NotificationsExecuteMethod="T42.Notifications.Execute",this.methodsRegistered=!1,this.NOTIFICATIONS_CONFIGURE_METHOD_NAME="T42.Notifications.Configure",this.methodNameRoot="T42.Notifications.Handler-"+Er(),this.nextId=0,this.notifications={},this.registry=ki(),this.subscribedForNotifications=!1,this.subscribedCounterStream=!1,this.subscriptionsCountForNotifications=0,this.subscriptionsCountForCounter=0,this._panel=new Ro(e,this.onStreamEventCore.bind(this)),this.subscribeInternalEvents()}get maxActions(){return 2}get panel(){return this._panel.toAPI()}async raise(e){var t,n,i;if(this.validate(e),!this.methodsRegistered){const e=[];for(let t=No;t<this.maxActions;t++)e.push(this.interop.register("".concat(this.methodNameRoot,"_").concat(t),this.handleNotificationEvent.bind(this)));this.methodsRegistered=!0,await Promise.all(e)}const r=String(this.nextId++),o=null!==(t=e.type)&&void 0!==t?t:"Notification",s={title:e.title,type:o,severity:null!==(n=e.severity)&&void 0!==n?n:"None",description:e.body,glueRoutingDetailMethodName:"".concat(this.methodNameRoot,"_").concat(No),actions:[],sourceId:r,source:e.source,publishExtraEvents:!0,clickInterop:e.clickInterop};e.actions&&this.handleActions(e,r,s),this.handleOptions(e,s);const a=new Mo(e);this.notifications[r]=a;try{const e=await this.interop.invoke(this.RaiseNotificationMethodName,{notification:s});a.id=null===(i=e.returned)||void 0===i?void 0:i.id}catch(c){const e=c.message;setTimeout((()=>{this.handleNotificationErrorEvent(a,e)}),1)}return a}async setFilter(e){return(await this.interop.invoke("T42.Notifications.Filter",e)).returned}async getFilter(){return(await this.interop.invoke("T42.Notifications.Filter")).returned}async configure(e){var t,n,i,r;if(!e||Array.isArray(e))throw new Error("Invalid options - should be an object.");if(0===Object.values(e).length)throw new Error("The argument must be a non-empty object.");if("undefined"!==typeof e.enable&&"boolean"!==typeof e.enable)throw new Error("Expected type of enabled - boolean.");if("undefined"!==typeof e.enableToasts&&"boolean"!==typeof e.enableToasts)throw new Error("Expected type of enableToasts - boolean.");if("undefined"!==typeof e.toastExpiry&&"number"!==typeof e.toastExpiry)throw new Error("Expected type of toastExpiry - number.");if(e.sourceFilter&&"object"!==typeof e.sourceFilter)throw new Error("Expected type of sourceFilter - object.");if((null===(t=e.sourceFilter)||void 0===t?void 0:t.allowed)&&!Array.isArray(null===(n=e.sourceFilter)||void 0===n?void 0:n.allowed))throw new Error("Expected type of sourceFilter.allowed - array.");if((null===(i=e.sourceFilter)||void 0===i?void 0:i.blocked)&&!Array.isArray(null===(r=e.sourceFilter)||void 0===r?void 0:r.blocked))throw new Error("Expected type of sourceFilter.blocked - array.");return(await this.interop.invoke(this.NOTIFICATIONS_CONFIGURE_METHOD_NAME,e)).returned}async getConfiguration(){return(await this.interop.invoke(this.NotificationsExecuteMethod,{command:"getConfiguration"})).returned}async list(){return(await this.interop.invoke(this.NotificationsExecuteMethod,{command:"list"})).returned.notifications}onRaised(e){return this.onStreamEventCore("on-notification-raised",e)}onStateChanged(e){return this.onStreamEventCore("on-state-changed",e)}onClosed(e){return this.onStreamEventCore("on-notification-closed",e)}onConfigurationChanged(e){if("function"!==typeof e)throw new Error("Please provide the callback as a function!");this.subscribe();const t=this.registry.add("on-configuration-changed",e);return()=>{t(),this.closeStreamSubscriptionIfNoNeeded()}}onCounterChanged(e){if("function"!==typeof e)throw new Error("Please provide the callback as a function!");this.subscribeForCounterStream();const t=this.registry.add("on-counter-changed",e);return()=>{t(),this.closeStreamCounterSubscriptionIfNoNeeded()}}async clearAll(){await this.interop.invoke(this.NotificationsExecuteMethod,{command:"clearAll"})}async clearOld(){await this.interop.invoke(this.NotificationsExecuteMethod,{command:"clearAllOld"})}async clear(e){if(!e)throw new Error("The 'id' argument cannot be null or undefined");if("string"!==typeof e)throw new Error("The 'id' argument must be a string");await this.interop.invoke(this.NotificationsExecuteMethod,{command:"clear",data:{id:e}})}async click(e,t){await this.interop.invoke(this.NotificationsExecuteMethod,{command:"click",data:{id:e,action:t}})}async setState(e,t){if(!e)throw new Error("The 'id' argument cannot be null or undefined");if("string"!==typeof e)throw new Error("The 'id' argument must be a string");if(!t)throw new Error("The 'state' argument cannot be null or undefined");if("string"!==typeof t)throw new Error("The 'state' argument must be a string");if(!["Active","Acknowledged","Stale"].includes(t))throw new Error("The state argument: ".concat(t," is not valid!"));await this.interop.invoke(this.NotificationsExecuteMethod,{command:"updateState",data:{id:e,state:t}})}toAPI(){return{maxActions:this.maxActions,panel:this._panel.toAPI(),raise:this.raise.bind(this),setFilter:this.setFilter.bind(this),getFilter:this.getFilter.bind(this),configure:this.configure.bind(this),getConfiguration:this.getConfiguration.bind(this),list:this.list.bind(this),onRaised:this.onRaised.bind(this),onStateChanged:this.onStateChanged.bind(this),onClosed:this.onClosed.bind(this),onConfigurationChanged:this.onConfigurationChanged.bind(this),onCounterChanged:this.onCounterChanged.bind(this),clearAll:this.clearAll.bind(this),clearOld:this.clearOld.bind(this),clear:this.clear.bind(this),click:this.click.bind(this),setState:this.setState.bind(this)}}onStreamEventCore(e,t){if("function"!==typeof t)throw new Error("Please provide the callback as a function!");this.subscribe();const n=this.registry.add(e,t);return()=>{n(),this.closeStreamSubscriptionIfNoNeeded()}}handleOptions(e,t){if(e.icon&&(t.attributes=t.attributes||[],t.attributes.push({key:"icon",value:{stringValue:e.icon}})),e.data){t.attributes=t.attributes||[];const n=JSON.stringify(e.data);t.attributes.push({key:"data",value:{stringValue:n}})}"number"===typeof e.panelExpiry&&(t.attributes=t.attributes||[],t.attributes.push({key:"panelExpiry",value:{stringValue:e.panelExpiry.toString()}})),"number"===typeof e.toastExpiry&&(t.attributes=t.attributes||[],t.attributes.push({key:"toastExpiry",value:{stringValue:e.toastExpiry.toString()}}))}handleActions(e,t,n){var i,r,o;const s=e.actions.slice(0,this.maxActions);let a=No;for(const c of s){const e={g42notificationId:t,g42action:c.action,g42interopMethod:null===(i=c.interop)||void 0===i?void 0:i.method,g42interopTarget:null===(r=c.interop)||void 0===r?void 0:r.target,g42interopArguments:JSON.stringify(null===(o=c.interop)||void 0===o?void 0:o.arguments)},s=Object.keys(e).map((t=>({name:t,value:{stringValue:e[t]}}))),u={name:"".concat(this.methodNameRoot,"_").concat(a),description:c.title,displayName:c.title,parameters:s};n.actions.push(u),a++}}validate(e){if(!e)throw new Error("invalid options - should be an object");if("object"!==typeof e)throw new Error("invalid options - should be an object");if(!e.title)throw new Error("invalid options - should have a title");if("string"!==typeof e.title)throw new Error("invalid options - title should be a string");if(e.severity&&"string"!==typeof e.severity)throw new Error("invalid options - severity should be a string");if(e.panelExpiry&&"number"!==typeof e.panelExpiry)throw new Error("invalid options - panelExpiry should be a number");if(e.toastExpiry&&"number"!==typeof e.toastExpiry)throw new Error("invalid options - toastExpiry should be a number")}subscribe(){var e=this;this.subscriptionsCountForNotifications++,this.subscribedForNotifications||(this.subscribedForNotifications=!0,this.logger.info('Attempting to subscribe to "'.concat(this.NotificationsSubscribeStream,'".')),this.interop.subscribe(this.NotificationsSubscribeStream,{arguments:{sendDeltaOnly:!0}}).then((t=>{this.subscriptionForNotifications=t,this.logger.info('Successfully subscribed to "'.concat(this.NotificationsSubscribeStream,'".')),t.onData((e=>{let{data:t}=e;this.handleData(t)})),t.onClosed((function(){e.subscribedForNotifications=!1;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.logger.info("Stream subscription Closed - ".concat(JSON.stringify(n)))})),t.onFailed((function(){e.subscribedForNotifications=!1;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.logger.warn("Stream subscription Failed - ".concat(JSON.stringify(n)))}))})).catch((e=>{this.subscribedForNotifications=!1,this.logger.error('Unable to subscribe to "'.concat(this.NotificationsSubscribeStream,'"'),e)})))}subscribeForCounterStream(){var e=this;this.subscriptionsCountForCounter++,this.subscribedCounterStream||(this.subscribedCounterStream=!0,this.logger.info('Attempting to subscribe to "'.concat(this.NotificationsCounterStream,'".')),this.interop.subscribe(this.NotificationsCounterStream,{arguments:{sendDeltaOnly:!0}}).then((t=>{this.subscriptionForCounter=t,this.logger.info('Successfully subscribed to "'.concat(this.NotificationsCounterStream,'".')),t.onData((e=>{let{data:t}=e;this.registry.execute("on-counter-changed",{count:t.count})})),t.onClosed((function(){e.subscribedCounterStream=!1;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.logger.info("Stream subscription Closed - ".concat(JSON.stringify(n)))})),t.onFailed((function(){e.subscribedCounterStream=!1;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.logger.warn("Stream subscription Failed - ".concat(JSON.stringify(n)))}))})).catch((e=>{this.subscribedCounterStream=!1,this.logger.error('Unable to subscribe to "'.concat(this.NotificationsCounterStream,'"'),e)})))}subscribeInternalEvents(){this.registry.add("on-notification-closed",(e=>{this.handleOnClosed(e)})),this.registry.add("on-notification-raised",(e=>{this.handleOnShow(e.id)}))}handleData(e){var t;try{"items"in e&&Array.isArray(e.items)?this.handleItemsData(e):"deltas"in e&&Array.isArray(e.deltas)&&this.handleDeltas(e),"configuration"in e&&"object"===typeof e.configuration&&(this.logger.info("Received configuration ".concat(JSON.stringify(e.configuration)," from the stream")),this.registry.execute("on-configuration-changed",e.configuration,e.configuration.allApplications)),"command"in e&&"string"===typeof e.command&&(this.logger.info('Received command "'.concat(null!==(t=e.command)&&void 0!==t?t:JSON.stringify(e),'" from the stream')),"showPanel"!==e.command&&"hidePanel"!==e.command||this.registry.execute("on-panel-visibility-changed","showPanel"===e.command))}catch(n){this.logger.error("Failed to parse data from the stream",n)}}handleItemsData(e){const t=e.items;this.logger.info("Received ".concat(t.length," notifications from the stream"));const n=t;if(e.isSnapshot)n.forEach((e=>{this.registry.execute("on-notification-raised",e)}));else{const e=n[0];"Closed"===e.state?this.registry.execute("on-notification-closed",{id:e.id}):"Active"===e.state&&this.registry.execute("on-notification-raised",e)}}handleDeltas(e){e.deltas.forEach((e=>{const t=e.id,n=e.delta;"Closed"===n.state?this.registry.execute("on-notification-closed",{id:t}):this.registry.execute("on-state-changed",{id:t},n.state)}))}handleOnClosed(e){const{notification:t,key:n}=this.getNotification(e);t&&(this.handleEvent(t,"close"),delete this.notifications[n])}handleOnShow(e){const{notification:t}=this.getNotification(e);t&&this.handleEvent(t,"show")}getNotification(e){let t,n;for(const i in this.notifications)if(this.notifications[i].id===e){t=this.notifications[i],n=i;break}return{notification:t,key:n}}handleNotificationEvent(e){const t=this.getGnsNotificationArgs(e);if("unknown"===t.event)return;const n=this.notifications[t.notificationId];n&&this.handleNotificationEventCore(n,t)}handleNotificationEventCore(e,t){switch(t.event){case"action":return this.handleNotificationActionEvent(e,t.notificationActionPayload);case"click":return this.handleNotificationClickEvent(e);case"close":return this.handleEvent(e,"close");case"error":return this.handleNotificationErrorEvent(e,t.error);case"show":return this.handleEvent(e,"show")}}handleNotificationActionEvent(e,t){const n={type:"onaction",action:t.g42action};e.onaction&&e.onaction(n),e.dispatchEvent(n)}handleNotificationClickEvent(e){const t={type:"onclick"};e.onclick&&e.onclick(t),e.dispatchEvent(t)}handleEvent(e,t){var n;const i={type:t};null===(n=e["on".concat(t)])||void 0===n||n.call(e,i),e.dispatchEvent(i)}handleNotificationErrorEvent(e,t){const n={type:"onerror",error:t};e.onerror&&e.onerror(n),e.dispatchEvent(n)}getGnsNotificationArgs(e){var t;let n;const i=null===(t=e.notification)||void 0===t?void 0:t.event;return n=i?{event:i,notificationId:e.notification.sourceNotificationId,notificationActionPayload:e}:this.getBackwardGnsNotificationArgs(e),n}getBackwardGnsNotificationArgs(e){var t;let n;return n=e.g42notificationId?{event:"action",notificationId:e.g42notificationId,notificationActionPayload:e}:(null===(t=e.notification)||void 0===t?void 0:t.sourceNotificationId)?{event:"click",notificationId:e.notification.sourceNotificationId,notificationActionPayload:e}:{event:"unknown",notificationId:void 0,notificationActionPayload:e},n}closeStreamSubscriptionIfNoNeeded(){this.subscriptionsCountForNotifications--,this.subscriptionForNotifications&&0===this.subscriptionsCountForNotifications&&(this.subscriptionForNotifications.close(),this.subscriptionForNotifications=void 0)}closeStreamCounterSubscriptionIfNoNeeded(){this.subscriptionsCountForCounter--,this.subscriptionForCounter&&0===this.subscriptionsCountForCounter&&(this.subscriptionForCounter.close(),this.subscriptionForCounter=void 0)}}const jo="T42.Themes.Configuration";class Do{constructor(e,t){this.contexts=e,this.interop=t,this.registry=ki(),this.isSubscribed=!1,this.getConfiguration()}async list(){if(await this.getConfiguration(),!this.getMethodName)throw new Error("not supported");return(await this.getAll()).returned.all}async getCurrent(){if(await this.getConfiguration(),!this.getMethodName)throw new Error("not supported");const e=await this.getAll();return e.returned.all.find((t=>t.name===e.returned.selected))}async select(e){if(await this.getConfiguration(),!this.setMethodName)throw new Error("not supported");await this.interop.invoke(this.setMethodName,{theme:e})}onChanged(e){return this.subscribe(),this.registry.add("changed",e)}async getConfiguration(){try{if(this.sharedContextName)return;const e=await this.interop.invoke(jo);this.sharedContextName=e.returned.sharedContextName,this.getMethodName=e.returned.getThemesMethodName,this.setMethodName=e.returned.setThemesMethodName}catch(e){return}}async getAll(){return await this.getConfiguration(),await this.interop.invoke(this.getMethodName)}async subscribe(){await this.getConfiguration(),this.isSubscribed||(this.isSubscribed=!0,this.contexts.subscribe(this.sharedContextName,(e=>{e&&e.all&&e.selected&&this.registry.execute("changed",e.all.find((t=>t.name===e.selected)))})))}}function Fo(e,t){const n=new Do(e,t);return{list:n.list.bind(n),getCurrent:n.getCurrent.bind(n),select:n.select.bind(n),onChanged:n.onChanged.bind(n),ready:()=>Promise.resolve()}}const Wo="Tick42.FDC3.Intents.",Lo="T42.Intents.Resolver.Control",Uo=400,qo=440,Bo=6e4,Go=["applicationName","type"],Ho="intentsResolver",zo=2147483647,Vo=6e4,Jo=9e4,Ko=(e,t,n)=>new Promise(((i,r)=>{const o=setTimeout((()=>{const e=n||"Promise timeout hit: ".concat(t);r(e)}),t);new Promise(e).then((e=>{clearTimeout(o),i(e)})).catch((e=>{clearTimeout(o),r(e)}))})),$o=(e,t,n)=>new Promise(((i,r)=>{let o=!0;const s=setTimeout((()=>{if(!o)return;o=!1;const e=n||"Promise timeout hit: ".concat(t);r(e)}),t);e().then((e=>{o&&(o=!1,clearTimeout(s),i(e))})).catch((e=>{o&&(o=!1,clearTimeout(s),r(e))}))}));class Qo{constructor(e,t,n,i,r){this.interop=e,this.windows=t,this.logger=n,this.appManager=r,this.myIntents=new Set,this.intentsResolverResponsePromises={},this.useIntentsResolverUI=!0,this.unregisterIntentPromises=[],this.checkIfIntentsResolverIsEnabled(i,r)}async find(e){await Promise.all(this.unregisterIntentPromises);let t=await this.all();if("undefined"===typeof e)return t;if("string"===typeof e)return t.filter((t=>t.name===e));if("object"!==typeof e)throw new Error("Please provide the intentFilter as a string or an object!");if(e.contextType){const n=e.contextType.toLowerCase();t=t.filter((e=>e.handlers.some((e=>{var t;return null===(t=e.contextTypes)||void 0===t?void 0:t.some((e=>e.toLowerCase()===n))}))))}if(e.resultType){const n=e.resultType.toLowerCase();t=t.filter((e=>e.handlers.some((e=>{var t;return(null===(t=e.resultType)||void 0===t?void 0:t.toLowerCase())===n}))))}return e.name&&(t=t.filter((t=>t.name===e.name))),t}async raise(e){if("string"!==typeof e&&"object"!==typeof e||"object"===typeof e&&"string"!==typeof e.intent)throw new Error("Please provide the intent as a string or an object with an intent property!");"string"===typeof e&&(e={intent:e}),this.validateIntentRequest(e),await Promise.all(this.unregisterIntentPromises);const t=e.timeout||Jo,n={},i=this.coreRaiseIntent.bind(this,{request:e,resolverInstance:n,timeout:t});if(e.waitUserResponseIndefinitely)return i();const r=$o(i,t,"Timeout of ".concat(t,"ms hit for intent request ").concat(JSON.stringify(e)));return r.catch((()=>this.handleRaiseOnError(n.instanceId))),r}async all(){let e;await Promise.all(this.unregisterIntentPromises);try{const t=await this.interop.invoke("T42.ACS.GetApplications",{withIntentsInfo:!0});e=t.returned.applications}catch(a){return this.logger.error("Failed to get the applications!",a),[]}const t={},n=e.filter((e=>e.intents&&e.intents.length>0));for(const c of n)for(const e of c.intents){let n=t[e.name];n||(n={name:e.name,handlers:[]},t[e.name]=n);const i={applicationName:c.name,applicationTitle:c.title||"",applicationDescription:c.caption,displayName:e.displayName,contextTypes:e.contexts,applicationIcon:c.icon,type:"app",resultType:e.resultType};n.handlers.push(i)}const i=this.interop.servers(),r=i.map((e=>e.windowId)).filter((e=>"undefined"!==typeof e)),o="T42.Wnd.GetInfo";let s;if(this.interop.methods().some((e=>e.name===o)))try{const e=await this.interop.invoke(o,{ids:r});s=e.returned.windows}catch(a){}for(const c of i)await Promise.all(c.getMethods().filter((e=>e.name.startsWith(Wo))).map((async n=>{const i=n.name.replace(Wo,"");let r=t[i];r||(r={name:i,handlers:[]},t[i]=r);const o=n.flags.intent,a=e.find((e=>e.name===c.application));let u;a&&a.intents&&(u=a.intents.find((e=>e.name===i)));const d=await this.windowsIdToTitle(c.windowId,s),l={instanceId:c.instance,applicationName:c.application,applicationIcon:o.icon||(null===a||void 0===a?void 0:a.icon),applicationTitle:(null===a||void 0===a?void 0:a.title)||"",applicationDescription:o.description||(null===a||void 0===a?void 0:a.caption),displayName:o.displayName||(null===u||void 0===u?void 0:u.displayName),contextTypes:o.contextTypes||(null===u||void 0===u?void 0:u.contexts),instanceTitle:d,type:"instance",resultType:(null===u||void 0===u?void 0:u.resultType)||o.resultType};r.handlers.push(l)})));return Object.values(t)}addIntentListener(e,t){if("string"!==typeof e&&"object"!==typeof e||"object"===typeof e&&"string"!==typeof e.intent)throw new Error("Please provide the intent as a string or an object with an intent property!");if("function"!==typeof t)throw new Error("Please provide the handler as a function!");const n="string"===typeof e?e:e.intent,i="".concat(Wo).concat(n);let r,o={};if(this.myIntents.has(n))throw new Error("Intent listener for intent ".concat(n," already registered!"));this.myIntents.add(n);const s={unsubscribe:()=>{this.myIntents.delete(n),r.then((()=>this.interop.unregister(i))).catch((e=>this.logger.trace("Unregistration of a method with name ".concat(i," failed with reason: ").concat(JSON.stringify(e)))))}};if("object"===typeof e){const{intent:t,...n}=e;o=n}return r=this.interop.register({name:i,flags:{intent:o}},(e=>{if(this.myIntents.has(n))return t(e)})),r.catch((e=>{this.myIntents.delete(n),this.logger.warn("Registration of a method with name ".concat(i," failed with reason: ").concat(JSON.stringify(e)))})),s}async register(e,t){if("string"!==typeof e&&"object"!==typeof e||"object"===typeof e&&"string"!==typeof e.intent)throw new Error("Please provide the intent as a string or an object with an intent property!");if("function"!==typeof t)throw new Error("Please provide the handler as a function!");await Promise.all(this.unregisterIntentPromises);const n="string"===typeof e?e:e.intent,i=this.buildInteropMethodName(n);let r={};if(this.myIntents.has(n))throw new Error("Intent listener for intent ".concat(n," already registered!"));if(this.myIntents.add(n),"object"===typeof e){const{intent:t,...n}=e;r=n}try{await this.interop.register({name:i,flags:{intent:r}},(e=>{if(this.myIntents.has(n))return t(e)}))}catch(o){throw this.myIntents.delete(n),new Error("Registration of a method with name ".concat(i," failed with reason: ").concat(JSON.stringify(o)))}return{unsubscribe:()=>this.unsubscribeIntent(n)}}async coreRaiseIntent(e){let{request:t,resolverInstance:n,timeout:i}=e;var r,o;const s=await this.get(t.intent);if("undefined"===typeof s)throw new Error("Intent ".concat(t.intent," not found."));const{open:a,reason:c}=this.checkIfResolverShouldBeOpened(s,t);if(!a)return this.logger.trace("Intent Resolver UI won't be used. Reason: ".concat(c)),t.waitUserResponseIndefinitely?$o((()=>this.raiseIntent(t,i)),i,"Timeout of ".concat(i,"ms hit for raise to resolve")):this.raiseIntent(t,i);const u=await this.startResolverApp(t,n);if(null===(r=this.logger)||void 0===r||r.trace("Raising intent to target handler: ".concat(JSON.stringify(u)," with timeout of ").concat(i)),t.waitUserResponseIndefinitely)return $o((()=>this.raiseIntentToTargetHandler(t,u,i)),i,"Timeout of ".concat(i,"ms hit for raise to resolve"));const d=await this.raiseIntentToTargetHandler(t,u,i);return null===(o=this.logger)||void 0===o||o.trace("Result from raise() method for intent ".concat(JSON.stringify(t.intent),": ").concat(JSON.stringify(d))),d}async get(e){return(await this.all()).find((t=>t.name===e))}async raiseIntent(e,t){const n=e.intent,i=await this.get(n);if("undefined"===typeof i)throw new Error("Intent ".concat(n," not found."));const r=e.handlers?this.findHandlerByFilter(e.handlers,{type:"app"}):this.findHandlerByFilter(i.handlers,{type:"app"}),o=e.handlers?this.findHandlerByFilter(e.handlers,{type:"instance"}):this.findHandlerByFilter(i.handlers,{type:"instance"});let s;if(e.target&&"reuse"!==e.target||(s=o||r),"startNew"===e.target&&(s=r),"object"===typeof e.target&&e.target.app&&(s=this.findHandlerByFilter(i.handlers,{app:e.target.app})),"object"===typeof e.target&&e.target.instance&&(s=this.findHandlerByFilter(i.handlers,{instance:e.target.instance,app:e.target.app})),!s)throw new Error("Can not raise intent for request ".concat(JSON.stringify(e)," - can not find intent handler!"));return await this.raiseIntentToTargetHandler(e,s,t)}async raiseIntentToTargetHandler(e,t,n){var i,r;null===(i=this.logger)||void 0===i||i.trace("Raising intent to target handler:".concat(JSON.stringify(t))),t.instanceId||(t.instanceId=await this.invokeStartApp(t.applicationName,e.context,e.options));const o="".concat(Wo).concat(e.intent),s={methodResponseTimeoutMs:n?n+1e3:Vo,waitTimeoutMs:n?n+1e3:Vo},a=await this.interop.invoke(o,e.context,{instance:t.instanceId},s);return null===(r=this.logger)||void 0===r||r.trace("raiseIntent command completed. Returning result: ".concat(JSON.stringify(a))),{request:e,handler:{...t,type:"instance"},result:a.returned}}async startResolverApp(e,t){var n,i,r,o;null===(n=this.logger)||void 0===n||n.trace("Intents Resolver UI with app name ".concat(this.intentsResolverAppName," will be used"));const s=await this.registerIntentResolverMethod();null===(i=this.logger)||void 0===i||i.trace("Registered interop method ".concat(s));const a=this.buildStartContext(e,s),c=await this.buildStartOptions();null===(r=this.logger)||void 0===r||r.trace("Starting Intents Resolver UI with context: ".concat(JSON.stringify(a)," and options: ").concat(JSON.stringify(c)));const u=await this.appManager.application(this.intentsResolverAppName).start(a,c);return t&&(t.instanceId=u.id),null===(o=this.logger)||void 0===o||o.trace("Intents Resolver instance with id ".concat(u.id," opened")),this.subscribeOnInstanceStopped(u),this.createResponsePromise(e,u.id,s),await this.handleInstanceResponse(u.id)}async windowsIdToTitle(e,t){var n,i;if("undefined"!==typeof t)return null===(n=t.find((t=>t.id===e)))||void 0===n?void 0:n.title;const r=null===(i=this.windows)||void 0===i?void 0:i.findById(e);return await(null===r||void 0===r?void 0:r.getTitle())}async handleInstanceResponse(e){var t;try{const{handler:n,intent:i}=await this.intentsResolverResponsePromises[e].promise;return null===(t=this.logger)||void 0===t||t.trace("Intent handler chosen for intent ".concat(i,": ").concat(JSON.stringify(n))),this.stopResolverInstance(e),n}catch(n){throw this.stopResolverInstance(e),new Error(n)}}async registerIntentResolverMethod(){const e=Lo+Er();return await this.interop.register(e,this.resolverResponseHandler.bind(this)),e}resolverResponseHandler(e,t){const{instance:n}=t,i=this.validateIntentsResolverResponse(e);i||(this.logger.trace("Intent Resolver sent invalid response. Error: ".concat(i.error)),this.intentsResolverResponsePromises[n].reject(i.error),this.stopResolverInstance(n));const r=i.ok;this.intentsResolverResponsePromises[n].resolve(r),this.cleanUpIntentResolverPromise(n)}buildStartContext(e,t){return{intent:e,callerId:this.interop.instance.instance,methodName:t}}async buildStartOptions(){const e=this.windows.my();if(!e)return;const t=await e.getBounds();return{top:(t.height-qo)/2+t.top,left:(t.width-Uo)/2+t.left}}createResponsePromise(e,t,n){let i,r;const o=e.waitUserResponseIndefinitely?zo:this.intentsResolverResponseTimeout,s=Ko(((e,t)=>{i=e,r=t}),o,"Timeout of ".concat(o,"ms hit waiting for the user to choose a handler for intent ").concat(e.intent));this.intentsResolverResponsePromises[t]={intent:e.intent,resolve:i,reject:r,promise:s,methodName:n}}async invokeStartApp(e,t,n){return(await this.interop.invoke("T42.ACS.StartApplication",{Name:e,options:n})).returned.Id}subscribeOnInstanceStopped(e){const t=e.onStopped((e=>{const n=this.intentsResolverResponsePromises[e.id];if(!n)return t();n.reject("Cannot resolve raise intent ".concat(n.intent," - User closed ").concat(this.intentsResolverAppName," app without choosing an intent handler")),this.cleanUpIntentResolverPromise(e.id),t()}))}async cleanUpIntentResolverPromise(e){const t=this.intentsResolverResponsePromises[e];t&&(this.interop.unregister(t.methodName).catch((e=>this.logger.warn(e))),delete this.intentsResolverResponsePromises[e])}validateIntentsResolverResponse(e){if(Object.keys(e).some((e=>"intent"!==e&&"handler"!==e)))return{isValid:!1,error:"Response is not a valid object. Expected { intent: string, handler: IntentHandler }"};if("string"!==typeof e.intent)return{isValid:!1,error:"Response object has invalid 'intent' key. Expected a string, got ".concat(typeof e.intent)};if("object"!==typeof e.handler)return{isValid:!1,error:"Response object has invalid 'handler' key. Expected an object, got ".concat(typeof e.handler)};const t=Go.filter((t=>!(t in e.handler)));return t.length?{isValid:!1,error:"Handler in Response object does not provide compulsory keys: ".concat(t.join(", "))}:{isValid:!0,ok:{intent:e.intent,handler:{...e.handler}}}}handleRaiseOnError(e){e&&this.stopResolverInstance(e)}stopResolverInstance(e){const t=this.windows.findById(e);null===t||void 0===t||t.close().catch((e=>this.logger.error(e)))}checkIfIntentsResolverIsEnabled(e,t){var n,i,r,o,s;t?(this.useIntentsResolverUI="boolean"!==typeof(null===(n=e.intents)||void 0===n?void 0:n.enableIntentsResolverUI)||e.intents.enableIntentsResolverUI,this.intentsResolverAppName=null!==(r=null===(i=e.intents)||void 0===i?void 0:i.intentsResolverAppName)&&void 0!==r?r:Ho,this.intentsResolverResponseTimeout=null!==(s=null===(o=e.intents)||void 0===o?void 0:o.methodResponseTimeoutMs)&&void 0!==s?s:Bo):this.useIntentsResolverUI=!1}checkIfResolverShouldBeOpened(e,t){return this.useIntentsResolverUI?this.appManager.application(this.intentsResolverAppName)?this.checkIfIntentHasMoreThanOneHandler(e,t)?{open:!0}:{open:!1,reason:"Raised intent ".concat(e.name," has only one handler")}:{open:!1,reason:"Intent Resolver Application with name ".concat(this.intentsResolverAppName," not found.")}:{open:!1,reason:"Intent Resolver is disabled. Raising intent to first found handler"}}checkIfIntentHasMoreThanOneHandler(e,t){return t.target?"reuse"===t.target?t.handlers?t.handlers.filter((e=>"instance"===e.type&&e.instanceId)).length>1||t.handlers.filter((e=>"app"===e.type)).length>1:e.handlers.filter((e=>"instance"===e.type&&e.instanceId)).length>1||e.handlers.filter((e=>"app"===e.type)).length>1:"startNew"===t.target?t.handlers?t.handlers.filter((e=>"app"===e.type)).length>1:e.handlers.filter((e=>"app"===e.type)).length>1:(t.target,!1):t.handlers?t.handlers.length>1:e.handlers.length>1}buildInteropMethodName(e){return"".concat(Wo).concat(e)}clearUnregistrationPromise(e){this.unregisterIntentPromises=this.unregisterIntentPromises.filter((t=>t!==e))}unsubscribeIntent(e){this.myIntents.delete(e);const t=this.buildInteropMethodName(e),n=this.interop.unregister(t);this.unregisterIntentPromises.push(n),n.then((()=>{this.clearUnregistrationPromise(n)})).catch((e=>{this.logger.error("Unregistration of a method with name ".concat(t," failed with reason: "),e),this.clearUnregistrationPromise(n)}))}validateIntentRequest(e){this.validateIntentRequestContext(e.context),this.validateIntentRequestTarget(e.target),this.validateIntentRequestTimeout(e.timeout),this.validateWaitUserResponseIndefinitely(e.waitUserResponseIndefinitely),e.handlers&&e.handlers.forEach((e=>this.validateIntentRequestHandler(e)))}validateIntentRequestTarget(e){if(e&&"string"!==typeof e&&"object"!==typeof e)throw new Error('Please provide the intent target as one of the valid values: "reuse", "startNew", { app: string }, { instance: string } ')}validateIntentRequestContext(e){if(e){if("object"!==typeof e)throw new Error("Please provide the intent context as an object");if(e.type&&"string"!==typeof e.type)throw new Error("Please provide the intent context as an object with 'type' property as string");if(e.data&&"object"!==typeof e.data)throw new Error("Please provide the intent context as an object with 'data' property as object")}}validateIntentRequestHandler(e){if(!e.applicationName)throw new Error("Please provide applicationName for handler ".concat(JSON.stringify(e)));if(!e.type)throw new Error("Please provide type for handler ".concat(JSON.stringify(e)));if("instance"===e.type&&!e.instanceId)throw new Error("Please provide instanceId for handler ".concat(JSON.stringify(e)))}validateIntentRequestTimeout(e){if(e){if("number"!==typeof e)throw new Error("Please provide the timeout as a number");if(e<=0)throw new Error("Please provide the timeout as a positive number")}}validateWaitUserResponseIndefinitely(e){if(e&&"boolean"!==typeof e)throw new Error("Please provide waitUserResponseIndefinitely as a boolean")}findHandlerByFilter(e,t){return t.type?e.find((e=>e.type===t.type)):t.instance?e.find((e=>t.app?e.applicationName===t.app&&e.instanceId===t.instance:e.instanceId===t.instance)):t.app?e.find((e=>e.applicationName===t.app)):void 0}}class Yo{constructor(){this.initialized=!1,this.details=[],this.reject=()=>{},this.resolve=()=>{}}init(e){this.initialized=!0,this.addCall(e),this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}addCall(e){this.details.push({date:new Date,config:e})}done(e){this.resolve(e)}error(e){this.reject(e)}}class Xo{constructor(e,t){this.appName=e,this.interop=t,this.registry=ki(),this.interopMethodRegistered=!1}async get(e){return(await this.interop.invoke("T42.Prefs.Get",{app:null!==e&&void 0!==e?e:this.appName})).returned}async set(e,t){var n;this.verifyDataObject(e),await this.interop.invoke("T42.Prefs.Set",{app:null!==(n=null===t||void 0===t?void 0:t.app)&&void 0!==n?n:this.appName,data:e,merge:!1})}async setFor(e,t){return this.verifyApp(e),this.verifyDataObject(t),this.set(t,{app:e})}async update(e,t){var n;this.verifyDataObject(e),await this.interop.invoke("T42.Prefs.Set",{app:null!==(n=null===t||void 0===t?void 0:t.app)&&void 0!==n?n:this.appName,data:e,merge:!0})}async updateFor(e,t){return this.verifyApp(e),this.verifyDataObject(t),this.update(t,{app:e})}async clear(e){await this.interop.invoke("T42.Prefs.Set",{app:null!==e&&void 0!==e?e:this.appName,clear:!0})}async clearFor(e){this.verifyApp(e),await this.interop.invoke("T42.Prefs.Set",{app:e,clear:!0})}async getAll(){return(await this.interop.invoke("T42.Prefs.Get")).returned}async clearAll(){await this.interop.invoke("T42.Prefs.Set",{clear:!0})}subscribe(e){return this.verifyCallback(e),this.subscribeFor(this.appName,e)}subscribeFor(e,t){this.verifyApp(e),this.verifyCallback(t);const n=this.registry.add(e,t);return this.registerInteropIfNeeded().then((()=>{this.interop.invoke("T42.Prefs.Get",{app:e,subscribe:!0})})),()=>{n()}}async registerInteropIfNeeded(){this.interopMethodRegistered||(this.interopMethodRegistered=!0,await this.interop.register("T42.Prefs.Update",(e=>{this.registry.execute(e.app,e)})))}verifyApp(e){if(!e)throw new Error("app should be defined");if(!Yt(e))throw new Error("app should be a string")}verifyDataObject(e){if(!e)throw new Error("data should be defined");if(!Xt(e))throw new Error("data should be an object")}verifyCallback(e){if(!on(e))throw new Error("callback should be defined")}}class Zo{constructor(e,t){this.methodName=e,this.interop=t}async get(e){return(await this.invoke("get-cookies",{filter:e})).returned.cookies}async set(e){this.verifyCookieObject(e),await this.invoke("set-cookie",e)}async remove(e,t){if(!Yt(e))throw new Error("url should be a string");if(!Yt(t))throw new Error("name should be a string");await this.invoke("remove-cookie",{url:e,name:t})}invoke(e,t){return this.interop.invoke(this.methodName,{command:e,args:t})}verifyCookieObject(e){if(!e)throw new Error("cookie should be defined");if(!Xt(e))throw new Error("cookie should be an object")}}function es(e,t){const n=new Zo(t,e);return{get:n.get.bind(n),remove:n.remove.bind(n),set:n.set.bind(n),ready:()=>Promise.resolve()}}class ts{constructor(e){this.config=e,this.glue42EventName="Glue42",this.events={notifyStarted:{name:"notifyStarted",handle:this.handleNotifyStarted.bind(this)},requestGlue:{name:"requestGlue",handle:this.handleRequestGlue.bind(this)}}}start(e){jr.isNode()||(this.glue=e,this.wireCustomEventListener(),this.announceStarted())}wireCustomEventListener(){window.addEventListener(this.glue42EventName,(e=>{const t=e.detail;if(!t||!t.glue42)return;const n=t.glue42.event,i=this.events[n];i&&i.handle(t.glue42.message)}))}announceStarted(){this.send("start")}handleRequestGlue(){this.config.exposeAPI?this.send("requestGlueResponse",{glue:this.glue}):this.send("requestGlueResponse",{error:"Will not give access to the underlying Glue API, because it was explicitly denied upon initialization."})}handleNotifyStarted(){this.announceStarted()}send(e,t){const n={glue42:{event:e,message:t}},i=new CustomEvent(this.glue42EventName,{detail:n});window.dispatchEvent(i)}}const ns=new Yo,is=async e=>{let t=!1;ns.initialized||(t=!0,ns.init(e));const n="undefined"!==typeof window&&window.glue42gd;if(n&&!t)return ns.addCall(e),ns.promise;const i=await rs(e,n);return ns.resolve(i),i},rs=async(e,t)=>{const n="T42.GD.Execute",i=jr.getGDMajorVersion(),r=Po(e=e||{});let o,s,a,c,u;e.gateway=e.gateway||{};const d=new ts(r);function l(e){if(r.windows){const t=C("windows",e.logger,r.windows);return a=Kr(e.agm,t,(()=>o),(()=>c),(()=>u),i),x(a),a}}function h(e){var n;if(r.activities&&ai.checkIsUsingGW3Implementation&&ai.checkIsUsingGW3Implementation(e.connection)){const c=C("activity",e.logger,r.activities);return s=new ai({connection:e.connection,contexts:e.contexts,agm:e.agm,logger:c,logLevel:"info",disableAutoAnnounce:!1,disposeRequestHandling:"exit",announcementInfo:null,windows:a,appManagerGetter:()=>o,mode:r.activities.mode,typesToTrack:r.activities.typesToTrack,activityId:null===(n=null===t||void 0===t?void 0:t.activityInfo)||void 0===n?void 0:n.activityId,gdMajorVersion:i}).api,x(s),s}}function p(e){if(!r.appManager)return;const t=C("appManager",e.logger,r.appManager);return o=$i({agm:e.agm,windows:a,logger:t,activities:s,mode:r.appManager.mode,gdMajorVersion:i}),x(o),o}function f(e){var t;if(!r.layouts)return;const n=C("layouts",e.logger,r.layouts),a=r.layouts,c=ro({agm:e.agm,appManager:o,activityGetter:()=>s,logger:n,mode:a.mode,autoSaveWindowContext:null!==(t=a.autoSaveWindowContext)&&void 0!==t&&t,gdMajorVersion:i});return x(c),c}function g(e){if(!r.channels)return;if(!e.contexts)return;const t=C("channels",e.logger,r.channels);return u=_o(e.contexts,e.agm,(()=>a),t),x(u),u}function m(e){const t=Ao(e.agm);return x(t),t}function v(t){const n=new Qo(t.agm,a,t.logger.subLogger("intents"),e,o);return x(n),n}function y(e){const t=new Oo(e.interop,e.logger).toAPI();return x(t),t}function w(e){if(r.displays){const t=C("displays",e.logger,r.displays);return c=new ao(e.agm,t),x(c),c}}function b(e){if(!e.contexts)return;const t=Fo(e.contexts,e.interop);return x(t),t}function _(n){var i,r;const o=null!==(r=null!==(i=e.application)&&void 0!==i?i:null===t||void 0===t?void 0:t.application)&&void 0!==r?r:n.interop.instance.application,s=new Xo(o,n.interop);return x(s),s}function I(e){const t=es(e.interop,n);return x(t),t}function C(e,t,n){const i=t.subLogger(e);if(n&&n.logger){const e=n.logger;e.console&&i.consoleLevel(e.console),e.publish&&i.publishLevel(e.publish)}return i}const S={libs:[{name:"windows",create:l},{name:"activities",create:h},{name:"appManager",create:p},{name:"layouts",create:f},{name:"channels",create:g},{name:"hotkeys",create:m},{name:"displays",create:w},{name:"intents",create:v},{name:"notifications",create:y},{name:"themes",create:b},{name:"prefs",create:_},{name:"cookies",create:I}],version:Eo,enrichGlue:e=>{e.config.activities=r.activities,e.config.windows=r.windows,e.config.appManager=r.appManager,e.config.layouts=r.layouts,e.config.channels=r.channels,e.config.displays=r.displays}},k=[];function x(e){k.push(e)}"undefined"!==typeof window&&(window.glueFactoryLog||(window.glueFactoryLog=[]),window.glueFactoryLog.push(k));const T=await Kt(e,S);return Array.isArray(null===e||void 0===e?void 0:e.libraries)&&e.libraries.length&&await Promise.all(e.libraries.map((t=>t(T,e)))),d.start(T),T};var os,ss;is.coreVersion=Kt.version,is.version=Eo,is.calls=ns;let as=is,cs=!0;if("undefined"!==typeof window){const e=window,t=null!==(os=e.iodesktop)&&void 0!==os?os:e.glue42gd;t&&t.autoInjected&&(as=null!==(ss=e.IODesktop)&&void 0!==ss?ss:e.Glue,cs=!1),cs&&(e.Glue=as,e.IODesktop=as),delete e.IOBrowser,delete e.GlueCore}return as.default=as,as}()},888:(e,t,n)=>{"use strict";var i=n(47);function r(){}function o(){}o.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,o,s){if(s!==i){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:r};return n.PropTypes=n,n}},7:(e,t,n)=>{e.exports=n(888)()},47:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},463:(e,t,n)=>{"use strict";var i=n(791),r=n(296);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),l=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function g(e,t,n,i,r,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function w(e,t,n,i){var r=m.hasOwnProperty(t)?m[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!l.call(f,e)||!l.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=Symbol.for("react.element"),I=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),x=Symbol.for("react.provider"),T=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var N=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function j(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var D,F=Object.assign;function W(e){if(void 0===D)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);D=t&&t[1]||""}return"\n"+D+e}var L=!1;function U(e,t){if(!e||L)return"";L=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var i=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){i=u}e.call(t.prototype)}else{try{throw Error()}catch(u){i=u}e()}}catch(u){if(u&&i&&"string"===typeof u.stack){for(var r=u.stack.split("\n"),o=i.stack.split("\n"),s=r.length-1,a=o.length-1;1<=s&&0<=a&&r[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(r[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||r[s]!==o[a]){var c="\n"+r[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=s&&0<=a);break}}}finally{L=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?W(e):""}function q(e){switch(e.tag){case 5:return W(e.type);case 16:return W("Lazy");case 13:return W("Suspense");case 19:return W("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function B(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case C:return"Fragment";case I:return"Portal";case k:return"Profiler";case S:return"StrictMode";case E:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case x:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case M:return null!==(t=e.displayName||null)?t:B(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return B(e(t))}catch(n){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return B(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function z(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function V(e){e._valueTracker||(e._valueTracker=function(e){var t=z(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=z(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&w(e,"checked",t,!1)}function X(e,t){Y(e,t);var n=H(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function oe(e,t){var n=H(t.value),i=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,de,le=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return de(e,t)}))}:de);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=ge(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ve=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function we(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function _e(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ie=null,Ce=null,Se=null;function ke(e){if(e=wr(e)){if("function"!==typeof Ie)throw Error(o(280));var t=e.stateNode;t&&(t=_r(t),Ie(e.stateNode,e.type,t))}}function xe(e){Ce?Se?Se.push(e):Se=[e]:Ce=e}function Te(){if(Ce){var e=Ce,t=Se;if(Se=Ce=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function Ae(e,t){return e(t)}function Ee(){}var Pe=!1;function Me(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return Ae(e,t,n)}finally{Pe=!1,(null!==Ce||null!==Se)&&(Ee(),Te())}}function Re(e,t){var n=e.stateNode;if(null===n)return null;var i=_r(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Ne=!1;if(d)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){Ne=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(de){Ne=!1}function je(e,t,n,i,r,o,s,a,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(d){this.onError(d)}}var De=!1,Fe=null,We=!1,Le=null,Ue={onError:function(e){De=!0,Fe=e}};function qe(e,t,n,i,r,o,s,a,c){De=!1,Fe=null,je.apply(Ue,arguments)}function Be(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Be(e)!==e)throw Error(o(188))}function ze(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Be(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(i=r.return)){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return He(r),e;if(s===i)return He(r),t;s=s.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=s;else{for(var a=!1,c=r.child;c;){if(c===n){a=!0,n=r,i=s;break}if(c===i){a=!0,i=r,n=s;break}c=c.sibling}if(!a){for(c=s.child;c;){if(c===n){a=!0,n=s,i=r;break}if(c===i){a=!0,i=s,n=r;break}c=c.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?Ve(e):null}function Ve(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ve(e);if(null!==t)return t;e=e.sibling}return null}var Je=r.unstable_scheduleCallback,Ke=r.unstable_cancelCallback,$e=r.unstable_shouldYield,Qe=r.unstable_requestPaint,Ye=r.unstable_now,Xe=r.unstable_getCurrentPriorityLevel,Ze=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,ot=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/ct|0)|0},at=Math.log,ct=Math.LN2;var ut=64,dt=4194304;function lt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~r;0!==a?i=lt(a):0!==(o&=s)&&(i=lt(o))}else 0!==(s=n&~r)?i=lt(s):0!==o&&(i=lt(o));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&0!==(4194240&o)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-st(t)),i|=e[n],t&=~r;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ut;return 0===(4194240&(ut<<=1))&&(ut=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-st(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var wt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var _t,It,Ct,St,kt,xt=!1,Tt=[],At=null,Et=null,Pt=null,Mt=new Map,Rt=new Map,Nt=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function jt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":Et=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":Mt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function Dt(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=wr(t))&&It(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ft(e){var t=yr(e.target);if(null!==t){var n=Be(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void kt(e.priority,(function(){Ct(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Wt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=$t(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=wr(n))&&It(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);be=i,n.target.dispatchEvent(i),be=null,t.shift()}return!0}function Lt(e,t,n){Wt(e)&&n.delete(t)}function Ut(){xt=!1,null!==At&&Wt(At)&&(At=null),null!==Et&&Wt(Et)&&(Et=null),null!==Pt&&Wt(Pt)&&(Pt=null),Mt.forEach(Lt),Rt.forEach(Lt)}function qt(e,t){e.blockedOn===t&&(e.blockedOn=null,xt||(xt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ut)))}function Bt(e){function t(t){return qt(t,e)}if(0<Tt.length){qt(Tt[0],e);for(var n=1;n<Tt.length;n++){var i=Tt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==At&&qt(At,e),null!==Et&&qt(Et,e),null!==Pt&&qt(Pt,e),Mt.forEach(t),Rt.forEach(t),n=0;n<Nt.length;n++)(i=Nt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Nt.length&&null===(n=Nt[0]).blockedOn;)Ft(n),null===n.blockedOn&&Nt.shift()}var Gt=b.ReactCurrentBatchConfig,Ht=!0;function zt(e,t,n,i){var r=wt,o=Gt.transition;Gt.transition=null;try{wt=1,Jt(e,t,n,i)}finally{wt=r,Gt.transition=o}}function Vt(e,t,n,i){var r=wt,o=Gt.transition;Gt.transition=null;try{wt=4,Jt(e,t,n,i)}finally{wt=r,Gt.transition=o}}function Jt(e,t,n,i){if(Ht){var r=$t(e,t,n,i);if(null===r)Hi(e,t,i,Kt,n),jt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return At=Dt(At,e,t,n,i,r),!0;case"dragenter":return Et=Dt(Et,e,t,n,i,r),!0;case"mouseover":return Pt=Dt(Pt,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return Mt.set(o,Dt(Mt.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Rt.set(o,Dt(Rt.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(jt(e,i),4&t&&-1<Ot.indexOf(e)){for(;null!==r;){var o=wr(r);if(null!==o&&_t(o),null===(o=$t(e,t,n,i))&&Hi(e,t,i,Kt,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else Hi(e,t,i,null,n)}}var Kt=null;function $t(e,t,n,i){if(Kt=null,null!==(e=yr(e=_e(i))))if(null===(t=Be(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Yt=null,Xt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Xt,i=n.length,r="value"in Yt?Yt.value:Yt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[o-t];t++);return Zt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,i,r,o){for(var s in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,an,cn,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=on(un),ln=F({},un,{view:0,detail:0}),hn=on(ln),pn=F({},ln,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(sn=e.screenX-cn.screenX,an=e.screenY-cn.screenY):an=sn=0,cn=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=on(pn),gn=on(F({},pn,{dataTransfer:0})),mn=on(F({},ln,{relatedTarget:0})),vn=on(F({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=F({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),wn=on(yn),bn=on(F({},un,{data:0})),_n={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},In={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cn[e])&&!!t[e]}function kn(){return Sn}var xn=F({},ln,{key:function(e){if(e.key){var t=_n[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?In[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=on(xn),An=on(F({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),En=on(F({},ln,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),Pn=on(F({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),Mn=F({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rn=on(Mn),Nn=[9,13,27,32],On=d&&"CompositionEvent"in window,jn=null;d&&"documentMode"in document&&(jn=document.documentMode);var Dn=d&&"TextEvent"in window&&!jn,Fn=d&&(!On||jn&&8<jn&&11>=jn),Wn=String.fromCharCode(32),Ln=!1;function Un(e,t){switch(e){case"keyup":return-1!==Nn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Bn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function zn(e,t,n,i){xe(i),0<(t=Vi(t,"onChange")).length&&(n=new dn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Vn=null,Jn=null;function Kn(e){Wi(e,0)}function $n(e){if(J(br(e)))return e}function Qn(e,t){if("change"===e)return t}var Yn=!1;if(d){var Xn;if(d){var Zn="oninput"in document;if(!Zn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Zn="function"===typeof ei.oninput}Xn=Zn}else Xn=!1;Yn=Xn&&(!document.documentMode||9<document.documentMode)}function ti(){Vn&&(Vn.detachEvent("onpropertychange",ni),Jn=Vn=null)}function ni(e){if("value"===e.propertyName&&$n(Jn)){var t=[];zn(t,Jn,e,_e(e)),Me(Kn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Jn=n,(Vn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return $n(Jn)}function oi(e,t){if("click"===e)return $n(t)}function si(e,t){if("input"===e||"change"===e)return $n(t)}var ai="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ci(e,t){if(ai(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!l.call(t,r)||!ai(e[r],t[r]))return!1}return!0}function ui(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function di(e,t){var n,i=ui(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ui(i)}}function li(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?li(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&li(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=void 0===i.end?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=di(n,o);var s=di(n,i);r&&s&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gi=d&&"documentMode"in document&&11>=document.documentMode,mi=null,vi=null,yi=null,wi=!1;function bi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;wi||null==mi||mi!==K(i)||("selectionStart"in(i=mi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&ci(yi,i)||(yi=i,0<(i=Vi(vi,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=mi)))}function _i(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ii={animationend:_i("Animation","AnimationEnd"),animationiteration:_i("Animation","AnimationIteration"),animationstart:_i("Animation","AnimationStart"),transitionend:_i("Transition","TransitionEnd")},Ci={},Si={};function ki(e){if(Ci[e])return Ci[e];if(!Ii[e])return e;var t,n=Ii[e];for(t in n)if(n.hasOwnProperty(t)&&t in Si)return Ci[e]=n[t];return e}d&&(Si=document.createElement("div").style,"AnimationEvent"in window||(delete Ii.animationend.animation,delete Ii.animationiteration.animation,delete Ii.animationstart.animation),"TransitionEvent"in window||delete Ii.transitionend.transition);var xi=ki("animationend"),Ti=ki("animationiteration"),Ai=ki("animationstart"),Ei=ki("transitionend"),Pi=new Map,Mi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ri(e,t){Pi.set(e,t),c(t,[e])}for(var Ni=0;Ni<Mi.length;Ni++){var Oi=Mi[Ni];Ri(Oi.toLowerCase(),"on"+(Oi[0].toUpperCase()+Oi.slice(1)))}Ri(xi,"onAnimationEnd"),Ri(Ti,"onAnimationIteration"),Ri(Ai,"onAnimationStart"),Ri("dblclick","onDoubleClick"),Ri("focusin","onFocus"),Ri("focusout","onBlur"),Ri(Ei,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ji="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Di=new Set("cancel close invalid load scroll toggle".split(" ").concat(ji));function Fi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,s,a,c,u){if(qe.apply(this,arguments),De){if(!De)throw Error(o(198));var d=Fe;De=!1,Fe=null,We||(We=!0,Le=d)}}(i,t,void 0,e),e.currentTarget=null}function Wi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var a=i[s],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==o&&r.isPropagationStopped())break e;Fi(r,a,u),o=c}else for(s=0;s<i.length;s++){if(c=(a=i[s]).instance,u=a.currentTarget,a=a.listener,c!==o&&r.isPropagationStopped())break e;Fi(r,a,u),o=c}}}if(We)throw e=Le,We=!1,Le=null,e}function Li(e,t){var n=t[gr];void 0===n&&(n=t[gr]=new Set);var i=e+"__bubble";n.has(i)||(Gi(t,e,2,!1),n.add(i))}function Ui(e,t,n){var i=0;t&&(i|=4),Gi(n,e,i,t)}var qi="_reactListening"+Math.random().toString(36).slice(2);function Bi(e){if(!e[qi]){e[qi]=!0,s.forEach((function(t){"selectionchange"!==t&&(Di.has(t)||Ui(t,!1,e),Ui(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[qi]||(t[qi]=!0,Ui("selectionchange",!1,t))}}function Gi(e,t,n,i){switch(Qt(t)){case 1:var r=zt;break;case 4:r=Vt;break;default:r=Jt}n=r.bind(null,t,n,e),r=void 0,!Ne||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Hi(e,t,n,i,r){var o=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var s=i.tag;if(3===s||4===s){var a=i.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===s)for(s=i.return;null!==s;){var c=s.tag;if((3===c||4===c)&&((c=s.stateNode.containerInfo)===r||8===c.nodeType&&c.parentNode===r))return;s=s.return}for(;null!==a;){if(null===(s=yr(a)))return;if(5===(c=s.tag)||6===c){i=o=s;continue e}a=a.parentNode}}i=i.return}Me((function(){var i=o,r=_e(n),s=[];e:{var a=Pi.get(e);if(void 0!==a){var c=dn,u=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Tn;break;case"focusin":u="focus",c=mn;break;case"focusout":u="blur",c=mn;break;case"beforeblur":case"afterblur":c=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=En;break;case xi:case Ti:case Ai:c=vn;break;case Ei:c=Pn;break;case"scroll":c=hn;break;case"wheel":c=Rn;break;case"copy":case"cut":case"paste":c=wn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=An}var d=0!==(4&t),l=!d&&"scroll"===e,h=d?null!==a?a+"Capture":null:a;d=[];for(var p,f=i;null!==f;){var g=(p=f).stateNode;if(5===p.tag&&null!==g&&(p=g,null!==h&&(null!=(g=Re(f,h))&&d.push(zi(f,g,p)))),l)break;f=f.return}0<d.length&&(a=new c(a,u,null,n,r),s.push({event:a,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===be||!(u=n.relatedTarget||n.fromElement)||!yr(u)&&!u[fr])&&(c||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,c?(c=i,null!==(u=(u=n.relatedTarget||n.toElement)?yr(u):null)&&(u!==(l=Be(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(c=null,u=i),c!==u)){if(d=fn,g="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(d=An,g="onPointerLeave",h="onPointerEnter",f="pointer"),l=null==c?a:br(c),p=null==u?a:br(u),(a=new d(g,f+"leave",c,n,r)).target=l,a.relatedTarget=p,g=null,yr(r)===i&&((d=new d(h,f+"enter",u,n,r)).target=p,d.relatedTarget=l,g=d),l=g,c&&u)e:{for(h=u,f=0,p=d=c;p;p=Ji(p))f++;for(p=0,g=h;g;g=Ji(g))p++;for(;0<f-p;)d=Ji(d),f--;for(;0<p-f;)h=Ji(h),p--;for(;f--;){if(d===h||null!==h&&d===h.alternate)break e;d=Ji(d),h=Ji(h)}d=null}else d=null;null!==c&&Ki(s,a,c,d,!1),null!==u&&null!==l&&Ki(s,l,u,d,!0)}if("select"===(c=(a=i?br(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===c&&"file"===a.type)var m=Qn;else if(Hn(a))if(Yn)m=si;else{m=ri;var v=ii}else(c=a.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(m=oi);switch(m&&(m=m(e,i))?zn(s,m,n,r):(v&&v(e,a,i),"focusout"===e&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&ee(a,"number",a.value)),v=i?br(i):window,e){case"focusin":(Hn(v)||"true"===v.contentEditable)&&(mi=v,vi=i,yi=null);break;case"focusout":yi=vi=mi=null;break;case"mousedown":wi=!0;break;case"contextmenu":case"mouseup":case"dragend":wi=!1,bi(s,n,r);break;case"selectionchange":if(gi)break;case"keydown":case"keyup":bi(s,n,r)}var y;if(On)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Bn?Un(e,n)&&(w="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(w="onCompositionStart");w&&(Fn&&"ko"!==n.locale&&(Bn||"onCompositionStart"!==w?"onCompositionEnd"===w&&Bn&&(y=en()):(Xt="value"in(Yt=r)?Yt.value:Yt.textContent,Bn=!0)),0<(v=Vi(i,w)).length&&(w=new bn(w,e,null,n,r),s.push({event:w,listeners:v}),y?w.data=y:null!==(y=qn(n))&&(w.data=y))),(y=Dn?function(e,t){switch(e){case"compositionend":return qn(t);case"keypress":return 32!==t.which?null:(Ln=!0,Wn);case"textInput":return(e=t.data)===Wn&&Ln?null:e;default:return null}}(e,n):function(e,t){if(Bn)return"compositionend"===e||!On&&Un(e,t)?(e=en(),Zt=Xt=Yt=null,Bn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Vi(i,"onBeforeInput")).length&&(r=new bn("onBeforeInput","beforeinput",null,n,r),s.push({event:r,listeners:i}),r.data=y))}Wi(s,t)}))}function zi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Vi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=Re(e,n))&&i.unshift(zi(e,o,r)),null!=(o=Re(e,t))&&i.push(zi(e,o,r))),e=e.return}return i}function Ji(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ki(e,t,n,i,r){for(var o=t._reactName,s=[];null!==n&&n!==i;){var a=n,c=a.alternate,u=a.stateNode;if(null!==c&&c===i)break;5===a.tag&&null!==u&&(a=u,r?null!=(c=Re(n,o))&&s.unshift(zi(n,c,a)):r||null!=(c=Re(n,o))&&s.push(zi(n,c,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var $i=/\r\n?/g,Qi=/\u0000|\uFFFD/g;function Yi(e){return("string"===typeof e?e:""+e).replace($i,"\n").replace(Qi,"")}function Xi(e,t,n){if(t=Yi(t),Yi(e)!==t&&n)throw Error(o(425))}function Zi(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,or="function"===typeof Promise?Promise:void 0,sr="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof or?function(e){return or.resolve(null).then(e).catch(ar)}:ir;function ar(e){setTimeout((function(){throw e}))}function cr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Bt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Bt(t)}function ur(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function dr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var lr=Math.random().toString(36).slice(2),hr="__reactFiber$"+lr,pr="__reactProps$"+lr,fr="__reactContainer$"+lr,gr="__reactEvents$"+lr,mr="__reactListeners$"+lr,vr="__reactHandles$"+lr;function yr(e){var t=e[hr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fr]||n[hr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=dr(e);null!==e;){if(n=e[hr])return n;e=dr(e)}return t}n=(e=n).parentNode}return null}function wr(e){return!(e=e[hr]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function br(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function _r(e){return e[pr]||null}var Ir=[],Cr=-1;function Sr(e){return{current:e}}function kr(e){0>Cr||(e.current=Ir[Cr],Ir[Cr]=null,Cr--)}function xr(e,t){Cr++,Ir[Cr]=e.current,e.current=t}var Tr={},Ar=Sr(Tr),Er=Sr(!1),Pr=Tr;function Mr(e,t){var n=e.type.contextTypes;if(!n)return Tr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Rr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Nr(){kr(Er),kr(Ar)}function Or(e,t,n){if(Ar.current!==Tr)throw Error(o(168));xr(Ar,t),xr(Er,n)}function jr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(o(108,G(e)||"Unknown",r));return F({},n,i)}function Dr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Tr,Pr=Ar.current,xr(Ar,e),xr(Er,Er.current),!0}function Fr(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=jr(e,t,Pr),i.__reactInternalMemoizedMergedChildContext=e,kr(Er),kr(Ar),xr(Ar,e)):kr(Er),xr(Er,n)}var Wr=null,Lr=!1,Ur=!1;function qr(e){null===Wr?Wr=[e]:Wr.push(e)}function Br(){if(!Ur&&null!==Wr){Ur=!0;var e=0,t=wt;try{var n=Wr;for(wt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Wr=null,Lr=!1}catch(r){throw null!==Wr&&(Wr=Wr.slice(e+1)),Je(Ze,Br),r}finally{wt=t,Ur=!1}}return null}var Gr=[],Hr=0,zr=null,Vr=0,Jr=[],Kr=0,$r=null,Qr=1,Yr="";function Xr(e,t){Gr[Hr++]=Vr,Gr[Hr++]=zr,zr=e,Vr=t}function Zr(e,t,n){Jr[Kr++]=Qr,Jr[Kr++]=Yr,Jr[Kr++]=$r,$r=e;var i=Qr;e=Yr;var r=32-st(i)-1;i&=~(1<<r),n+=1;var o=32-st(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,Qr=1<<32-st(t)+r|n<<r|i,Yr=o+e}else Qr=1<<o|n<<r|i,Yr=e}function eo(e){null!==e.return&&(Xr(e,1),Zr(e,1,0))}function to(e){for(;e===zr;)zr=Gr[--Hr],Gr[Hr]=null,Vr=Gr[--Hr],Gr[Hr]=null;for(;e===$r;)$r=Jr[--Kr],Jr[Kr]=null,Yr=Jr[--Kr],Jr[Kr]=null,Qr=Jr[--Kr],Jr[Kr]=null}var no=null,io=null,ro=!1,oo=null;function so(e,t){var n=Ru(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,io=ur(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,io=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==$r?{id:Qr,overflow:Yr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ru(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,io=null,!0);default:return!1}}function co(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function uo(e){if(ro){var t=io;if(t){var n=t;if(!ao(e,t)){if(co(e))throw Error(o(418));t=ur(n.nextSibling);var i=no;t&&ao(e,t)?so(i,n):(e.flags=-4097&e.flags|2,ro=!1,no=e)}}else{if(co(e))throw Error(o(418));e.flags=-4097&e.flags|2,ro=!1,no=e}}}function lo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!ro)return lo(e),ro=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=io)){if(co(e))throw po(),Error(o(418));for(;t;)so(e,t),t=ur(t.nextSibling)}if(lo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){io=ur(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}io=null}}else io=no?ur(e.stateNode.nextSibling):null;return!0}function po(){for(var e=io;e;)e=ur(e.nextSibling)}function fo(){io=no=null,ro=!1}function go(e){null===oo?oo=[e]:oo.push(e)}var mo=b.ReactCurrentBatchConfig;function vo(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var yo=Sr(null),wo=null,bo=null,_o=null;function Io(){_o=bo=wo=null}function Co(e){var t=yo.current;kr(yo),e._currentValue=t}function So(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function ko(e,t){wo=e,_o=bo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ba=!0),e.firstContext=null)}function xo(e){var t=e._currentValue;if(_o!==e)if(e={context:e,memoizedValue:t,next:null},null===bo){if(null===wo)throw Error(o(308));bo=e,wo.dependencies={lanes:0,firstContext:e}}else bo=bo.next=e;return t}var To=null;function Ao(e){null===To?To=[e]:To.push(e)}function Eo(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Ao(t)):(n.next=r.next,r.next=n),t.interleaved=n,Po(e,i)}function Po(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Mo=!1;function Ro(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function No(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Oo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function jo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Ec)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Po(e,n)}return null===(r=i.interleaved)?(t.next=t,Ao(i)):(t.next=r.next,r.next=t),i.interleaved=t,Po(e,n)}function Do(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Fo(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Wo(e,t,n,i){var r=e.updateQueue;Mo=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var c=a,u=c.next;c.next=null,null===s?o=u:s.next=u,s=c;var d=e.alternate;null!==d&&((a=(d=d.updateQueue).lastBaseUpdate)!==s&&(null===a?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=c))}if(null!==o){var l=r.baseState;for(s=0,d=u=c=null,a=o;;){var h=a.lane,p=a.eventTime;if((i&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,g=a;switch(h=t,p=n,g.tag){case 1:if("function"===typeof(f=g.payload)){l=f.call(p,l,h);break e}l=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=g.payload)?f.call(p,l,h):f)||void 0===h)break e;l=F({},l,h);break e;case 2:Mo=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===d?(u=d=p,c=l):d=d.next=p,s|=h;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(h=a).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===d&&(c=l),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=d,null!==(t=r.shared.interleaved)){r=t;do{s|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);Fc|=s,e.lanes=s,e.memoizedState=l}}function Lo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var Uo=(new i.Component).refs;function qo(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Bo={isMounted:function(e){return!!(e=e._reactInternals)&&Be(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tu(),r=nu(e),o=Oo(i,r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=jo(e,o,r))&&(iu(t,e,r,i),Do(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tu(),r=nu(e),o=Oo(i,r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=jo(e,o,r))&&(iu(t,e,r,i),Do(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tu(),i=nu(e),r=Oo(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=jo(e,r,i))&&(iu(t,e,i,n),Do(t,e,i))}};function Go(e,t,n,i,r,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!ci(n,i)||!ci(r,o))}function Ho(e,t,n){var i=!1,r=Tr,o=t.contextType;return"object"===typeof o&&null!==o?o=xo(o):(r=Rr(t)?Pr:Ar.current,o=(i=null!==(i=t.contextTypes)&&void 0!==i)?Mr(e,r):Tr),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Bo,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function zo(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Bo.enqueueReplaceState(t,t.state,null)}function Vo(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Uo,Ro(e);var o=t.contextType;"object"===typeof o&&null!==o?r.context=xo(o):(o=Rr(t)?Pr:Ar.current,r.context=Mr(e,o)),r.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(qo(e,t,o,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Bo.enqueueReplaceState(r,r.state,null),Wo(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function Jo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=i,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=r.refs;t===Uo&&(t=r.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Ko(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function $o(e){return(0,e._init)(e._payload)}function Qo(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Ou(e,t)).index=0,e.sibling=null,e}function s(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,i){return null===t||6!==t.tag?((t=Wu(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function u(e,t,n,i){var o=n.type;return o===C?l(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===R&&$o(o)===t.type)?((i=r(t,n.props)).ref=Jo(e,t,n),i.return=e,i):((i=ju(n.type,n.key,n.props,null,e.mode,i)).ref=Jo(e,t,n),i.return=e,i)}function d(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Lu(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function l(e,t,n,i,o){return null===t||7!==t.tag?((t=Du(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Wu(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case _:return(n=ju(t.type,t.key,t.props,null,e.mode,n)).ref=Jo(e,null,t),n.return=e,n;case I:return(t=Lu(t,e.mode,n)).return=e,t;case R:return h(e,(0,t._init)(t._payload),n)}if(te(t)||j(t))return(t=Du(t,e.mode,n,null)).return=e,t;Ko(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:c(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case _:return n.key===r?u(e,t,n,i):null;case I:return n.key===r?d(e,t,n,i):null;case R:return p(e,t,(r=n._init)(n._payload),i)}if(te(n)||j(n))return null!==r?null:l(e,t,n,i,null);Ko(e,n)}return null}function f(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return c(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case _:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case I:return d(t,e=e.get(null===i.key?n:i.key)||null,i,r);case R:return f(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||j(i))return l(t,e=e.get(n)||null,i,r,null);Ko(t,i)}return null}function g(r,o,a,c){for(var u=null,d=null,l=o,g=o=0,m=null;null!==l&&g<a.length;g++){l.index>g?(m=l,l=null):m=l.sibling;var v=p(r,l,a[g],c);if(null===v){null===l&&(l=m);break}e&&l&&null===v.alternate&&t(r,l),o=s(v,o,g),null===d?u=v:d.sibling=v,d=v,l=m}if(g===a.length)return n(r,l),ro&&Xr(r,g),u;if(null===l){for(;g<a.length;g++)null!==(l=h(r,a[g],c))&&(o=s(l,o,g),null===d?u=l:d.sibling=l,d=l);return ro&&Xr(r,g),u}for(l=i(r,l);g<a.length;g++)null!==(m=f(l,r,g,a[g],c))&&(e&&null!==m.alternate&&l.delete(null===m.key?g:m.key),o=s(m,o,g),null===d?u=m:d.sibling=m,d=m);return e&&l.forEach((function(e){return t(r,e)})),ro&&Xr(r,g),u}function m(r,a,c,u){var d=j(c);if("function"!==typeof d)throw Error(o(150));if(null==(c=d.call(c)))throw Error(o(151));for(var l=d=null,g=a,m=a=0,v=null,y=c.next();null!==g&&!y.done;m++,y=c.next()){g.index>m?(v=g,g=null):v=g.sibling;var w=p(r,g,y.value,u);if(null===w){null===g&&(g=v);break}e&&g&&null===w.alternate&&t(r,g),a=s(w,a,m),null===l?d=w:l.sibling=w,l=w,g=v}if(y.done)return n(r,g),ro&&Xr(r,m),d;if(null===g){for(;!y.done;m++,y=c.next())null!==(y=h(r,y.value,u))&&(a=s(y,a,m),null===l?d=y:l.sibling=y,l=y);return ro&&Xr(r,m),d}for(g=i(r,g);!y.done;m++,y=c.next())null!==(y=f(g,r,m,y.value,u))&&(e&&null!==y.alternate&&g.delete(null===y.key?m:y.key),a=s(y,a,m),null===l?d=y:l.sibling=y,l=y);return e&&g.forEach((function(e){return t(r,e)})),ro&&Xr(r,m),d}return function e(i,o,s,c){if("object"===typeof s&&null!==s&&s.type===C&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case _:e:{for(var u=s.key,d=o;null!==d;){if(d.key===u){if((u=s.type)===C){if(7===d.tag){n(i,d.sibling),(o=r(d,s.props.children)).return=i,i=o;break e}}else if(d.elementType===u||"object"===typeof u&&null!==u&&u.$$typeof===R&&$o(u)===d.type){n(i,d.sibling),(o=r(d,s.props)).ref=Jo(i,d,s),o.return=i,i=o;break e}n(i,d);break}t(i,d),d=d.sibling}s.type===C?((o=Du(s.props.children,i.mode,c,s.key)).return=i,i=o):((c=ju(s.type,s.key,s.props,null,i.mode,c)).ref=Jo(i,o,s),c.return=i,i=c)}return a(i);case I:e:{for(d=s.key;null!==o;){if(o.key===d){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(i,o.sibling),(o=r(o,s.children||[])).return=i,i=o;break e}n(i,o);break}t(i,o),o=o.sibling}(o=Lu(s,i.mode,c)).return=i,i=o}return a(i);case R:return e(i,o,(d=s._init)(s._payload),c)}if(te(s))return g(i,o,s,c);if(j(s))return m(i,o,s,c);Ko(i,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(i,o.sibling),(o=r(o,s)).return=i,i=o):(n(i,o),(o=Wu(s,i.mode,c)).return=i,i=o),a(i)):n(i,o)}}var Yo=Qo(!0),Xo=Qo(!1),Zo={},es=Sr(Zo),ts=Sr(Zo),ns=Sr(Zo);function is(e){if(e===Zo)throw Error(o(174));return e}function rs(e,t){switch(xr(ns,t),xr(ts,e),xr(es,Zo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}kr(es),xr(es,t)}function os(){kr(es),kr(ts),kr(ns)}function ss(e){is(ns.current);var t=is(es.current),n=ce(t,e.type);t!==n&&(xr(ts,e),xr(es,n))}function as(e){ts.current===e&&(kr(es),kr(ts))}var cs=Sr(0);function us(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ds=[];function ls(){for(var e=0;e<ds.length;e++)ds[e]._workInProgressVersionPrimary=null;ds.length=0}var hs=b.ReactCurrentDispatcher,ps=b.ReactCurrentBatchConfig,fs=0,gs=null,ms=null,vs=null,ys=!1,ws=!1,bs=0,_s=0;function Is(){throw Error(o(321))}function Cs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ai(e[n],t[n]))return!1;return!0}function Ss(e,t,n,i,r,s){if(fs=s,gs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,hs.current=null===e||null===e.memoizedState?aa:ca,e=n(i,r),ws){s=0;do{if(ws=!1,bs=0,25<=s)throw Error(o(301));s+=1,vs=ms=null,t.updateQueue=null,hs.current=ua,e=n(i,r)}while(ws)}if(hs.current=sa,t=null!==ms&&null!==ms.next,fs=0,vs=ms=gs=null,ys=!1,t)throw Error(o(300));return e}function ks(){var e=0!==bs;return bs=0,e}function xs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===vs?gs.memoizedState=vs=e:vs=vs.next=e,vs}function Ts(){if(null===ms){var e=gs.alternate;e=null!==e?e.memoizedState:null}else e=ms.next;var t=null===vs?gs.memoizedState:vs.next;if(null!==t)vs=t,ms=e;else{if(null===e)throw Error(o(310));e={memoizedState:(ms=e).memoizedState,baseState:ms.baseState,baseQueue:ms.baseQueue,queue:ms.queue,next:null},null===vs?gs.memoizedState=vs=e:vs=vs.next=e}return vs}function As(e,t){return"function"===typeof t?t(e):t}function Es(e){var t=Ts(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=ms,r=i.baseQueue,s=n.pending;if(null!==s){if(null!==r){var a=r.next;r.next=s.next,s.next=a}i.baseQueue=r=s,n.pending=null}if(null!==r){s=r.next,i=i.baseState;var c=a=null,u=null,d=s;do{var l=d.lane;if((fs&l)===l)null!==u&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),i=d.hasEagerState?d.eagerState:e(i,d.action);else{var h={lane:l,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===u?(c=u=h,a=i):u=u.next=h,gs.lanes|=l,Fc|=l}d=d.next}while(null!==d&&d!==s);null===u?a=i:u.next=c,ai(i,t.memoizedState)||(ba=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=u,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{s=r.lane,gs.lanes|=s,Fc|=s,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ps(e){var t=Ts(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,s=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{s=e(s,a.action),a=a.next}while(a!==r);ai(s,t.memoizedState)||(ba=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,i]}function Ms(){}function Rs(e,t){var n=gs,i=Ts(),r=t(),s=!ai(i.memoizedState,r);if(s&&(i.memoizedState=r,ba=!0),i=i.queue,Hs(js.bind(null,n,i,e),[e]),i.getSnapshot!==t||s||null!==vs&&1&vs.memoizedState.tag){if(n.flags|=2048,Ls(9,Os.bind(null,n,i,r,t),void 0,null),null===Pc)throw Error(o(349));0!==(30&fs)||Ns(n,t,r)}return r}function Ns(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=gs.updateQueue)?(t={lastEffect:null,stores:null},gs.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Os(e,t,n,i){t.value=n,t.getSnapshot=i,Ds(t)&&Fs(e)}function js(e,t,n){return n((function(){Ds(t)&&Fs(e)}))}function Ds(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ai(e,n)}catch(i){return!0}}function Fs(e){var t=Po(e,1);null!==t&&iu(t,e,1,-1)}function Ws(e){var t=xs();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:As,lastRenderedState:e},t.queue=e,e=e.dispatch=na.bind(null,gs,e),[t.memoizedState,e]}function Ls(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=gs.updateQueue)?(t={lastEffect:null,stores:null},gs.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Us(){return Ts().memoizedState}function qs(e,t,n,i){var r=xs();gs.flags|=e,r.memoizedState=Ls(1|t,n,void 0,void 0===i?null:i)}function Bs(e,t,n,i){var r=Ts();i=void 0===i?null:i;var o=void 0;if(null!==ms){var s=ms.memoizedState;if(o=s.destroy,null!==i&&Cs(i,s.deps))return void(r.memoizedState=Ls(t,n,o,i))}gs.flags|=e,r.memoizedState=Ls(1|t,n,o,i)}function Gs(e,t){return qs(8390656,8,e,t)}function Hs(e,t){return Bs(2048,8,e,t)}function zs(e,t){return Bs(4,2,e,t)}function Vs(e,t){return Bs(4,4,e,t)}function Js(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ks(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Bs(4,4,Js.bind(null,t,e),n)}function $s(){}function Qs(e,t){var n=Ts();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Cs(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ys(e,t){var n=Ts();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Cs(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Xs(e,t,n){return 0===(21&fs)?(e.baseState&&(e.baseState=!1,ba=!0),e.memoizedState=n):(ai(n,t)||(n=gt(),gs.lanes|=n,Fc|=n,e.baseState=!0),t)}function Zs(e,t){var n=wt;wt=0!==n&&4>n?n:4,e(!0);var i=ps.transition;ps.transition={};try{e(!1),t()}finally{wt=n,ps.transition=i}}function ea(){return Ts().memoizedState}function ta(e,t,n){var i=nu(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},ia(e))ra(t,n);else if(null!==(n=Eo(e,t,n,i))){iu(n,e,i,tu()),oa(n,t,i)}}function na(e,t,n){var i=nu(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(ia(e))ra(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(r.hasEagerState=!0,r.eagerState=a,ai(a,s)){var c=t.interleaved;return null===c?(r.next=r,Ao(t)):(r.next=c.next,c.next=r),void(t.interleaved=r)}}catch(u){}null!==(n=Eo(e,t,r,i))&&(iu(n,e,i,r=tu()),oa(n,t,i))}}function ia(e){var t=e.alternate;return e===gs||null!==t&&t===gs}function ra(e,t){ws=ys=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function oa(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var sa={readContext:xo,useCallback:Is,useContext:Is,useEffect:Is,useImperativeHandle:Is,useInsertionEffect:Is,useLayoutEffect:Is,useMemo:Is,useReducer:Is,useRef:Is,useState:Is,useDebugValue:Is,useDeferredValue:Is,useTransition:Is,useMutableSource:Is,useSyncExternalStore:Is,useId:Is,unstable_isNewReconciler:!1},aa={readContext:xo,useCallback:function(e,t){return xs().memoizedState=[e,void 0===t?null:t],e},useContext:xo,useEffect:Gs,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,qs(4194308,4,Js.bind(null,t,e),n)},useLayoutEffect:function(e,t){return qs(4194308,4,e,t)},useInsertionEffect:function(e,t){return qs(4,2,e,t)},useMemo:function(e,t){var n=xs();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=xs();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ta.bind(null,gs,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},xs().memoizedState=e},useState:Ws,useDebugValue:$s,useDeferredValue:function(e){return xs().memoizedState=e},useTransition:function(){var e=Ws(!1),t=e[0];return e=Zs.bind(null,e[1]),xs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=gs,r=xs();if(ro){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Pc)throw Error(o(349));0!==(30&fs)||Ns(i,t,n)}r.memoizedState=n;var s={value:n,getSnapshot:t};return r.queue=s,Gs(js.bind(null,i,s,e),[e]),i.flags|=2048,Ls(9,Os.bind(null,i,s,n,t),void 0,null),n},useId:function(){var e=xs(),t=Pc.identifierPrefix;if(ro){var n=Yr;t=":"+t+"R"+(n=(Qr&~(1<<32-st(Qr)-1)).toString(32)+n),0<(n=bs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=_s++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ca={readContext:xo,useCallback:Qs,useContext:xo,useEffect:Hs,useImperativeHandle:Ks,useInsertionEffect:zs,useLayoutEffect:Vs,useMemo:Ys,useReducer:Es,useRef:Us,useState:function(){return Es(As)},useDebugValue:$s,useDeferredValue:function(e){return Xs(Ts(),ms.memoizedState,e)},useTransition:function(){return[Es(As)[0],Ts().memoizedState]},useMutableSource:Ms,useSyncExternalStore:Rs,useId:ea,unstable_isNewReconciler:!1},ua={readContext:xo,useCallback:Qs,useContext:xo,useEffect:Hs,useImperativeHandle:Ks,useInsertionEffect:zs,useLayoutEffect:Vs,useMemo:Ys,useReducer:Ps,useRef:Us,useState:function(){return Ps(As)},useDebugValue:$s,useDeferredValue:function(e){var t=Ts();return null===ms?t.memoizedState=e:Xs(t,ms.memoizedState,e)},useTransition:function(){return[Ps(As)[0],Ts().memoizedState]},useMutableSource:Ms,useSyncExternalStore:Rs,useId:ea,unstable_isNewReconciler:!1};function da(e,t){try{var n="",i=t;do{n+=q(i),i=i.return}while(i);var r=n}catch(o){r="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:r,digest:null}}function la(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ha(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var pa="function"===typeof WeakMap?WeakMap:Map;function fa(e,t,n){(n=Oo(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){zc||(zc=!0,Vc=i),ha(0,t)},n}function ga(e,t,n){(n=Oo(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){ha(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){ha(0,t),"function"!==typeof i&&(null===Jc?Jc=new Set([this]):Jc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ma(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new pa;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=xu.bind(null,e,t,n),t.then(e,e))}function va(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ya(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Oo(-1,1)).tag=2,jo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var wa=b.ReactCurrentOwner,ba=!1;function _a(e,t,n,i){t.child=null===e?Xo(t,null,n,i):Yo(t,e.child,n,i)}function Ia(e,t,n,i,r){n=n.render;var o=t.ref;return ko(t,r),i=Ss(e,t,n,i,o,r),n=ks(),null===e||ba?(ro&&n&&eo(t),t.flags|=1,_a(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,za(e,t,r))}function Ca(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||Nu(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ju(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Sa(e,t,o,i,r))}if(o=e.child,0===(e.lanes&r)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:ci)(s,i)&&e.ref===t.ref)return za(e,t,r)}return t.flags|=1,(e=Ou(o,i)).ref=t.ref,e.return=t,t.child=e}function Sa(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(ci(o,i)&&e.ref===t.ref){if(ba=!1,t.pendingProps=i=o,0===(e.lanes&r))return t.lanes=e.lanes,za(e,t,r);0!==(131072&e.flags)&&(ba=!0)}}return Ta(e,t,n,i,r)}function ka(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},xr(Oc,Nc),Nc|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,xr(Oc,Nc),Nc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==o?o.baseLanes:n,xr(Oc,Nc),Nc|=i}else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,xr(Oc,Nc),Nc|=i;return _a(e,t,r,n),t.child}function xa(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ta(e,t,n,i,r){var o=Rr(n)?Pr:Ar.current;return o=Mr(t,o),ko(t,r),n=Ss(e,t,n,i,o,r),i=ks(),null===e||ba?(ro&&i&&eo(t),t.flags|=1,_a(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,za(e,t,r))}function Aa(e,t,n,i,r){if(Rr(n)){var o=!0;Dr(t)}else o=!1;if(ko(t,r),null===t.stateNode)Ha(e,t),Ho(t,n,i),Vo(t,n,i,r),i=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var c=s.context,u=n.contextType;"object"===typeof u&&null!==u?u=xo(u):u=Mr(t,u=Rr(n)?Pr:Ar.current);var d=n.getDerivedStateFromProps,l="function"===typeof d||"function"===typeof s.getSnapshotBeforeUpdate;l||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==i||c!==u)&&zo(t,s,i,u),Mo=!1;var h=t.memoizedState;s.state=h,Wo(t,i,s,r),c=t.memoizedState,a!==i||h!==c||Er.current||Mo?("function"===typeof d&&(qo(t,n,d,i),c=t.memoizedState),(a=Mo||Go(t,n,a,i,h,c,u))?(l||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),s.props=i,s.state=c,s.context=u,i=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,No(e,t),a=t.memoizedProps,u=t.type===t.elementType?a:vo(t.type,a),s.props=u,l=t.pendingProps,h=s.context,"object"===typeof(c=n.contextType)&&null!==c?c=xo(c):c=Mr(t,c=Rr(n)?Pr:Ar.current);var p=n.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==l||h!==c)&&zo(t,s,i,c),Mo=!1,h=t.memoizedState,s.state=h,Wo(t,i,s,r);var f=t.memoizedState;a!==l||h!==f||Er.current||Mo?("function"===typeof p&&(qo(t,n,p,i),f=t.memoizedState),(u=Mo||Go(t,n,u,i,h,f,c)||!1)?(d||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(i,f,c),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,f,c)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),s.props=i,s.state=f,s.context=c,i=u):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Ea(e,t,n,i,o,r)}function Ea(e,t,n,i,r,o){xa(e,t);var s=0!==(128&t.flags);if(!i&&!s)return r&&Fr(t,n,!1),za(e,t,o);i=t.stateNode,wa.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&s?(t.child=Yo(t,e.child,null,o),t.child=Yo(t,null,a,o)):_a(e,t,a,o),t.memoizedState=i.state,r&&Fr(t,n,!0),t.child}function Pa(e){var t=e.stateNode;t.pendingContext?Or(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Or(0,t.context,!1),rs(e,t.containerInfo)}function Ma(e,t,n,i,r){return fo(),go(r),t.flags|=256,_a(e,t,n,i),t.child}var Ra,Na,Oa,ja,Da={dehydrated:null,treeContext:null,retryLane:0};function Fa(e){return{baseLanes:e,cachePool:null,transitions:null}}function Wa(e,t,n){var i,r=t.pendingProps,s=cs.current,a=!1,c=0!==(128&t.flags);if((i=c)||(i=(null===e||null!==e.memoizedState)&&0!==(2&s)),i?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),xr(cs,1&s),null===e)return uo(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=r.children,e=r.fallback,a?(r=t.mode,a=t.child,c={mode:"hidden",children:c},0===(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=c):a=Fu(c,r,0,null),e=Du(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Fa(n),t.memoizedState=Da,e):La(t,c));if(null!==(s=e.memoizedState)&&null!==(i=s.dehydrated))return function(e,t,n,i,r,s,a){if(n)return 256&t.flags?(t.flags&=-257,Ua(e,t,a,i=la(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=i.fallback,r=t.mode,i=Fu({mode:"visible",children:i.children},r,0,null),(s=Du(s,r,a,null)).flags|=2,i.return=t,s.return=t,i.sibling=s,t.child=i,0!==(1&t.mode)&&Yo(t,e.child,null,a),t.child.memoizedState=Fa(a),t.memoizedState=Da,s);if(0===(1&t.mode))return Ua(e,t,a,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var c=i.dgst;return i=c,Ua(e,t,a,i=la(s=Error(o(419)),i,void 0))}if(c=0!==(a&e.childLanes),ba||c){if(null!==(i=Pc)){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|a))?0:r)&&r!==s.retryLane&&(s.retryLane=r,Po(e,r),iu(i,e,r,-1))}return mu(),Ua(e,t,a,i=la(Error(o(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Au.bind(null,e),r._reactRetry=t,null):(e=s.treeContext,io=ur(r.nextSibling),no=t,ro=!0,oo=null,null!==e&&(Jr[Kr++]=Qr,Jr[Kr++]=Yr,Jr[Kr++]=$r,Qr=e.id,Yr=e.overflow,$r=t),t=La(t,i.children),t.flags|=4096,t)}(e,t,c,r,i,s,n);if(a){a=r.fallback,c=t.mode,i=(s=e.child).sibling;var u={mode:"hidden",children:r.children};return 0===(1&c)&&t.child!==s?((r=t.child).childLanes=0,r.pendingProps=u,t.deletions=null):(r=Ou(s,u)).subtreeFlags=14680064&s.subtreeFlags,null!==i?a=Ou(i,a):(a=Du(a,c,n,null)).flags|=2,a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,c=null===(c=e.child.memoizedState)?Fa(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},a.memoizedState=c,a.childLanes=e.childLanes&~n,t.memoizedState=Da,r}return e=(a=e.child).sibling,r=Ou(a,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function La(e,t){return(t=Fu({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ua(e,t,n,i){return null!==i&&go(i),Yo(t,e.child,null,n),(e=La(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function qa(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),So(e.return,t,n)}function Ba(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function Ga(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(_a(e,t,i.children,n),0!==(2&(i=cs.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&qa(e,n,t);else if(19===e.tag)qa(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(xr(cs,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===us(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Ba(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===us(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Ba(t,!0,n,null,o);break;case"together":Ba(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ha(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function za(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Ou(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ou(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Va(e,t){if(!ro)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ja(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Ka(e,t,n){var i=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ja(t),null;case 1:case 17:return Rr(t.type)&&Nr(),Ja(t),null;case 3:return i=t.stateNode,os(),kr(Er),kr(Ar),ls(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(au(oo),oo=null))),Na(e,t),Ja(t),null;case 5:as(t);var r=is(ns.current);if(n=t.type,null!==e&&null!=t.stateNode)Oa(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(o(166));return Ja(t),null}if(e=is(es.current),ho(t)){i=t.stateNode,n=t.type;var s=t.memoizedProps;switch(i[hr]=t,i[pr]=s,e=0!==(1&t.mode),n){case"dialog":Li("cancel",i),Li("close",i);break;case"iframe":case"object":case"embed":Li("load",i);break;case"video":case"audio":for(r=0;r<ji.length;r++)Li(ji[r],i);break;case"source":Li("error",i);break;case"img":case"image":case"link":Li("error",i),Li("load",i);break;case"details":Li("toggle",i);break;case"input":Q(i,s),Li("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Li("invalid",i);break;case"textarea":re(i,s),Li("invalid",i)}for(var c in ye(n,s),r=null,s)if(s.hasOwnProperty(c)){var u=s[c];"children"===c?"string"===typeof u?i.textContent!==u&&(!0!==s.suppressHydrationWarning&&Xi(i.textContent,u,e),r=["children",u]):"number"===typeof u&&i.textContent!==""+u&&(!0!==s.suppressHydrationWarning&&Xi(i.textContent,u,e),r=["children",""+u]):a.hasOwnProperty(c)&&null!=u&&"onScroll"===c&&Li("scroll",i)}switch(n){case"input":V(i),Z(i,s,!0);break;case"textarea":V(i),se(i);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(i.onclick=Zi)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{c=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=c.createElement(n,{is:i.is}):(e=c.createElement(n),"select"===n&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,n),e[hr]=t,e[pr]=i,Ra(e,t,!1,!1),t.stateNode=e;e:{switch(c=we(n,i),n){case"dialog":Li("cancel",e),Li("close",e),r=i;break;case"iframe":case"object":case"embed":Li("load",e),r=i;break;case"video":case"audio":for(r=0;r<ji.length;r++)Li(ji[r],e);r=i;break;case"source":Li("error",e),r=i;break;case"img":case"image":case"link":Li("error",e),Li("load",e),r=i;break;case"details":Li("toggle",e),r=i;break;case"input":Q(e,i),r=$(e,i),Li("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=F({},i,{value:void 0}),Li("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Li("invalid",e)}for(s in ye(n,r),u=r)if(u.hasOwnProperty(s)){var d=u[s];"style"===s?me(e,d):"dangerouslySetInnerHTML"===s?null!=(d=d?d.__html:void 0)&&le(e,d):"children"===s?"string"===typeof d?("textarea"!==n||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=d&&"onScroll"===s&&Li("scroll",e):null!=d&&w(e,s,d,c))}switch(n){case"input":V(e),Z(e,i,!1);break;case"textarea":V(e),se(e);break;case"option":null!=i.value&&e.setAttribute("value",""+H(i.value));break;case"select":e.multiple=!!i.multiple,null!=(s=i.value)?ne(e,!!i.multiple,s,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Zi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ja(t),null;case 6:if(e&&null!=t.stateNode)ja(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(o(166));if(n=is(ns.current),is(es.current),ho(t)){if(i=t.stateNode,n=t.memoizedProps,i[hr]=t,(s=i.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Xi(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xi(i.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hr]=t,t.stateNode=i}return Ja(t),null;case 13:if(kr(cs),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ro&&null!==io&&0!==(1&t.mode)&&0===(128&t.flags))po(),fo(),t.flags|=98560,s=!1;else if(s=ho(t),null!==i&&null!==i.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[hr]=t}else fo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ja(t),s=!1}else null!==oo&&(au(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&cs.current)?0===jc&&(jc=3):mu())),null!==t.updateQueue&&(t.flags|=4),Ja(t),null);case 4:return os(),Na(e,t),null===e&&Bi(t.stateNode.containerInfo),Ja(t),null;case 10:return Co(t.type._context),Ja(t),null;case 19:if(kr(cs),null===(s=t.memoizedState))return Ja(t),null;if(i=0!==(128&t.flags),null===(c=s.rendering))if(i)Va(s,!1);else{if(0!==jc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=us(e))){for(t.flags|=128,Va(s,!1),null!==(i=c.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(s=n).flags&=14680066,null===(c=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,e=c.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return xr(cs,1&cs.current|2),t.child}e=e.sibling}null!==s.tail&&Ye()>Gc&&(t.flags|=128,i=!0,Va(s,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=us(c))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Va(s,!0),null===s.tail&&"hidden"===s.tailMode&&!c.alternate&&!ro)return Ja(t),null}else 2*Ye()-s.renderingStartTime>Gc&&1073741824!==n&&(t.flags|=128,i=!0,Va(s,!1),t.lanes=4194304);s.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=s.last)?n.sibling=c:t.child=c,s.last=c)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ye(),t.sibling=null,n=cs.current,xr(cs,i?1&n|2:1&n),t):(Ja(t),null);case 22:case 23:return hu(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Nc)&&(Ja(t),6&t.subtreeFlags&&(t.flags|=8192)):Ja(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function $a(e,t){switch(to(t),t.tag){case 1:return Rr(t.type)&&Nr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return os(),kr(Er),kr(Ar),ls(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return as(t),null;case 13:if(kr(cs),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return kr(cs),null;case 4:return os(),null;case 10:return Co(t.type._context),null;case 22:case 23:return hu(),null;default:return null}}Ra=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Na=function(){},Oa=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,is(es.current);var o,s=null;switch(n){case"input":r=$(e,r),i=$(e,i),s=[];break;case"select":r=F({},r,{value:void 0}),i=F({},i,{value:void 0}),s=[];break;case"textarea":r=ie(e,r),i=ie(e,i),s=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=Zi)}for(d in ye(n,i),n=null,r)if(!i.hasOwnProperty(d)&&r.hasOwnProperty(d)&&null!=r[d])if("style"===d){var c=r[d];for(o in c)c.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(a.hasOwnProperty(d)?s||(s=[]):(s=s||[]).push(d,null));for(d in i){var u=i[d];if(c=null!=r?r[d]:void 0,i.hasOwnProperty(d)&&u!==c&&(null!=u||null!=c))if("style"===d)if(c){for(o in c)!c.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in u)u.hasOwnProperty(o)&&c[o]!==u[o]&&(n||(n={}),n[o]=u[o])}else n||(s||(s=[]),s.push(d,n)),n=u;else"dangerouslySetInnerHTML"===d?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(s=s||[]).push(d,u)):"children"===d?"string"!==typeof u&&"number"!==typeof u||(s=s||[]).push(d,""+u):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(a.hasOwnProperty(d)?(null!=u&&"onScroll"===d&&Li("scroll",e),s||c===u||(s=[])):(s=s||[]).push(d,u))}n&&(s=s||[]).push("style",n);var d=s;(t.updateQueue=d)&&(t.flags|=4)}},ja=function(e,t,n,i){n!==i&&(t.flags|=4)};var Qa=!1,Ya=!1,Xa="function"===typeof WeakSet?WeakSet:Set,Za=null;function ec(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){ku(e,t,i)}else n.current=null}function tc(e,t,n){try{n()}catch(i){ku(e,t,i)}}var nc=!1;function ic(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&tc(t,n,o)}r=r.next}while(r!==i)}}function rc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function oc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sc(e){var t=e.alternate;null!==t&&(e.alternate=null,sc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[pr],delete t[gr],delete t[mr],delete t[vr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ac(e){return 5===e.tag||3===e.tag||4===e.tag}function cc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ac(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zi));else if(4!==i&&null!==(e=e.child))for(uc(e,t,n),e=e.sibling;null!==e;)uc(e,t,n),e=e.sibling}function dc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(dc(e,t,n),e=e.sibling;null!==e;)dc(e,t,n),e=e.sibling}var lc=null,hc=!1;function pc(e,t,n){for(n=n.child;null!==n;)fc(e,t,n),n=n.sibling}function fc(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(rt,n)}catch(a){}switch(n.tag){case 5:Ya||ec(n,t);case 6:var i=lc,r=hc;lc=null,pc(e,t,n),hc=r,null!==(lc=i)&&(hc?(e=lc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):lc.removeChild(n.stateNode));break;case 18:null!==lc&&(hc?(e=lc,n=n.stateNode,8===e.nodeType?cr(e.parentNode,n):1===e.nodeType&&cr(e,n),Bt(e)):cr(lc,n.stateNode));break;case 4:i=lc,r=hc,lc=n.stateNode.containerInfo,hc=!0,pc(e,t,n),lc=i,hc=r;break;case 0:case 11:case 14:case 15:if(!Ya&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var o=r,s=o.destroy;o=o.tag,void 0!==s&&(0!==(2&o)||0!==(4&o))&&tc(n,t,s),r=r.next}while(r!==i)}pc(e,t,n);break;case 1:if(!Ya&&(ec(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){ku(n,t,a)}pc(e,t,n);break;case 21:pc(e,t,n);break;case 22:1&n.mode?(Ya=(i=Ya)||null!==n.memoizedState,pc(e,t,n),Ya=i):pc(e,t,n);break;default:pc(e,t,n)}}function gc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Xa),t.forEach((function(t){var i=Eu.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function mc(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var s=e,a=t,c=a;e:for(;null!==c;){switch(c.tag){case 5:lc=c.stateNode,hc=!1;break e;case 3:case 4:lc=c.stateNode.containerInfo,hc=!0;break e}c=c.return}if(null===lc)throw Error(o(160));fc(s,a,r),lc=null,hc=!1;var u=r.alternate;null!==u&&(u.return=null),r.return=null}catch(d){ku(r,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vc(t,e),t=t.sibling}function vc(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mc(t,e),yc(e),4&i){try{ic(3,e,e.return),rc(3,e)}catch(m){ku(e,e.return,m)}try{ic(5,e,e.return)}catch(m){ku(e,e.return,m)}}break;case 1:mc(t,e),yc(e),512&i&&null!==n&&ec(n,n.return);break;case 5:if(mc(t,e),yc(e),512&i&&null!==n&&ec(n,n.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(m){ku(e,e.return,m)}}if(4&i&&null!=(r=e.stateNode)){var s=e.memoizedProps,a=null!==n?n.memoizedProps:s,c=e.type,u=e.updateQueue;if(e.updateQueue=null,null!==u)try{"input"===c&&"radio"===s.type&&null!=s.name&&Y(r,s),we(c,a);var d=we(c,s);for(a=0;a<u.length;a+=2){var l=u[a],h=u[a+1];"style"===l?me(r,h):"dangerouslySetInnerHTML"===l?le(r,h):"children"===l?he(r,h):w(r,l,h,d)}switch(c){case"input":X(r,s);break;case"textarea":oe(r,s);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ne(r,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ne(r,!!s.multiple,s.defaultValue,!0):ne(r,!!s.multiple,s.multiple?[]:"",!1))}r[pr]=s}catch(m){ku(e,e.return,m)}}break;case 6:if(mc(t,e),yc(e),4&i){if(null===e.stateNode)throw Error(o(162));r=e.stateNode,s=e.memoizedProps;try{r.nodeValue=s}catch(m){ku(e,e.return,m)}}break;case 3:if(mc(t,e),yc(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Bt(t.containerInfo)}catch(m){ku(e,e.return,m)}break;case 4:default:mc(t,e),yc(e);break;case 13:mc(t,e),yc(e),8192&(r=e.child).flags&&(s=null!==r.memoizedState,r.stateNode.isHidden=s,!s||null!==r.alternate&&null!==r.alternate.memoizedState||(Bc=Ye())),4&i&&gc(e);break;case 22:if(l=null!==n&&null!==n.memoizedState,1&e.mode?(Ya=(d=Ya)||l,mc(t,e),Ya=d):mc(t,e),yc(e),8192&i){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!l&&0!==(1&e.mode))for(Za=e,l=e.child;null!==l;){for(h=Za=l;null!==Za;){switch(f=(p=Za).child,p.tag){case 0:case 11:case 14:case 15:ic(4,p,p.return);break;case 1:ec(p,p.return);var g=p.stateNode;if("function"===typeof g.componentWillUnmount){i=p,n=p.return;try{t=i,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(m){ku(i,n,m)}}break;case 5:ec(p,p.return);break;case 22:if(null!==p.memoizedState){Ic(h);continue}}null!==f?(f.return=p,Za=f):Ic(h)}l=l.sibling}e:for(l=null,h=e;;){if(5===h.tag){if(null===l){l=h;try{r=h.stateNode,d?"function"===typeof(s=r.style).setProperty?s.setProperty("display","none","important"):s.display="none":(c=h.stateNode,a=void 0!==(u=h.memoizedProps.style)&&null!==u&&u.hasOwnProperty("display")?u.display:null,c.style.display=ge("display",a))}catch(m){ku(e,e.return,m)}}}else if(6===h.tag){if(null===l)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(m){ku(e,e.return,m)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;l===h&&(l=null),h=h.return}l===h&&(l=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:mc(t,e),yc(e),4&i&&gc(e);case 21:}}function yc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ac(n)){var i=n;break e}n=n.return}throw Error(o(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(he(r,""),i.flags&=-33),dc(e,cc(e),r);break;case 3:case 4:var s=i.stateNode.containerInfo;uc(e,cc(e),s);break;default:throw Error(o(161))}}catch(a){ku(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function wc(e,t,n){Za=e,bc(e,t,n)}function bc(e,t,n){for(var i=0!==(1&e.mode);null!==Za;){var r=Za,o=r.child;if(22===r.tag&&i){var s=null!==r.memoizedState||Qa;if(!s){var a=r.alternate,c=null!==a&&null!==a.memoizedState||Ya;a=Qa;var u=Ya;if(Qa=s,(Ya=c)&&!u)for(Za=r;null!==Za;)c=(s=Za).child,22===s.tag&&null!==s.memoizedState?Cc(r):null!==c?(c.return=s,Za=c):Cc(r);for(;null!==o;)Za=o,bc(o,t,n),o=o.sibling;Za=r,Qa=a,Ya=u}_c(e)}else 0!==(8772&r.subtreeFlags)&&null!==o?(o.return=r,Za=o):_c(e)}}function _c(e){for(;null!==Za;){var t=Za;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ya||rc(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Ya)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:vo(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Lo(t,s,i);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Lo(t,a,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var l=d.memoizedState;if(null!==l){var h=l.dehydrated;null!==h&&Bt(h)}}}break;default:throw Error(o(163))}Ya||512&t.flags&&oc(t)}catch(p){ku(t,t.return,p)}}if(t===e){Za=null;break}if(null!==(n=t.sibling)){n.return=t.return,Za=n;break}Za=t.return}}function Ic(e){for(;null!==Za;){var t=Za;if(t===e){Za=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Za=n;break}Za=t.return}}function Cc(e){for(;null!==Za;){var t=Za;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rc(4,t)}catch(c){ku(t,n,c)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(c){ku(t,r,c)}}var o=t.return;try{oc(t)}catch(c){ku(t,o,c)}break;case 5:var s=t.return;try{oc(t)}catch(c){ku(t,s,c)}}}catch(c){ku(t,t.return,c)}if(t===e){Za=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Za=a;break}Za=t.return}}var Sc,kc=Math.ceil,xc=b.ReactCurrentDispatcher,Tc=b.ReactCurrentOwner,Ac=b.ReactCurrentBatchConfig,Ec=0,Pc=null,Mc=null,Rc=0,Nc=0,Oc=Sr(0),jc=0,Dc=null,Fc=0,Wc=0,Lc=0,Uc=null,qc=null,Bc=0,Gc=1/0,Hc=null,zc=!1,Vc=null,Jc=null,Kc=!1,$c=null,Qc=0,Yc=0,Xc=null,Zc=-1,eu=0;function tu(){return 0!==(6&Ec)?Ye():-1!==Zc?Zc:Zc=Ye()}function nu(e){return 0===(1&e.mode)?1:0!==(2&Ec)&&0!==Rc?Rc&-Rc:null!==mo.transition?(0===eu&&(eu=gt()),eu):0!==(e=wt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function iu(e,t,n,i){if(50<Yc)throw Yc=0,Xc=null,Error(o(185));vt(e,n,i),0!==(2&Ec)&&e===Pc||(e===Pc&&(0===(2&Ec)&&(Wc|=n),4===jc&&cu(e,Rc)),ru(e,i),1===n&&0===Ec&&0===(1&t.mode)&&(Gc=Ye()+500,Lr&&Br()))}function ru(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,c=r[s];-1===c?0!==(a&n)&&0===(a&i)||(r[s]=pt(a,t)):c<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var i=ht(e,e===Pc?Rc:0);if(0===i)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Lr=!0,qr(e)}(uu.bind(null,e)):qr(uu.bind(null,e)),sr((function(){0===(6&Ec)&&Br()})),n=null;else{switch(bt(i)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Pu(n,ou.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ou(e,t){if(Zc=-1,eu=0,0!==(6&Ec))throw Error(o(327));var n=e.callbackNode;if(Cu()&&e.callbackNode!==n)return null;var i=ht(e,e===Pc?Rc:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=vu(e,i);else{t=i;var r=Ec;Ec|=2;var s=gu();for(Pc===e&&Rc===t||(Hc=null,Gc=Ye()+500,pu(e,t));;)try{wu();break}catch(c){fu(e,c)}Io(),xc.current=s,Ec=r,null!==Mc?t=0:(Pc=null,Rc=0,t=jc)}if(0!==t){if(2===t&&(0!==(r=ft(e))&&(i=r,t=su(e,r))),1===t)throw n=Dc,pu(e,0),cu(e,i),ru(e,Ye()),n;if(6===t)cu(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!ai(o(),r))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=vu(e,i))&&(0!==(s=ft(e))&&(i=s,t=su(e,s))),1===t))throw n=Dc,pu(e,0),cu(e,i),ru(e,Ye()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(o(345));case 2:case 5:Iu(e,qc,Hc);break;case 3:if(cu(e,i),(130023424&i)===i&&10<(t=Bc+500-Ye())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&i)!==i){tu(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(Iu.bind(null,e,qc,Hc),t);break}Iu(e,qc,Hc);break;case 4:if(cu(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var a=31-st(i);s=1<<a,(a=t[a])>r&&(r=a),i&=~s}if(i=r,10<(i=(120>(i=Ye()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*kc(i/1960))-i)){e.timeoutHandle=ir(Iu.bind(null,e,qc,Hc),i);break}Iu(e,qc,Hc);break;default:throw Error(o(329))}}}return ru(e,Ye()),e.callbackNode===n?ou.bind(null,e):null}function su(e,t){var n=Uc;return e.current.memoizedState.isDehydrated&&(pu(e,t).flags|=256),2!==(e=vu(e,t))&&(t=qc,qc=n,null!==t&&au(t)),e}function au(e){null===qc?qc=e:qc.push.apply(qc,e)}function cu(e,t){for(t&=~Lc,t&=~Wc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),i=1<<n;e[n]=-1,t&=~i}}function uu(e){if(0!==(6&Ec))throw Error(o(327));Cu();var t=ht(e,0);if(0===(1&t))return ru(e,Ye()),null;var n=vu(e,t);if(0!==e.tag&&2===n){var i=ft(e);0!==i&&(t=i,n=su(e,i))}if(1===n)throw n=Dc,pu(e,0),cu(e,t),ru(e,Ye()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Iu(e,qc,Hc),ru(e,Ye()),null}function du(e,t){var n=Ec;Ec|=1;try{return e(t)}finally{0===(Ec=n)&&(Gc=Ye()+500,Lr&&Br())}}function lu(e){null!==$c&&0===$c.tag&&0===(6&Ec)&&Cu();var t=Ec;Ec|=1;var n=Ac.transition,i=wt;try{if(Ac.transition=null,wt=1,e)return e()}finally{wt=i,Ac.transition=n,0===(6&(Ec=t))&&Br()}}function hu(){Nc=Oc.current,kr(Oc)}function pu(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Mc)for(n=Mc.return;null!==n;){var i=n;switch(to(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Nr();break;case 3:os(),kr(Er),kr(Ar),ls();break;case 5:as(i);break;case 4:os();break;case 13:case 19:kr(cs);break;case 10:Co(i.type._context);break;case 22:case 23:hu()}n=n.return}if(Pc=e,Mc=e=Ou(e.current,null),Rc=Nc=t,jc=0,Dc=null,Lc=Wc=Fc=0,qc=Uc=null,null!==To){for(t=0;t<To.length;t++)if(null!==(i=(n=To[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var s=o.next;o.next=r,i.next=s}n.pending=i}To=null}return e}function fu(e,t){for(;;){var n=Mc;try{if(Io(),hs.current=sa,ys){for(var i=gs.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}ys=!1}if(fs=0,vs=ms=gs=null,ws=!1,bs=0,Tc.current=null,null===n||null===n.return){jc=1,Dc=t,Mc=null;break}e:{var s=e,a=n.return,c=n,u=t;if(t=Rc,c.flags|=32768,null!==u&&"object"===typeof u&&"function"===typeof u.then){var d=u,l=c,h=l.tag;if(0===(1&l.mode)&&(0===h||11===h||15===h)){var p=l.alternate;p?(l.updateQueue=p.updateQueue,l.memoizedState=p.memoizedState,l.lanes=p.lanes):(l.updateQueue=null,l.memoizedState=null)}var f=va(a);if(null!==f){f.flags&=-257,ya(f,a,c,0,t),1&f.mode&&ma(s,d,t),u=d;var g=(t=f).updateQueue;if(null===g){var m=new Set;m.add(u),t.updateQueue=m}else g.add(u);break e}if(0===(1&t)){ma(s,d,t),mu();break e}u=Error(o(426))}else if(ro&&1&c.mode){var v=va(a);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),ya(v,a,c,0,t),go(da(u,c));break e}}s=u=da(u,c),4!==jc&&(jc=2),null===Uc?Uc=[s]:Uc.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Fo(s,fa(0,u,t));break e;case 1:c=u;var y=s.type,w=s.stateNode;if(0===(128&s.flags)&&("function"===typeof y.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===Jc||!Jc.has(w)))){s.flags|=65536,t&=-t,s.lanes|=t,Fo(s,ga(s,c,t));break e}}s=s.return}while(null!==s)}_u(n)}catch(b){t=b,Mc===n&&null!==n&&(Mc=n=n.return);continue}break}}function gu(){var e=xc.current;return xc.current=sa,null===e?sa:e}function mu(){0!==jc&&3!==jc&&2!==jc||(jc=4),null===Pc||0===(268435455&Fc)&&0===(268435455&Wc)||cu(Pc,Rc)}function vu(e,t){var n=Ec;Ec|=2;var i=gu();for(Pc===e&&Rc===t||(Hc=null,pu(e,t));;)try{yu();break}catch(r){fu(e,r)}if(Io(),Ec=n,xc.current=i,null!==Mc)throw Error(o(261));return Pc=null,Rc=0,jc}function yu(){for(;null!==Mc;)bu(Mc)}function wu(){for(;null!==Mc&&!$e();)bu(Mc)}function bu(e){var t=Sc(e.alternate,e,Nc);e.memoizedProps=e.pendingProps,null===t?_u(e):Mc=t,Tc.current=null}function _u(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ka(n,t,Nc)))return void(Mc=n)}else{if(null!==(n=$a(n,t)))return n.flags&=32767,void(Mc=n);if(null===e)return jc=6,void(Mc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Mc=t);Mc=t=e}while(null!==t);0===jc&&(jc=5)}function Iu(e,t,n){var i=wt,r=Ac.transition;try{Ac.transition=null,wt=1,function(e,t,n,i){do{Cu()}while(null!==$c);if(0!==(6&Ec))throw Error(o(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-st(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,s),e===Pc&&(Mc=Pc=null,Rc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Kc||(Kc=!0,Pu(tt,(function(){return Cu(),null}))),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Ac.transition,Ac.transition=null;var a=wt;wt=1;var c=Ec;Ec|=4,Tc.current=null,function(e,t){if(er=Ht,pi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch(_){n=null;break e}var a=0,c=-1,u=-1,d=0,l=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==r&&3!==h.nodeType||(c=a+r),h!==s||0!==i&&3!==h.nodeType||(u=a+i),3===h.nodeType&&(a+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++d===r&&(c=a),p===s&&++l===i&&(u=a),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===c||-1===u?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Ht=!1,Za=t;null!==Za;)if(e=(t=Za).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Za=e;else for(;null!==Za;){t=Za;try{var g=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,v=g.memoizedState,y=t.stateNode,w=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:vo(t.type,m),v);y.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(o(163))}}catch(_){ku(t,t.return,_)}if(null!==(e=t.sibling)){e.return=t.return,Za=e;break}Za=t.return}g=nc,nc=!1}(e,n),vc(n,e),fi(tr),Ht=!!er,tr=er=null,e.current=n,wc(n,e,r),Qe(),Ec=c,wt=a,Ac.transition=s}else e.current=n;if(Kc&&(Kc=!1,$c=e,Qc=r),s=e.pendingLanes,0===s&&(Jc=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ru(e,Ye()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(zc)throw zc=!1,e=Vc,Vc=null,e;0!==(1&Qc)&&0!==e.tag&&Cu(),s=e.pendingLanes,0!==(1&s)?e===Xc?Yc++:(Yc=0,Xc=e):Yc=0,Br()}(e,t,n,i)}finally{Ac.transition=r,wt=i}return null}function Cu(){if(null!==$c){var e=bt(Qc),t=Ac.transition,n=wt;try{if(Ac.transition=null,wt=16>e?16:e,null===$c)var i=!1;else{if(e=$c,$c=null,Qc=0,0!==(6&Ec))throw Error(o(331));var r=Ec;for(Ec|=4,Za=e.current;null!==Za;){var s=Za,a=s.child;if(0!==(16&Za.flags)){var c=s.deletions;if(null!==c){for(var u=0;u<c.length;u++){var d=c[u];for(Za=d;null!==Za;){var l=Za;switch(l.tag){case 0:case 11:case 15:ic(8,l,s)}var h=l.child;if(null!==h)h.return=l,Za=h;else for(;null!==Za;){var p=(l=Za).sibling,f=l.return;if(sc(l),l===d){Za=null;break}if(null!==p){p.return=f,Za=p;break}Za=f}}}var g=s.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(null!==m)}}Za=s}}if(0!==(2064&s.subtreeFlags)&&null!==a)a.return=s,Za=a;else e:for(;null!==Za;){if(0!==(2048&(s=Za).flags))switch(s.tag){case 0:case 11:case 15:ic(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,Za=y;break e}Za=s.return}}var w=e.current;for(Za=w;null!==Za;){var b=(a=Za).child;if(0!==(2064&a.subtreeFlags)&&null!==b)b.return=a,Za=b;else e:for(a=w;null!==Za;){if(0!==(2048&(c=Za).flags))try{switch(c.tag){case 0:case 11:case 15:rc(9,c)}}catch(I){ku(c,c.return,I)}if(c===a){Za=null;break e}var _=c.sibling;if(null!==_){_.return=c.return,Za=_;break e}Za=c.return}}if(Ec=r,Br(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(rt,e)}catch(I){}i=!0}return i}finally{wt=n,Ac.transition=t}}return!1}function Su(e,t,n){e=jo(e,t=fa(0,t=da(n,t),1),1),t=tu(),null!==e&&(vt(e,1,t),ru(e,t))}function ku(e,t,n){if(3===e.tag)Su(e,e,n);else for(;null!==t;){if(3===t.tag){Su(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Jc||!Jc.has(i))){t=jo(t,e=ga(t,e=da(n,e),1),1),e=tu(),null!==t&&(vt(t,1,e),ru(t,e));break}}t=t.return}}function xu(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tu(),e.pingedLanes|=e.suspendedLanes&n,Pc===e&&(Rc&n)===n&&(4===jc||3===jc&&(130023424&Rc)===Rc&&500>Ye()-Bc?pu(e,0):Lc|=n),ru(e,t)}function Tu(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var n=tu();null!==(e=Po(e,t))&&(vt(e,t,n),ru(e,n))}function Au(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tu(e,n)}function Eu(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(t),Tu(e,n)}function Pu(e,t){return Je(e,t)}function Mu(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ru(e,t,n,i){return new Mu(e,t,n,i)}function Nu(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ou(e,t){var n=e.alternate;return null===n?((n=Ru(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ju(e,t,n,i,r,s){var a=2;if(i=e,"function"===typeof e)Nu(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case C:return Du(n.children,r,s,t);case S:a=8,r|=8;break;case k:return(e=Ru(12,n,t,2|r)).elementType=k,e.lanes=s,e;case E:return(e=Ru(13,n,t,r)).elementType=E,e.lanes=s,e;case P:return(e=Ru(19,n,t,r)).elementType=P,e.lanes=s,e;case N:return Fu(n,r,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case x:a=10;break e;case T:a=9;break e;case A:a=11;break e;case M:a=14;break e;case R:a=16,i=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Ru(a,n,t,r)).elementType=e,t.type=i,t.lanes=s,t}function Du(e,t,n,i){return(e=Ru(7,e,i,t)).lanes=n,e}function Fu(e,t,n,i){return(e=Ru(22,e,i,t)).elementType=N,e.lanes=n,e.stateNode={isHidden:!1},e}function Wu(e,t,n){return(e=Ru(6,e,null,t)).lanes=n,e}function Lu(e,t,n){return(t=Ru(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uu(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function qu(e,t,n,i,r,o,s,a,c){return e=new Uu(e,t,n,a,c),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Ru(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ro(o),e}function Bu(e){if(!e)return Tr;e:{if(Be(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Rr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Rr(n))return jr(e,n,t)}return t}function Gu(e,t,n,i,r,o,s,a,c){return(e=qu(n,i,!0,e,0,o,0,a,c)).context=Bu(null),n=e.current,(o=Oo(i=tu(),r=nu(n))).callback=void 0!==t&&null!==t?t:null,jo(n,o,r),e.current.lanes=r,vt(e,r,i),ru(e,i),e}function Hu(e,t,n,i){var r=t.current,o=tu(),s=nu(r);return n=Bu(n),null===t.context?t.context=n:t.pendingContext=n,(t=Oo(o,s)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=jo(r,t,s))&&(iu(e,r,s,o),Do(e,r,s)),s}function zu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Vu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Ju(e,t){Vu(e,t),(e=e.alternate)&&Vu(e,t)}Sc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Er.current)ba=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ba=!1,function(e,t,n){switch(t.tag){case 3:Pa(t),fo();break;case 5:ss(t);break;case 1:Rr(t.type)&&Dr(t);break;case 4:rs(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;xr(yo,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(xr(cs,1&cs.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Wa(e,t,n):(xr(cs,1&cs.current),null!==(e=za(e,t,n))?e.sibling:null);xr(cs,1&cs.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Ga(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),xr(cs,cs.current),i)break;return null;case 22:case 23:return t.lanes=0,ka(e,t,n)}return za(e,t,n)}(e,t,n);ba=0!==(131072&e.flags)}else ba=!1,ro&&0!==(1048576&t.flags)&&Zr(t,Vr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ha(e,t),e=t.pendingProps;var r=Mr(t,Ar.current);ko(t,n),r=Ss(null,t,i,e,r,n);var s=ks();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Rr(i)?(s=!0,Dr(t)):s=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ro(t),r.updater=Bo,t.stateNode=r,r._reactInternals=t,Vo(t,i,e,n),t=Ea(null,t,i,!0,s,n)):(t.tag=0,ro&&s&&eo(t),_a(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Ha(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Nu(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===M)return 14}return 2}(i),e=vo(i,e),r){case 0:t=Ta(null,t,i,e,n);break e;case 1:t=Aa(null,t,i,e,n);break e;case 11:t=Ia(null,t,i,e,n);break e;case 14:t=Ca(null,t,i,vo(i.type,e),n);break e}throw Error(o(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Ta(e,t,i,r=t.elementType===i?r:vo(i,r),n);case 1:return i=t.type,r=t.pendingProps,Aa(e,t,i,r=t.elementType===i?r:vo(i,r),n);case 3:e:{if(Pa(t),null===e)throw Error(o(387));i=t.pendingProps,r=(s=t.memoizedState).element,No(e,t),Wo(t,i,null,n);var a=t.memoizedState;if(i=a.element,s.isDehydrated){if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Ma(e,t,i,n,r=da(Error(o(423)),t));break e}if(i!==r){t=Ma(e,t,i,n,r=da(Error(o(424)),t));break e}for(io=ur(t.stateNode.containerInfo.firstChild),no=t,ro=!0,oo=null,n=Xo(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),i===r){t=za(e,t,n);break e}_a(e,t,i,n)}t=t.child}return t;case 5:return ss(t),null===e&&uo(t),i=t.type,r=t.pendingProps,s=null!==e?e.memoizedProps:null,a=r.children,nr(i,r)?a=null:null!==s&&nr(i,s)&&(t.flags|=32),xa(e,t),_a(e,t,a,n),t.child;case 6:return null===e&&uo(t),null;case 13:return Wa(e,t,n);case 4:return rs(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Yo(t,null,i,n):_a(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Ia(e,t,i,r=t.elementType===i?r:vo(i,r),n);case 7:return _a(e,t,t.pendingProps,n),t.child;case 8:case 12:return _a(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,s=t.memoizedProps,a=r.value,xr(yo,i._currentValue),i._currentValue=a,null!==s)if(ai(s.value,a)){if(s.children===r.children&&!Er.current){t=za(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var c=s.dependencies;if(null!==c){a=s.child;for(var u=c.firstContext;null!==u;){if(u.context===i){if(1===s.tag){(u=Oo(-1,n&-n)).tag=2;var d=s.updateQueue;if(null!==d){var l=(d=d.shared).pending;null===l?u.next=u:(u.next=l.next,l.next=u),d.pending=u}}s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),So(s.return,n,t),c.lanes|=n;break}u=u.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),So(a,n,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}_a(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,ko(t,n),i=i(r=xo(r)),t.flags|=1,_a(e,t,i,n),t.child;case 14:return r=vo(i=t.type,t.pendingProps),Ca(e,t,i,r=vo(i.type,r),n);case 15:return Sa(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:vo(i,r),Ha(e,t),t.tag=1,Rr(i)?(e=!0,Dr(t)):e=!1,ko(t,n),Ho(t,i,r),Vo(t,i,r,n),Ea(null,t,i,!0,e,n);case 19:return Ga(e,t,n);case 22:return ka(e,t,n)}throw Error(o(156,t.tag))};var Ku="function"===typeof reportError?reportError:function(e){console.error(e)};function $u(e){this._internalRoot=e}function Qu(e){this._internalRoot=e}function Yu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Xu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zu(){}function ed(e,t,n,i,r){var o=n._reactRootContainer;if(o){var s=o;if("function"===typeof r){var a=r;r=function(){var e=zu(s);a.call(e)}}Hu(t,s,e,r)}else s=function(e,t,n,i,r){if(r){if("function"===typeof i){var o=i;i=function(){var e=zu(s);o.call(e)}}var s=Gu(t,i,e,0,null,!1,0,"",Zu);return e._reactRootContainer=s,e[fr]=s.current,Bi(8===e.nodeType?e.parentNode:e),lu(),s}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var a=i;i=function(){var e=zu(c);a.call(e)}}var c=qu(e,0,!1,null,0,!1,0,"",Zu);return e._reactRootContainer=c,e[fr]=c.current,Bi(8===e.nodeType?e.parentNode:e),lu((function(){Hu(t,c,n,i)})),c}(n,t,e,r,i);return zu(s)}Qu.prototype.render=$u.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Hu(e,t,null,null)},Qu.prototype.unmount=$u.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;lu((function(){Hu(null,e,null,null)})),t[fr]=null}},Qu.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Nt.length&&0!==t&&t<Nt[n].priority;n++);Nt.splice(n,0,e),0===n&&Ft(e)}},_t=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=lt(t.pendingLanes);0!==n&&(yt(t,1|n),ru(t,Ye()),0===(6&Ec)&&(Gc=Ye()+500,Br()))}break;case 13:lu((function(){var t=Po(e,1);if(null!==t){var n=tu();iu(t,e,1,n)}})),Ju(e,1)}},It=function(e){if(13===e.tag){var t=Po(e,134217728);if(null!==t)iu(t,e,134217728,tu());Ju(e,134217728)}},Ct=function(e){if(13===e.tag){var t=nu(e),n=Po(e,t);if(null!==n)iu(n,e,t,tu());Ju(e,t)}},St=function(){return wt},kt=function(e,t){var n=wt;try{return wt=e,t()}finally{wt=n}},Ie=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=_r(i);if(!r)throw Error(o(90));J(i),X(i,r)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ae=du,Ee=lu;var td={usingClientEntryPoint:!1,Events:[wr,br,_r,xe,Te,du]},nd={findFiberByHostInstance:yr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},id={bundleType:nd.bundleType,version:nd.version,rendererPackageName:nd.rendererPackageName,rendererConfig:nd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=ze(e))?null:e.stateNode},findFiberByHostInstance:nd.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rd.isDisabled&&rd.supportsFiber)try{rt=rd.inject(id),ot=rd}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=td,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yu(t))throw Error(o(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:I,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Yu(e))throw Error(o(299));var n=!1,i="",r=Ku;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=qu(e,1,!1,null,0,n,0,i,r),e[fr]=t.current,Bi(8===e.nodeType?e.parentNode:e),new $u(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=ze(t))?null:e.stateNode},t.flushSync=function(e){return lu(e)},t.hydrate=function(e,t,n){if(!Xu(t))throw Error(o(200));return ed(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yu(e))throw Error(o(405));var i=null!=n&&n.hydratedSources||null,r=!1,s="",a=Ku;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Gu(t,null,e,1,null!=n?n:null,r,0,s,a),e[fr]=t.current,Bi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Qu(t)},t.render=function(e,t,n){if(!Xu(t))throw Error(o(200));return ed(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Xu(e))throw Error(o(40));return!!e._reactRootContainer&&(lu((function(){ed(null,null,e,!1,(function(){e._reactRootContainer=null,e[fr]=null}))})),!0)},t.unstable_batchedUpdates=du,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Xu(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return ed(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},250:(e,t,n)=>{"use strict";var i=n(164);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},164:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},374:(e,t,n)=>{"use strict";var i=n(791),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var i,o={},u=null,d=null;for(i in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(d=t.ref),t)s.call(t,i)&&!c.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:r,type:e,key:u,ref:d,props:o,_owner:a.current}}t.Fragment=o,t.jsx=u,t.jsxs=u},117:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}function y(){}function w(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var b=w.prototype=new y;b.constructor=w,g(b,v.prototype),b.isPureReactComponent=!0;var _=Array.isArray,I=Object.prototype.hasOwnProperty,C={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,i){var r,o={},s=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)I.call(t,r)&&!S.hasOwnProperty(r)&&(o[r]=t[r]);var c=arguments.length-2;if(1===c)o.children=i;else if(1<c){for(var u=Array(c),d=0;d<c;d++)u[d]=arguments[d+2];o.children=u}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===o[r]&&(o[r]=c[r]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:C.current}}function x(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function E(e,t,r,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case i:c=!0}}if(c)return s=s(c=e),e=""===o?"."+A(c,0):o,_(s)?(r="",null!=e&&(r=e.replace(T,"$&/")+"/"),E(s,t,r,"",(function(e){return e}))):null!=s&&(x(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,r+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(T,"$&/")+"/")+e)),t.push(s)),1;if(c=0,o=""===o?".":o+":",_(e))for(var u=0;u<e.length;u++){var d=o+A(a=e[u],u);c+=E(a,t,r,d,s)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),u=0;!(a=e.next()).done;)c+=E(a=a.value,t,r,d=o+A(a,u++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function P(e,t,n){if(null==e)return e;var i=[],r=0;return E(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function M(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R={current:null},N={transition:null},O={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:N,ReactCurrentOwner:C};t.Children={map:P,forEach:function(e,t,n){P(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!x(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=s,t.PureComponent=w,t.StrictMode=o,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=g({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=C.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)I.call(t,u)&&!S.hasOwnProperty(u)&&(r[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)r.children=i;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:n,type:e.type,key:o,ref:s,props:r,_owner:a}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=x,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:M}},t.memo=function(e,t){return{$$typeof:l,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=N.transition;N.transition={};try{e()}finally{N.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return R.current.useCallback(e,t)},t.useContext=function(e){return R.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return R.current.useDeferredValue(e)},t.useEffect=function(e,t){return R.current.useEffect(e,t)},t.useId=function(){return R.current.useId()},t.useImperativeHandle=function(e,t,n){return R.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return R.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return R.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return R.current.useMemo(e,t)},t.useReducer=function(e,t,n){return R.current.useReducer(e,t,n)},t.useRef=function(e){return R.current.useRef(e)},t.useState=function(e){return R.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return R.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return R.current.useTransition()},t.version="18.2.0"},791:(e,t,n)=>{"use strict";e.exports=n(117)},184:(e,t,n)=>{"use strict";e.exports=n(374)},813:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,s=r>>>1;i<s;){var a=2*(i+1)-1,c=e[a],u=a+1,d=e[u];if(0>o(c,n))u<r&&0>o(d,c)?(e[i]=d,e[u]=n,i=u):(e[i]=c,e[a]=n,i=a);else{if(!(u<r&&0>o(d,n)))break e;e[i]=d,e[u]=n,i=u}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,c=a.now();t.unstable_now=function(){return a.now()-c}}var u=[],d=[],l=1,h=null,p=3,f=!1,g=!1,m=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,w="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=i(d);null!==t;){if(null===t.callback)r(d);else{if(!(t.startTime<=e))break;r(d),t.sortIndex=t.expirationTime,n(u,t)}t=i(d)}}function _(e){if(m=!1,b(e),!g)if(null!==i(u))g=!0,N(I);else{var t=i(d);null!==t&&O(_,t.startTime-e)}}function I(e,n){g=!1,m&&(m=!1,y(x),x=-1),f=!0;var o=p;try{for(b(n),h=i(u);null!==h&&(!(h.expirationTime>n)||e&&!E());){var s=h.callback;if("function"===typeof s){h.callback=null,p=h.priorityLevel;var a=s(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?h.callback=a:h===i(u)&&r(u),b(n)}else r(u);h=i(u)}if(null!==h)var c=!0;else{var l=i(d);null!==l&&O(_,l.startTime-n),c=!1}return c}finally{h=null,p=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var C,S=!1,k=null,x=-1,T=5,A=-1;function E(){return!(t.unstable_now()-A<T)}function P(){if(null!==k){var e=t.unstable_now();A=e;var n=!0;try{n=k(!0,e)}finally{n?C():(S=!1,k=null)}}else S=!1}if("function"===typeof w)C=function(){w(P)};else if("undefined"!==typeof MessageChannel){var M=new MessageChannel,R=M.port2;M.port1.onmessage=P,C=function(){R.postMessage(null)}}else C=function(){v(P,0)};function N(e){k=e,S||(S=!0,C())}function O(e,n){x=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,N(I))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(u)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:l++,callback:r,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(d,e),null===i(u)&&e===i(d)&&(m?(y(x),x=-1):m=!0,O(_,o-s))):(e.sortIndex=a,n(u,e),g||f||(g=!0,N(I))),e},t.unstable_shouldYield=E,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},296:(e,t,n)=>{"use strict";e.exports=n(813)},559:e=>{"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,i)=>(n.f[i](e,t),t)),[])),n.u=e=>"static/js/"+e+".17e09523.chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="intents-resolver:";n.l=(i,r,o,s)=>{if(e[i])e[i].push(r);else{var a,c;if(void 0!==o)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var l=u[d];if(l.getAttribute("src")==i||l.getAttribute("data-webpack")==t+o){a=l;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+o),a.src=i),e[i]=[r];var h=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var r=e[i];if(delete e[i],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(n))),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="./",(()=>{var e={179:0};n.f.j=(t,i)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var o=new Promise(((n,i)=>r=e[t]=[n,i]));i.push(r[2]=o);var s=n.p+n.u(t),a=new Error;n.l(s,(i=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,r[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var r,o,s=i[0],a=i[1],c=i[2],u=0;if(s.some((t=>0!==e[t]))){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(c)c(n)}for(t&&t(i);u<s.length;u++)o=s[u],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},i=self.webpackChunkintents_resolver=self.webpackChunkintents_resolver||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e=n(791),t=n(250),i=n(7);function r(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}const o=(0,e.createContext)(null),s=(0,e.memo)((t=>{let{children:n,fallback:i=null,settings:s={}}=t;const a=(t=>{const[n,i]=(0,e.useState)(null);return(0,e.useEffect)((()=>{r(void 0,void 0,void 0,(function*(){var e,n,r,o,s,a,c,u,d,l;try{if(t.browser&&t.browserPlatform)throw new Error("Cannot initialize, because the settings are over-specified: defined are both browser and browserPlatform. Please set one or the other");if("undefined"!==typeof window.glue42gd||"undefined"!==typeof window.iodesktop){const c=(null===(e=t.desktop)||void 0===e?void 0:e.factory)||(null===(n=t.browser)||void 0===n?void 0:n.factory)||(null===(r=t.browserPlatform)||void 0===r?void 0:r.factory)||window.Glue,u=(null===(o=t.desktop)||void 0===o?void 0:o.config)||(null===(s=t.browser)||void 0===s?void 0:s.config)||(null===(a=t.browserPlatform)||void 0===a?void 0:a.config),d=yield c(u);return void i(d.io||d.glue||d)}const h=(null===(c=t.browser)||void 0===c?void 0:c.config)||(null===(u=t.browserPlatform)||void 0===u?void 0:u.config),p=(null===(d=t.browser)||void 0===d?void 0:d.factory)||(null===(l=t.browserPlatform)||void 0===l?void 0:l.factory)||window.IOBrowser||window.IOBrowserPlatform,f=yield p(h);i(f.io||f.glue||f)}catch(h){console.error(h)}}))}),[]),n})(s);return a?e.createElement(o.Provider,{value:a},n):e.createElement(e.Fragment,null,i)}));s.propTypes={children:i.node,settings:i.object,fallback:i.node},s.displayName="IOConnectProvider";var a=n(184);const c=()=>{const t=(0,e.useContext)(o);window.io=t;const[n,i]=(0,e.useState)([]),r=async e=>{const i=n.find((t=>t.id===e));await t.intents.resolver.sendResponse(i)};return(0,e.useEffect)((()=>{(async()=>{var e;const n=await(null===(e=t.themes)||void 0===e?void 0:e.getCurrent());if(!n)return;document.querySelector("html").classList.add(n.name)})(),t.intents.resolver.onHandlerAdded((e=>{i((t=>[...t,{...e,id:e.instanceId||e.applicationName,title:e.applicationTitle}]))})),t.intents.resolver.onHandlerRemoved((e=>{i((t=>{const n={...e,id:"app"===e.type?e.applicationName:e.instanceId};return t.filter((e=>e.id!==n.id))}))}))}),[]),(0,e.useEffect)((()=>{(async()=>{const e=document.querySelector("html").getBoundingClientRect().height;if(e>800)return;const n=t.windows.my();window.iobrowser?n.moveResize({height:e+100,width:400}):n.resizeTo(void 0,e+50)})()}),[n]),(0,a.jsxs)("div",{className:"container-fluid",children:[!t&&(0,a.jsx)("div",{className:"tick42-loader active",children:(0,a.jsx)("div",{className:"tick42-loader-text",children:"Loading ..."})}),(0,a.jsx)("div",{className:"row mt-3",style:{cursor:"default"},children:(0,a.jsx)("div",{className:"col",children:(0,a.jsxs)("h3",{style:{margin:0},children:["Choose an app to ","object"===typeof t.intents.resolver.intent?t.intents.resolver.intent.intent:t.intents.resolver.intent]})})}),!!n.filter((e=>!e.instanceId)).length&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"row mt-3",children:(0,a.jsx)("div",{className:"col",children:(0,a.jsx)("h5",{children:"Start new:"})})}),(0,a.jsx)("ul",{className:"list-group",children:n.filter((e=>!e.instanceId)).map((e=>(0,a.jsxs)("li",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center",onClick:()=>r(e.id),style:{cursor:"pointer"},children:[(0,a.jsxs)("span",{children:[e.applicationIcon?(0,a.jsx)("img",{src:"data:image/png;base64, "+e.applicationIcon,alt:"",style:{width:16},className:"mr-3"}):(0,a.jsx)("i",{className:"icon-app mr-3"}),e.title||e.applicationName]}),(0,a.jsx)("span",{className:"badge badge-info badge-pill",children:"app"})]},e.id)))})]}),!!n.filter((e=>e.instanceId)).length&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"row mt-3",children:(0,a.jsx)("div",{className:"col",children:(0,a.jsx)("h5",{children:"Use already running:"})})}),(0,a.jsx)("ul",{className:"list-group",children:n.filter((e=>e.instanceId)).map((e=>(0,a.jsxs)("li",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center",onClick:()=>r(e.id),style:{cursor:"pointer"},children:[(0,a.jsxs)("span",{children:[e.applicationIcon?(0,a.jsx)("img",{src:"data:image/png;base64, "+e.applicationIcon,alt:"",style:{width:16},className:"mr-3"}):(0,a.jsx)("i",{className:"icon-app mr-3"}),e.title||e.applicationName]}),(0,a.jsx)("span",{className:"badge badge-secondary badge-pill",children:"inst"})]},e.id)))})]})]})},u=e=>{e&&e instanceof Function&&n.e(787).then(n.bind(n,787)).then((t=>{let{getCLS:n,getFID:i,getFCP:r,getLCP:o,getTTFB:s}=t;n(e),i(e),r(e),o(e),s(e)}))};function d(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}function l(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}const h={logger:"info",gateway:{webPlatform:{}},libraries:[],exposeAPI:!0};var p=function(e){return{ok:!0,result:e}},f=function(e){return{ok:!1,error:e}},g=function(e,t,n){return!1===t.ok?t:!1===n.ok?n:p(e(t.result,n.result))},m=function(e,t){return!0===t.ok?t:f(e(t.error))},v=function(){return v=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},v.apply(this,arguments)};function y(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if(typeof e!==typeof t)return!1;if("object"===typeof e){if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!y(e[n],t[n]))return!1;return!0}var i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(n=0;n<i.length;n++){if(!t.hasOwnProperty(i[n]))return!1;if(!y(e[i[n]],t[i[n]]))return!1}return!0}}var w=function(e){return Array.isArray(e)},b=function(e){return"object"===typeof e&&null!==e&&!w(e)},_=function(e,t){return"expected "+e+", got "+function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}}(t)},I=function(e){return e.map((function(e){return"string"===typeof e?"."+e:"["+e+"]"})).join("")},C=function(e,t){var n=t.at,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(t,["at"]);return v({at:e+(n||"")},i)},S=function(){function e(t){var n=this;this.decode=t,this.run=function(e){return m((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),n.decode(e))},this.runPromise=function(e){return!0===(t=n.run(e)).ok?Promise.resolve(t.result):Promise.reject(t.error);var t},this.runWithException=function(e){return function(e){if(!0===e.ok)return e.result;throw e.error}(n.run(e))},this.map=function(t){return new e((function(e){return function(e,t){return!0===t.ok?p(e(t.result)):t}(t,n.decode(e))}))},this.andThen=function(t){return new e((function(e){return function(e,t){return!0===t.ok?e(t.result):t}((function(n){return t(n).decode(e)}),n.decode(e))}))},this.where=function(t,i){return n.andThen((function(n){return t(n)?e.succeed(n):e.fail(i)}))}}return e.string=function(){return new e((function(e){return"string"===typeof e?p(e):f({message:_("a string",e)})}))},e.number=function(){return new e((function(e){return"number"===typeof e?p(e):f({message:_("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"===typeof e?p(e):f({message:_("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return y(e,t)?p(t):f({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(b(e)&&t){var n={};for(var i in t)if(t.hasOwnProperty(i)){var r=t[i].decode(e[i]);if(!0!==r.ok)return void 0===e[i]?f({message:"the key '"+i+"' is required but was not present"}):f(C("."+i,r.error));void 0!==r.result&&(n[i]=r.result)}return p(n)}return b(e)?p(e):f({message:_("an object",e)})}))},e.array=function(t){return new e((function(e){if(w(e)&&t){return e.reduce((function(e,n,i){return g((function(e,t){return e.concat([t])}),e,function(e,n){return m((function(e){return C("["+n+"]",e)}),t.decode(e))}(n,i))}),p([]))}return w(e)?p(e):f({message:_("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(w(e)){if(e.length!==t.length)return f({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var n=[],i=0;i<t.length;i++){var r=t[i].decode(e[i]);if(!r.ok)return f(C("["+i+"]",r.error));n[i]=r.result}return p(n)}return f({message:_("a tuple of length "+t.length,e)})}))},e.union=function(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.oneOf.apply(e,[t,n].concat(i))},e.intersection=function(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return new e((function(e){return[t,n].concat(i).reduce((function(t,n){return g(Object.assign,t,n.decode(e))}),p({}))}))},e.anyJson=function(){return new e((function(e){return p(e)}))},e.unknownJson=function(){return new e((function(e){return p(e)}))},e.dict=function(t){return new e((function(e){if(b(e)){var n={};for(var i in e)if(e.hasOwnProperty(i)){var r=t.decode(e[i]);if(!0!==r.ok)return f(C("."+i,r.error));n[i]=r.result}return p(n)}return f({message:_("an object",e)})}))},e.optional=function(t){return new e((function(e){return void 0===e||null===e?p(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new e((function(e){for(var n=[],i=0;i<t.length;i++){var r=t[i].decode(e);if(!0===r.ok)return r;n[i]=r.error}var o=n.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return f({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},e.withDefault=function(t,n){return new e((function(e){return p(function(e,t){return!0===t.ok?t.result:e}(t,n.decode(e)))}))},e.valueAt=function(t,n){return new e((function(e){for(var i=e,r=0;r<t.length;r++){if(void 0===i)return f({at:I(t.slice(0,r+1)),message:"path does not exist"});if("string"===typeof t[r]&&!b(i))return f({at:I(t.slice(0,r+1)),message:_("an object",i)});if("number"===typeof t[r]&&!w(i))return f({at:I(t.slice(0,r+1)),message:_("an array",i)});i=i[t[r]]}return m((function(e){return void 0===i?{at:I(t),message:"path does not exist"}:C(I(t),e)}),n.decode(i))}))},e.succeed=function(t){return new e((function(e){return p(t)}))},e.fail=function(t){return new e((function(e){return f({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),k=S.string,x=S.number,T=S.boolean,A=S.anyJson;S.unknownJson;var E=S.constant,P=S.object,M=S.array;S.tuple,S.dict;var R=S.optional,N=S.oneOf;S.union,S.intersection,S.withDefault,S.valueAt,S.succeed,S.fail;var O=S.lazy;const j=["name","title","version","customProperties","icon","caption","type"],D=["appId","name","type","details","version","title","tooltip","lang","description","categories","icons","screenshots","contactEmail","moreInfo","publisher","customConfig","hostManifests","interop","localizedVersions"];var F=function(e){return{ok:!0,result:e}},W=function(e){return{ok:!1,error:e}},L=function(e,t,n){return!1===t.ok?t:!1===n.ok?n:F(e(t.result,n.result))},U=function(e,t){return!0===t.ok?t:W(e(t.error))},q=function(){return q=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},q.apply(this,arguments)};function B(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if(typeof e!==typeof t)return!1;if("object"===typeof e){if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!B(e[n],t[n]))return!1;return!0}var i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(n=0;n<i.length;n++){if(!t.hasOwnProperty(i[n]))return!1;if(!B(e[i[n]],t[i[n]]))return!1}return!0}}var G=function(e){return Array.isArray(e)},H=function(e){return"object"===typeof e&&null!==e&&!G(e)},z=function(e,t){return"expected "+e+", got "+function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}}(t)},V=function(e){return e.map((function(e){return"string"===typeof e?"."+e:"["+e+"]"})).join("")},J=function(e,t){var n=t.at,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(t,["at"]);return q({at:e+(n||"")},i)},K=function(){function e(t){var n=this;this.decode=t,this.run=function(e){return U((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),n.decode(e))},this.runPromise=function(e){return!0===(t=n.run(e)).ok?Promise.resolve(t.result):Promise.reject(t.error);var t},this.runWithException=function(e){return function(e){if(!0===e.ok)return e.result;throw e.error}(n.run(e))},this.map=function(t){return new e((function(e){return function(e,t){return!0===t.ok?F(e(t.result)):t}(t,n.decode(e))}))},this.andThen=function(t){return new e((function(e){return function(e,t){return!0===t.ok?e(t.result):t}((function(n){return t(n).decode(e)}),n.decode(e))}))},this.where=function(t,i){return n.andThen((function(n){return t(n)?e.succeed(n):e.fail(i)}))}}return e.string=function(){return new e((function(e){return"string"===typeof e?F(e):W({message:z("a string",e)})}))},e.number=function(){return new e((function(e){return"number"===typeof e?F(e):W({message:z("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"===typeof e?F(e):W({message:z("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return B(e,t)?F(t):W({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(H(e)&&t){var n={};for(var i in t)if(t.hasOwnProperty(i)){var r=t[i].decode(e[i]);if(!0!==r.ok)return void 0===e[i]?W({message:"the key '"+i+"' is required but was not present"}):W(J("."+i,r.error));void 0!==r.result&&(n[i]=r.result)}return F(n)}return H(e)?F(e):W({message:z("an object",e)})}))},e.array=function(t){return new e((function(e){if(G(e)&&t){return e.reduce((function(e,n,i){return L((function(e,t){return e.concat([t])}),e,function(e,n){return U((function(e){return J("["+n+"]",e)}),t.decode(e))}(n,i))}),F([]))}return G(e)?F(e):W({message:z("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(G(e)){if(e.length!==t.length)return W({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var n=[],i=0;i<t.length;i++){var r=t[i].decode(e[i]);if(!r.ok)return W(J("["+i+"]",r.error));n[i]=r.result}return F(n)}return W({message:z("a tuple of length "+t.length,e)})}))},e.union=function(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.oneOf.apply(e,[t,n].concat(i))},e.intersection=function(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return new e((function(e){return[t,n].concat(i).reduce((function(t,n){return L(Object.assign,t,n.decode(e))}),F({}))}))},e.anyJson=function(){return new e((function(e){return F(e)}))},e.unknownJson=function(){return new e((function(e){return F(e)}))},e.dict=function(t){return new e((function(e){if(H(e)){var n={};for(var i in e)if(e.hasOwnProperty(i)){var r=t.decode(e[i]);if(!0!==r.ok)return W(J("."+i,r.error));n[i]=r.result}return F(n)}return W({message:z("an object",e)})}))},e.optional=function(t){return new e((function(e){return void 0===e||null===e?F(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new e((function(e){for(var n=[],i=0;i<t.length;i++){var r=t[i].decode(e);if(!0===r.ok)return r;n[i]=r.error}var o=n.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return W({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},e.withDefault=function(t,n){return new e((function(e){return F(function(e,t){return!0===t.ok?t.result:e}(t,n.decode(e)))}))},e.valueAt=function(t,n){return new e((function(e){for(var i=e,r=0;r<t.length;r++){if(void 0===i)return W({at:V(t.slice(0,r+1)),message:"path does not exist"});if("string"===typeof t[r]&&!H(i))return W({at:V(t.slice(0,r+1)),message:z("an object",i)});if("number"===typeof t[r]&&!G(i))return W({at:V(t.slice(0,r+1)),message:z("an array",i)});i=i[t[r]]}return U((function(e){return void 0===i?{at:V(t),message:"path does not exist"}:J(V(t),e)}),n.decode(i))}))},e.succeed=function(t){return new e((function(e){return F(t)}))},e.fail=function(t){return new e((function(e){return W({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),$=K.string,Q=K.number,Y=K.boolean,X=K.anyJson;K.unknownJson;var Z=K.constant,ee=K.object,te=K.array;K.tuple;var ne=K.dict,ie=K.optional,re=K.oneOf;K.union,K.intersection,K.withDefault,K.valueAt,K.succeed,K.fail,K.lazy;const oe=$().where((e=>e.length>0),"Expected a non-empty string"),se=Q().where((e=>e>=0),"Expected a non-negative number"),ae=ee({name:oe,displayName:ie($()),contexts:ie(te($())),customConfig:ie(ee())}),ce=re(Z("web"),Z("native"),Z("citrix"),Z("onlineNative"),Z("other")),ue=ee({url:oe}),de=ee({src:oe,size:ie(oe),type:ie(oe)}),le=ee({src:oe,size:ie(oe),type:ie(oe),label:ie(oe)}),he=ee({contexts:te(oe),displayName:ie(oe),resultType:ie(oe),customConfig:ie(X())}),pe=ee({listensFor:ie(ne(he)),raises:ie(ne(te(oe)))}),fe=ee({broadcasts:ie(te(oe)),listensFor:ie(te(oe))}),ge=ee({name:oe,description:ie(oe),broadcasts:ie(te(oe)),listensFor:ie(te(oe))}),me=ee({intents:ie(pe),userChannels:ie(fe),appChannels:ie(te(ge))}),ve=ee({url:oe,top:ie(Q()),left:ie(Q()),width:ie(se),height:ie(se)}),ye=ee({name:ie(oe),type:ie(oe.where((e=>"window"===e),"Expected a value of window")),title:ie(oe),version:ie(oe),customProperties:ie(X()),icon:ie($()),caption:ie($()),details:ie(ve),intents:ie(te(ae)),hidden:ie(Y())}),we=re(ee({Glue42:re(ye,X())}),X()),be=ee({name:oe,appId:oe,title:ie(oe),version:ie(oe),manifest:oe,manifestType:oe,tooltip:ie(oe),description:ie(oe),contactEmail:ie(oe),supportEmail:ie(oe),publisher:ie(oe),images:ie(te(ee({url:ie(oe)}))),icons:ie(te(ee({icon:ie(oe)}))),customConfig:X(),intents:ie(te(ae))}),_e=ee({appId:ie(oe),name:ie(oe),details:ie(ue),version:ie(oe),title:ie(oe),tooltip:ie(oe),lang:ie(oe),description:ie(oe),categories:ie(te(oe)),icons:ie(te(de)),screenshots:ie(te(le)),contactEmail:ie(oe),supportEmail:ie(oe),moreInfo:ie(oe),publisher:ie(oe),customConfig:ie(te(X())),hostManifests:ie(we),interop:ie(me)}),Ie=ee({appId:oe,name:oe,type:ce,details:ue,version:ie(oe),title:ie(oe),tooltip:ie(oe),lang:ie(oe),description:ie(oe),categories:ie(te(oe)),icons:ie(te(de)),screenshots:ie(te(le)),contactEmail:ie(oe),supportEmail:ie(oe),moreInfo:ie(oe),publisher:ie(oe),customConfig:ie(te(X())),hostManifests:ie(we),interop:ie(me),localizedVersions:ie(ne(_e))}),Ce=re(be,Ie),Se=e=>"".concat(e.kind," at ").concat(e.at,": ").concat(JSON.stringify(e.input),". Reason - ").concat(e.message);class ke{constructor(){this.fdc3ToDesktopDefinitionType={web:"window",native:"exe",citrix:"citrix",onlineNative:"clickonce",other:"window"}}toApi(){return{isFdc3Definition:this.isFdc3Definition.bind(this),parseToBrowserBaseAppData:this.parseToBrowserBaseAppData.bind(this),parseToDesktopAppConfig:this.parseToDesktopAppConfig.bind(this)}}isFdc3Definition(e){return Ce.run(e).ok?e.appId&&e.details?{isFdc3:!0,version:"2.0"}:e.manifest?{isFdc3:!0,version:"1.2"}:{isFdc3:!1}:{isFdc3:!1}}parseToBrowserBaseAppData(e){var t;const{isFdc3:n,version:i}=this.isFdc3Definition(e);if(!n)throw new Error("The passed definition is not FDC3");const r=Ce.run(e);if(!r.ok)throw new Error("Invalid FDC3 ".concat(i," definition. Error: ").concat(Se(r.error)));const o=this.getUserPropertiesFromDefinition(e,i),s={url:this.getUrl(e,i)};let a={name:e.appId,type:"window",createOptions:s,userProperties:Object.assign(Object.assign({},o),{intents:"1.2"===i?o.intents:this.getIntentsFromV2AppDefinition(e),details:s}),title:e.title,version:e.version,icon:this.getIconFromDefinition(e,i),caption:e.description,fdc3:"2.0"===i?Object.assign(Object.assign({},e),{definitionVersion:"2.0"}):void 0};if(null===(t=e.hostManifests)||void 0===t?void 0:t.Glue42){const t=ye.run(e.hostManifests.Glue42);if(!t.ok)throw new Error("Invalid FDC3 ".concat(i," definition. Error: ").concat(Se(t.error)));if(!Object.keys(t.result).length)throw new Error("Invalid 'hostManifests['Glue42]' key");a=this.mergeBaseAppDataWithGlueManifest(a,t.result)}return a}parseToDesktopAppConfig(e){var t,n,i;const{isFdc3:r,version:o}=this.isFdc3Definition(e);if(!r)throw new Error("The passed definition is not FDC3");const s=Ce.run(e);if(!s.ok)throw new Error("Invalid FDC3 ".concat(o," definition. Error: ").concat(Se(s.error)));if("1.2"===o){const n=e;return{name:n.appId,type:"window",details:{url:this.getUrl(e,o)},version:n.version,title:n.title,tooltip:n.tooltip,caption:n.description,icon:null===(t=n.icons)||void 0===t?void 0:t[0].icon,intents:n.intents,customProperties:{manifestType:n.manifestType,images:n.images,contactEmail:n.contactEmail,supportEmail:n.supportEmail,publisher:n.publisher,icons:n.icons,customConfig:n.customConfig}}}const a=e;let c={name:a.appId,type:this.fdc3ToDesktopDefinitionType[a.type],details:a.details,version:a.version,title:a.title,tooltip:a.tooltip,caption:a.description,icon:this.getIconFromDefinition(a,"2.0"),intents:this.getIntentsFromV2AppDefinition(a),fdc3:Object.assign(Object.assign({},a),{definitionVersion:"2.0"})};if(null===(n=a.hostManifests)||void 0===n?void 0:n.Glue42){if("object"!==typeof a.hostManifests.Glue42||Array.isArray(a.hostManifests.Glue42))throw new Error("Invalid 'hostManifests['Glue42]' key");c=this.mergeDesktopConfigWithGlueManifest(c,null===(i=a.hostManifests)||void 0===i?void 0:i.Glue42)}return c}getUserPropertiesFromDefinition(e,t){return"1.2"===t?Object.fromEntries(Object.entries(e).filter((e=>{let[t]=e;return!j.includes(t)}))):Object.fromEntries(Object.entries(e).filter((e=>{let[t]=e;return!j.includes(t)&&!D.includes(t)})))}getUrl(e,t){var n,i;let r;if("1.2"===t){const t=JSON.parse(e.manifest);r=(null===(n=t.details)||void 0===n?void 0:n.url)||t.url}else r=null===(i=e.details)||void 0===i?void 0:i.url;if(!r||"string"!==typeof r)throw new Error("Invalid FDC3 ".concat(t," definition. Provide valid 'url' under '").concat("1.2"===t?"manifest":"details","' key"));return r}getIntentsFromV2AppDefinition(e){var t,n;const i=null===(n=null===(t=e.interop)||void 0===t?void 0:t.intents)||void 0===n?void 0:n.listensFor;if(!i)return;return Object.entries(i).map((e=>{const[t,n]=e;return Object.assign({name:t},n)}))}getIconFromDefinition(e,t){var n,i,r,o;return"1.2"===t?(null===(i=null===(n=e.icons)||void 0===n?void 0:n.find((e=>e.icon)))||void 0===i?void 0:i.icon)||void 0:(null===(o=null===(r=e.icons)||void 0===r?void 0:r.find((e=>e.src)))||void 0===o?void 0:o.src)||void 0}mergeBaseAppDataWithGlueManifest(e,t){let n=e;if(t.details){const i=Object.assign(Object.assign({},e.createOptions),t.details);n.createOptions=i,n.userProperties.details=i}return Array.isArray(t.intents)&&(n.userProperties.intents=(n.userProperties.intents||[]).concat(t.intents)),n=Object.assign(Object.assign({},n),t),delete n.details,delete n.intents,n}mergeDesktopConfigWithGlueManifest(e,t){const n=Object.assign({},e,t,{details:Object.assign(Object.assign({},e.details),t.details)});return Array.isArray(t.intents)&&(n.intents=(e.intents||[]).concat(t.intents)),n}}const xe={common:{nonEmptyStringDecoder:oe,nonNegativeNumberDecoder:se},fdc3:{allDefinitionsDecoder:Ce,v1DefinitionDecoder:be,v2DefinitionDecoder:Ie}};const Te=new class{constructor(){this._decoders=xe}get fdc3(){return this._fdc3||(this._fdc3=(new ke).toApi()),this._fdc3}get decoders(){return this._decoders}};Te.fdc3;const Ae=Te.decoders,Ee=k().where((e=>e.length>0),"Expected a non-empty string"),Pe=x().where((e=>e>=0),"Expected a non-negative number"),Me=R(Ee),Re=N(E("system"),E("windows"),E("appManager"),E("layouts"),E("intents"),E("notifications"),E("channels"),E("extension"),E("themes")),Ne=N(E("openWindow"),E("windowHello"),E("windowAdded"),E("windowRemoved"),E("getBounds"),E("getFrameBounds"),E("getUrl"),E("moveResize"),E("focus"),E("close"),E("getTitle"),E("setTitle"),E("focusChange"),E("getChannel")),Oe=N(E("appHello"),E("appDirectoryStateChange"),E("instanceStarted"),E("instanceStopped"),E("applicationStart"),E("instanceStop"),E("clear")),je=N(E("layoutAdded"),E("layoutChanged"),E("layoutRemoved"),E("get"),E("getAll"),E("export"),E("import"),E("remove"),E("clientSaveRequest"),E("getGlobalPermissionState"),E("checkGlobalActivated"),E("requestGlobalPermission"),E("getDefaultGlobal"),E("setDefaultGlobal"),E("clearDefaultGlobal")),De=N(E("raiseNotification"),E("requestPermission"),E("notificationShow"),E("notificationClick"),E("getPermission"),E("list"),E("notificationRaised"),E("notificationClosed"),E("click"),E("clear"),E("clearAll")),Fe=N(E("getEnvironment"),E("getBase"),E("platformShutdown")),We=N(E("top"),E("left"),E("right"),E("bottom")),Le=P({top:x(),left:x(),width:Pe,height:Pe}),Ue=R(P({top:R(x()),left:R(x()),width:R(Pe),height:R(Pe),context:R(A()),relativeTo:R(Ee),relativeDirection:R(We),windowId:R(Ee),layoutComponentId:R(Ee)})),qe=P({name:Ee,url:Ee,options:Ue}),Be=P({windowId:R(Ee)}),Ge=P({windowId:Ee,name:Ee}),He=P({windowId:Ee}),ze=P({windows:M(Ge),isWorkspaceFrame:T()}),Ve=P({windowId:Ee,title:k()}),Je=P({windowId:Ee,hasFocus:T()}),Ke=P({windowId:Ee,top:R(x()),left:R(x()),width:R(Pe),height:R(Pe),relative:R(T())}),$e=P({windowId:Ee,bounds:P({top:x(),left:x(),width:Pe,height:Pe})}),Qe=P({bounds:P({top:x(),left:x(),width:Pe,height:Pe})}),Ye=P({windowId:Ee,url:Ee}),Xe=A(),Ze=P({top:R(x()),left:R(x()),width:R(Pe),height:R(Pe)}),et=P({id:Ee,applicationName:Ee}),tt=P({url:Ee,top:R(x()),left:R(x()),width:R(Pe),height:R(Pe)}),nt=P({name:Ee,displayName:R(k()),contexts:R(M(k())),customConfig:R(P())});P({name:Ee,title:R(Ee),version:R(Ee),appId:R(Ee),manifest:Ee,manifestType:Ee,tooltip:R(Ee),description:R(Ee),contactEmail:R(Ee),supportEmail:R(Ee),publisher:R(Ee),images:R(M(P({url:R(Ee)}))),icons:R(M(P({icon:R(Ee)}))),customConfig:A(),intents:R(M(nt))});const it=P({name:Ee,type:Ee.where((e=>"window"===e),"Expected a value of window"),title:R(Ee),version:R(Ee),customProperties:R(A()),icon:R(k()),caption:R(k()),details:tt,intents:R(M(nt)),hidden:R(T()),fdc3:R(Ae.fdc3.v2DefinitionDecoder)}),rt=N(it,Ae.fdc3.v2DefinitionDecoder,Ae.fdc3.v1DefinitionDecoder);P({definitions:M(rt),mode:N(E("replace"),E("merge"))});const ot=P({name:Ee}),st=P({definitions:M(it)}),at=P({name:Ee,type:Ee.where((e=>"window"===e),"Expected a value of window"),instances:M(et),userProperties:R(A()),title:R(Ee),version:R(Ee),icon:R(Ee),caption:R(Ee)}),ct=P({name:Ee,type:Ee.where((e=>"window"===e),"Expected a value of window"),userProperties:A(),title:R(Ee),version:R(Ee),icon:R(Ee),caption:R(Ee)}),ut=P({appsAdded:M(ct),appsChanged:M(ct),appsRemoved:M(ct)}),dt=P({apps:M(at),initialChannelId:R(Ee)}),lt=P({id:Ee}),ht=P({name:Ee,waitForAGMReady:T(),id:R(Ee),context:R(A()),top:R(x()),left:R(x()),width:R(Pe),height:R(Pe),relativeTo:R(Ee),relativeDirection:R(We),forceChromeTab:R(T()),layoutComponentId:R(Ee),channelId:R(Ee)}),pt=N(E("Global"),E("Activity"),E("ApplicationDefault"),E("Swimlane"),E("Workspace")),ft=N(E("application"),E("activity")),gt=P({context:R(A()),bounds:Le,createArgs:P({name:R(Ee),url:R(Ee),context:R(A())}),windowState:R(Ee),restoreState:R(Ee),instanceId:Ee,isCollapsed:R(T()),isSticky:R(T()),restoreSettings:P({groupId:R(Ee),groupZOrder:R(x())})}),mt=P({type:E("window"),componentType:R(ft),application:Ee,state:gt}),vt=P({type:E("window"),config:P({appName:Ee,url:R(Ee),title:R(k()),allowExtract:R(T()),allowReorder:R(T()),showCloseButton:R(T()),isMaximized:R(T())})}),yt=P({type:E("group"),config:A(),children:M(N(vt))}),wt=P({type:E("column"),config:A(),children:M(N(yt,vt,O((()=>wt)),O((()=>bt))))}),bt=P({type:E("row"),config:A(),children:M(N(wt,yt,vt,O((()=>bt))))}),_t=P({config:A(),context:A(),children:M(N(bt,wt,yt,vt))}),It=P({type:E("Workspace"),application:R(Ee),state:_t}),Ct=P({bounds:Le,instanceId:Ee,selectedWorkspace:Pe,workspaces:M(_t),windowState:R(Ee),restoreState:R(Ee),context:R(A())}),St=P({type:E("workspaceFrame"),application:Ee,componentType:R(ft),state:Ct}),kt=P({name:Ee,type:pt,components:M(N(mt,It,St)),context:R(A()),metadata:R(A()),version:R(x())}),xt=P({name:Ee,context:R(A()),metadata:R(A()),instances:R(M(Ee)),ignoreInstances:R(M(Ee))}),Tt=P({name:Ee,context:R(A()),closeRunningInstance:R(T()),closeMe:R(T()),timeout:R(Pe)}),At=P({name:Ee,type:pt,context:R(A()),metadata:R(A())}),Et=P({name:Ee,type:pt}),Pt=P({layout:xt}),Mt=P({layout:Tt}),Rt=P({type:pt}),Nt=P({layouts:M(kt)}),Ot=N(E("replace"),E("merge")),jt=P({layouts:M(kt),mode:Ot,isManagerOperation:R(T())}),Dt=P({summaries:M(At)}),Ft=P({layout:kt}),Wt=P({layout:R(kt)}),Lt=P({name:Ee}),Ut=N(E("findIntent"),E("getIntents"),E("raiseIntent"),E("raise")),qt=P({applicationName:Ee,applicationTitle:R(k()),applicationDescription:R(k()),applicationIcon:R(k()),type:N(E("app"),E("instance")),displayName:R(k()),contextTypes:R(M(Ee)),instanceId:R(k()),instanceTitle:R(k()),resultType:R(k())});P({applicationName:k(),applicationIcon:R(k()),instanceId:R(k())});const Bt=P({intent:Ee,handler:qt}),Gt=P({name:Ee,handlers:M(qt)}),Ht=N(E("startNew"),E("reuse"),P({app:R(Ee),instance:R(Ee)})),zt=P({type:R(Ee),data:R(A())}),Vt=P({intents:M(Gt)}),Jt=P({name:R(Ee),contextType:R(Ee),resultType:R(Ee)}),Kt=N(Ee,Jt),$t=P({filter:R(Jt)}),Qt=P({intent:Ee,target:R(Ht),context:R(zt),options:R(Ue),handlers:R(M(qt)),timeout:R(Pe),waitUserResponseIndefinitely:R(T())}),Yt=N(Ee,Qt),Xt=P({enabled:T(),appName:Ee,waitResponseTimeout:x()}),Zt=P({intentRequest:Qt,resolverConfig:Xt}),en=P({request:Qt,handler:qt,result:A()}),tn=P({intent:Ee,contextTypes:R(M(Ee)),displayName:R(k()),icon:R(k()),description:R(k()),resultType:R(k())}),nn=N(Ee,tn),rn=e=>Ee.where((t=>e.includes(t)),"Expected a valid channel name"),on=P({method:Ee,arguments:R(A()),target:R(N(E("all"),E("best")))}),sn=P({action:k(),title:Ee,icon:R(k()),interop:R(on)}),an=P({badge:R(k()),body:R(k()),data:R(A()),dir:R(N(E("auto"),E("ltr"),E("rtl"))),icon:R(k()),image:R(k()),lang:R(k()),renotify:R(T()),requireInteraction:R(T()),silent:R(T()),tag:R(k()),timestamp:R(Pe),vibrate:R(M(x()))}),cn=P({title:Ee,clickInterop:R(on),actions:R(M(sn)),focusPlatformOnDefaultClick:R(T()),badge:R(k()),body:R(k()),data:R(A()),dir:R(N(E("auto"),E("ltr"),E("rtl"))),icon:R(k()),image:R(k()),lang:R(k()),renotify:R(T()),requireInteraction:R(T()),silent:R(T()),tag:R(k()),timestamp:R(Pe),vibrate:R(M(x())),severity:R(N(E("Low"),E("None"),E("Medium"),E("High"),E("Critical"))),showToast:R(T()),showInPanel:R(T())}),un=P({name:Ee,meta:P({color:Ee}),data:R(P())}),dn=P({settings:cn,id:Ee}),ln=P({settings:cn}),hn=P({permissionGranted:T()}),pn=P({permission:N(E("default"),E("granted"),E("denied"))}),fn=P({definition:an,action:R(k()),id:R(Ee)}),gn=P({layoutType:N(E("Global"),E("Workspace")),layoutName:Ee,context:R(A())}),mn=P({windowContext:R(A())}),vn=P({state:N(E("prompt"),E("denied"),E("granted"))}),yn=P({isAvailable:T()}),wn=P({itemId:Ee}),bn=P({isSupported:T()}),_n=P({operation:Ee}),In=P({bounds:Le}),Cn=P({displayName:Ee,name:Ee}),Sn=P({theme:Cn}),kn=P({themes:M(Cn)}),xn=P({name:Ee}),Tn=P({id:Ee,title:Ee,clickInterop:R(on),actions:R(M(sn)),focusPlatformOnDefaultClick:R(T()),badge:R(k()),body:R(k()),data:R(A()),dir:R(N(E("auto"),E("ltr"),E("rtl"))),icon:R(k()),image:R(k()),lang:R(k()),renotify:R(T()),requireInteraction:R(T()),silent:R(T()),tag:R(k()),timestamp:R(Pe),vibrate:R(M(x())),severity:R(N(E("Low"),E("None"),E("Medium"),E("High"),E("Critical"))),showToast:R(T()),showInPanel:R(T())}),An=P({notification:Tn}),En=P({notifications:M(Tn)}),Pn=P({id:Ee}),Mn=P({channel:Ee}),Rn=P({windowIds:M(Ee)}),Nn=N(E("addChannel"),E("getMyChannel"),E("getWindowIdsOnChannel"),E("getWindowIdsWithChannels"),E("joinChannel")),On=P({channel:R(Ee)}),jn=P({application:R(Ee),channels:R(M(Ee)),windowIds:R(M(Ee))}),Dn=P({filter:R(jn)}),Fn=P({windowIdsWithChannels:M(P({application:Ee,channel:R(Ee),windowId:Ee}))}),Wn=R(A()),Ln=R(P({top:R(x()),left:R(x()),width:R(Pe),height:R(Pe),relativeTo:R(Ee),relativeDirection:R(We),waitForAGMReady:R(T()),channelId:R(Ee),reuseId:R(Ee)})),Un=P({channel:Ee,windowId:Ee}),qn={openWindow:{name:"openWindow",dataDecoder:qe,resultDecoder:Ge},windowHello:{name:"windowHello",dataDecoder:Be,resultDecoder:ze},windowAdded:{name:"windowAdded",dataDecoder:Ge},windowRemoved:{name:"windowRemoved",dataDecoder:He},getBounds:{name:"getBounds",dataDecoder:He,resultDecoder:$e},getFrameBounds:{name:"getFrameBounds",dataDecoder:He,resultDecoder:Qe},getUrl:{name:"getUrl",dataDecoder:He,resultDecoder:Ye},moveResize:{name:"moveResize",dataDecoder:Ke},focus:{name:"focus",dataDecoder:He},close:{name:"close",dataDecoder:He},getTitle:{name:"getTitle",dataDecoder:He,resultDecoder:Ve},setTitle:{name:"setTitle",dataDecoder:Ve},focusChange:{name:"focusChange",dataDecoder:Je},getChannel:{name:"getChannel",dataDecoder:He,resultDecoder:P({channel:R(Ee)})}};function Bn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Gn(e){if(e&&e.errorHandling&&"function"!==typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"===typeof e.errorHandling&&e.errorHandling,n={};function i(n,i){var r=n instanceof Error?n:new Error(n);if(t)t(r);else{var o='[ERROR] callback-registry: User callback for key "'+i+'" failed: '+r.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t,r){var o=n[e];return o||(o=[],n[e]=o),o.push(t),r&&setTimeout((function(){r.forEach((function(r){var o;if(null===(o=n[e])||void 0===o?void 0:o.includes(t))try{Array.isArray(r)?t.apply(void 0,r):t.apply(void 0,[r])}catch(W){i(W,e)}}))}),0),function(){var i=n[e];i&&(0===(i=i.reduce((function(e,n,i){return n===t&&e.length===i||e.push(n),e}),[])).length?delete n[e]:n[e]=i)}},execute:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=n[e];if(!o||0===o.length)return[];var s=[];return o.forEach((function(n){try{var r=n.apply(void 0,t);s.push(r)}catch(W){s.push(void 0),i(W,e)}})),s},clear:function(){n={}},clearKey:function(e){n[e]&&delete n[e]}}}Gn.default=Gn;var Hn=Gn;class zn{constructor(e,t,n){this._id=e,this._name=t,this._bridge=n,this.registry=Hn(),this.myCtxKey="___window___".concat(this.id)}get id(){return this._id.slice()}get name(){return this._name.slice()}clean(){this.ctxUnsubscribe&&this.ctxUnsubscribe()}processSelfFocusEvent(e){this.me.isFocused=e,this.registry.execute("focus-change",this.me)}toApi(){return l(this,void 0,void 0,(function*(){return this.ctxUnsubscribe=yield this._bridge.contextLib.subscribe(this.myCtxKey,(e=>this.registry.execute("context-updated",e))),this.me={id:this.id,name:this.name,isFocused:!1,getURL:this.getURL.bind(this),moveResize:this.moveResize.bind(this),resizeTo:this.resizeTo.bind(this),moveTo:this.moveTo.bind(this),focus:this.focus.bind(this),close:this.close.bind(this),getTitle:this.getTitle.bind(this),setTitle:this.setTitle.bind(this),getBounds:this.getBounds.bind(this),getContext:this.getContext.bind(this),updateContext:this.updateContext.bind(this),setContext:this.setContext.bind(this),onContextUpdated:this.onContextUpdated.bind(this),onFocusChanged:this.onFocusChanged.bind(this),getChannel:this.getChannel.bind(this)},this.me}))}getURL(){return l(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",qn.getUrl,{windowId:this.id})).url}))}onFocusChanged(e){if("function"!==typeof e)throw new Error("Cannot subscribe to context changes, because the provided callback is not a function!");return this.registry.add("focus-change",e)}moveResize(e){return l(this,void 0,void 0,(function*(){const t=Ze.runWithException(e),n=Object.assign({},t,{windowId:this.id,relative:!1});return yield this._bridge.send("windows",qn.moveResize,n),this.me}))}resizeTo(e,t){return l(this,void 0,void 0,(function*(){if("undefined"===typeof e&&"undefined"===typeof t)return this.me;"undefined"!==typeof e&&Pe.runWithException(e),"undefined"!==typeof t&&Pe.runWithException(t);const n=Object.assign({},{width:e,height:t},{windowId:this.id,relative:!0});return yield this._bridge.send("windows",qn.moveResize,n),this.me}))}moveTo(e,t){return l(this,void 0,void 0,(function*(){if("undefined"===typeof e&&"undefined"===typeof t)return this.me;"undefined"!==typeof e&&x().runWithException(e),"undefined"!==typeof t&&x().runWithException(t);const n=Object.assign({},{top:e,left:t},{windowId:this.id,relative:!0});return yield this._bridge.send("windows",qn.moveResize,n),this.me}))}focus(){return l(this,void 0,void 0,(function*(){return"Platform"===this.name?window.open(void 0,this.id):yield this._bridge.send("windows",qn.focus,{windowId:this.id}),this.me}))}close(){return l(this,void 0,void 0,(function*(){return yield this._bridge.send("windows",qn.close,{windowId:this.id}),this.me}))}getTitle(){return l(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",qn.getTitle,{windowId:this.id})).title}))}setTitle(e){return l(this,void 0,void 0,(function*(){const t=Ee.runWithException(e);return yield this._bridge.send("windows",qn.setTitle,{windowId:this.id,title:t}),this.me}))}getBounds(){return l(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",qn.getBounds,{windowId:this.id})).bounds}))}getContext(){return l(this,void 0,void 0,(function*(){return yield this._bridge.contextLib.get(this.myCtxKey)}))}updateContext(e){return l(this,void 0,void 0,(function*(){const t=Xe.runWithException(e);return yield this._bridge.contextLib.update(this.myCtxKey,t),this.me}))}setContext(e){return l(this,void 0,void 0,(function*(){const t=Xe.runWithException(e);return yield this._bridge.contextLib.set(this.myCtxKey,t),this.me}))}onContextUpdated(e){if("function"!==typeof e)throw new Error("Cannot subscribe to context changes, because the provided callback is not a function!");return this.registry.add("context-updated",(t=>{e(t,this.me)}))}getChannel(){return l(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",qn.getChannel,{windowId:this.id},void 0,{includeOperationCheck:!0})).channel}))}}const Vn={operationCheck:{name:"operationCheck",dataDecoder:_n,resultDecoder:bn},getWorkspaceWindowFrameBounds:{name:"getWorkspaceWindowFrameBounds",resultDecoder:In,dataDecoder:wn}},Jn=(e,t,n)=>new Promise(((i,r)=>{const o=setTimeout((()=>{const e=n||"Promise timeout hit: ".concat(t);r(e)}),t);new Promise(e).then((e=>{clearTimeout(o),i(e)})).catch((e=>{clearTimeout(o),r(e)}))}));class Kn{constructor(){this.registry=Hn(),this.allWindowProjections=[]}start(e,t){return l(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("windows.controller.web"),this.logger.trace("starting the web windows controller"),this.publicWindowId=t.publicWindowId,this.addWindowOperationExecutors(),this.ioc=t,this.bridge=t.bridge,this.instanceId=e.interop.instance.instance,this.channelsController=t.channelsController,this.logger.trace("set the public window id: ".concat(this.publicWindowId,", set the bridge operations and ioc, registering with the platform now")),this.platformRegistration=this.registerWithPlatform(),yield this.platformRegistration,yield this.initializeFocusTracking(),this.logger.trace("registration with the platform successful, attaching the windows property to glue and returning");const n=this.toApi();e.windows=n}))}handlePlatformShutdown(){this.registry.clear(),this.allWindowProjections=[],this.focusEventHandler&&(document.removeEventListener("visibilityChange",this.focusEventHandler),window.removeEventListener("focus",this.focusEventHandler),window.removeEventListener("blur",this.focusEventHandler))}handleBridgeMessage(e){return l(this,void 0,void 0,(function*(){yield this.platformRegistration;const t=Ne.runWithException(e.operation),n=qn[t];if(!n.execute)return;let i=e.data;return n.dataDecoder&&(i=n.dataDecoder.runWithException(e.data)),yield n.execute(i)}))}open(e,t,n){return l(this,void 0,void 0,(function*(){Ee.runWithException(e),Ee.runWithException(t);const i=Ue.runWithException(n),r=yield this.bridge.send("windows",qn.openWindow,{name:e,url:t,options:i});return this.waitForWindowAdded(r.windowId)}))}list(){return this.allWindowProjections.map((e=>e.api))}findById(e){var t;return Ee.runWithException(e),null===(t=this.allWindowProjections.find((t=>t.id===e)))||void 0===t?void 0:t.api}toApi(){return{open:this.open.bind(this),my:this.my.bind(this),list:this.list.bind(this),findById:this.findById.bind(this),onWindowAdded:this.onWindowAdded.bind(this),onWindowRemoved:this.onWindowRemoved.bind(this),onWindowGotFocus:this.onWindowGotFocus.bind(this),onWindowLostFocus:this.onWindowLostFocus.bind(this)}}addWindowOperationExecutors(){qn.focusChange.execute=this.handleFocusChangeEvent.bind(this),qn.windowAdded.execute=this.handleWindowAdded.bind(this),qn.windowRemoved.execute=this.handleWindowRemoved.bind(this),qn.getBounds.execute=this.handleGetBounds.bind(this),qn.getFrameBounds.execute=this.handleGetBounds.bind(this),qn.getTitle.execute=this.handleGetTitle.bind(this),qn.getUrl.execute=this.handleGetUrl.bind(this),qn.moveResize.execute=this.handleMoveResize.bind(this),qn.setTitle.execute=this.handleSetTitle.bind(this),qn.getChannel.execute=this.handleGetChannel.bind(this)}my(){return Object.assign({},this.me)}onWindowAdded(e){if("function"!==typeof e)throw new Error("Cannot subscribe to window added, because the provided callback is not a function!");return this.registry.add("window-added",e)}onWindowRemoved(e){if("function"!==typeof e)throw new Error("Cannot subscribe to window removed, because the provided callback is not a function!");return this.registry.add("window-removed",e)}onWindowGotFocus(e){if("function"!==typeof e)throw new Error("Cannot subscribe to onWindowGotFocus, because the provided callback is not a function!");return this.registry.add("window-got-focus",e)}onWindowLostFocus(e){if("function"!==typeof e)throw new Error("Cannot subscribe to onWindowLostFocus, because the provided callback is not a function!");return this.registry.add("window-lost-focus",e)}sayHello(){return l(this,void 0,void 0,(function*(){return yield this.bridge.send("windows",qn.windowHello,{windowId:this.publicWindowId})}))}registerWithPlatform(){return l(this,void 0,void 0,(function*(){const{windows:e,isWorkspaceFrame:t}=yield this.sayHello();if(this.isWorkspaceFrame=t,this.logger.trace("the platform responded to the hello message"),!this.isWorkspaceFrame&&this.publicWindowId){this.logger.trace("i am not treated as a workspace frame, setting my window");const t=e.find((e=>e.windowId===this.publicWindowId));if(!t)throw new Error("Cannot initialize the window library, because I received no information about me from the platform");const n=yield this.ioc.buildWebWindow(this.publicWindowId,t.name);this.me=n.api,this.allWindowProjections.push(n)}const n=yield Promise.all(e.filter((e=>e.windowId!==this.publicWindowId)).map((e=>this.ioc.buildWebWindow(e.windowId,e.name))));this.logger.trace("all windows projections are completed, building the list collection"),this.allWindowProjections.push(...n)}))}handleFocusChangeEvent(e){return l(this,void 0,void 0,(function*(){const t=this.allWindowProjections.find((t=>t.id===e.windowId));if(!t)return;t.model.processSelfFocusEvent(e.hasFocus);const n=e.hasFocus?"window-got-focus":"window-lost-focus";this.registry.execute(n,t.api)}))}handleWindowAdded(e){return l(this,void 0,void 0,(function*(){if(this.allWindowProjections.some((t=>t.id===e.windowId)))return;const t=yield this.ioc.buildWebWindow(e.windowId,e.name);this.allWindowProjections.push(t),this.registry.execute("window-added",t.api)}))}handleWindowRemoved(e){return l(this,void 0,void 0,(function*(){const t=this.allWindowProjections.find((t=>t.id===e.windowId));t&&(this.allWindowProjections=this.allWindowProjections.filter((t=>t.id!==e.windowId)),t.model.clean(),this.registry.execute("window-removed",t.api))}))}handleGetBounds(){return l(this,void 0,void 0,(function*(){if(!this.me&&!this.isWorkspaceFrame)throw new Error("This window cannot report it's bounds, because it is not a Glue Window, most likely because it is an iframe");return{windowId:this.isWorkspaceFrame?"noop":this.me.id,bounds:{top:window.screenTop,left:window.screenLeft,width:window.innerWidth,height:window.innerHeight}}}))}handleGetTitle(){return l(this,void 0,void 0,(function*(){if(!this.me)throw new Error("This window cannot report it's title, because it is not a Glue Window, most likely because it is an iframe");return{windowId:this.me.id,title:document.title}}))}handleGetUrl(){return l(this,void 0,void 0,(function*(){if(!this.me)throw new Error("This window cannot report it's url, because it is not a Glue Window, most likely because it is an iframe");return{windowId:this.me.id,url:window.location.href}}))}handleMoveResize(e){return l(this,void 0,void 0,(function*(){const t="number"===typeof e.top?e.top:e.relative?0:window.screenTop,n="number"===typeof e.left?e.left:e.relative?0:window.screenLeft,i="number"===typeof e.height?e.height:e.relative?0:window.innerHeight,r="number"===typeof e.width?e.width:e.relative?0:window.innerWidth,o=e.relative?window.moveBy:window.moveTo,s=e.relative?window.resizeBy:window.resizeTo;o(n,t),s(r,i)}))}handleSetTitle(e){return l(this,void 0,void 0,(function*(){document.title=e.title}))}initializeFocusTracking(){return l(this,void 0,void 0,(function*(){if(this.isWorkspaceFrame)return void this.logger.trace("Ignoring the focus tracking, because this client is a workspace frame");try{yield this.bridge.send("windows",Vn.operationCheck,{operation:"focusChange"})}catch(t){return void this.logger.warn("The platform of this client is outdated and does not support focus tracking, disabling focus events for this client.")}const e=document.hasFocus();yield this.transmitFocusChange(!0),e||(yield this.transmitFocusChange(!1)),this.defineEventListeners()}))}processFocusEvent(){const e=document.hasFocus();this.transmitFocusChange(e)}waitForWindowAdded(e){const t=this.allWindowProjections.find((t=>t.id===e));return t?Promise.resolve(t.api):Jn((t=>{const n=this.onWindowAdded((i=>{i.id===e&&(n(),t(i))}))}),3e4,"Timed out waiting for ".concat(e," to be announced"))}transmitFocusChange(e){var t;return l(this,void 0,void 0,(function*(){const n={windowId:(null===(t=this.me)||void 0===t?void 0:t.id)||"iframe-".concat(this.instanceId),hasFocus:e};this.me&&(this.me.isFocused=e),yield this.bridge.send("windows",qn.focusChange,n)}))}defineEventListeners(){this.focusEventHandler=this.processFocusEvent.bind(this),document.addEventListener("visibilityChange",this.focusEventHandler),window.addEventListener("focus",this.focusEventHandler),window.addEventListener("blur",this.focusEventHandler)}handleGetChannel(){return l(this,void 0,void 0,(function*(){if(!this.me)throw new Error("This window cannot report it's channel, because it is not a Glue Window, most likely because it is an iframe");const e=this.channelsController.my();return Object.assign({},e?{channel:e}:{})}))}}const $n="T42.Web.Platform.Control",Qn="T42.Web.Platform.Stream",Yn="T42.Web.Client.Control",Xn="T42.Core.Plus.Themes.Stream";class Zn{constructor(e,t){this.coreGlue=e,this.communicationId=t,this.platformMethodTimeoutMs=1e4}get contextLib(){return this.coreGlue.contexts}get interopInstance(){return this.coreGlue.interop.instance.instance}stop(){return l(this,void 0,void 0,(function*(){this.running=!1,this.sub.close(),yield this.coreGlue.interop.unregister(Yn)}))}start(e){return l(this,void 0,void 0,(function*(){this.running=!0,this.controllers=e,yield Promise.all([this.checkWaitMethod($n),this.checkWaitMethod(Qn)]);const t=this.communicationId,[n]=yield Promise.all([this.coreGlue.interop.subscribe(Qn,t?{target:{instance:this.communicationId}}:void 0),this.coreGlue.interop.registerAsync(Yn,((e,t,n,i)=>this.passMessageController(e,n,i)))]);this.sub=n,this.sub.onData((e=>this.passMessageController(e.data)))}))}getInteropInstance(e){const t=this.coreGlue.interop.servers().find((t=>t.windowId&&t.windowId===e));return{application:null===t||void 0===t?void 0:t.application,applicationName:null===t||void 0===t?void 0:t.applicationName,peerId:null===t||void 0===t?void 0:t.peerId,instance:null===t||void 0===t?void 0:t.instance,windowId:null===t||void 0===t?void 0:t.windowId}}send(e,t,n,i,r){return l(this,void 0,void 0,(function*(){if(t.dataDecoder)try{t.dataDecoder.runWithException(n)}catch(o){throw new Error("Unexpected Web->Platform outgoing validation error: ".concat(o.message,", for operation: ").concat(t.name," and input: ").concat(JSON.stringify(o.input)))}if(!(!(null===r||void 0===r?void 0:r.includeOperationCheck)||(yield this.checkOperationSupported(e,t)).isSupported))throw new Error("Cannot complete operation: ".concat(t.name," for domain: ").concat(e," because this client is connected to a platform which does not support it"));try{const r=yield this.transmitMessage(e,t,n,i);return t.resultDecoder&&t.resultDecoder.runWithException(r),r}catch(o){if(o.kind)throw new Error("Unexpected Web<-Platform incoming validation error: ".concat(o.message,", for operation: ").concat(t.name," and input: ").concat(JSON.stringify(o.input)));throw new Error(o.message)}}))}createNotificationsSteam(){return l(this,void 0,void 0,(function*(){if(!this.coreGlue.interop.methods().some((e=>e.name===Xn)))throw new Error("Cannot subscribe to theme changes, because the underlying interop stream does not exist. Most likely this is the case when this client is not connected to Core Plus.");return this.coreGlue.interop.subscribe(Xn,this.communicationId?{target:{instance:this.communicationId}}:void 0)}))}checkOperationSupported(e,t){return l(this,void 0,void 0,(function*(){try{return yield this.send(e,Vn.operationCheck,{operation:t.name})}catch(n){return{isSupported:!1}}}))}checkWaitMethod(e){return Jn((t=>{if(this.coreGlue.interop.methods().some((t=>{const n=t.name===e,i=!this.communicationId||t.getServers().some((e=>e.instance===this.communicationId));return n&&i})))return t();const n=this.coreGlue.interop.serverMethodAdded((i=>{const r=i.method,o=i.server,s=!this.communicationId||o.instance===this.communicationId;r.name===e&&s&&(n(),t())}))}),this.platformMethodTimeoutMs,"Cannot initiate Glue Web, because a system method's discovery timed out: ".concat(e))}passMessageController(e,t,n){const i=Re.run(e.domain);if(!i.ok)return void(n&&n("Cannot execute this client control, because of domain validation error: ".concat(JSON.stringify(i.error))));const r=i.result;this.controllers[r].handleBridgeMessage(e).then((e=>{t&&t(e)})).catch((e=>{n&&n(e),console.warn(e)}))}transmitMessage(e,t,n,i){return l(this,void 0,void 0,(function*(){const r={domain:e,data:n,operation:t.name};let o;const s="Internal Platform Communication Error. Attempted operation: ".concat(JSON.stringify(t.name)," with data: ").concat(JSON.stringify(n),". "),a=this.communicationId;try{if(!this.running)throw new Error("Cannot send a control message, because the platform shut down");if(o=yield this.coreGlue.interop.invoke($n,r,a?{instance:this.communicationId}:void 0,i),!o)throw new Error("Received unsupported result from the platform - empty result");if(!Array.isArray(o.all_return_values)||0===o.all_return_values.length)throw new Error("Received unsupported result from the platform - empty values collection")}catch(c){if(c&&c.all_errors&&c.all_errors.length){const e=c.all_errors[0].message;throw new Error("".concat(s," -> Inner message: ").concat(e))}throw new Error("".concat(s," -> Inner message: ").concat(c.message))}return o.all_return_values[0].returned}))}}const ei={appHello:{name:"appHello",dataDecoder:Be,resultDecoder:dt},appDirectoryStateChange:{name:"appDirectoryStateChange",dataDecoder:ut},instanceStarted:{name:"instanceStarted",dataDecoder:et},instanceStopped:{name:"instanceStopped",dataDecoder:et},applicationStart:{name:"applicationStart",dataDecoder:ht,resultDecoder:et},instanceStop:{name:"instanceStop",dataDecoder:lt},import:{name:"import"},remove:{name:"remove",dataDecoder:ot},export:{name:"export",resultDecoder:st},clear:{name:"clear"}};class ti{constructor(){this.baseApplicationsTimeoutMS=6e4,this.appImportTimeoutMS=20,this.registry=Hn(),this.applications=[],this.instances=[]}handlePlatformShutdown(){this.registry.clear(),this.applications=[],this.instances=[],delete this.me}start(e,t){return l(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("appManger.controller.web"),this.logger.trace("starting the web appManager controller"),this.publicWindowId=t.publicWindowId,this.addOperationsExecutors(),this.ioc=t,this.bridge=t.bridge,this.channelsController=t.channelsController,this.sessionController=t.sessionController,this.platformRegistration=this.registerWithPlatform(),yield this.platformRegistration,this.logger.trace("registration with the platform successful, attaching the appManager property to glue and returning");const n=this.toApi();e.appManager=n}))}handleBridgeMessage(e){return l(this,void 0,void 0,(function*(){yield this.platformRegistration;const t=Oe.runWithException(e.operation),n=ei[t];if(!n.execute)return;let i=e.data;return n.dataDecoder&&(i=n.dataDecoder.runWithException(e.data)),yield n.execute(i)}))}onInstanceStarted(e){if("function"!==typeof e)throw new Error("onInstanceStarted requires a single argument of type function");return this.registry.add("instance-started",e,this.instances)}onInstanceStopped(e){if("function"!==typeof e)throw new Error("onInstanceStopped requires a single argument of type function");return this.registry.add("instance-stopped",e)}startApplication(e,t,n){var i;return l(this,void 0,void 0,(function*(){const r=yield this.channelsController.all();if((null===n||void 0===n?void 0:n.channelId)&&!r.includes(n.channelId))throw new Error('The channel with name "'.concat(n.channelId,"\" doesn't exist!"));const o={name:e,waitForAGMReady:null===(i=null===n||void 0===n?void 0:n.waitForAGMReady)||void 0===i||i,context:t,top:null===n||void 0===n?void 0:n.top,left:null===n||void 0===n?void 0:n.left,width:null===n||void 0===n?void 0:n.width,height:null===n||void 0===n?void 0:n.height,relativeTo:null===n||void 0===n?void 0:n.relativeTo,relativeDirection:null===n||void 0===n?void 0:n.relativeDirection,id:null===n||void 0===n?void 0:n.reuseId,forceChromeTab:null===n||void 0===n?void 0:n.forceTab,layoutComponentId:null===n||void 0===n?void 0:n.layoutComponentId,channelId:null===n||void 0===n?void 0:n.channelId},s=yield this.bridge.send("appManager",ei.applicationStart,o),a=this.applications.find((e=>e.name===s.applicationName));return this.ioc.buildInstance(s,a)}))}getApplication(e){const t=Ee.runWithException(e);return this.applications.find((e=>e.name===t))}getInstances(){return this.instances.slice()}toApi(){return{myInstance:this.me,inMemory:{import:this.import.bind(this),remove:this.remove.bind(this),export:this.export.bind(this),clear:this.clear.bind(this)},application:this.getApplication.bind(this),applications:this.getApplications.bind(this),instances:this.getInstances.bind(this),onAppAdded:this.onAppAdded.bind(this),onAppChanged:this.onAppChanged.bind(this),onAppRemoved:this.onAppRemoved.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)}}addOperationsExecutors(){ei.appDirectoryStateChange.execute=this.handleAppDirectoryStateChange.bind(this),ei.instanceStarted.execute=this.handleInstanceStartedMessage.bind(this),ei.instanceStopped.execute=this.handleInstanceStoppedMessage.bind(this)}handleAppDirectoryStateChange(e){return l(this,void 0,void 0,(function*(){e.appsAdded.forEach(this.handleApplicationAddedMessage.bind(this)),e.appsChanged.forEach(this.handleApplicationChangedMessage.bind(this)),e.appsRemoved.forEach(this.handleApplicationRemovedMessage.bind(this))}))}onAppAdded(e){if("function"!==typeof e)throw new Error("onAppAdded requires a single argument of type function");return this.registry.add("application-added",e,this.applications)}onAppRemoved(e){if("function"!==typeof e)throw new Error("onAppRemoved requires a single argument of type function");return this.registry.add("application-removed",e)}onAppChanged(e){if("function"!==typeof e)throw new Error("onAppChanged requires a single argument of type function");return this.registry.add("application-changed",e)}handleApplicationAddedMessage(e){return l(this,void 0,void 0,(function*(){if(this.applications.some((t=>t.name===e.name)))return;const t=yield this.ioc.buildApplication(e,[]),n=this.instances.filter((e=>e.application.name===t.name));t.instances.push(...n),this.applications.push(t),this.registry.execute("application-added",t)}))}handleApplicationRemovedMessage(e){return l(this,void 0,void 0,(function*(){const t=this.applications.findIndex((t=>t.name===e.name));if(t<0)return;const n=this.applications[t];this.applications.splice(t,1),this.registry.execute("application-removed",n)}))}handleApplicationChangedMessage(e){return l(this,void 0,void 0,(function*(){const t=this.applications.find((t=>t.name===e.name));if(!t)return this.handleApplicationAddedMessage(e);t.title=e.title,t.version=e.version,t.icon=e.icon,t.caption=e.caption,t.userProperties=e.userProperties,this.registry.execute("application-changed",t)}))}handleInstanceStartedMessage(e){return l(this,void 0,void 0,(function*(){if(this.instances.some((t=>t.id===e.id)))return;const t=this.applications.find((t=>t.name===e.applicationName));if(!t)throw new Error("Cannot add instance: ".concat(e.id,", because there is no application definition associated with it"));const n=this.ioc.buildInstance(e,t);this.instances.push(n),t.instances.push(n),this.registry.execute("instance-started",n)}))}handleInstanceStoppedMessage(e){return l(this,void 0,void 0,(function*(){const t=this.instances.find((t=>t.id===e.id));if(t){const t=this.instances.findIndex((t=>t.id===e.id));this.instances.splice(t,1)}const n=this.applications.find((t=>t.instances.some((t=>t.id===e.id))));if(n){const t=n.instances.findIndex((t=>t.id===e.id));n.instances.splice(t,1)}t&&this.registry.execute("instance-stopped",t)}))}import(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"replace";return l(this,void 0,void 0,(function*(){if(Ot.runWithException(t),!Array.isArray(e))throw new Error("Import must be called with an array of definitions");if(e.length>1e4)throw new Error("Cannot import more than 10000 app definitions in Glue42 Core.");const n=e.reduce(((e,t)=>{const n=rt.run(t);return n.ok?e.valid.push(t):e.invalid.push({app:null===t||void 0===t?void 0:t.name,error:JSON.stringify(n.error)}),e}),{valid:[],invalid:[]}),i=this.baseApplicationsTimeoutMS+this.appImportTimeoutMS*n.valid.length;return yield this.bridge.send("appManager",ei.import,{definitions:n.valid,mode:t},{methodResponseTimeoutMs:i}),{imported:n.valid.map((e=>e.name)),errors:n.invalid}}))}remove(e){return l(this,void 0,void 0,(function*(){Ee.runWithException(e),yield this.bridge.send("appManager",ei.remove,{name:e},{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})}))}clear(){return l(this,void 0,void 0,(function*(){yield this.bridge.send("appManager",ei.clear,void 0,{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})}))}export(){return l(this,void 0,void 0,(function*(){return(yield this.bridge.send("appManager",ei.export,void 0,{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})).definitions}))}getApplications(){return this.applications.slice()}joinInitialChannel(e){return l(this,void 0,void 0,(function*(){try{yield this.channelsController.join(e)}catch(t){this.logger.warn("Application instance ".concat(this.me," was unable to join the ").concat(e," channel. Reason: ").concat(JSON.stringify(t)))}}))}registerWithPlatform(){return l(this,void 0,void 0,(function*(){const e=yield this.bridge.send("appManager",ei.appHello,{windowId:this.publicWindowId},{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS});this.logger.trace("the platform responded to the hello message with a full list of apps"),this.applications=yield Promise.all(e.apps.map((e=>this.ioc.buildApplication(e,e.instances)))),this.instances=this.applications.reduce(((e,t)=>(e.push(...t.instances),e)),[]),this.me=this.findMyInstance(),this.logger.trace("all applications were parsed and saved. I am ".concat(this.me?"NOT a":"a"," valid instance"));const{channels:t}=this.sessionController.getWindowData(),n=t?t.currentName:e.initialChannelId;n&&(yield this.joinInitialChannel(n))}))}findMyInstance(){for(const e of this.applications){const t=e.instances.find((e=>e.id===this.publicWindowId));if(t)return t}}}class ni{constructor(e,t,n){this.data=e,this.bridge=t,this.application=n,this.myCtxKey="___instance___".concat(this.data.id)}toApi(){const e=this.bridge.getInteropInstance(this.data.id),t={id:this.data.id,agm:e,application:this.application,stop:this.stop.bind(this),getContext:this.getContext.bind(this)};return this.me=Object.freeze(t),this.me}getContext(){return l(this,void 0,void 0,(function*(){return this.bridge.contextLib.get(this.myCtxKey)}))}stop(){return l(this,void 0,void 0,(function*(){yield this.bridge.send("appManager",ei.instanceStop,{id:this.data.id})}))}}class ii{constructor(e,t,n){this.data=e,this.instances=t,this.controller=n}toApi(){const e={name:this.data.name,title:this.data.title,version:this.data.version,icon:this.data.icon,caption:this.data.caption,userProperties:this.data.userProperties,instances:this.instances,start:this.start.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)};return this.me=e,this.me}onInstanceStarted(e){if("function"!==typeof e)throw new Error("OnInstanceStarted requires a single argument of type function");return this.controller.onInstanceStarted((t=>{t.application.name===this.data.name&&e(t)}))}onInstanceStopped(e){if("function"!==typeof e)throw new Error("OnInstanceStarted requires a single argument of type function");return this.controller.onInstanceStopped((t=>{t.application.name===this.data.name&&e(t)}))}start(e,t){return l(this,void 0,void 0,(function*(){const n=Wn.runWithException(e),i=Ln.runWithException(t);return this.controller.startApplication(this.data.name,n,i)}))}}const ri={layoutAdded:{name:"layoutAdded",dataDecoder:kt},layoutChanged:{name:"layoutChanged",dataDecoder:kt},layoutRemoved:{name:"layoutRemoved",dataDecoder:kt},get:{name:"get",dataDecoder:Et,resultDecoder:Wt},getAll:{name:"getAll",dataDecoder:Rt,resultDecoder:Dt},export:{name:"export",dataDecoder:Rt,resultDecoder:Nt},import:{name:"import",dataDecoder:jt},remove:{name:"remove",dataDecoder:Et},save:{name:"save",dataDecoder:Pt,resultDecoder:Ft},restore:{name:"restore",dataDecoder:Mt},clientSaveRequest:{name:"clientSaveRequest",dataDecoder:gn,resultDecoder:mn},getGlobalPermissionState:{name:"getGlobalPermissionState",resultDecoder:vn},requestGlobalPermission:{name:"requestGlobalPermission",resultDecoder:yn},checkGlobalActivated:{name:"checkGlobalActivated",resultDecoder:yn},getDefaultGlobal:{name:"getDefaultGlobal",resultDecoder:Wt},setDefaultGlobal:{name:"setDefaultGlobal",dataDecoder:Lt},clearDefaultGlobal:{name:"clearDefaultGlobal"}};class oi{constructor(){this.defaultLayoutRestoreTimeoutMS=12e4,this.registry=Hn()}handlePlatformShutdown(){this.registry.clear()}start(e,t){return l(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("layouts.controller.web"),this.logger.trace("starting the web layouts controller"),this.bridge=t.bridge,this.windowsController=t.windowsController,this.addOperationsExecutors();const n=this.toApi();this.logger.trace("no need for platform registration, attaching the layouts property to glue and returning"),e.layouts=n}))}handleBridgeMessage(e){return l(this,void 0,void 0,(function*(){const t=je.runWithException(e.operation),n=ri[t];if(!n.execute)return;let i=e.data;return n.dataDecoder&&(i=n.dataDecoder.runWithException(e.data)),yield n.execute(i)}))}toApi(){const e={get:this.get.bind(this),getAll:this.getAll.bind(this),export:this.export.bind(this),import:this.import.bind(this),save:this.save.bind(this),restore:this.restore.bind(this),remove:this.remove.bind(this),onAdded:this.onAdded.bind(this),onChanged:this.onChanged.bind(this),onRemoved:this.onRemoved.bind(this),onSaveRequested:this.subscribeOnSaveRequested.bind(this),getMultiScreenPermissionState:this.getGlobalPermissionState.bind(this),requestMultiScreenPermission:this.requestGlobalPermission.bind(this),getGlobalTypeState:this.checkGlobalActivated.bind(this),getDefaultGlobal:this.getDefaultGlobal.bind(this),setDefaultGlobal:this.setDefaultGlobal.bind(this),clearDefaultGlobal:this.clearDefaultGlobal.bind(this)};return Object.freeze(e)}addOperationsExecutors(){ri.layoutAdded.execute=this.handleOnAdded.bind(this),ri.layoutChanged.execute=this.handleOnChanged.bind(this),ri.layoutRemoved.execute=this.handleOnRemoved.bind(this),ri.clientSaveRequest.execute=this.handleSaveRequest.bind(this)}get(e,t){return l(this,void 0,void 0,(function*(){Ee.runWithException(e),pt.runWithException(t);return(yield this.bridge.send("layouts",ri.get,{name:e,type:t})).layout}))}getAll(e){return l(this,void 0,void 0,(function*(){pt.runWithException(e);return(yield this.bridge.send("layouts",ri.getAll,{type:e})).summaries}))}export(e){return l(this,void 0,void 0,(function*(){pt.runWithException(e);return(yield this.bridge.send("layouts",ri.export,{type:e})).layouts}))}import(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"replace";return l(this,void 0,void 0,(function*(){if(Ot.runWithException(t),!Array.isArray(e))throw new Error("Import must be called with an array of layouts");if(e.length>1e3)throw new Error("Cannot import more than 1000 layouts at once in Glue42 Core.");const n=e.reduce(((e,t)=>{const n=kt.run(t);return n.ok?e.valid.push(t):this.logger.warn("A layout with name: ".concat(t.name," was not imported, because of error: ").concat(JSON.stringify(n.error))),e}),{valid:[]}),i=e.filter((e=>n.valid.some((t=>t.name===e.name))));yield this.bridge.send("layouts",ri.import,{layouts:i,mode:t})}))}save(e){return l(this,void 0,void 0,(function*(){xt.runWithException(e);return(yield this.bridge.send("layouts",ri.save,{layout:e})).layout}))}restore(e){return l(this,void 0,void 0,(function*(){Tt.runWithException(e);const t=e.timeout?2*e.timeout:this.defaultLayoutRestoreTimeoutMS;yield this.bridge.send("layouts",ri.restore,{layout:e},{methodResponseTimeoutMs:t})}))}remove(e,t){return l(this,void 0,void 0,(function*(){pt.runWithException(e),Ee.runWithException(t),yield this.bridge.send("layouts",ri.remove,{type:e,name:t})}))}handleSaveRequest(e){return l(this,void 0,void 0,(function*(){const t={};if(this.saveRequestSubscription)try{const n=this.saveRequestSubscription(e);t.windowContext=null===n||void 0===n?void 0:n.windowContext}catch(n){this.logger.warn("An error was thrown by the onSaveRequested callback, ignoring the callback: ".concat(JSON.stringify(n)))}return t}))}getGlobalPermissionState(){return l(this,void 0,void 0,(function*(){return yield this.bridge.send("layouts",ri.getGlobalPermissionState,void 0)}))}requestGlobalPermission(){return l(this,void 0,void 0,(function*(){const e=(yield this.getGlobalPermissionState()).state;if("denied"===e)return{permissionGranted:!1};if("granted"===e)return{permissionGranted:!0};const t=this.windowsController.my(),n=(window.glue42core||window.iobrowser).isPlatformFrame;if("Platform"!==t.name&&!n)throw new Error("Cannot request permission for multi-window placement from any app other than the Platform.");return{permissionGranted:(yield this.bridge.send("layouts",ri.requestGlobalPermission,void 0,{methodResponseTimeoutMs:18e4})).isAvailable}}))}checkGlobalActivated(){return l(this,void 0,void 0,(function*(){return{activated:(yield this.bridge.send("layouts",ri.checkGlobalActivated,void 0)).isAvailable}}))}getDefaultGlobal(){return l(this,void 0,void 0,(function*(){return(yield this.bridge.send("layouts",ri.getDefaultGlobal,void 0,void 0,{includeOperationCheck:!0})).layout}))}setDefaultGlobal(e){return l(this,void 0,void 0,(function*(){Ee.runWithException(e),yield this.bridge.send("layouts",ri.setDefaultGlobal,{name:e},void 0,{includeOperationCheck:!0})}))}clearDefaultGlobal(){return l(this,void 0,void 0,(function*(){yield this.bridge.send("layouts",ri.clearDefaultGlobal,void 0,void 0,{includeOperationCheck:!0})}))}onAdded(e){return this.export("Global").then((t=>t.forEach((t=>e(t))))).catch((()=>{})),this.export("Workspace").then((t=>t.forEach((t=>e(t))))).catch((()=>{})),this.registry.add(ri.layoutAdded.name,e)}onChanged(e){return this.registry.add(ri.layoutChanged.name,e)}onRemoved(e){return this.registry.add(ri.layoutRemoved.name,e)}subscribeOnSaveRequested(e){if("function"!==typeof e)throw new Error("Cannot subscribe to onSaveRequested, because the provided argument is not a valid callback function.");if(this.saveRequestSubscription)throw new Error("Cannot subscribe to onSaveRequested, because this client has already subscribed and only one subscription is supported. Consider unsubscribing from the initial one.");return this.saveRequestSubscription=e,()=>{delete this.saveRequestSubscription}}handleOnAdded(e){return l(this,void 0,void 0,(function*(){this.registry.execute(ri.layoutAdded.name,e)}))}handleOnChanged(e){return l(this,void 0,void 0,(function*(){this.registry.execute(ri.layoutChanged.name,e)}))}handleOnRemoved(e){return l(this,void 0,void 0,(function*(){this.registry.execute(ri.layoutRemoved.name,e)}))}}const si={raiseNotification:{name:"raiseNotification",dataDecoder:dn,resultDecoder:ln},requestPermission:{name:"requestPermission",resultDecoder:hn},notificationShow:{name:"notificationShow",dataDecoder:fn},notificationClick:{name:"notificationClick",dataDecoder:fn},getPermission:{name:"getPermission",resultDecoder:pn},list:{name:"list",resultDecoder:En},notificationRaised:{name:"notificationRaised",dataDecoder:An},notificationClosed:{name:"notificationClosed",dataDecoder:Pn},click:{name:"click"},clear:{name:"clear"},clearAll:{name:"clearAll"}};var ai={},ci={get exports(){return ai},set exports(e){ai=e}},ui={},di={get exports(){return ui},set exports(e){ui=e}},li=1;var hi,pi,fi,gi={nextValue:function(){return(li=(9301*li+49297)%233280)/233280},seed:function(e){li=e}},mi="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function vi(){fi=!1}function yi(e){if(e){if(e!==hi){if(e.length!==mi.length)throw new Error("Custom alphabet for shortid must be "+mi.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+mi.length+" unique characters. These characters were not unique: "+t.join(", "));hi=e,vi()}}else hi!==mi&&(hi=mi,vi())}function wi(){return fi||(fi=function(){hi||yi(mi);for(var e,t=hi.split(""),n=[],i=gi.nextValue();t.length>0;)i=gi.nextValue(),e=Math.floor(i*t.length),n.push(t.splice(e,1)[0]);return n.join("")}())}var bi,_i={get:function(){return hi||mi},characters:function(e){return yi(e),hi},seed:function(e){gi.seed(e),pi!==e&&(vi(),pi=e)},lookup:function(e){return wi()[e]},shuffled:wi},Ii="object"===typeof window&&(window.crypto||window.msCrypto);bi=Ii&&Ii.getRandomValues?function(e){return Ii.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t};var Ci=_i,Si=bi,ki=function(e,t,n){for(var i=(2<<Math.log(t.length-1)/Math.LN2)-1,r=-~(1.6*i*n/t.length),o="";;)for(var s=e(r),a=r;a--;)if((o+=t[s[a]&i]||"").length===+n)return o};var xi,Ti,Ai=function(e){for(var t,n=0,i="";!t;)i+=ki(Si,Ci.get(),1),t=e<Math.pow(16,n+1),n++;return i},Ei=Ai;var Pi=function(e){var t="",n=Math.floor(.001*(Date.now()-1567752802062));return n===Ti?xi++:(xi=0,Ti=n),t+=Ei(7),t+=Ei(e),xi>0&&(t+=Ei(xi)),t+=Ei(n)},Mi=_i;var Ri=function(e){return!(!e||"string"!==typeof e||e.length<6)&&!new RegExp("[^"+Mi.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)};!function(e){var t=_i,n=Pi,i=Ri,r=0;function o(){return n(r)}e.exports=o,e.exports.generate=o,e.exports.seed=function(n){return t.seed(n),e.exports},e.exports.worker=function(t){return r=t,e.exports},e.exports.characters=function(e){return void 0!==e&&t.characters(e),t.shuffled()},e.exports.isValid=i}(di),ci.exports=ui;var Ni=Bn(ai);class Oi{constructor(){this.registry=Hn(),this.notifications={}}handlePlatformShutdown(){this.notifications={},this.registry.clear()}start(e,t){return l(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("notifications.controller.web"),this.logger.trace("starting the web notifications controller"),this.bridge=t.bridge,this.coreGlue=e,this.notificationsSettings=t.config.notifications,this.buildNotificationFunc=t.buildNotification;const n=this.toApi();this.addOperationExecutors(),e.notifications=n,this.logger.trace("notifications are ready")}))}handleBridgeMessage(e){return l(this,void 0,void 0,(function*(){const t=De.runWithException(e.operation),n=si[t];if(!n.execute)return;let i=e.data;return n.dataDecoder&&(i=n.dataDecoder.runWithException(e.data)),yield n.execute(i)}))}toApi(){const e={raise:this.raise.bind(this),requestPermission:this.requestPermission.bind(this),getPermission:this.getPermission.bind(this),list:this.list.bind(this),onRaised:this.onRaised.bind(this),onClosed:this.onClosed.bind(this),click:this.click.bind(this),clear:this.clear.bind(this),clearAll:this.clearAll.bind(this)};return Object.freeze(e)}getPermission(){return l(this,void 0,void 0,(function*(){return(yield this.bridge.send("notifications",si.getPermission,void 0)).permission}))}requestPermission(){return l(this,void 0,void 0,(function*(){return(yield this.bridge.send("notifications",si.requestPermission,void 0)).permissionGranted}))}raise(e){return l(this,void 0,void 0,(function*(){const t=cn.runWithException(e);t.showToast="boolean"!==typeof t.showToast||t.showToast,t.showInPanel="boolean"!==typeof t.showInPanel||t.showInPanel;if(!(yield this.requestPermission()))throw new Error("Cannot raise the notification, because the user has declined the permission request");const n=ai.generate(),i=yield this.bridge.send("notifications",si.raiseNotification,{settings:t,id:n}),r=this.buildNotificationFunc(i.settings,n);return this.notifications[n]=r,r}))}list(){return l(this,void 0,void 0,(function*(){return(yield this.bridge.send("notifications",si.list,void 0,void 0,{includeOperationCheck:!0})).notifications}))}onRaised(e){if("function"!==typeof e)throw new Error("onRaised expects a callback of type function");return this.registry.add("notification-raised",e)}onClosed(e){if("function"!==typeof e)throw new Error("onRaised expects a callback of type function");return this.registry.add("notification-closed",e)}click(e,t){return l(this,void 0,void 0,(function*(){Ee.runWithException(e),t&&Ee.runWithException(t),yield this.bridge.send("notifications",si.click,{id:e,action:t},void 0,{includeOperationCheck:!0})}))}clear(e){return l(this,void 0,void 0,(function*(){Ee.runWithException(e),yield this.bridge.send("notifications",si.clear,{id:e},void 0,{includeOperationCheck:!0})}))}clearAll(){return l(this,void 0,void 0,(function*(){yield this.bridge.send("notifications",si.clearAll,void 0,void 0,{includeOperationCheck:!0})}))}addOperationExecutors(){si.notificationShow.execute=this.handleNotificationShow.bind(this),si.notificationClick.execute=this.handleNotificationClick.bind(this),si.notificationRaised.execute=this.handleNotificationRaised.bind(this),si.notificationClosed.execute=this.handleNotificationClosed.bind(this)}handleNotificationShow(e){return l(this,void 0,void 0,(function*(){if(!e.id)return;const t=this.notifications[e.id];t&&t.onshow&&t.onshow()}))}handleNotificationClick(e){var t,n,i,r,o;return l(this,void 0,void 0,(function*(){if(!e.action&&(null===(t=this.notificationsSettings)||void 0===t?void 0:t.defaultClick)&&this.notificationsSettings.defaultClick(this.coreGlue,e.definition),e.action&&(null===(i=null===(n=this.notificationsSettings)||void 0===n?void 0:n.actionClicks)||void 0===i?void 0:i.some((t=>t.action===e.action)))){(null===(o=null===(r=this.notificationsSettings)||void 0===r?void 0:r.actionClicks)||void 0===o?void 0:o.find((t=>t.action===e.action))).handler(this.coreGlue,e.definition)}if(!e.id)return;const s=this.notifications[e.id];s&&s.onclick&&(s.onclick(),delete this.notifications[e.id])}))}handleNotificationRaised(e){return l(this,void 0,void 0,(function*(){this.registry.execute("notification-raised",e.notification)}))}handleNotificationClosed(e){return l(this,void 0,void 0,(function*(){this.registry.execute("notification-closed",e)}))}}const ji={getIntents:{name:"getIntents",resultDecoder:Vt},findIntent:{name:"findIntent",dataDecoder:$t,resultDecoder:Vt},raiseIntent:{name:"raiseIntent",dataDecoder:Qt,resultDecoder:en},raise:{name:"raise",dataDecoder:Zt,resultDecoder:en}},Di=2147483647;class Fi{constructor(){this.myIntents=new Set,this.useIntentsResolverUI=!0,this.unregisterIntentPromises=[]}start(e,t){return l(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("intents.controller.web"),this.logger.trace("starting the web intents controller"),this.bridge=t.bridge,this.interop=e.interop,this.legacyIntentsController=t.legacyIntentsHelper,this.checkIfIntentsResolverIsEnabled(t.config);const n=this.toApi();this.logger.trace("no need for platform registration, attaching the intents property to glue and returning"),e.intents=n}))}handlePlatformShutdown(){this.myIntents=new Set,this.unregisterIntentPromises=[]}handleBridgeMessage(e){return l(this,void 0,void 0,(function*(){const t=Ut.runWithException(e.operation),n=ji[t];if(!n.execute)return;let i=e.data;return n.dataDecoder&&(i=n.dataDecoder.runWithException(e.data)),yield n.execute(i)}))}toApi(){return{raise:this.raise.bind(this),all:this.all.bind(this),addIntentListener:this.addIntentListener.bind(this),register:this.register.bind(this),find:this.find.bind(this)}}raise(e){return l(this,void 0,void 0,(function*(){const t=Yt.runWithException(e),n="string"===typeof t?{intent:t}:t;yield Promise.all(this.unregisterIntentPromises);const i=this.buildIntentRequestWithResolverInfo(n),r=yield this.isRaiseOperationSupported();if(!r.supported)return this.logger.warn("".concat(r.reason,". Invoking legacy raise method")),this.legacyIntentsController.raise(i,this.find.bind(this));this.logger.trace("Sending raise request to the platform: ".concat(JSON.stringify(e)," and method response timeout of ").concat(this.intentResolverResponseTimeout,"ms"));const o=n.waitUserResponseIndefinitely?Di:(n.timeout||this.intentResolverResponseTimeout)+3e4;return yield this.bridge.send("intents",ji.raise,i,{methodResponseTimeoutMs:o,waitTimeoutMs:o})}))}buildIntentRequestWithResolverInfo(e){return{intentRequest:e,resolverConfig:{enabled:this.useIntentsResolverUI,appName:this.intentsResolverAppName,waitResponseTimeout:e.waitUserResponseIndefinitely?Di:this.intentResolverResponseTimeout}}}isRaiseOperationSupported(){return l(this,void 0,void 0,(function*(){try{const{isSupported:e}=yield this.bridge.send("intents",Vn.operationCheck,{operation:"raise"});return{supported:e,reason:e?"":'The platform of this client is outdated and does not support "raise" operation'}}catch(e){return{supported:!1,reason:'The platform of this client is outdated and does not support "operationCheck" command'}}}))}all(){return l(this,void 0,void 0,(function*(){yield Promise.all(this.unregisterIntentPromises);return(yield this.bridge.send("intents",ji.getIntents,void 0)).intents}))}addIntentListener(e,t){if(nn.runWithException(e),"function"!==typeof t)throw new Error("Cannot add intent listener, because the provided handler is not a function!");let n;const i="string"===typeof e?e:e.intent,r=this.buildInteropMethodName(i);if(this.myIntents.has(i))throw new Error("Intent listener for intent ".concat(i," already registered!"));this.myIntents.add(i);const o={unsubscribe:()=>{this.myIntents.delete(i),n.then((()=>this.interop.unregister(r))).catch((e=>this.logger.trace("Unregistration of a method with name ".concat(r," failed with reason: ").concat(e))))}};let s={};if("object"===typeof e){s=d(e,["intent"])}return n=this.interop.register({name:r,flags:{intent:s}},(e=>{if(this.myIntents.has(i)){const n=d(e,["_initialCallerId"]);return t(n)}})),n.catch((e=>{this.myIntents.delete(i),this.logger.warn("Registration of a method with name ".concat(r," failed with reason: ").concat(e))})),o}register(e,t){return l(this,void 0,void 0,(function*(){if(nn.runWithException(e),"function"!==typeof t)throw new Error("Cannot add intent listener, because the provided handler is not a function!");yield Promise.all(this.unregisterIntentPromises);const n="string"===typeof e?e:e.intent,i=this.buildInteropMethodName(n);if(this.myIntents.has(n))throw new Error("Intent listener for intent ".concat(n," already registered!"));this.myIntents.add(n);let r={};if("object"===typeof e){r=d(e,["intent"])}try{yield this.interop.register({name:i,flags:{intent:r}},(e=>{if(this.myIntents.has(n)){const{_initialCallerId:n}=e,i=d(e,["_initialCallerId"]),r=this.interop.servers().find((e=>e.instance===n));return t(i,r)}}))}catch(W){throw this.myIntents.delete(n),new Error("Registration of a method with name ".concat(i," failed with reason: ").concat(JSON.stringify(W)))}return{unsubscribe:()=>this.unsubscribeIntent(n)}}))}find(e){return l(this,void 0,void 0,(function*(){let t;if("undefined"!==typeof e){const n=Kt.runWithException(e);"string"===typeof n?t={filter:{name:n}}:"object"===typeof n&&(t={filter:n})}yield Promise.all(this.unregisterIntentPromises);return(yield this.bridge.send("intents",ji.findIntent,t)).intents}))}checkIfIntentsResolverIsEnabled(e){var t,n,i,r,o;this.useIntentsResolverUI="boolean"!==typeof(null===(t=e.intents)||void 0===t?void 0:t.enableIntentsResolverUI)||e.intents.enableIntentsResolverUI,this.intentsResolverAppName=null!==(i=null===(n=e.intents)||void 0===n?void 0:n.intentsResolverAppName)&&void 0!==i?i:"intentsResolver",this.intentResolverResponseTimeout=null!==(o=null===(r=e.intents)||void 0===r?void 0:r.methodResponseTimeoutMs)&&void 0!==o?o:6e4}clearUnregistrationPromise(e){this.unregisterIntentPromises=this.unregisterIntentPromises.filter((t=>t!==e))}buildInteropMethodName(e){return"".concat("Tick42.FDC3.Intents.").concat(e)}unsubscribeIntent(e){this.myIntents.delete(e);const t=this.buildInteropMethodName(e),n=this.interop.unregister(t);this.unregisterIntentPromises.push(n),n.then((()=>{this.clearUnregistrationPromise(n)})).catch((e=>{this.logger.error("Unregistration of a method with name ".concat(t," failed with reason: ").concat(e)),this.clearUnregistrationPromise(n)}))}}const Wi={name:"platformUnload"},Li={name:"transportSwitchRequest"},Ui={name:"transportSwitchResponse"},qi={name:"getCurrentTransport"},Bi={name:"getCurrentTransportResponse"},Gi={name:"checkPreferredLogic"},Hi={name:"checkPreferredConnection"},zi={name:"checkPreferredLogicResponse"},Vi={name:"checkPreferredConnectionResponse"},Ji="web-platform",Ki="latest_fdc3_type",$i={addChannel:{name:"addChannel",dataDecoder:un},getMyChannel:{name:"getMyChannel",resultDecoder:On},getWindowIdsOnChannel:{name:"getWindowIdsOnChannel",dataDecoder:Mn,resultDecoder:Rn},getWindowIdsWithChannels:{name:"getWindowIdsWithChannels",dataDecoder:Dn,resultDecoder:Fn},joinChannel:{name:"joinChannel",dataDecoder:Un}};class Qi{constructor(){this.registry=Hn(),this.GlueWebChannelsPrefix="___channel___",this.SubsKey="subs",this.ChangedKey="changed",this.replaySubscribe=(e,t)=>{this.get(t).then((t=>{if("object"===typeof t.data&&Object.keys(t.data).length){const n=this.createContextName(t.name);return this.contexts.subscribe(n,((t,n,i,r,o)=>{e(t.data,t,null===o||void 0===o?void 0:o.updaterId)}))}})).then((e=>{e&&"function"===typeof e&&e()})).catch((e=>this.logger.trace(e)))}}handlePlatformShutdown(){this.registry.clear()}addOperationsExecutors(){$i.getMyChannel.execute=this.handleGetMyChannel.bind(this),$i.joinChannel.execute=this.handleJoinChannel.bind(this)}start(e,t){return l(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("channels.controller.web"),this.logger.trace("starting the web channels controller"),this.contexts=e.contexts,this.addOperationsExecutors(),this.bridge=t.bridge,this.windowsController=t.windowsController,this.sessionController=t.sessionController,this.logger.trace("no need for platform registration, attaching the channels property to glue and returning");const n=this.toApi();e.channels=n}))}handleBridgeMessage(e){return l(this,void 0,void 0,(function*(){const t=Nn.runWithException(e.operation),n=$i[t];if(!n.execute)return;let i=e.data;return n.dataDecoder&&(i=n.dataDecoder.runWithException(e.data)),yield n.execute(i)}))}list(){return l(this,void 0,void 0,(function*(){const e=this.getAllChannelNames();return yield Promise.all(e.map((e=>this.get(e))))}))}my(){return this.current()}handleGetMyChannel(){return l(this,void 0,void 0,(function*(){const e=this.my();return e?{channel:e}:{}}))}join(e,t){return l(this,void 0,void 0,(function*(){const n=this.getAllChannelNames();rn(n).runWithException(e),Me.runWithException(t),t&&t!==this.windowsController.my().id?yield this.bridge.send("channels",$i.joinChannel,{channel:e,windowId:t},void 0,{includeOperationCheck:!0}):yield this.switchToChannel(e)}))}handleJoinChannel(e){let{channel:t,windowId:n}=e;return this.join(t,n)}onChanged(e){return this.changed(e)}leave(){return l(this,void 0,void 0,(function*(){yield this.switchToChannel()}))}toApi(){const e={subscribe:this.subscribe.bind(this),subscribeFor:this.subscribeFor.bind(this),publish:this.publish.bind(this),all:this.all.bind(this),list:this.list.bind(this),get:this.get.bind(this),join:this.join.bind(this),leave:this.leave.bind(this),current:this.current.bind(this),my:this.my.bind(this),changed:this.changed.bind(this),onChanged:this.onChanged.bind(this),add:this.add.bind(this),getMy:this.getMy.bind(this),getWindowsOnChannel:this.getWindowsOnChannel.bind(this),getWindowsWithChannels:this.getWindowsWithChannels.bind(this)};return Object.freeze(e)}createContextName(e){return"".concat(this.GlueWebChannelsPrefix).concat(e)}getAllChannelNames(){return this.contexts.all().filter((e=>e.startsWith(this.GlueWebChannelsPrefix))).map((e=>e.replace(this.GlueWebChannelsPrefix,"")))}unsubscribe(){this.unsubscribeFunc&&(this.unsubscribeFunc(),this.unsubscribeFunc=void 0)}switchToChannel(e){return l(this,void 0,void 0,(function*(){if(this.unsubscribe(),this.currentChannelName=e,"undefined"!==typeof e){const t=this.createContextName(e);this.unsubscribeFunc=yield this.contexts.subscribe(t,((e,t,n,i,r)=>{this.registry.execute(this.SubsKey,e.data,e,null===r||void 0===r?void 0:r.updaterId)}))}this.registry.execute(this.ChangedKey,e),this.sessionController.setWindowData({currentName:e},"channels")}))}updateData(e,t){return l(this,void 0,void 0,(function*(){const n=this.createContextName(e),i=this.getFDC3Type(t);if(this.contexts.setPathSupported){const e=Object.keys(t).map((e=>({path:"data.".concat(e),value:t[e]})));i&&e.push({path:Ki,value:i}),yield this.contexts.setPaths(n,e)}else i&&(t[Ki]=i),yield this.contexts.update(n,{data:t})}))}getFDC3Type(e){const t=Object.keys(e).filter((e=>0===e.indexOf("fdc3_")));if(0!==t.length){if(t.length>1)throw new Error("FDC3 does not support updating of multiple context keys");return t[0].split("_").slice(1).join("_")}}subscribe(e){if("function"!==typeof e)throw new Error("Cannot subscribe to channels, because the provided callback is not a function!");const t=this.current();return t&&this.replaySubscribe(e,t),this.registry.add(this.SubsKey,e)}subscribeFor(e,t){return l(this,void 0,void 0,(function*(){const n=this.getAllChannelNames();if(rn(n).runWithException(e),"function"!==typeof t)throw new Error("Cannot subscribe to channel ".concat(e,", because the provided callback is not a function!"));const i=this.createContextName(e);return this.contexts.subscribe(i,((e,n,i,r,o)=>{t(e.data,e,null===o||void 0===o?void 0:o.updaterId)}))}))}publish(e,t){if("object"!==typeof e)throw new Error("Cannot publish to channel, because the provided data is not an object!");if("undefined"!==typeof t){const n=this.getAllChannelNames();return rn(n).runWithException(t),this.updateData(t,e)}if("undefined"===typeof this.currentChannelName)throw new Error("Cannot publish to channel, because not joined to a channel!");return this.updateData(this.currentChannelName,e)}all(){return l(this,void 0,void 0,(function*(){return this.getAllChannelNames()}))}get(e){return l(this,void 0,void 0,(function*(){const t=this.getAllChannelNames();rn(t).runWithException(e);const n=this.createContextName(e),i=yield this.contexts.get(n);if(i.latest_fdc3_type){const e=d(i,["latest_fdc3_type"]);return Object.assign({},e)}return i}))}current(){return this.currentChannelName}changed(e){if("function"!==typeof e)throw new Error("Cannot subscribe to channel changed, because the provided callback is not a function!");return this.registry.add(this.ChangedKey,e)}add(e){return l(this,void 0,void 0,(function*(){const t=un.runWithException(e);if(this.getAllChannelNames().includes(t.name))throw new Error("There's an already existing channel with such name");return yield this.bridge.send("channels",$i.addChannel,t),t}))}getMy(){return l(this,void 0,void 0,(function*(){if(this.currentChannelName)return this.get(this.currentChannelName)}))}getWindowsOnChannel(e){return l(this,void 0,void 0,(function*(){const t=this.getAllChannelNames();rn(t).runWithException(e);const{windowIds:n}=yield this.bridge.send("channels",$i.getWindowIdsOnChannel,{channel:e},void 0,{includeOperationCheck:!0});return n.reduce(((e,t)=>{const n=this.windowsController.findById(t);return n?[...e,n]:e}),[])}))}getWindowsWithChannels(e){return l(this,void 0,void 0,(function*(){const t=void 0!==e?{filter:jn.runWithException(e)}:{},{windowIdsWithChannels:n}=yield this.bridge.send("channels",$i.getWindowIdsWithChannels,t,void 0,{includeOperationCheck:!0});return n.reduce(((e,t)=>{let{application:n,channel:i,windowId:r}=t;const o=this.windowsController.findById(r);return o?[...e,{application:n,channel:i,window:o}]:e}),[])}))}}const Yi={getEnvironment:{name:"getEnvironment",resultDecoder:Xe},getBase:{name:"getBase",resultDecoder:Xe},platformShutdown:{name:"platformShutdown"}};class Xi{start(e,t){return l(this,void 0,void 0,(function*(){this.bridge=t.bridge,this.ioc=t,this.addOperationsExecutors(),yield this.setEnvironment()}))}handleBridgeMessage(e){return l(this,void 0,void 0,(function*(){const t=Fe.runWithException(e.operation),n=Yi[t];if(!n.execute)return;let i=e.data;return n.dataDecoder&&(i=n.dataDecoder.runWithException(e.data)),yield n.execute(i)}))}processPlatformShutdown(){return l(this,void 0,void 0,(function*(){Object.values(this.ioc.controllers).forEach((e=>e.handlePlatformShutdown?e.handlePlatformShutdown():null)),this.ioc.preferredConnectionController.stop(),this.ioc.eventsDispatcher.stop(),yield this.bridge.stop()}))}setEnvironment(){return l(this,void 0,void 0,(function*(){const e=yield this.bridge.send("system",Yi.getEnvironment,void 0),t=yield this.bridge.send("system",Yi.getBase,void 0),n=window.glue42core||window.iobrowser,i=window.glue42core?"glue42core":"iobrowser",r=Object.assign({},n,t,{environment:e});window[i]=Object.freeze(r)}))}addOperationsExecutors(){Yi.platformShutdown.execute=this.processPlatformShutdown.bind(this)}}class Zi{constructor(e,t){this.onclick=()=>{},this.onshow=()=>{},this.id=t,this.badge=e.badge,this.body=e.body,this.data=e.data,this.dir=e.dir,this.icon=e.icon,this.image=e.image,this.lang=e.lang,this.renotify=e.renotify,this.requireInteraction=e.requireInteraction,this.silent=e.silent,this.tag=e.tag,this.timestamp=e.timestamp,this.vibrate=e.vibrate,this.title=e.title,this.clickInterop=e.clickInterop,this.actions=e.actions,this.focusPlatformOnDefaultClick=e.focusPlatformOnDefaultClick,this.severity=e.severity,this.showToast=e.showToast,this.showInPanel=e.showInPanel}}N(E("clientHello"));const er={clientHello:{name:"clientHello",resultDecoder:P({widget:P({inject:T()})})}};class tr{constructor(){this.channels=[],this.unsubFuncs=[],this.contentCommands={widgetVisualizationPermission:{name:"widgetVisualizationPermission",handle:this.handleWidgetVisualizationPermission.bind(this)},changeChannel:{name:"changeChannel",handle:this.handleChangeChannel.bind(this)}}}handlePlatformShutdown(){this.unsubFuncs.forEach((e=>e())),this.channels=[],this.unsubFuncs=[]}start(e,t){return l(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("extension.controller.web"),this.windowId=t.publicWindowId,this.logger.trace("starting the extension web controller"),this.bridge=t.bridge,this.channelsController=t.channelsController,this.eventsDispatcher=t.eventsDispatcher;try{yield this.registerWithPlatform()}catch(r){return}this.channels=yield this.channelsController.list();const n=this.eventsDispatcher.onContentMessage(this.handleContentMessage.bind(this)),i=this.channelsController.onChanged((e=>{this.eventsDispatcher.sendContentMessage({command:"channelChange",newChannel:e})}));this.unsubFuncs.push(n),this.unsubFuncs.push(i)}))}handleBridgeMessage(e){return l(this,void 0,void 0,(function*(){}))}handleContentMessage(e){if(!e||"string"!==typeof e.command)return;const t=this.contentCommands[e.command];t&&t.handle(e)}registerWithPlatform(){return l(this,void 0,void 0,(function*(){this.logger.trace("registering with the platform"),this.config=yield this.bridge.send("extension",er.clientHello,{windowId:this.windowId}),this.logger.trace("the platform responded to the hello message with a valid extension config")}))}handleWidgetVisualizationPermission(){var e;return l(this,void 0,void 0,(function*(){if(!(null===(e=this.config)||void 0===e?void 0:e.widget.inject))return this.eventsDispatcher.sendContentMessage({command:"permissionResponse",allowed:!1});const t=this.channels.find((e=>e.name===this.channelsController.my()));this.eventsDispatcher.sendContentMessage({command:"permissionResponse",allowed:!0,channels:this.channels,currentChannel:t})}))}handleChangeChannel(e){return l(this,void 0,void 0,(function*(){"no-channel"!==e.name?yield this.channelsController.join(e.name):yield this.channelsController.leave()}))}}class nr{constructor(e){this.config=e,this.registry=Hn(),this.glue42EventName="Glue42",this.events={notifyStarted:{name:"notifyStarted",handle:this.handleNotifyStarted.bind(this)},contentInc:{name:"contentInc",handle:this.handleContentInc.bind(this)},requestGlue:{name:"requestGlue",handle:this.handleRequestGlue.bind(this)}}}stop(){window.removeEventListener(this.glue42EventName,this._handleMessage)}start(e){this.glue=e,this.wireCustomEventListener(),this.announceStarted()}sendContentMessage(e){this.send("contentOut","glue42core",e)}onContentMessage(e){return this.registry.add("content-inc",e)}wireCustomEventListener(){this._handleMessage=this.handleMessage.bind(this),window.addEventListener(this.glue42EventName,this._handleMessage)}handleMessage(e){var t;const n=e.detail,i=null!==(t=null===n||void 0===n?void 0:n.glue42)&&void 0!==t?t:null===n||void 0===n?void 0:n.glue42core;if(!i)return;const r=i.event,o=this.events[r];o&&o.handle(i.message)}announceStarted(){this.send("start","glue42")}handleRequestGlue(){this.config.exposeAPI?this.send("requestGlueResponse","glue42",{glue:this.glue}):this.send("requestGlueResponse","glue42",{error:"Will not give access to the underlying Glue API, because it was explicitly denied upon initialization."})}handleNotifyStarted(){this.announceStarted()}handleContentInc(e){this.registry.execute("content-inc",e)}send(e,t,n){const i={};i[t]={event:e,message:n};const r=new CustomEvent(this.glue42EventName,{detail:i});window.dispatchEvent(r)}}class ir{constructor(e){this.coreGlue=e,this.transactionTimeout=15e3,this.transactionLocks={},this.reconnectCounter=0,this.logger=this.coreGlue.logger.subLogger("web.preferred.connection.controller")}stop(){this.webPlatformMessagesUnsubscribe&&this.webPlatformMessagesUnsubscribe()}start(e){return l(this,void 0,void 0,(function*(){if(e.isPlatformInternal)return void this.logger.trace("This is an internal client to the platform, skipping all client preferred communication logic.");if(!(this.coreGlue.connection.transport.name()===Ji))throw new Error("Cannot initiate the Glue Web Bridge, because the initial connection was not handled by a Web Platform transport.");if(!this.coreGlue.connection.transport.isPreferredActivated)return void this.logger.trace("The platform of this client was configured without a preferred connection, skipping the rest of the initialization.");this.webPlatformTransport=this.coreGlue.connection.transport,this.webPlatformMessagesUnsubscribe=this.webPlatformTransport.onMessage(this.handleWebPlatformMessage.bind(this));const t=yield this.getCurrentPlatformTransportState();yield this.checkSwitchTransport(t)}))}handleWebPlatformMessage(e){if("string"===typeof e)return;const t=this.coreGlue.connection.transport.name()===Ji,n=e.type,i=e.args,r=e.transactionId;return n===Li.name?this.handleTransportSwitchRequest(i,r):n!==Wi.name||t?n===Bi.name?this.handleGetCurrentTransportResponse(i,r):n===Gi.name?this.handleCheckPreferredLogic(r):n===Hi.name?this.handleCheckPreferredConnection(i,r):void 0:this.handlePlatformUnload()}reEstablishPlatformPort(){return l(this,void 0,void 0,(function*(){try{yield this.webPlatformTransport.connect()}catch(t){if(this.logger.trace("Error when re-establishing port connection to the platform: ".concat(JSON.stringify(t))),--this.reconnectCounter,this.reconnectCounter>0)return this.reEstablishPlatformPort();this.logger.warn("This client lost connection to the platform while connected to a preferred GW and was not able to re-connect to the platform.")}this.logger.trace("The connection to the platform was re-established, closing the connection to the web gateway."),this.reconnectCounter=0,this.webPlatformTransport.close();const e=yield this.getCurrentPlatformTransportState();yield this.checkSwitchTransport(e)}))}checkSwitchTransport(e){return l(this,void 0,void 0,(function*(){const t=this.coreGlue.connection.transport.name();if(t===e.transportName)return void this.logger.trace("A check switch was requested, but the platform transport and my transport are identical, no switch is necessary");this.logger.trace("A check switch was requested and a transport switch is necessary, because this client is now on ".concat(t,", but it should reconnect to ").concat(JSON.stringify(e)));const n=yield this.coreGlue.connection.switchTransport(e);this.setConnected(),this.logger.trace("The transport switch was completed with result: ".concat(JSON.stringify(n)))}))}getCurrentPlatformTransportState(){return l(this,void 0,void 0,(function*(){this.logger.trace("Requesting the current transport state of the platform.");const e=this.setTransaction(qi.name);this.sendPlatformMessage(qi.name,e.id);const t=yield e.lock;return this.logger.trace("The platform responded with transport state: ".concat(JSON.stringify(t))),t}))}setTransaction(e){const t={},n=ai.generate(),i=new Promise(((i,r)=>{let o=!0;t.lift=e=>{o=!1,delete this.transactionLocks[n],i(e)},t.fail=e=>{o=!1,delete this.transactionLocks[n],r(e)},setTimeout((()=>{o&&(o=!1,this.logger.warn("Transaction for operation: ".concat(e," timed out.")),delete this.transactionLocks[n],r("Transaction for operation: ".concat(e," timed out.")))}),this.transactionTimeout)}));return t.lock=i,t.id=n,this.transactionLocks[n]=t,t}sendPlatformMessage(e,t,n){this.logger.trace("Sending a platform message of type: ".concat(e,", id: ").concat(t," and args: ").concat(JSON.stringify(n))),this.webPlatformTransport.sendObject({glue42core:{type:e,args:n,transactionId:t}})}handleTransportSwitchRequest(e,t){this.logger.trace("Received a transport switch request with id: ".concat(t," and data: ").concat(JSON.stringify(e))),this.coreGlue.connection.switchTransport(e.switchSettings).then((e=>{this.logger.trace("The transport switch was completed with result: ".concat(JSON.stringify(e))),this.setConnected(),this.sendPlatformMessage(Ui.name,t,{success:e.success})})).catch((e=>{this.logger.error(e),this.sendPlatformMessage(Ui.name,t,{success:!1})}))}handlePlatformUnload(){this.reconnectCounter=5,this.logger.trace("The platform was unloaded while I am connected to a preferred connection, re-establishing the port connection."),this.reEstablishPlatformPort()}handleGetCurrentTransportResponse(e,t){this.logger.trace("Got a current transport response from the platform with id: ".concat(t," and data: ").concat(JSON.stringify(e)));const n=e.transportState,i=this.transactionLocks[t];null===i||void 0===i||i.lift(n)}handleCheckPreferredLogic(e){setTimeout((()=>this.sendPlatformMessage(zi.name,e)),0)}handleCheckPreferredConnection(e,t){const n=e.url;this.logger.trace("Testing the possible connection to: ".concat(n)),this.checkPreferredConnection(n).then((e=>{this.logger.trace("The connection to ".concat(n," is possible")),this.sendPlatformMessage(Vi.name,t,e)})).catch((e=>{this.logger.trace("The connection to ".concat(n," is not possible")),this.sendPlatformMessage(Vi.name,t,{error:e})}))}checkPreferredConnection(e){return new Promise((t=>{const n=new WebSocket(e);n.onerror=()=>t({live:!1}),n.onopen=()=>{n.close(),t({live:!0})}}))}setConnected(){this.webPlatformTransport.manualSetReadyState()}}class rr{constructor(e,t,n,i,r){this.bridge=t,this.interop=n,this.appManagerController=i,this.windowsController=r,this.intentsResolverResponsePromises={},this.logger=this.configureLogger(e)}raise(e,t){var n;return l(this,void 0,void 0,(function*(){const{intentRequest:i,resolverConfig:r}=e,o=(yield t(i.intent)).find((e=>e.name===i.intent));if(!o)throw new Error("Intent with name ".concat(i.intent," not found"));const{open:s,reason:a}=this.checkIfResolverShouldBeOpened(o,i,r);if(!s)return null===(n=this.logger)||void 0===n||n.trace("Intent Resolver UI won't be used. Reason: ".concat(a)),this.invokeRaiseIntent(i);return yield this.raiseIntentWithResolverApp(e)}))}configureLogger(e){return e.subLogger("intents.legacy.helper.web")}raiseIntentWithResolverApp(e){return l(this,void 0,void 0,(function*(){const{intentRequest:t,resolverConfig:n}=e;this.logger.trace("Intents Resolver UI with app name ".concat(n.appName," will be used"));const i=yield this.registerResponseMethod();this.logger.trace("Registered interop method ".concat(i));const r=yield this.openIntentResolverApplication(e,i);this.logger.trace("Intents Resolver Instance with id ".concat(r.id," opened"));const o=yield this.handleInstanceResponse(r.id),s="app"===o.type?{app:o.applicationName}:{instance:o.instanceId};this.logger.trace("Intent handler chosen by the user: ".concat(JSON.stringify(s)));return yield this.invokeRaiseIntent(Object.assign(Object.assign({},t),{target:s}))}))}handleInstanceResponse(e){var t;return l(this,void 0,void 0,(function*(){try{const{handler:n,intent:i}=yield this.intentsResolverResponsePromises[e].promise;return null===(t=this.logger)||void 0===t||t.trace("Intent handler chosen for intent ".concat(i,": ").concat(JSON.stringify(n))),this.stopResolverInstance(e),n}catch(n){throw this.stopResolverInstance(e),new Error(n)}}))}invokeRaiseIntent(e){return this.bridge.send("intents",ji.raiseIntent,e)}registerResponseMethod(){return l(this,void 0,void 0,(function*(){const e="T42.Intents.Resolver.Control."+Ni();return yield this.interop.register(e,this.resolverResponseHandler.bind(this)),e}))}openIntentResolverApplication(e,t){return l(this,void 0,void 0,(function*(){const{intentRequest:n,resolverConfig:i}=e,r=this.buildStartContext(n,t),o=yield this.buildStartOptions();this.logger.trace("Starting Intents Resolver UI with context: ".concat(JSON.stringify(r)," and options: ").concat(o));const s=yield this.appManagerController.getApplication(i.appName).start(r,o);return this.logger.trace("Intents Resolver instance with id ".concat(s.id," opened")),this.subscribeOnInstanceStopped(s),this.createResponsePromise(n.intent,s.id,t,i.waitResponseTimeout),s}))}cleanUpIntentResolverPromise(e){return l(this,void 0,void 0,(function*(){const t=this.intentsResolverResponsePromises[e];if(!t)return;this.interop.unregister(t.methodName).catch((e=>this.logger.warn(e))),delete this.intentsResolverResponsePromises[e]}))}buildStartContext(e,t){return{intent:e,callerId:this.interop.instance.instance,methodName:t}}buildStartOptions(){return l(this,void 0,void 0,(function*(){const e=yield this.getTargetBounds();return{top:(e.height-440)/2+e.top,left:(e.width-400)/2+e.left,width:400,height:440}}))}getTargetBounds(){return l(this,void 0,void 0,(function*(){const e=(yield this.tryGetWindowBasedBounds())||(yield this.tryGetWorkspaceBasedBounds());if(e)return this.logger.trace("Opening Intents Resolver UI with bounds: ".concat(JSON.stringify(e))),e;const t={top:window.screen.availTop||0,left:window.screen.availLeft||0,width:window.screen.width,height:window.screen.height};return this.logger.trace("Opening Intents Resolver UI relative to my screen bounds: ".concat(JSON.stringify(t))),t}))}tryGetWindowBasedBounds(){return l(this,void 0,void 0,(function*(){try{const e=yield this.windowsController.my().getBounds();return this.logger.trace("Opening the resolver UI relative to my window bounds: ".concat(JSON.stringify(e))),e}catch(e){this.logger.trace("Failure to get my window bounds: ".concat(JSON.stringify(e)))}}))}tryGetWorkspaceBasedBounds(){return l(this,void 0,void 0,(function*(){try{yield this.bridge.send("workspaces",Vn.operationCheck,{operation:"getWorkspaceWindowFrameBounds"});const e=(yield this.bridge.send("workspaces",Vn.getWorkspaceWindowFrameBounds,{itemId:this.windowsController.my().id})).bounds;return this.logger.trace("Opening the resolver UI relative to my workspace frame window bounds: ".concat(JSON.stringify(e))),e}catch(e){this.logger.trace("Failure to get my workspace frame window bounds: ".concat(JSON.stringify(e)))}}))}subscribeOnInstanceStopped(e){const{application:t}=e,n=t.onInstanceStopped((i=>{if(i.id!==e.id)return;const r=this.intentsResolverResponsePromises[i.id];if(!r)return n();r.reject('Cannot resolve raised intent "'.concat(r.intent,'" - User closed ').concat(t.name," app without choosing an intent handler")),this.cleanUpIntentResolverPromise(i.id),n()}))}createResponsePromise(e,t,n,i){let r=()=>{},o=()=>{};const s=Jn(((e,t)=>{r=e,o=t}),i,"Timeout of ".concat(i,"ms hit waiting for the user to choose a handler for intent ").concat(e));this.intentsResolverResponsePromises[t]={intent:e,resolve:r,reject:o,promise:s,methodName:n}}resolverResponseHandler(e,t){const n=Bt.run(e),i=t.instance;if(n.ok)return this.logger.trace("Intent Resolver instance with id ".concat(i," send a valid response: ").concat(JSON.stringify(n.result))),this.intentsResolverResponsePromises[i].resolve(n.result);this.logger.trace("Intent Resolver instance with id ".concat(i," sent an invalid response. Error: ").concat(JSON.stringify(n.error))),this.intentsResolverResponsePromises[i].reject(n.error.message),this.stopResolverInstance(i)}stopResolverInstance(e){const t=this.appManagerController.getInstances().find((t=>t.id===e));t&&t.stop().catch((e=>this.logger.error(e)))}checkIfIntentHasMoreThanOneHandler(e,t){return"object"!==typeof t.target&&(t.handlers?t.handlers.length>1:e.handlers.length>1)}checkIfResolverShouldBeOpened(e,t,n){if(!n.enabled)return{open:!1,reason:"Intent Resolver is disabled. Raising intent to first found handler"};if(!this.appManagerController.getApplication(n.appName))return{open:!1,reason:"Application with name ".concat(n.appName," not found")};return this.checkIfIntentHasMoreThanOneHandler(e,t)?{open:!0}:{open:!1,reason:"Raised intent has only one handler"}}}const or={getCurrent:{name:"getCurrent",resultDecoder:Sn},list:{name:"list",resultDecoder:kn},select:{name:"select",dataDecoder:xn}};class sr{constructor(){this.registry=Hn(),this.activeThemeSubs=0}start(e,t){return l(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("themes.controller.web"),this.logger.trace("starting the web themes controller"),this.bridge=t.bridge;const n=this.toApi();e.themes=n,this.logger.trace("themes are ready")}))}handlePlatformShutdown(){var e;this.registry.clear(),this.activeThemeSubs=0,null===(e=this.themesSubscription)||void 0===e||e.close(),delete this.themesSubscription}handleBridgeMessage(){return l(this,void 0,void 0,(function*(){}))}toApi(){const e={getCurrent:this.getCurrent.bind(this),list:this.list.bind(this),select:this.select.bind(this),onChanged:this.onChanged.bind(this)};return Object.freeze(e)}getCurrent(){return l(this,void 0,void 0,(function*(){return(yield this.bridge.send("themes",or.getCurrent,void 0,void 0,{includeOperationCheck:!0})).theme}))}list(){return l(this,void 0,void 0,(function*(){return(yield this.bridge.send("themes",or.list,void 0,void 0,{includeOperationCheck:!0})).themes}))}select(e){return l(this,void 0,void 0,(function*(){Ee.runWithException(e),yield this.bridge.send("themes",or.select,{name:e},void 0,{includeOperationCheck:!0})}))}onChanged(e){return l(this,void 0,void 0,(function*(){if("function"!==typeof e)throw new Error("onChanged requires a callback of type function");const t=this.themesSubscription?Promise.resolve():this.configureThemeSubscription();yield t,++this.activeThemeSubs;const n=this.registry.add("on-theme-change",e);return()=>this.themeUnsub(n)}))}configureThemeSubscription(){return l(this,void 0,void 0,(function*(){this.themesSubscription||(this.themesSubscription=yield this.bridge.createNotificationsSteam(),this.themesSubscription.onData((e=>{const t=e.data,n=Sn.run(t);if(!n.ok)return void this.logger.warn("Received invalid theme data on the theme event stream: ".concat(JSON.stringify(n.error)));const i=n.result;this.registry.execute("on-theme-change",i.theme)})),this.themesSubscription.onClosed((()=>{this.logger.warn("The Themes interop stream was closed, no theme changes notifications will be received"),this.registry.clear(),this.activeThemeSubs=0,delete this.themesSubscription})))}))}themeUnsub(e){var t;e(),--this.activeThemeSubs,this.activeThemeSubs||(null===(t=this.themesSubscription)||void 0===t||t.close(),delete this.themesSubscription)}}class ar{constructor(){this.sessionStorage=window.sessionStorage}get allNamespaces(){return[{namespace:this.windowNamespace,defaultValue:{}}]}configure(e){this.windowId=e.windowId,this.allNamespaces.forEach((e=>{let{namespace:t,defaultValue:n}=e;this.sessionStorage.getItem(t)||this.sessionStorage.setItem(t,JSON.stringify(n))}))}get windowNamespace(){return"io_connect_window_".concat(this.windowId)}getWindowData(){return JSON.parse(this.sessionStorage.getItem(this.windowNamespace))}setWindowData(e,t){const n=this.getWindowData();n[t]=e,this.sessionStorage.setItem(this.windowNamespace,JSON.stringify(n))}}class cr{constructor(){this.controllers={windows:this.windowsController,appManager:this.appManagerController,layouts:this.layoutsController,notifications:this.notificationsController,intents:this.intentsController,channels:this.channelsController,system:this.systemController,extension:this.extensionController,themes:this.themesController}}get communicationId(){return this._communicationId}get publicWindowId(){return this._publicWindowId}get windowsController(){return this._windowsControllerInstance||(this._windowsControllerInstance=new Kn),this._windowsControllerInstance}get appManagerController(){return this._appManagerControllerInstance||(this._appManagerControllerInstance=new ti),this._appManagerControllerInstance}get layoutsController(){return this._layoutsControllerInstance||(this._layoutsControllerInstance=new oi),this._layoutsControllerInstance}get themesController(){return this._themesControllerInstance||(this._themesControllerInstance=new sr),this._themesControllerInstance}get notificationsController(){return this._notificationsControllerInstance||(this._notificationsControllerInstance=new Oi),this._notificationsControllerInstance}get intentsController(){return this._intentsControllerInstance||(this._intentsControllerInstance=new Fi),this._intentsControllerInstance}get legacyIntentsHelper(){return this._legacyIntentsHelperInstance||(this._legacyIntentsHelperInstance=new rr(this._coreGlue.logger,this.bridge,this._coreGlue.interop,this.appManagerController,this.windowsController)),this._legacyIntentsHelperInstance}get systemController(){return this._systemControllerInstance||(this._systemControllerInstance=new Xi),this._systemControllerInstance}get channelsController(){return this._channelsControllerInstance||(this._channelsControllerInstance=new Qi),this._channelsControllerInstance}get extensionController(){return this._extensionController||(this._extensionController=new tr),this._extensionController}get eventsDispatcher(){return this._eventsDispatcher||(this._eventsDispatcher=new nr(this.config)),this._eventsDispatcher}get bridge(){return this._bridgeInstance||(this._bridgeInstance=new Zn(this._coreGlue,this.communicationId)),this._bridgeInstance}get preferredConnectionController(){return this._preferredConnectionController||(this._preferredConnectionController=new ir(this._coreGlue)),this._preferredConnectionController}get sessionController(){return this._sessionController||(this._sessionController=new ar),this._sessionController}get config(){return this._webConfig}defineGlue(e){this._coreGlue=e,this._publicWindowId=e.connection.transport.publicWindowId;const t=window.glue42core||window.iobrowser;this._communicationId=e.connection.transport.communicationId||t.communicationId}defineConfig(e){this._webConfig=e}buildWebWindow(e,t){return l(this,void 0,void 0,(function*(){const n=new zn(e,t,this.bridge),i=yield n.toApi();return{id:e,model:n,api:i}}))}buildNotification(e,t){return new Zi(e,t)}buildApplication(e,t){return l(this,void 0,void 0,(function*(){const n=new ii(e,[],this.appManagerController).toApi(),i=t.map((e=>this.buildInstance(e,n)));return n.instances.push(...i),n}))}buildInstance(e,t){return new ni(e,this.bridge,t).toApi()}}var ur="3.1.2";var dr=function(e,t){return dr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},dr(e,t)};function lr(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}dr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var hr=function(){return hr=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},hr.apply(this,arguments)};function pr(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}function fr(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function gr(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}var mr={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function vr(e){return e.type===mr.TIMESTAMP?"timestamp":e.type===mr.NUMBER?"number":e.type===mr.STRING?"string":e.type===mr.OBJECT?"object":"unknown"}function yr(e){return e.constructor===Date?"timestamp":"number"===typeof e?"number":"string"===typeof e?"string":"object"===typeof e?"object":"string"}function wr(e){var t={},n=vr(e);if("object"===n){var i=Object.keys(e.value).reduce((function(t,n){var i=yr(e.value[n]);if("object"===i){var r=br(e.value[n]);t[n]={type:"object",description:"",context:{},composite:r}}else t[n]={type:i,description:"",context:{}};return t}),{});t.composite=i}return t.name=_r(e.path.join("/")+"/"+e.name),t.type=n,t.description=e.description,t.context={},t}function br(e){return Object.keys(e).reduce((function(t,n){var i=yr(e[n]);return t[n]="object"===i?{type:"object",description:"",context:{},composite:br(e[n])}:{type:i,description:"",context:{}},t}),{})}function _r(e){return"undefined"!==typeof e&&e.length>0&&"/"!==e[0]?"/"+e:e}function Ir(e){return"timestamp"===vr(e)?Date.now():Cr(e.value)}function Cr(e){return"object"!==typeof e?e:Object.keys(e).reduce((function(t,n){var i=e[n];return"object"===typeof i&&i.constructor!==Date?t[n]=Cr(i):i.constructor===Date?t[n]=new Date(i).getTime():i.constructor===Boolean?t[n]=i.toString():t[n]=i,t}),{})}function Sr(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?Sr(t):t)}),[])}function kr(e){var t=Sr(e.root.getAggregateState()),n=t.sort((function(e,t){return e.state?t.state?t.state-e.state:-1:1}))[0],i=function(e){var t="";return e.forEach((function(e,n,i){var r=e.path.join(".");n===i.length-1?t+=r+"."+e.name+": "+e.description:t+=r+"."+e.name+": "+e.description+","})),t.length>100?t.slice(0,100)+"...":t}(t);return{description:i,value:n.state}}var xr=function(e,t,n){if(null===e||"object"!==typeof e)throw new Error("Missing definition");if(null===t||"object"!==typeof t)throw new Error("Missing parent");if(null===n||"object"!==typeof n)throw new Error("Missing transport")},Tr=function(){function e(e,t,n,i,r){this.definition=e,this.system=t,this.transport=n,this.value=i,this.type=r,this.path=[],xr(e,t,n),this.path=t.path.slice(0),this.path.push(t.name),this.name=e.name,this.description=e.description,n.createMetric(this)}return Object.defineProperty(e.prototype,"repo",{get:function(){var e;return null===(e=this.system)||void 0===e?void 0:e.repo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return"".concat(this.system.path,"/").concat(name)},enumerable:!1,configurable:!0}),e.prototype.update=function(e){return this.value=e,this.transport.updateMetric(this)},e}(),Ar=function(e){function t(t,n,i,r){return e.call(this,t,n,i,r,mr.NUMBER)||this}return lr(t,e),t.prototype.incrementBy=function(e){this.update(this.value+e)},t.prototype.increment=function(){this.incrementBy(1)},t.prototype.decrement=function(){this.incrementBy(-1)},t.prototype.decrementBy=function(e){this.incrementBy(-1*e)},t}(Tr),Er=function(e){function t(t,n,i,r){return e.call(this,t,n,i,r,mr.OBJECT)||this}return lr(t,e),t.prototype.update=function(e){return this.mergeValues(e),this.transport.updateMetric(this)},t.prototype.mergeValues=function(e){var t=this;return Object.keys(this.value).forEach((function(n){"undefined"!==typeof e[n]&&(t.value[n]=e[n])}))},t}(Tr),Pr=function(e){function t(t,n,i,r){return e.call(this,t,n,i,r,mr.STRING)||this}return lr(t,e),t}(Tr),Mr=function(e){function t(t,n,i,r){return e.call(this,t,n,i,r,mr.TIMESTAMP)||this}return lr(t,e),t.prototype.now=function(){this.update(new Date)},t}(Tr);function Rr(e,t,n,i,r){if(!t)throw new Error("Repository is required");if(!n)throw new Error("Transport is required");var o,s,a=n,c=e,u=r||"",d=t,l=i,h=function e(t){if(!t||!t.parent)return[];var n=e(t.parent);return n.push(t.name),n}(i),p={},f=(s="/",((o=h)&&o.length>0?o.join(s):"")+e),g=t.root,m=[],v=[];function y(e,t,n,i){var r={name:""};r="string"===typeof e?{name:e}:e;var o=v.filter((function(e){return e.name===r.name}));if(o.length>0){var s=o[0];if(s.type!==t)throw new Error("A metric named ".concat(r.name," is already defined with different type."));return"undefined"!==typeof n&&s.update(n).catch((function(){})),s}var a=i(r);return v.push(a),a}var w={get name(){return c},get description(){return u},get repo(){return d},get parent(){return l},path:h,id:f,root:g,get subSystems(){return m},get metrics(){return v},subSystem:function(e,t){if(!e||0===e.length)throw new Error("name is required");var n=m.filter((function(t){return t.name===e}));if(n.length>0)return n[0];var i=Rr(e,d,a,w,t);return m.push(i),i},getState:function(){return p},setState:function(e,t){p={state:e,description:t},a.updateSystem(w,p)},stringMetric:function(e,t){return y(e,mr.STRING,t,(function(e){return new Pr(e,w,a,t)}))},timestampMetric:function(e,t){return y(e,mr.TIMESTAMP,t,(function(e){return new Mr(e,w,a,t)}))},objectMetric:function(e,t){return y(e,mr.OBJECT,t,(function(e){return new Er(e,w,a,t)}))},numberMetric:function(e,t){return y(e,mr.NUMBER,t,(function(e){return new Ar(e,w,a,t)}))},getAggregateState:function(){var e=[];return Object.keys(p).length>0&&e.push({name:c,path:h,state:p.state,description:p.description}),m.forEach((function(t){var n=t.getAggregateState();n.length>0&&e.push.apply(e,n)})),e}};return a.createSystem(w),w}var Nr=function(){function e(e,t){t.init(this),this.root=Rr("",this,t),this.addSystemMetrics(this.root,e.clickStream||void 0===e.clickStream)}return e.prototype.addSystemMetrics=function(e,t){if("undefined"!==typeof navigator&&e.stringMetric("UserAgent",navigator.userAgent),t&&"undefined"!==typeof document){var n=e.subSystem("ClickStream"),i=function(e){var t;if(e.target){var i=e.target,r=i&&null!==(t=i.getAttribute("class"))&&void 0!==t?t:"";n.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:r,id:i.id,type:"<"+i.tagName.toLowerCase()+">",href:i.href||""}})}};n.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",i):document.attachEvent("onclick",i)}e.stringMetric("StartTime",(new Date).toString());var r=e.stringMetric("StartURL",""),o=e.stringMetric("AppName","");if("undefined"!==typeof window){if("undefined"!==typeof window.location){var s=window.location.href;r.update(s)}"undefined"!==typeof window.glue42gd&&o.update(window.glue42gd.appName)}},e}(),Or=function(){function e(){}return e.prototype.init=function(e){},e.prototype.createSystem=function(e){return Promise.resolve()},e.prototype.updateSystem=function(e,t){return Promise.resolve()},e.prototype.createMetric=function(e){return Promise.resolve()},e.prototype.updateMetric=function(e){return Promise.resolve()},e}(),jr=function(){function e(e,t,n){this.api=e,this.lastCount=0,this.initialPublishTimeout=1e4,this.publishInterval=6e4,this.initialPublishTimeout=null!==t&&void 0!==t?t:this.initialPublishTimeout,this.publishInterval=null!==n&&void 0!==n?n:this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}return e.prototype.scheduleCollection=function(){var e=this;setTimeout((function(){e.collect(),setInterval((function(){e.collect()}),e.publishInterval)}),this.initialPublishTimeout)},e.prototype.collect=function(){try{this.collectMemory(),this.collectEntries()}catch(e){}},e.prototype.collectMemory=function(){var e=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:e.totalJSHeapSize,usedJSHeapSize:e.usedJSHeapSize}))},e.prototype.collectEntries=function(){var e=window.performance.getEntries();if(!(e.length<=this.lastCount)){this.lastCount=e.length;var t=e.map((function(e){return e.toJSON()}));this.system.stringMetric("entries",JSON.stringify(t))}},e}(),Dr=function(e){var t;t=e.connection&&"object"===typeof e.connection?function(e,t){var n,i,r=this;if(!e||"object"!==typeof e)throw new Error("Connection is required parameter");var o=function(e){s(e.root)},s=function(e){a(e),e.metrics.forEach((function(e){c(e)})),e.subSystems.forEach((function(e){s(e)}))},a=function(e){return pr(r,void 0,void 0,(function(){var t,r;return fr(this,(function(o){switch(o.label){case 0:return void 0===e.parent?[2]:[4,n];case 1:return o.sent(),t={name:_r(e.path.join("/")+"/"+e.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},r={type:"define",metrics:[t]},i.send(r),[2]}}))}))},c=function(e){return pr(r,void 0,void 0,(function(){var t,r,o;return fr(this,(function(s){switch(s.label){case 0:return t=d(e),[4,n];case 1:return s.sent(),r=wr(t),o={type:"define",metrics:[r]},i.send(o),"undefined"!==typeof t.value&&u(t),[2]}}))}))},u=function(e){if(l()){var t=Ir(e),n={type:"publish",values:[{name:_r(e.path.join("/")+"/"+e.name),value:t,timestamp:Date.now()}]};return i.sendFireAndForget(n)}return Promise.resolve()},d=function(e){var t=hr({},e);return"object"===typeof e.value&&null!==e.value&&(t.value=hr({},e.value)),t},l=function(){var e;try{return(null!==(e=t.canUpdateMetric)&&void 0!==e?e:function(){return!0})()}catch(n){return!0}};return{init:function(r){var s;n=new Promise((function(e){s=e})),(i=e.domain("metrics")).onJoined((function(e){!e&&s&&(s(),s=void 0);var t={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};i.send(t),e&&o(r)})),i.join({system:t.system,service:t.service,instance:t.instance})},createSystem:a,updateSystem:function(t,o){return pr(r,void 0,void 0,(function(){var r,s,a;return fr(this,(function(c){switch(c.label){case 0:return[4,n];case 1:return c.sent(),r={type:"publish",values:[{name:_r(t.path.join("/")+"/"+t.name+"/State"),value:{Description:o.description,Value:o.state},timestamp:Date.now()}]},i.send(r),s=kr(t),a={type:"publish",peer_id:e.peerId,values:[{name:"/State",value:{Description:s.description,Value:s.value},timestamp:Date.now()}]},i.send(a),[2]}}))}))},createMetric:c,updateMetric:function(e){return pr(r,void 0,void 0,(function(){var t;return fr(this,(function(i){switch(i.label){case 0:return t=d(e),[4,n];case 1:return i.sent(),u(t),[2]}}))}))}}}(e.connection,e):new Or;var n=new Nr(e,t).root;e.disableAutoAppSystem||(n=n.subSystem("App"));var i=function(e){var t,n=e.subSystem("reporting"),i={name:"features"},r=function(e,r,o){if("undefined"===typeof e||""===e)throw new Error("name is mandatory");if("undefined"===typeof r||""===r)throw new Error("action is mandatory");if("undefined"===typeof o||""===o)throw new Error("payload is mandatory");t?t.update({name:e,action:r,payload:o}):t=n.objectMetric(i,{name:e,action:r,payload:o})};return e.featureMetric=r,e}(n);return function(e,t){var n,i;if("undefined"===typeof window)return;var r=null===(i=null===(n=null===window||void 0===window?void 0:window.glue42gd)||void 0===n?void 0:n.metrics)||void 0===i?void 0:i.pagePerformanceMetrics;r&&(t=r);(null===t||void 0===t?void 0:t.enabled)&&new jr(e,t.initialPublishTimeout,t.publishInterval)}(i,e.pagePerformanceMetrics),i};var Fr="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{};function Wr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Lr(e){if(e&&e.errorHandling&&"function"!==typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"===typeof e.errorHandling&&e.errorHandling,n={};function i(n,i){var r=n instanceof Error?n:new Error(n);if(t)t(r);else{var o='[ERROR] callback-registry: User callback for key "'+i+'" failed: '+r.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t,r){var o=n[e];return o||(o=[],n[e]=o),o.push(t),r&&setTimeout((function(){r.forEach((function(r){var o;if(null===(o=n[e])||void 0===o?void 0:o.includes(t))try{Array.isArray(r)?t.apply(void 0,r):t.apply(void 0,[r])}catch(W){i(W,e)}}))}),0),function(){var i=n[e];i&&(0===(i=i.reduce((function(e,n,i){return n===t&&e.length===i||e.push(n),e}),[])).length?delete n[e]:n[e]=i)}},execute:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=n[e];if(!o||0===o.length)return[];var s=[];return o.forEach((function(n){try{var r=n.apply(void 0,t);s.push(r)}catch(W){s.push(void 0),i(W,e)}})),s},clear:function(){n={}},clearKey:function(e){n[e]&&delete n[e]}}}Lr.default=Lr;var Ur=Lr,qr=function(){function e(e,t){var n=this;this.registry=Ur(),this.gw=e.facade,this.gw.connect((function(e,t){n.messageHandler(t)})).then((function(e){n.client=e}))}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return this.client?(this.client.send(e),Promise.resolve(void 0)):Promise.reject("not connected")},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"in-memory"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),Br=function(){function e(e,t){var n=this;this.logger=t,this.registry=Ur(),this.worker=new SharedWorker(e),this.worker.port.onmessage=function(e){n.messageHandler(e.data)}}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return this.worker.port.postMessage(e),Promise.resolve()},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"shared-worker"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),Gr=function(){function e(){}return e.isNode=function(){if("undefined"!==typeof e._isNode)return e._isNode;if("undefined"!==typeof window)return e._isNode=!1,!1;try{e._isNode="[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){e._isNode=!1}return e._isNode},e}(),Hr=function(){function e(){var e=this;this.rejected=!1,this.resolved=!1,this.promise=new Promise((function(t,n){e.resolve=function(n){e.resolved=!0,t(n)},e.reject=function(t){e.rejected=!0,n(t)}}))}return e.delay=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Object.defineProperty(e.prototype,"ended",{get:function(){return this.rejected||this.resolved},enumerable:!1,configurable:!0}),e}(),zr={};function Vr(e){var t=zr[e];if(t)return t;var n=[];function i(){return(new Date).getTime()}var r,o,s=i();function a(e,t){var r=null!==t&&void 0!==t?t:i(),o=0;n.length>0&&(o=r-n[n.length-1].time),n.push({name:e,time:r,diff:o})}a("start",s);var c={get startTime(){return s},get endTime(){return r},get period(){return o},stop:function(){return a("end",r=i()),o=r-s},mark:a,marks:n};return zr[e]=c,c}var Jr=Gr.isNode()?n(559):window.WebSocket,Kr=function(){function e(e,t){if(this.startupTimer=Vr("connection"),this._running=!0,this._registry=Ur(),this.wsRequests=[],this.settings=e,this.logger=t,!this.settings.ws)throw new Error("ws is missing")}return e.prototype.onMessage=function(e){return this._registry.add("onMessage",e)},e.prototype.send=function(e,t){var n=this;return new Promise((function(t,i){n.waitForSocketConnection((function(){var r;try{null===(r=n.ws)||void 0===r||r.send(e),t()}catch(o){i(o)}}),i)}))},e.prototype.open=function(){var e=this;return this.logger.info("opening ws..."),this._running=!0,new Promise((function(t,n){e.waitForSocketConnection(t,n)}))},e.prototype.close=function(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()},e.prototype.onConnectedChanged=function(e){return this._registry.add("onConnectedChanged",e)},e.prototype.name=function(){return this.settings.ws},e.prototype.reconnect=function(){var e;null===(e=this.ws)||void 0===e||e.close();var t=new Hr;return this.waitForSocketConnection((function(){t.resolve()})),t.promise},e.prototype.waitForSocketConnection=function(e,t){var n;t=null!==t&&void 0!==t?t:function(){},this._running?1!==(null===(n=this.ws)||void 0===n?void 0:n.readyState)?(this.wsRequests.push({callback:e,failed:t}),this.wsRequests.length>1||this.openSocket()):e():t("wait for socket on ".concat(this.settings.ws," failed - socket closed by user"))},e.prototype.openSocket=function(e,t){return pr(this,void 0,void 0,(function(){var n=this;return fr(this,(function(i){switch(i.label){case 0:if(this.startupTimer.mark("opening-socket"),void 0===e&&(e=this.settings.reconnectInterval),"undefined"===typeof t&&(t=this.settings.reconnectAttempts),void 0!==t){if(0===t)return this.notifyForSocketState("wait for socket on ".concat(this.settings.ws," failed - no more retries left")),[2];this.logger.debug("will retry ".concat(t," more times (every ").concat(e," ms)"))}i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.initiateSocket()];case 2:return i.sent(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState(),[3,4];case 3:return i.sent(),setTimeout((function(){var i=void 0===t?void 0:t-1;n.openSocket(e,i)}),e),[3,4];case 4:return[2]}}))}))},e.prototype.initiateSocket=function(){var e=this,t=new Hr;return this.logger.debug("initiating ws to ".concat(this.settings.ws,"...")),this.ws=new Jr(this.settings.ws||""),this.ws.onerror=function(n){var i="";try{i=JSON.stringify(n)}catch(o){var r=new WeakSet;i=JSON.stringify(n,(function(e,t){if("object"===typeof t&&null!==t){if(r.has(t))return;r.add(t)}return t}))}t.reject("error"),e.notifyStatusChanged(!1,i)},this.ws.onclose=function(n){e.logger.info("ws closed ".concat(n)),t.reject("closed"),e.notifyStatusChanged(!1)},this.ws.onopen=function(){var n;e.startupTimer.mark("ws-opened"),e.logger.info("ws opened ".concat(null===(n=e.settings.identity)||void 0===n?void 0:n.application)),t.resolve(),e.notifyStatusChanged(!0)},this.ws.onmessage=function(t){e._registry.execute("onMessage",t.data)},t.promise},e.prototype.notifyForSocketState=function(e){this.wsRequests.forEach((function(t){e?t.failed&&t.failed(e):t.callback()})),this.wsRequests=[]},e.prototype.notifyStatusChanged=function(e,t){this._registry.execute("onConnectedChanged",e,t)},e}(),$r={},Qr={get exports(){return $r},set exports(e){$r=e}},Yr={},Xr={get exports(){return Yr},set exports(e){Yr=e}},Zr=1;var eo,to,no,io={nextValue:function(){return(Zr=(9301*Zr+49297)%233280)/233280},seed:function(e){Zr=e}},ro="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function oo(){no=!1}function so(e){if(e){if(e!==eo){if(e.length!==ro.length)throw new Error("Custom alphabet for shortid must be "+ro.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+ro.length+" unique characters. These characters were not unique: "+t.join(", "));eo=e,oo()}}else eo!==ro&&(eo=ro,oo())}function ao(){return no||(no=function(){eo||so(ro);for(var e,t=eo.split(""),n=[],i=io.nextValue();t.length>0;)i=io.nextValue(),e=Math.floor(i*t.length),n.push(t.splice(e,1)[0]);return n.join("")}())}var co,uo={get:function(){return eo||ro},characters:function(e){return so(e),eo},seed:function(e){io.seed(e),to!==e&&(oo(),to=e)},lookup:function(e){return ao()[e]},shuffled:ao},lo="object"===typeof window&&(window.crypto||window.msCrypto);co=lo&&lo.getRandomValues?function(e){return lo.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t};var ho=uo,po=co,fo=function(e,t,n){for(var i=(2<<Math.log(t.length-1)/Math.LN2)-1,r=-~(1.6*i*n/t.length),o="";;)for(var s=e(r),a=r;a--;)if((o+=t[s[a]&i]||"").length===+n)return o};var go,mo,vo=function(e){for(var t,n=0,i="";!t;)i+=fo(po,ho.get(),1),t=e<Math.pow(16,n+1),n++;return i},yo=vo;var wo=function(e){var t="",n=Math.floor(.001*(Date.now()-1567752802062));return n===mo?go++:(go=0,mo=n),t+=yo(7),t+=yo(e),go>0&&(t+=yo(go)),t+=yo(n)},bo=uo;var _o=function(e){return!(!e||"string"!==typeof e||e.length<6)&&!new RegExp("[^"+bo.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)};!function(e){var t=uo,n=wo,i=_o,r=0;function o(){return n(r)}e.exports=o,e.exports.generate=o,e.exports.seed=function(n){return t.seed(n),e.exports},e.exports.worker=function(t){return r=t,e.exports},e.exports.characters=function(e){return void 0!==e&&t.characters(e),t.shuffled()},e.exports.isValid=i}(Xr),function(e){e.exports=Yr}(Qr);var Io=Wr($r);function Co(e,t,n,i,r){null==e&&(e="global"),i=i||["success"],r=r||["error"];var o,s=!1,a=!1,c=!1,u=Ur();t.disconnected((function(){c=!1,n.debug("connection is down"),s=!1,a=!0,u.execute("onLeft",{disconnected:!0})})),t.loggedIn((function(){c=!0,a&&(n.debug("connection is now up - trying to reconnect..."),l(o))})),t.on("success",(function(e){return p(e)})),t.on("error",(function(e){return h(e)})),t.on("result",(function(e){return p(e)})),i&&i.forEach((function(e){t.on(e,(function(e){return p(e)}))})),r&&r.forEach((function(e){t.on(e,(function(e){return h(e)}))}));var d={};function l(t){return o=t,new Promise((function(i,r){if(s)i({});else{var o;if("global"===e)o=c?Promise.resolve({}):Promise.reject("not connected to gateway");else n.debug("joining domain ".concat(e)),o=g({type:"join",destination:e,domain:"global",options:t});o.then((function(){!function(){n.debug("did join "+e),s=!0;var t=a;a=!1,u.execute("onJoined",t)}(),i({})})).catch((function(t){n.debug("error joining "+e+" domain: "+JSON.stringify(t)),r(t)}))}}))}function h(t){if(e===t.domain){var n=t.request_id;if(n){var i=d[n];i&&i.error(t)}}}function p(t){if(t.domain===e){var n=t.request_id;if(n){var i=d[n];i&&i.success(t)}}}function f(){return Io()}function g(i,r,o){o=o||{},i.request_id=i.request_id||f(),i.domain=i.domain||e,o.skipPeerId||(i.peer_id=t.peerId);var s=i.request_id;return new Promise((function(e,a){d[s]={success:function(t){delete d[s],t._tag=r,e(t)},error:function(e){n.warn("GW error - ".concat(JSON.stringify(e)," for request ").concat(JSON.stringify(i))),delete d[s],e._tag=r,a(e)}},t.send(i,o).catch((function(e){d[s].error({err:e})}))}))}return{join:l,leave:function(){return"global"===e?Promise.resolve():(n.debug("stopping session "+e+"..."),a=!1,g({type:"leave",destination:e,domain:"global"}).then((function(){s=!1,u.execute("onLeft")})).catch((function(){s=!1,u.execute("onLeft")})))},onJoined:function(e){return s&&e(!1),u.add("onJoined",e)},onLeft:function(e){return s||e(),u.add("onLeft",e)},send:g,sendFireAndForget:function(n){return n.request_id=n.request_id?n.request_id:f(),n.domain=n.domain||e,n.peer_id=t.peerId,t.send(n)},on:function(i,r){t.on(i,(function(t){if(t.domain===e)try{r(t)}catch(i){n.error("Callback  failed: ".concat(i," \n ").concat(i.stack," \n msg was: ").concat(JSON.stringify(t)),i)}}))},loggedIn:function(e){return t.loggedIn(e)},connected:function(e){return t.connected(e)},disconnected:function(e){return t.disconnected(e)},get peerId(){return t.peerId},get domain(){return e}}}var So=function(){function e(e,t,n){var i=this;this.connection=e,this.settings=t,this.logger=n,this.protocolVersion=3,this.datePrefix="#T42_DATE#",this.datePrefixLen=this.datePrefix.length,this.dateMinLen=this.datePrefixLen+1,this.datePrefixFirstChar=this.datePrefix[0],this.registry=Ur(),this._isLoggedIn=!1,this.shouldTryLogin=!0,this.initialLogin=!0,this.initialLoginAttempts=3,this.sessions=[],e.disconnected((function(){i.handleDisconnected()})),this.ping()}return Object.defineProperty(e.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!1,configurable:!0}),e.prototype.processStringMessage=function(e){var t=this,n=JSON.parse(e,(function(e,n){if("string"!==typeof n)return n;if(n.length<t.dateMinLen)return n;if(n[0]!==t.datePrefixFirstChar)return n;if(n.substring(0,t.datePrefixLen)!==t.datePrefix)return n;try{var i=parseInt(n.substring(t.datePrefixLen,n.length),10);return isNaN(i)?n:new Date(i)}catch(r){return n}}));return{msg:n,msgType:n.type}},e.prototype.createStringMessage=function(e){var t=Date.prototype.toJSON;try{var n=this.datePrefix;return Date.prototype.toJSON=function(){return n+this.getTime()},JSON.stringify(e)}finally{Date.prototype.toJSON=t}},e.prototype.processObjectMessage=function(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}},e.prototype.createObjectMessage=function(e){return e},e.prototype.login=function(e,t){return pr(this,void 0,void 0,(function(){var n,i,r,o,s,a,c,u,d,l;return fr(this,(function(h){switch(h.label){case 0:if(this.logger.debug("logging in..."),this.loginConfig=e,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0,n={},this.connection.gatewayToken=e.gatewayToken,!e.gatewayToken)return[3,5];if(!t)return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.getNewGWToken()];case 2:return u=h.sent(),e.gatewayToken=u,[3,4];case 3:return i=h.sent(),this.logger.warn("failed to get GW token when reconnecting ".concat((null===i||void 0===i?void 0:i.message)||i)),[3,4];case 4:return n.method="gateway-token",n.token=e.gatewayToken,this.connection.gatewayToken=e.gatewayToken,[3,10];case 5:return"sspi"!==e.flowName?[3,9]:(n.provider="win",n.method="access-token",e.flowCallback&&e.sessionId?(r=n,[4,e.flowCallback(e.sessionId,null)]):[3,7]);case 6:return r.token=h.sent().data.toString("base64"),[3,8];case 7:throw new Error("Invalid SSPI config");case 8:return[3,10];case 9:if(e.token)n.method="access-token",n.token=e.token;else if(e.username)n.method="secret",n.login=e.username,n.secret=e.password;else{if(!e.provider)throw new Error("invalid auth message"+JSON.stringify(e));n.provider=e.provider,n.providerContext=e.providerContext}h.label=10;case 10:o={type:"hello",identity:this.settings.identity,authentication:n},e.sessionId&&(o.request_id=e.sessionId),this.globalDomain=Co("global",this.connection,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]),s={skipPeerId:!0},this.initialLogin&&(s.retryInterval=this.settings.reconnectInterval,s.maxRetries=this.settings.reconnectAttempts),h.label=11;case 11:h.trys.push([11,19,20,21]),a=void 0,h.label=12;case 12:return[4,this.globalDomain.send(o,void 0,s)];case 13:return"authentication-request"!==(c=h.sent()).type?[3,16]:(u=Buffer.from(c.authentication.token,"base64"),e.flowCallback&&e.sessionId?(d=o.authentication,[4,e.flowCallback(e.sessionId,u)]):[3,15]);case 14:d.token=h.sent().data.toString("base64"),h.label=15;case 15:return o.request_id=e.sessionId,[3,12];case 16:if("welcome"===c.type)return a=c,[3,18];throw"error"===c.type?new Error("Authentication failed: "+c.reason):new Error("Unexpected message type during authentication: "+c.type);case 17:return[3,12];case 18:return this.initialLogin=!1,this.logger.debug("login successful with peerId "+a.peer_id),this.connection.peerId=a.peer_id,this.connection.resolvedIdentity=a.resolved_identity,this.connection.availableDomains=a.available_domains,a.options&&(this.connection.token=a.options.access_token,this.connection.info=a.options.info),this.setLoggedIn(!0),[2,a.resolved_identity];case 19:throw l=h.sent(),this.logger.error("error sending hello message - "+(l.message||l.msg||l.reason||l),l),l;case 20:return e&&e.flowCallback&&e.sessionId&&e.flowCallback(e.sessionId,null),[7];case 21:return[2]}}))}))},e.prototype.logout=function(){return pr(this,void 0,void 0,(function(){var e;return fr(this,(function(t){switch(t.label){case 0:return this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer),e=this.sessions.map((function(e){e.leave()})),[4,Promise.all(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this._isLoggedIn&&e(),this.registry.add("onLoggedIn",e)},e.prototype.domain=function(e,t,n,i){var r=this.sessions.filter((function(t){return t.domain===e}))[0];return r||(r=Co(e,this.connection,t,n,i),this.sessions.push(r)),r},e.prototype.handleDisconnected=function(){var e=this;if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.connection.login(this.loginConfig,!0).catch((function(){setTimeout(e.handleDisconnected.bind(e),e.settings.reconnectInterval||1e3)}))}},e.prototype.setLoggedIn=function(e){this._isLoggedIn=e,this._isLoggedIn&&this.registry.execute("onLoggedIn")},e.prototype.ping=function(){var e=this;this.shouldTryLogin&&(this._isLoggedIn&&this.connection.send({type:"ping"}),this.pingTimer=setTimeout((function(){e.ping()}),3e4))},e.prototype.authToken=function(){return this.globalDomain?this.globalDomain.send({type:"create-token"}).then((function(e){return e.token})):Promise.reject(new Error("no global domain session"))},e.prototype.getNewGWToken=function(){if(void 0!==typeof window){var e=window.glue42gd;if(e)return e.getGWToken()}return Promise.reject(new Error("not running in GD"))},e}(),ko=function(){function e(e){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var t=0,n=e;t<n.length;t++){var i=n[t];this.specs[i.name]=i,this.specsNames.push(i.name)}}return e.prototype.init=function(e){var t=this;this.connection=e;for(var n=0,i=this.specsNames;n<i.length;n++)for(var r=i[n],o=function(n){var i=s.subsRefCount[n];if(i||(i=0),i+=1,s.subsRefCount[n]=i,i>1)return"continue";var r=e.on(n,(function(e){return t.processMessage(n,e)}));s.subs[n]=r},s=this,a=0,c=this.specs[r].types;a<c.length;a++){o(c[a])}},e.prototype.processMessage=function(e,t){if(!this.isDone&&t)for(var n=0,i=this.specsNames;n<i.length;n++){var r=i[n];if(-1!==this.specs[r].types.indexOf(e)){var o=this.messages[r]||[];this.messages[r]=o,o.push(t)}}},e.prototype.drain=function(e,t){var n;t&&(this.messages[e]||[]).forEach(t),delete this.messages[e];for(var i=0,r=this.specs[e].types;i<r.length;i++){var o=r[i];this.subsRefCount[o]-=1,this.subsRefCount[o]<=0&&(null===(n=this.connection)||void 0===n||n.off(this.subs[o]),delete this.subs[o],delete this.subsRefCount[o])}delete this.specs[e],this.specs.length||(this.isDone=!0)},e}(),xo=function(e,t,n){return new Promise((function(i,r){var o=setTimeout((function(){var e=n||"Promise timeout hit: ".concat(t);r(e)}),t);new Promise(e).then((function(e){clearTimeout(o),i(e)})).catch((function(e){clearTimeout(o),r(e)}))}))},To=function(){function e(e,t,n){this.settings=e,this.logger=t,this.identity=n,this.iAmConnected=!1,this.parentReady=!1,this.rejected=!1,this.children=[],this.extContentAvailable=!1,this.extContentConnecting=!1,this.extContentConnected=!1,this.parentInExtMode=!1,this.webNamespace="g42_core_web",this.parentPingTimeout=5e3,this.connectionRequestTimeout=7e3,this.defaultTargetString="*",this.registry=Ur(),this.messages={connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:function(){}},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:this.handleClientUnload.bind(this)},manualUnload:{name:"manualUnload",handle:this.handleManualUnload.bind(this)},extConnectionResponse:{name:"extConnectionResponse",handle:this.handleExtConnectionResponse.bind(this)},extSetupRequest:{name:"extSetupRequest",handle:this.handleExtSetupRequest.bind(this)},gatewayDisconnect:{name:"gatewayDisconnect",handle:this.handleGatewayDisconnect.bind(this)},gatewayInternalConnect:{name:"gatewayInternalConnect",handle:this.handleGatewayInternalConnect.bind(this)}},this.extContentAvailable=!!window.glue42ext,this.setUpMessageListener(),this.setUpUnload(),this.setupPlatformUnloadListener(),this.parentType=window.name.includes("#wsp")?"workspace":void 0}return e.prototype.manualSetReadyState=function(){this.iAmConnected=!0,this.parentReady=!0},Object.defineProperty(e.prototype,"transportWindowId",{get:function(){return this.publicWindowId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"communicationId",{get:function(){return this._communicationId},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return pr(this,void 0,void 0,(function(){return fr(this,(function(t){if(this.extContentConnected)return[2,window.postMessage({glue42ExtOut:e},this.defaultTargetString)];if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");return this.port.postMessage(e),[2]}))}))},Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.send=function(){return Promise.reject("not supported")},e.prototype.onConnectedChanged=function(e){return this.registry.add("onConnectedChanged",e)},e.prototype.open=function(){return pr(this,void 0,void 0,(function(){return fr(this,(function(e){switch(e.label){case 0:return this.logger.debug("opening a connection to the web platform gateway."),[4,this.connect()];case 1:return e.sent(),this.notifyStatusChanged(!0),[2]}}))}))},e.prototype.close=function(){var e,t,n={glue42core:{type:this.messages.gatewayDisconnect.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};return null===(t=this.port)||void 0===t||t.postMessage(n),this.parentReady=!1,this.notifyStatusChanged(!1,"manual reconnection"),Promise.resolve()},e.prototype.name=function(){return"web-platform"},e.prototype.reconnect=function(){return pr(this,void 0,void 0,(function(){return fr(this,(function(e){switch(e.label){case 0:return[4,this.close()];case 1:return e.sent(),[2,Promise.resolve()]}}))}))},e.prototype.initiateInternalConnection=function(){var e=this;return new Promise((function(t,n){e.logger.debug("opening an internal web platform connection"),e.port=e.settings.port,e.iAmConnected?e.logger.warn("cannot open a new connection, because this client is currently connected"):(e.port.onmessage=function(i){var r,o;if(!e.iAmConnected||(null===(r=i.data)||void 0===r?void 0:r.glue42core)){var s=null===(o=i.data)||void 0===o?void 0:o.glue42core;s&&(s.type===e.messages.gatewayInternalConnect.name&&s.success&&(e.publicWindowId=e.settings.windowId,e.identity&&e.publicWindowId&&(e.identity.windowId=e.publicWindowId,e.identity.instance=e.publicWindowId),t()),s.type===e.messages.gatewayInternalConnect.name&&s.error&&n(s.error))}else e.registry.execute("onMessage",i.data)},e.port.postMessage({glue42core:{type:e.messages.gatewayInternalConnect.name}}))}))},e.prototype.initiateRemoteConnection=function(e){var t=this;return xo((function(n,i){var r;t.connectionResolve=n,t.connectionReject=i,t.myClientId=null!==(r=t.myClientId)&&void 0!==r?r:Io();var o=t.getMyWindowId()||Io(),s={glue42core:{type:t.messages.connectionRequest.name,clientId:t.myClientId,clientType:"child",bridgeInstanceId:o,selfAssignedWindowId:t.selfAssignedWindowId}};if(t.logger.debug("sending connection request"),t.extContentConnecting)return s.glue42core.clientType="child",s.glue42core.bridgeInstanceId=t.myClientId,s.glue42core.parentWindowId=t.parentWindowId,window.postMessage(s,t.defaultTargetString);if(!e)throw new Error("Cannot send a connection request, because no glue target was specified!");e.postMessage(s,t.defaultTargetString)}),this.connectionRequestTimeout,"The connection to the target glue window timed out")},e.prototype.isParentCheckSuccess=function(e){return pr(this,void 0,void 0,(function(){return fr(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e];case 1:return t.sent(),[2,{success:!0}];case 2:return t.sent(),[2,{success:!1}];case 3:return[2]}}))}))},e.prototype.setUpMessageListener=function(){var e=this;this.settings.port?this.logger.debug("skipping generic message listener, because this is an internal client"):window.addEventListener("message",(function(t){var n,i=null===(n=t.data)||void 0===n?void 0:n.glue42core;if(i&&!e.rejected)if(e.checkMessageTypeValid(i.type)){var r=i.type;e.logger.debug("received valid glue42core message of type: ".concat(r)),e.messages[r].handle(t)}else e.logger.error("cannot handle the incoming glue42 core message, because the type is invalid: ".concat(i.type))}))},e.prototype.setUpUnload=function(){var e=this;this.settings.port?this.logger.debug("skipping unload event listener, because this is an internal client"):window.addEventListener("beforeunload",(function(){var t,n;if(!e.extContentConnected){var i={glue42core:{type:e.messages.clientUnload.name,data:{clientId:e.myClientId,ownWindowId:null===(t=e.identity)||void 0===t?void 0:t.windowId}}};e.parent&&e.parent.postMessage(i,e.defaultTargetString),null===(n=e.port)||void 0===n||n.postMessage(i)}}))},e.prototype.handlePlatformReady=function(e){this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve&&(this.parentPingResolve(),delete this.parentPingResolve),this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval),this.parent=e.source,this.parentType=window.name.includes("#wsp")?"workspace":"window"},e.prototype.handleConnectionAccepted=function(e){var t,n=null===(t=e.data)||void 0===t?void 0:t.glue42core;return this.myClientId===n.clientId?this.handleAcceptanceOfMyRequest(n):this.handleAcceptanceOfGrandChildRequest(n,e)},e.prototype.handleAcceptanceOfMyRequest=function(e){var t=this;if(this.logger.debug("handling a connection accepted signal targeted at me."),this.isPreferredActivated=e.isPreferredActivated,this.extContentConnecting)return this.processExtContentConnection(e);if(e.port){if(this.publicWindowId=this.getMyWindowId(),this.identity&&(this.identity.windowId=this.publicWindowId,this.identity.instance=this.identity.instance?this.identity.instance:this.publicWindowId||Io()),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),this._communicationId=e.communicationId,this.port=e.port,this.port.onmessage=function(e){return t.registry.execute("onMessage",e.data)},this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve;this.logger.error("unable to call the connection resolve, because no connection promise was found")}else this.logger.error("cannot set up my connection, because I was not provided with a port")},e.prototype.processExtContentConnection=function(e){var t=this;if(this.logger.debug("handling a connection accepted signal targeted at me for extension content connection."),this.extContentConnecting=!1,this.extContentConnected=!0,this.publicWindowId=this.parentWindowId||this.myClientId,this.extContentConnecting&&this.identity&&(this.identity.windowId=this.publicWindowId),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),window.addEventListener("message",(function(e){var n,i=null===(n=e.data)||void 0===n?void 0:n.glue42ExtInc;i&&t.registry.execute("onMessage",i)})),this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve},e.prototype.handleAcceptanceOfGrandChildRequest=function(e,t){if(this.extContentConnecting||this.extContentConnected)this.logger.debug("cannot process acceptance of a grandchild, because I am connected to a content script");else{this.logger.debug("handling a connection accepted signal targeted at a grandchild: ".concat(e.clientId));var n=this.children.find((function(t){return t.grandChildId===e.clientId}));n?(n.connected=!0,this.logger.debug("the grandchild connection for ".concat(e.clientId," is set up, forwarding the success message and the gateway port")),e.parentWindowId=this.publicWindowId,n.source.postMessage(t.data,n.origin,[e.port])):this.logger.error("cannot handle connection accepted for grandchild: ".concat(e.clientId,", because there is no grandchild with this id"))}},e.prototype.handleConnectionRejected=function(){this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),this.connectionReject&&(this.connectionReject("The platform connection was rejected. Most likely because this window was not created by a glue API call"),delete this.connectionReject)},e.prototype.handleConnectionRequest=function(e){if(this.extContentConnecting)this.logger.debug("This connection request event is targeted at the extension content");else{var t=e.source,n=e.data.glue42core;if(!n.clientType||"grandChild"!==n.clientType)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source was not opened by a glue API call");if(!n.clientId)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source did not provide a valid id");if(!this.parent)return this.rejectConnectionRequest(t,e.origin,"Cannot forward the connection request, because no direct connection to the platform was found");this.logger.debug("handling a connection request for a grandchild: ".concat(n.clientId)),this.children.push({grandChildId:n.clientId,source:t,connected:!1,origin:e.origin}),this.logger.debug("grandchild: ".concat(n.clientId," is prepared, forwarding connection request to the platform")),this.parent.postMessage(e.data,this.defaultTargetString)}},e.prototype.handleParentPing=function(e){if(this.parentReady)if(this.iAmConnected){var t={glue42core:{type:this.messages.parentReady.name}};this.extContentConnected&&(t.glue42core.extMode={windowId:this.myClientId});var n=e.source;this.logger.debug("responding to a parent ping with a ready message"),n.postMessage(t,e.origin)}else this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");else this.logger.debug("my parent is not ready, I am ignoring the parent ping")},e.prototype.setupPlatformUnloadListener=function(){var e=this;this.onMessage((function(t){"platformUnload"===t.type&&(e.logger.debug("detected a web platform unload"),e.parentReady=!1,e.notifyStatusChanged(!1,"Gateway unloaded"))}))},e.prototype.handleManualUnload=function(){var e,t,n={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};if(this.extContentConnected)return window.postMessage({glue42ExtOut:n},this.defaultTargetString);null===(t=this.port)||void 0===t||t.postMessage(n)},e.prototype.handleClientUnload=function(e){var t=e.data.glue42core,n=null===t||void 0===t?void 0:t.data.clientId;n?this.children.find((function(e){return e.grandChildId===n}))?(this.logger.debug("handling grandchild unload for id: ".concat(n)),this.children=this.children.filter((function(e){return e.grandChildId!==n}))):this.logger.warn("cannot process grand child unload, because this client is unaware of this grandchild"):this.logger.warn("cannot process grand child unload, because the provided id was not valid")},e.prototype.handlePlatformPing=function(){},e.prototype.notifyStatusChanged=function(e,t){this.iAmConnected=e,this.registry.execute("onConnectedChanged",e,t)},e.prototype.checkMessageTypeValid=function(e){return"string"===typeof e&&!!this.messages[e]},e.prototype.rejectConnectionRequest=function(e,t,n){this.rejected=!0,this.logger.error(n);var i={glue42core:{type:this.messages.connectionRejected.name}};e.postMessage(i,t)},e.prototype.requestConnectionPermissionFromExt=function(){var e=this;return this.waitForContentScript().then((function(){return xo((function(t,n){e.extConnectionResolve=t,e.extConnectionReject=n;e.logger.debug("permission request to the extension content script was sent"),window.postMessage({glue42core:{type:"extSetupRequest"}},e.defaultTargetString)}),e.parentPingTimeout,"Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection timed out")}))},e.prototype.handleExtConnectionResponse=function(e){var t;if(!(null===(t=e.data)||void 0===t?void 0:t.glue42core).approved)return this.extConnectionReject?this.extConnectionReject("Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection was rejected"):void 0;this.extConnectionResolve&&(this.extConnectionResolve(),delete this.extConnectionResolve),this.extContentConnecting=!0,this.parentType="extension",this.logger.debug("The extension connection was approved, proceeding.")},e.prototype.handleExtSetupRequest=function(){},e.prototype.handleGatewayDisconnect=function(){},e.prototype.handleGatewayInternalConnect=function(){},e.prototype.waitForContentScript=function(){var e;return!!(null===(e=window.glue42ext)||void 0===e?void 0:e.content)?Promise.resolve():xo((function(e){window.addEventListener("Glue42EXTReady",(function(){e()}))}),this.connectionRequestTimeout,"The content script was available, but was never heard to be ready")},e.prototype.connect=function(){return pr(this,void 0,void 0,(function(){return fr(this,(function(e){switch(e.label){case 0:return this.settings.port?[4,this.initiateInternalConnection()]:[3,2];case 1:return e.sent(),this.logger.debug("internal web platform connection completed"),[2];case 2:return this.logger.debug("opening a client web platform connection"),[4,this.findParent()];case 3:return e.sent(),[4,this.initiateRemoteConnection(this.parent)];case 4:return e.sent(),this.logger.debug("the client is connected"),[2]}}))}))},e.prototype.findParent=function(){var e;return pr(this,void 0,void 0,(function(){var t,n,i,r;return fr(this,(function(o){switch(o.label){case 0:if(t="Cannot initiate glue, because this window was not opened or created by a glue client",n=this.getPossibleParentsInWindow(window),i=this.getPossibleParentsOutsideWindow(null===(e=window.top)||void 0===e?void 0:e.opener,window.top),!(r=new Set(gr(gr([],n,!0),i,!0))).size&&!this.extContentAvailable)throw new Error(t);return r.size||!this.extContentAvailable?[3,2]:[4,this.requestConnectionPermissionFromExt()];case 1:case 4:return o.sent(),[2];case 2:return[4,this.isParentCheckSuccess(this.confirmParent(Array.from(r)))];case 3:if(o.sent().success)return this.logger.debug("The default parent was found!"),[2];if(!this.extContentAvailable)throw new Error(t);return[4,this.requestConnectionPermissionFromExt()]}}))}))},e.prototype.getPossibleParentsInWindow=function(e){return e&&e!==e.top?gr([e.parent],this.getPossibleParentsInWindow(e.parent),!0):[]},e.prototype.getPossibleParentsOutsideWindow=function(e,t){return e&&t&&e!==t?gr(gr([e],this.getPossibleParentsInWindow(e),!0),this.getPossibleParentsOutsideWindow(e.opener,e),!0):[]},e.prototype.confirmParent=function(e){var t=this,n=xo((function(n){t.parentPingResolve=n;var i={glue42core:{type:t.messages.platformPing.name}};t.parentPingInterval=setInterval((function(){e.forEach((function(e){e.postMessage(i,t.defaultTargetString)}))}),1e3)}),this.parentPingTimeout,"Cannot initiate glue, because this window was not opened or created by a glue client");return n.catch((function(){t.parentPingInterval&&(clearInterval(t.parentPingInterval),delete t.parentPingInterval)})),n},e.prototype.getMyWindowId=function(){var e;return"workspace"===this.parentType?window.name.substring(0,window.name.indexOf("#wsp")):window===window.top?(null===(e=window.name)||void 0===e?void 0:e.includes("g42"))?window.name:(this.selfAssignedWindowId=this.selfAssignedWindowId||"g42-".concat(Io()),this.selfAssignedWindowId):void 0},e}(),Ao=function(){function e(e){void 0===e&&(e=0),this.minSequenceInterval=e,this.queue=[],this.isExecutingQueue=!1}return e.prototype.enqueue=function(e){var t=this;return new Promise((function(n,i){t.queue.push({action:e,resolve:n,reject:i}),t.executeQueue()}))},e.prototype.executeQueue=function(){return pr(this,void 0,void 0,(function(){var e,t,n;return fr(this,(function(i){switch(i.label){case 0:if(this.isExecutingQueue)return[2];this.isExecutingQueue=!0,i.label=1;case 1:if(!this.queue.length)return[3,7];if(!(e=this.queue.shift()))return this.isExecutingQueue=!1,[2];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,e.action()];case 3:return t=i.sent(),e.resolve(t),[3,5];case 4:return n=i.sent(),e.reject(n),[3,5];case 5:return[4,this.intervalBreak()];case 6:return i.sent(),[3,1];case 7:return this.isExecutingQueue=!1,[2]}}))}))},e.prototype.intervalBreak=function(){var e=this;return new Promise((function(t){return setTimeout(t,e.minSequenceInterval)}))},e}(),Eo=function(){function e(e,t){if(this.settings=e,this.logger=t,this.messageHandlers={},this.ids=1,this.registry=Ur(),this._connected=!1,this.isTrace=!1,this._swapTransport=!1,this._switchInProgress=!1,this._transportSubscriptions=[],this._sequelizer=new Ao,(e=e||{}).reconnectAttempts=e.reconnectAttempts||10,e.reconnectInterval=e.reconnectInterval||1e3,e.inproc)this.transport=new qr(e.inproc,t.subLogger("inMemory"));else if(e.sharedWorker)this.transport=new Br(e.sharedWorker,t.subLogger("shared-worker"));else if(e.webPlatform)this.transport=new To(e.webPlatform,t.subLogger("web-platform"),e.identity);else{if(void 0===e.ws)throw new Error("No connection information specified");this.transport=new Kr(e,t.subLogger("ws"))}this.isTrace=t.canPublish("trace"),t.debug("starting with ".concat(this.transport.name()," transport")),this.protocol=new So(this,e,t.subLogger("protocol"));var n=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),i=this.transport.onMessage(this.handleTransportMessage.bind(this));this._transportSubscriptions.push(n),this._transportSubscriptions.push(i),this._defaultTransport=this.transport}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;return null===(e=this.protocol)||void 0===e?void 0:e.protocolVersion},enumerable:!1,configurable:!0}),e.prototype.switchTransport=function(e){return pr(this,void 0,void 0,(function(){var t=this;return fr(this,(function(n){return[2,this._sequelizer.enqueue((function(){return pr(t,void 0,void 0,(function(){var t,n,i;return fr(this,(function(r){switch(r.label){case 0:if(!e||"object"!==typeof e)throw new Error("Cannot switch transports, because the settings are missing or invalid.");if("undefined"===typeof e.type)throw new Error("Cannot switch the transport, because the type is not defined");return this.logger.trace("Starting transport switch with settings: ".concat(JSON.stringify(e))),t="secondary"===e.type?this.getNewSecondaryTransport(e):this._defaultTransport,this._targetTransport=t,this._targetAuth="secondary"===e.type?this.getNewSecondaryAuth(e):this._defaultAuth,n=this.verifyConnection(),this._swapTransport=!0,this._switchInProgress=!0,this.logger.trace("The new transport has been set, closing the current transport"),[4,this.transport.close()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,n];case 3:return r.sent(),i=this.transport===t,this.logger.info("The reconnection after the switch was completed. Was the switch a success: ".concat(i)),this._switchInProgress=!1,[2,{success:i}];case 4:return r.sent(),this.logger.info("The reconnection after the switch timed out, reverting back to the default transport."),this.switchTransport({type:"default"}),this._switchInProgress=!1,[2,{success:!1}];case 5:return[2]}}))}))}))]}))}))},e.prototype.onLibReAnnounced=function(e){return this.registry.add("libReAnnounced",e)},e.prototype.setLibReAnnounced=function(e){this.registry.execute("libReAnnounced",e)},e.prototype.send=function(e,t){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){var n=this.protocol.createObjectMessage(e);return this.isTrace&&this.logger.trace(">> ".concat(JSON.stringify(n))),this.transport.sendObject(n,t)}var i=this.protocol.createStringMessage(e);return this.isTrace&&this.logger.trace(">> ".concat(i)),this.transport.send(i,t)},e.prototype.on=function(e,t){e=e.toLowerCase(),void 0===this.messageHandlers[e]&&(this.messageHandlers[e]={});var n=this.ids++;return this.messageHandlers[e][n]=t,{type:e,id:n}},e.prototype.off=function(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.protocol.isLoggedIn},enumerable:!1,configurable:!0}),e.prototype.connected=function(e){var t=this;return this.protocol.loggedIn((function(){var n=t.transport.name();e(n)}))},e.prototype.disconnected=function(e){return this.registry.add("disconnected",e)},e.prototype.login=function(e,t){return pr(this,void 0,void 0,(function(){var n,i,r;return fr(this,(function(o){switch(o.label){case 0:this._defaultAuth||(this._defaultAuth=e),this._swapTransport&&(this.logger.trace("Detected a transport swap, swapping transports"),n=this.transportSwap(),e=null!==n&&void 0!==n?n:e),this.logger.trace("Starting login for transport: ".concat(this.transport.name()," and auth ").concat(JSON.stringify(e))),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.transport.open()];case 2:return o.sent(),this.logger.trace("Transport: ".concat(this.transport.name()," opened, logging in")),Vr("connection").mark("transport-opened"),[4,this.protocol.login(e,t)];case 3:return i=o.sent(),this.logger.trace("Logged in with identity: ".concat(JSON.stringify(i))),Vr("connection").mark("protocol-logged-in"),[2,i];case 4:throw r=o.sent(),this._switchInProgress&&(this.logger.trace("An error while logging in after a transport swap, preparing a default swap."),this.prepareDefaultSwap()),new Error(r);case 5:return[2]}}))}))},e.prototype.logout=function(){return pr(this,void 0,void 0,(function(){return fr(this,(function(e){switch(e.label){case 0:return[4,this.protocol.logout()];case 1:return e.sent(),[4,this.transport.close()];case 2:return e.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this.protocol.loggedIn(e)},e.prototype.domain=function(e,t,n){return this.protocol.domain(e,this.logger.subLogger("domain=".concat(e)),t,n)},e.prototype.authToken=function(){return this.protocol.authToken()},e.prototype.reconnect=function(){return this.transport.reconnect()},e.prototype.distributeMessage=function(e,t){var n=this,i=this.messageHandlers[t.toLowerCase()];void 0!==i&&Object.keys(i).forEach((function(t){var r=i[t];if(void 0!==r)try{r(e)}catch(o){try{n.logger.error("Message handler failed with ".concat(o.stack),o)}catch(s){console.log("Message handler failed",o)}}}))},e.prototype.handleConnectionChanged=function(e){this._connected!==e&&(this._connected=e,e?(this.settings.replaySpecs&&this.settings.replaySpecs.length&&(this.replayer=new ko(this.settings.replaySpecs),this.replayer.init(this)),this.registry.execute("connected")):this.registry.execute("disconnected"))},e.prototype.handleTransportMessage=function(e){var t;t="string"===typeof e?this.protocol.processStringMessage(e):this.protocol.processObjectMessage(e),this.isTrace&&this.logger.trace("<< ".concat(JSON.stringify(t))),this.distributeMessage(t.msg,t.msgType)},e.prototype.verifyConnection=function(){var e=this;return xo((function(t){var n,i=function(e,t){var n=e;return function(){0===--n&&t()}}(2,(function(){n&&n(),t()}));n=e.onLibReAnnounced((function(e){return"interop"===e.name||"contexts"===e.name?i():void 0}))}),1e4,"Transport switch timed out waiting for all libraries to be re-announced")},e.prototype.getNewSecondaryTransport=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.url))throw new Error("Missing secondary transport URL.");return new Kr(Object.assign({},this.settings,{ws:e.transportConfig.url,reconnectAttempts:1}),this.logger.subLogger("ws-secondary"))},e.prototype.getNewSecondaryAuth=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.auth))throw new Error("Missing secondary transport auth information.");return e.transportConfig.auth},e.prototype.transportSwap=function(){if(this._swapTransport=!1,this._targetTransport&&this._targetAuth){this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport=this._targetTransport;var e=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),t=this.transport.onMessage(this.handleTransportMessage.bind(this));return this._transportSubscriptions.push(e),this._transportSubscriptions.push(t),this._targetAuth}this.logger.warn("Error while switching transports - either the target transport or auth is not defined: transport defined -> ".concat(!!this._defaultTransport,", auth defined -> ").concat(!!this._targetAuth,". Staying on the current one."))},e.prototype.prepareDefaultSwap=function(){var e=this;this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport.close().catch((function(t){return e.logger.warn("Error closing the ".concat(e.transport.name()," transport after a failed connection attempt: ").concat(JSON.stringify(t)))})),this._targetTransport=this._defaultTransport,this._targetAuth=this._defaultAuth,this._swapTransport=!0},e}(),Po=["trace","debug","info","warn","error","off"],Mo=function(){function e(e,t,n){this.name=e,this.parent=t,this.subLoggers=[],this.logFn=console,this.customLogFn=!1,this.name=e,this.path=t?"".concat(t.path,".").concat(e):e,this.loggerFullName="[".concat(this.path,"]"),this.includeTimeAndLevel=!n,n&&(this.logFn=n,this.customLogFn=!0)}return e.prototype.subLogger=function(t){var n=this.subLoggers.filter((function(e){return e.name===t}))[0];if(void 0!==n)return n;Object.keys(this).forEach((function(e){if(e===t)throw new Error("This sub logger name is not allowed.")}));var i=new e(t,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(i),i},e.prototype.publishLevel=function(e){var t;return e&&(this._publishLevel=e),this._publishLevel||(null===(t=this.parent)||void 0===t?void 0:t.publishLevel())},e.prototype.consoleLevel=function(e){var t;return e&&(this._consoleLevel=e),this._consoleLevel||(null===(t=this.parent)||void 0===t?void 0:t.consoleLevel())},e.prototype.log=function(e,t,n){this.publishMessage(t||"info",e,n)},e.prototype.trace=function(e){this.log(e,"trace")},e.prototype.debug=function(e){this.log(e,"debug")},e.prototype.info=function(e){this.log(e,"info")},e.prototype.warn=function(e){this.log(e,"warn")},e.prototype.error=function(e,t){this.log(e,"error")},e.prototype.canPublish=function(e,t){return Po.indexOf(e)>=Po.indexOf(t||this.consoleLevel()||"trace")},e.prototype.publishMessage=function(t,n,i){var r=this.loggerFullName;if("error"===t&&!i){var o=new Error;o.stack&&(n=n+"\n"+o.stack.split("\n").slice(3).join("\n"))}if(this.canPublish(t,this.publishLevel())){var s=e.Interop;if(s)try{s.methods({name:e.InteropMethodName}).length>0&&s.invoke(e.InteropMethodName,{msg:"".concat(n),logger:r,level:t})}catch(l){}}if(this.canPublish(t)){var a="";if(this.includeTimeAndLevel){var c=new Date,u="".concat(c.getHours(),":").concat(c.getMinutes(),":").concat(c.getSeconds(),":").concat(c.getMilliseconds());a="[".concat(u,"] [").concat(t,"] ")}var d="".concat(a).concat(r,": ").concat(n);switch(t){case"trace":this.logFn.debug(d);break;case"debug":this.logFn.debug?this.logFn.debug(d):this.logFn.log(d);break;case"info":this.logFn.info(d);break;case"warn":this.logFn.warn(d);break;case"error":this.logFn.error(d,i)}}},e.InteropMethodName="T42.AppLogger.Log",e}(),Ro="create-context",No="created",Oo="destroyed",jo="context-created",Do="context-added",Fo="subscribe-context",Wo="subscribed-context",Lo="unsubscribe-context",Uo="destroy-context",qo="context-destroyed",Bo="update-context",Go="context-updated",Ho="joined",zo={get name(){return"context"},get types(){return[Ro,No,Oo,jo,Do,Fo,Wo,Lo,Uo,qo,Bo,Go,Ho]}},Vo="6.1.0";var Jo=function(){function e(e,t,n,i){this.updateCallbacks={},this.contextId=e,this.name=t,this.isAnnounced=n,this.activityId=i,this.context={}}return e.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},e.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},e}(),Ko={};!function(e,t){var n="__lodash_hash_undefined__",i=9007199254740991,r="[object Arguments]",o="[object Boolean]",s="[object Date]",a="[object Function]",c="[object GeneratorFunction]",u="[object Map]",d="[object Number]",l="[object Object]",h="[object Promise]",p="[object RegExp]",f="[object Set]",g="[object String]",m="[object Symbol]",v="[object WeakMap]",y="[object ArrayBuffer]",w="[object DataView]",b="[object Float32Array]",_="[object Float64Array]",I="[object Int8Array]",C="[object Int16Array]",S="[object Int32Array]",k="[object Uint8Array]",x="[object Uint8ClampedArray]",T="[object Uint16Array]",A="[object Uint32Array]",E=/\w*$/,P=/^\[object .+?Constructor\]$/,M=/^(?:0|[1-9]\d*)$/,R={};R[r]=R["[object Array]"]=R[y]=R[w]=R[o]=R[s]=R[b]=R[_]=R[I]=R[C]=R[S]=R[u]=R[d]=R[l]=R[p]=R[f]=R[g]=R[m]=R[k]=R[x]=R[T]=R[A]=!0,R["[object Error]"]=R[a]=R[v]=!1;var N="object"==typeof Fr&&Fr&&Fr.Object===Object&&Fr,O="object"==typeof self&&self&&self.Object===Object&&self,j=N||O||Function("return this")(),D=t&&!t.nodeType&&t,F=D&&e&&!e.nodeType&&e,W=F&&F.exports===D;function L(e,t){return e.set(t[0],t[1]),e}function U(e,t){return e.add(t),e}function q(e,t,n,i){var r=-1,o=e?e.length:0;for(i&&o&&(n=e[++r]);++r<o;)n=t(n,e[r],r,e);return n}function B(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}function G(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}function H(e,t){return function(n){return e(t(n))}}function z(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var V=Array.prototype,J=Function.prototype,K=Object.prototype,$=j["__core-js_shared__"],Q=function(){var e=/[^.]+$/.exec($&&$.keys&&$.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Y=J.toString,X=K.hasOwnProperty,Z=K.toString,ee=RegExp("^"+Y.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),te=W?j.Buffer:void 0,ne=j.Symbol,ie=j.Uint8Array,re=H(Object.getPrototypeOf,Object),oe=Object.create,se=K.propertyIsEnumerable,ae=V.splice,ce=Object.getOwnPropertySymbols,ue=te?te.isBuffer:void 0,de=H(Object.keys,Object),le=De(j,"DataView"),he=De(j,"Map"),pe=De(j,"Promise"),fe=De(j,"Set"),ge=De(j,"WeakMap"),me=De(Object,"create"),ve=qe(le),ye=qe(he),we=qe(pe),be=qe(fe),_e=qe(ge),Ie=ne?ne.prototype:void 0,Ce=Ie?Ie.valueOf:void 0;function Se(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function ke(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function xe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Te(e){this.__data__=new ke(e)}function Ae(e,t){var n=Ge(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&He(e)}(e)&&X.call(e,"callee")&&(!se.call(e,"callee")||Z.call(e)==r)}(e)?function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}(e.length,String):[],i=n.length,o=!!i;for(var s in e)!t&&!X.call(e,s)||o&&("length"==s||Le(s,i))||n.push(s);return n}function Ee(e,t,n){var i=e[t];X.call(e,t)&&Be(i,n)&&(void 0!==n||t in e)||(e[t]=n)}function Pe(e,t){for(var n=e.length;n--;)if(Be(e[n][0],t))return n;return-1}function Me(e,t,n,i,h,v,P){var M;if(i&&(M=v?i(e,h,v,P):i(e)),void 0!==M)return M;if(!Je(e))return e;var N=Ge(e);if(N){if(M=function(e){var t=e.length,n=e.constructor(t);t&&"string"==typeof e[0]&&X.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!t)return function(e,t){var n=-1,i=e.length;t||(t=Array(i));for(;++n<i;)t[n]=e[n];return t}(e,M)}else{var O=We(e),j=O==a||O==c;if(ze(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if(O==l||O==r||j&&!v){if(B(e))return v?e:{};if(M=function(e){return"function"!=typeof e.constructor||Ue(e)?{}:(t=re(e),Je(t)?oe(t):{});var t}(j?{}:e),!t)return function(e,t){return Oe(e,Fe(e),t)}(e,function(e,t){return e&&Oe(t,Ke(t),e)}(M,e))}else{if(!R[O])return v?e:{};M=function(e,t,n,i){var r=e.constructor;switch(t){case y:return Ne(e);case o:case s:return new r(+e);case w:return function(e,t){var n=t?Ne(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,i);case b:case _:case I:case C:case S:case k:case x:case T:case A:return function(e,t){var n=t?Ne(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,i);case u:return function(e,t,n){var i=t?n(G(e),!0):G(e);return q(i,L,new e.constructor)}(e,i,n);case d:case g:return new r(e);case p:return function(e){var t=new e.constructor(e.source,E.exec(e));return t.lastIndex=e.lastIndex,t}(e);case f:return function(e,t,n){var i=t?n(z(e),!0):z(e);return q(i,U,new e.constructor)}(e,i,n);case m:return a=e,Ce?Object(Ce.call(a)):{}}var a}(e,O,Me,t)}}P||(P=new Te);var D=P.get(e);if(D)return D;if(P.set(e,M),!N)var F=n?function(e){return function(e,t,n){var i=t(e);return Ge(e)?i:function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}(i,n(e))}(e,Ke,Fe)}(e):Ke(e);return function(e,t){for(var n=-1,i=e?e.length:0;++n<i&&!1!==t(e[n],n,e););}(F||e,(function(r,o){F&&(r=e[o=r]),Ee(M,o,Me(r,t,n,i,o,e,P))})),M}function Re(e){return!(!Je(e)||(t=e,Q&&Q in t))&&(Ve(e)||B(e)?ee:P).test(qe(e));var t}function Ne(e){var t=new e.constructor(e.byteLength);return new ie(t).set(new ie(e)),t}function Oe(e,t,n,i){n||(n={});for(var r=-1,o=t.length;++r<o;){var s=t[r],a=i?i(n[s],e[s],s,n,e):void 0;Ee(n,s,void 0===a?e[s]:a)}return n}function je(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function De(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Re(n)?n:void 0}Se.prototype.clear=function(){this.__data__=me?me(null):{}},Se.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Se.prototype.get=function(e){var t=this.__data__;if(me){var i=t[e];return i===n?void 0:i}return X.call(t,e)?t[e]:void 0},Se.prototype.has=function(e){var t=this.__data__;return me?void 0!==t[e]:X.call(t,e)},Se.prototype.set=function(e,t){return this.__data__[e]=me&&void 0===t?n:t,this},ke.prototype.clear=function(){this.__data__=[]},ke.prototype.delete=function(e){var t=this.__data__,n=Pe(t,e);return!(n<0)&&(n==t.length-1?t.pop():ae.call(t,n,1),!0)},ke.prototype.get=function(e){var t=this.__data__,n=Pe(t,e);return n<0?void 0:t[n][1]},ke.prototype.has=function(e){return Pe(this.__data__,e)>-1},ke.prototype.set=function(e,t){var n=this.__data__,i=Pe(n,e);return i<0?n.push([e,t]):n[i][1]=t,this},xe.prototype.clear=function(){this.__data__={hash:new Se,map:new(he||ke),string:new Se}},xe.prototype.delete=function(e){return je(this,e).delete(e)},xe.prototype.get=function(e){return je(this,e).get(e)},xe.prototype.has=function(e){return je(this,e).has(e)},xe.prototype.set=function(e,t){return je(this,e).set(e,t),this},Te.prototype.clear=function(){this.__data__=new ke},Te.prototype.delete=function(e){return this.__data__.delete(e)},Te.prototype.get=function(e){return this.__data__.get(e)},Te.prototype.has=function(e){return this.__data__.has(e)},Te.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ke){var i=n.__data__;if(!he||i.length<199)return i.push([e,t]),this;n=this.__data__=new xe(i)}return n.set(e,t),this};var Fe=ce?H(ce,Object):function(){return[]},We=function(e){return Z.call(e)};function Le(e,t){return!!(t=null==t?i:t)&&("number"==typeof e||M.test(e))&&e>-1&&e%1==0&&e<t}function Ue(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||K)}function qe(e){if(null!=e){try{return Y.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Be(e,t){return e===t||e!==e&&t!==t}(le&&We(new le(new ArrayBuffer(1)))!=w||he&&We(new he)!=u||pe&&We(pe.resolve())!=h||fe&&We(new fe)!=f||ge&&We(new ge)!=v)&&(We=function(e){var t=Z.call(e),n=t==l?e.constructor:void 0,i=n?qe(n):void 0;if(i)switch(i){case ve:return w;case ye:return u;case we:return h;case be:return f;case _e:return v}return t});var Ge=Array.isArray;function He(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}(e.length)&&!Ve(e)}var ze=ue||function(){return!1};function Ve(e){var t=Je(e)?Z.call(e):"";return t==a||t==c}function Je(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ke(e){return He(e)?Ae(e):function(e){if(!Ue(e))return de(e);var t=[];for(var n in Object(e))X.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}e.exports=function(e){return Me(e,!0,!0)}}({get exports(){return Ko},set exports(e){Ko=e}},Ko);var $o=Ko;function Qo(e,t,n){try{if((null===n||void 0===n?void 0:n.canPublish("trace"))&&(null===n||void 0===n||n.trace("applying context delta ".concat(JSON.stringify(t)," on context ").concat(JSON.stringify(e)))),!t)return e;if(t.reset)return e=hr({},t.reset);if(e=Yo(e,void 0),t.commands){for(var i=0,r=t.commands;i<r.length;i++){var o=r[i];"remove"===o.type?ns(e,o.path):"set"===o.type&&es(e,o.value,o.path)}return e}var s=t.added,a=t.updated,c=t.removed;return s&&Object.keys(s).forEach((function(t){e[t]=s[t]})),a&&Object.keys(a).forEach((function(t){Xo(t,e,a)})),c&&c.forEach((function(t){delete e[t]})),e}catch(u){return null===n||void 0===n||n.error("error applying context delta ".concat(JSON.stringify(t)," on context ").concat(JSON.stringify(e)),u),e}}function Yo(e,t){return $o(e)}var Xo=function(e,t,n){var i=n[e];if(void 0===i)return t;var r=t[e];return r&&i?"string"===typeof r||"number"===typeof r||"boolean"===typeof r||"string"===typeof i||"number"===typeof i||"boolean"===typeof i||Array.isArray(r)||Array.isArray(i)?(t[e]=i,t):(t[e]=Object.assign({},r,i),t):(t[e]=i,t)};function Zo(e,t){if(e===t)return!0;if(!(e instanceof Object)||!(t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n]){if("object"!==typeof e[n])return!1;if(!Zo(e[n],t[n]))return!1}}for(var n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}function es(e,t,n){var i,r=n.split(".");for(i=0;i<r.length-1;i++)e[r[i]]||(e[r[i]]={}),"object"!==typeof e[r[i]]&&(e[r[i]]={}),e=e[r[i]];e[r[i]]=t}function ts(e,t){return Object.keys(t).every((function(n){return"object"===typeof t[n]?ts((null===e||void 0===e?void 0:e[n])||{},t[n]||{}):t[n]===(null===e||void 0===e?void 0:e[n])}))}function ns(e,t){var n,i=t.split(".");for(n=0;n<i.length-1;n++){if(!e[i[n]])return;e=e[i[n]]}delete e[i[n]]}var is,rs=function(){function e(e){var t,n=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._creationPromises={},this._contextNameToId={},this._contextIdToName={},this._protocolVersion=void 0,this._contextsTempCache={},this._contextsSubscriptionsCache=[],this._connection=e.connection,this._logger=e.logger,this._trackAllContexts=e.trackAllContexts,this._reAnnounceKnownContexts=e.reAnnounceKnownContexts,this._gw3Session=this._connection.domain("global",[jo,Wo,qo,Go]),this._gw3Session.disconnected(this.resetState.bind(this)),this._gw3Session.onJoined((function(e){if(e)return n._reAnnounceKnownContexts?void n.reInitiateState().then((function(){return n._connection.setLibReAnnounced({name:"contexts"})})):n._connection.setLibReAnnounced({name:"contexts"})})),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(t=this._connection.replayer)||void 0===t||t.drain(zo.name,(function(e){var t=e.type;t&&(t===jo||t===Do||t===No?n.handleContextCreatedMessage(e):t===Wo||t===Go||t===Ho?n.handleContextUpdatedMessage(e):t!==qo&&t!==Oo||n.handleContextDestroyedMessage(e))}))}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;if(!this._protocolVersion){var t=this._connection.availableDomains.find((function(e){return"context"===e.uri}));this._protocolVersion=null!==(e=null===t||void 0===t?void 0:t.version)&&void 0!==e?e:1}return this._protocolVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this.protocolVersion>=2},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){for(var e=0,t=this._gw3Subscriptions;e<t.length;e++){var n=t[e];this._connection.off(n)}for(var i in this._gw3Subscriptions.length=0,this._contextNameToData)this._contextNameToId.hasOwnProperty(i)&&delete this._contextNameToData[i]},e.prototype.createContext=function(e,t){var n=this;return e in this._creationPromises||(this._creationPromises[e]=this._gw3Session.send({type:Ro,domain:"global",name:e,data:t,lifetime:"retained"}).then((function(i){n._contextNameToId[e]=i.context_id,n._contextIdToName[i.context_id]=e;var r=n._contextNameToData[e]||new Jo(i.context_id,e,!0,void 0);return r.isAnnounced=!0,r.name=e,r.contextId=i.context_id,r.context=i.data||Yo(t),r.hasReceivedSnapshot=!0,n._contextNameToData[e]=r,delete n._creationPromises[e],i.context_id}))),this._creationPromises[e]},e.prototype.all=function(){var e=this;return Object.keys(this._contextNameToData).filter((function(t){return e._contextNameToData[t].isAnnounced}))},e.prototype.update=function(e,t){var n;return pr(this,void 0,void 0,(function(){var i,r,o,s=this;return fr(this,(function(a){switch(a.label){case 0:return t&&(t=Yo(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:a.sent(),a.label=2;case 2:return(i=this._contextNameToData[e])&&i.isAnnounced?(r=i.context,i.hasCallbacks()?[3,4]:[4,this.get(i.name)]):[2,this.createContext(e,t)];case 3:r=a.sent(),a.label=4;case 4:return o=2===this.protocolVersion?this.calculateContextDeltaV2(r,t):this.calculateContextDeltaV1(r,t),Object.keys(o.added).length||Object.keys(o.updated).length||o.removed.length||(null===(n=o.commands)||void 0===n?void 0:n.length)?[2,this._gw3Session.send({type:Bo,domain:"global",context_id:i.contextId,delta:o},{},{skipPeerId:!1}).then((function(e){s.handleUpdated(i,o,{updaterId:e.peer_id})}))]:[2,Promise.resolve()]}}))}))},e.prototype.set=function(e,t){return pr(this,void 0,void 0,(function(){var n,i=this;return fr(this,(function(r){switch(r.label){case 0:return t&&(t=Yo(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:r.sent(),r.label=2;case 2:return(n=this._contextNameToData[e])&&n.isAnnounced?[2,this._gw3Session.send({type:Bo,domain:"global",context_id:n.contextId,delta:{reset:t}},{},{skipPeerId:!1}).then((function(e){i.handleUpdated(n,{reset:t,added:{},removed:[],updated:{}},{updaterId:e.peer_id})}))]:[2,this.createContext(e,t)]}}))}))},e.prototype.setPath=function(e,t,n){return this.setPathSupported?this.setPaths(e,[{path:t,value:n}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")},e.prototype.setPaths=function(e,t){return pr(this,void 0,void 0,(function(){var n,i,r,o,s,a,c,u,d=this;return fr(this,(function(l){switch(l.label){case 0:return this.setPathSupported?(t&&(t=Yo(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2]):[2,Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later")];case 1:l.sent(),l.label=2;case 2:if(!(n=this._contextNameToData[e])||!n.isAnnounced){for(i={},r=0,o=t;r<o.length;r++)u=o[r],es(i,u.value,u.path);return[2,this.createContext(e,i)]}for(s=[],a=0,c=t;a<c.length;a++)null===(u=c[a]).value?s.push({type:"remove",path:u.path}):s.push({type:"set",path:u.path,value:u.value});return[2,this._gw3Session.send({type:Bo,domain:"global",context_id:n.contextId,delta:{commands:s}},{},{skipPeerId:!1}).then((function(e){d.handleUpdated(n,{added:{},removed:[],updated:{},commands:s},{updaterId:e.peer_id})}))]}}))}))},e.prototype.get=function(e){var t;return pr(this,void 0,void 0,(function(){var n,i,r=this;return fr(this,(function(o){switch(o.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:o.sent(),o.label=2;case 2:return(n=this._contextNameToData[e])&&n.isAnnounced?!n||n.hasCallbacks()&&n.hasReceivedSnapshot?(i=null!==(t=null===n||void 0===n?void 0:n.context)&&void 0!==t?t:{},[2,Promise.resolve(Yo(i))]):[2,new Promise((function(t){r.subscribe(e,(function(e,n,i,o){r.unsubscribe(o),t(e)}))}))]:[2,Promise.resolve({})]}}))}))},e.prototype.subscribe=function(e,t,n){return pr(this,void 0,void 0,(function(){var i,r,o,s,a=this;return fr(this,(function(c){switch(c.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:c.sent(),c.label=2;case 2:return i="undefined"===typeof n?this._nextCallbackSubscriptionNumber:n,"undefined"===typeof n&&(this._nextCallbackSubscriptionNumber+=1),this._contextsSubscriptionsCache.every((function(e){return e.subKey!==a._nextCallbackSubscriptionNumber}))&&this._contextsSubscriptionsCache.push({contextName:e,subKey:i,callback:t}),(r=this._contextNameToData[e])&&r.isAnnounced?(o=r.hasCallbacks(),r.updateCallbacks[i]=t,o||r.joinedActivity||r.context&&r.sentExplicitSubscription?(r.hasReceivedSnapshot&&(s=Yo(r.context),t(s,s,[],i)),[2,Promise.resolve(i)]):[2,this.sendSubscribe(r).then((function(){return i}))]):(r=r||new Jo(void 0,e,!1,void 0),this._contextNameToData[e]=r,r.updateCallbacks[i]=t,[2,Promise.resolve(i)])}}))}))},e.prototype.unsubscribe=function(e){this._contextsSubscriptionsCache=this._contextsSubscriptionsCache.filter((function(t){return t.subKey!==e}));for(var t=0,n=Object.keys(this._contextNameToData);t<n.length;t++){var i=n[t],r=this._contextNameToData[i];if(!r)return;var o=r.hasCallbacks();delete r.updateCallbacks[e],r.isAnnounced&&o&&!r.hasCallbacks()&&r.sentExplicitSubscription&&this.sendUnsubscribe(r),r.isAnnounced||r.hasCallbacks()||delete this._contextNameToData[i]}},e.prototype.destroy=function(e){return pr(this,void 0,void 0,(function(){var t;return fr(this,(function(n){switch(n.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:n.sent(),n.label=2;case 2:return(t=this._contextNameToData[e])?[2,this._gw3Session.send({type:Uo,domain:"global",context_id:t.contextId}).then((function(e){}))]:[2,Promise.reject("context with ".concat(e," does not exist"))]}}))}))},e.prototype.handleUpdated=function(e,t,n){var i=e.context;e.context=Qo(e.context,t,this._logger),e.hasReceivedSnapshot=!0,this._contextNameToData[e.name]!==e||Zo(i,e.context)||this.invokeUpdateCallbacks(e,t,n)},e.prototype.subscribeToContextCreatedMessages=function(){for(var e=0,t=[Do,jo,No];e<t.length;e++){var n=t[e],i=this._connection.on(n,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(i)}},e.prototype.handleContextCreatedMessage=function(e){var t=this,n=e.type;n===No?(this._contextNameToId[e.activity_id]=e.context_id,this._contextIdToName[e.context_id]=e.activity_id):n===Do&&(this._contextNameToId[e.name]=e.context_id,this._contextIdToName[e.context_id]=e.name);var i=this._contextIdToName[e.context_id];if(!i)throw new Error("Received created event for context with unknown name: "+e.context_id);if(!this._contextNameToId[i])throw new Error("Received created event for context with unknown id: "+e.context_id);var r=this._contextNameToData[i];if(r){if(r.isAnnounced)return;if(!r.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");r.isAnnounced=!0,r.contextId=e.context_id,r.activityId=e.activity_id,r.sentExplicitSubscription||this.sendSubscribe(r)}else this._contextNameToData[i]=r=new Jo(e.context_id,i,!0,e.activity_id),this._trackAllContexts&&this.subscribe(i,(function(){})).then((function(e){return t._systemContextsSubKey=e}))},e.prototype.subscribeToContextUpdatedMessages=function(){for(var e=0,t=[Go,Wo,Ho];e<t.length;e++){var n=t[e],i=this._connection.on(n,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(i)}},e.prototype.handleContextUpdatedMessage=function(e){var t=e.type,n=e.context_id,i=this._contextNameToData[this._contextIdToName[n]],r=!i||!i.isAnnounced;if(t===Ho)i||(i=this._contextNameToData[e.activity_id]||new Jo(n,e.activity_id,!0,e.activity_id)),this._contextNameToData[e.activity_id]=i,this._contextIdToName[n]=e.activity_id,this._contextNameToId[e.activity_id]=n,i.contextId=n,i.isAnnounced=!0,i.activityId=e.activity_id,i.joinedActivity=!0;else if(!i||!i.isAnnounced)return void(t===Wo?((i=i||new Jo(n,e.name,!0,void 0)).sentExplicitSubscription=!0,this._contextNameToData[e.name]=i,this._contextIdToName[n]=e.name,this._contextNameToId[e.name]=n):this._logger.error("Received 'update' for unknown context: ".concat(n)));var o=i.context;if(i.hasReceivedSnapshot=!0,t===Wo)i.context=e.data||{};else if(t===Ho)i.context=e.context_snapshot||{};else{if(t!==Go)throw new Error("Unrecognized context update message "+t);i.context=Qo(i.context,e.delta,this._logger)}!r&&Zo(i.context,o)&&t!==Wo||this.invokeUpdateCallbacks(i,e.delta,{updaterId:e.updater_id})},e.prototype.invokeUpdateCallbacks=function(e,t,n){if((t=t||{added:{},updated:{},reset:{},removed:[]}).commands){t.added=t.updated=t.reset={},t.removed=[];for(var i=0,r=t.commands;i<r.length;i++){var o=r[i];"remove"===o.type?(-1===o.path.indexOf(".")&&t.removed.push(o.path),es(t.updated,null,o.path)):"set"===o.type&&es(t.updated,o.value,o.path)}}for(var s in e.updateCallbacks)if(e.updateCallbacks.hasOwnProperty(s))try{(0,e.updateCallbacks[s])(Yo(e.context),Yo(Object.assign({},t.added||{},t.updated||{},t.reset||{})),t.removed,parseInt(s,10),n)}catch(W){this._logger.debug("callback error: "+JSON.stringify(W))}},e.prototype.subscribeToContextDestroyedMessages=function(){for(var e=0,t=[qo,Oo];e<t.length;e++){var n=t[e],i=this._connection.on(n,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(i)}},e.prototype.handleContextDestroyedMessage=function(e){var t,n;if(e.type===Oo){if(n=e.activity_id,!(t=this._contextNameToId[n]))return void this._logger.error("Received 'destroyed' for unknown activity: ".concat(e.activity_id))}else if(t=e.context_id,!(n=this._contextIdToName[t]))return void this._logger.error("Received 'destroyed' for unknown context: ".concat(e.context_id));delete this._contextIdToName[t],delete this._contextNameToId[n];var i=this._contextNameToData[n];delete this._contextNameToData[n],i&&i.isAnnounced||this._logger.error("Received 'destroyed' for unknown context: ".concat(t))},e.prototype.sendSubscribe=function(e){return e.sentExplicitSubscription=!0,this._gw3Session.send({type:Fo,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.sendUnsubscribe=function(e){return e.sentExplicitSubscription=!1,this._gw3Session.send({type:Lo,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.calculateContextDeltaV1=function(e,t){var n={added:{},updated:{},removed:[],reset:void 0};if(e)for(var i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];-1===Object.keys(t).indexOf(o)||null===t[o]||Zo(e[o],t[o])||(n.updated[o]=t[o])}for(var s=0,a=Object.keys(t);s<a.length;s++){o=a[s];e&&-1!==Object.keys(e).indexOf(o)?null===t[o]&&n.removed.push(o):null!==t[o]&&(n.added[o]=t[o])}return n},e.prototype.calculateContextDeltaV2=function(e,t){for(var n,i,r={added:{},updated:{},removed:[],reset:void 0,commands:[]},o=0,s=Object.keys(t);o<s.length;o++){var a=s[o];if(null!==t[a])Zo(e?e[a]:null,t[a])||null===(n=r.commands)||void 0===n||n.push({type:"set",path:a,value:t[a]});else null===(i=r.commands)||void 0===i||i.push({type:"remove",path:a})}return r},e.prototype.resetState=function(){for(var e=this,t=0,n=this._gw3Subscriptions;t<n.length;t++){var i=n[t];this._connection.off(i)}this._systemContextsSubKey&&(this.unsubscribe(this._systemContextsSubKey),delete this._systemContextsSubKey),this._gw3Subscriptions=[],this._contextNameToId={},this._contextIdToName={},delete this._protocolVersion,this._contextsTempCache=Object.keys(this._contextNameToData).reduce((function(t,n){return t[n]=e._contextNameToData[n].context,t}),{}),this._contextNameToData={}},e.prototype.reInitiateState=function(){var e;return pr(this,void 0,void 0,(function(){var t,n,i,r,o,s,a=this;return fr(this,(function(c){switch(c.label){case 0:return this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(e=this._connection.replayer)||void 0===e||e.drain(zo.name,(function(e){var t=e.type;t&&(t===jo||t===Do||t===No?a.handleContextCreatedMessage(e):t===Wo||t===Go||t===Ho?a.handleContextUpdatedMessage(e):t!==qo&&t!==Oo||a.handleContextDestroyedMessage(e))})),[4,Promise.all(this._contextsSubscriptionsCache.map((function(e){return a.subscribe(e.contextName,e.callback,e.subKey)})))];case 1:return c.sent(),[4,this.flushQueue()];case 2:for(i in c.sent(),t=this._contextsTempCache,n=[],t)n.push(i);r=0,c.label=3;case 3:return r<n.length?(i=n[r])in t?(o=i,"object"!==typeof this._contextsTempCache[o]||0===Object.keys(this._contextsTempCache[o]).length?[3,6]:(s=this._contextsTempCache[o],this._logger.info("Re-announcing known context: ".concat(o)),[4,this.flushQueue()])):[3,6]:[3,7];case 4:return c.sent(),[4,this.update(o,s)];case 5:c.sent(),c.label=6;case 6:return r++,[3,3];case 7:return this._contextsTempCache={},this._logger.info("Contexts are re-announced"),[2]}}))}))},e.prototype.flushQueue=function(){return new Promise((function(e){return setTimeout((function(){return e()}),0)}))},e}(),os=function(){function e(e){this._bridge=new rs(e)}return e.prototype.all=function(){return this._bridge.all()},e.prototype.update=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.update(e,t)},e.prototype.set=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.set(e,t)},e.prototype.setPath=function(e,t,n){return this.checkName(e),this.checkPath(t),""===t?(this.checkData(n),this.set(e,n)):this._bridge.setPath(e,t,n)},e.prototype.setPaths=function(e,t){if(this.checkName(e),!Array.isArray(t))throw new Error("Please provide the paths as an array of PathValues!");for(var n=0,i=t;n<i.length;n++){var r=i[n],o=r.path,s=r.value;this.checkPath(o),""===o&&this.checkData(s)}return this._bridge.setPaths(e,t)},e.prototype.subscribe=function(e,t){var n=this;if(this.checkName(e),"function"!==typeof t)throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(e,(function(e,i,r,o,s){return t(e,i,r,(function(){return n._bridge.unsubscribe(o)}),s)})).then((function(e){return function(){n._bridge.unsubscribe(e)}}))},e.prototype.get=function(e){return this.checkName(e),this._bridge.get(e)},e.prototype.ready=function(){return Promise.resolve(this)},e.prototype.destroy=function(e){return this.checkName(e),this._bridge.destroy(e)},Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this._bridge.setPathSupported},enumerable:!1,configurable:!0}),e.prototype.checkName=function(e){if("string"!==typeof e||""===e)throw new Error("Please provide the name as a non-empty string!")},e.prototype.checkPath=function(e){if("string"!==typeof e)throw new Error("Please provide the path as a dot delimited string!")},e.prototype.checkData=function(e){if("object"!==typeof e)throw new Error("Please provide the data as an object!")},e}();function ss(e,t,n){return"function"!==typeof t&&"function"!==typeof n?e:("function"!==typeof t?t=function(){}:"function"!==typeof n&&(n=function(){}),e.then(t,n))}function as(e,t,n){var i;void 0===e&&(e=0);var r=function(){i&&clearTimeout(i)};return t.then((function(){r()})).catch((function(){r()})),new Promise((function(t,r){i=setTimeout((function(){return r(n)}),e)}))}!function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(is||(is={}));var cs=function(){function e(e,t,n,i){this.protocol=e,this.repo=t,this.instance=n,this.configuration=i}return e.prototype.subscribe=function(e,t,n,i,r){var o=this,s=function(e,n,i,s){var a;t.methodResponseTimeout=null!==(a=t.methodResponseTimeout)&&void 0!==a?a:t.waitTimeoutMs,o.protocol.client.subscribe(n,t,e,i,s,r)},a=new Promise((function(n,i){var r,a=function(e){n(e)},c=function(e){i(e)};if(e)if((r="string"===typeof e?{name:e}:e).name){void 0===t&&(t={});var u=t.target;if(void 0===u&&(u="best"),"string"!==typeof u||"all"===u||"best"===u){void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=t.method_response_timeout,void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=o.configuration.methodResponseTimeout)),void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=t.wait_for_method_timeout,void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=o.configuration.waitTimeoutMs));var d=0,l=o.getServerMethodsByFilterAndTarget(r,u);if(l.length>0)s(l,l[0].methods[0],a,c);else{var h=function(){if(u&&t.waitTimeoutMs)if(d+=500,(l=o.getServerMethodsByFilterAndTarget(r,u)).length>0){var n=l[0].methods[0];s(l,n,a,c)}else if(d>=t.waitTimeoutMs){s(l,"string"===typeof e?{name:e}:e,a,c)}else setTimeout(h,500)};setTimeout(h,500)}}else i(new Error('"'.concat(u,'" is not a valid target. Valid targets are "all", "best", or an instance.')))}else i("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");else i("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.")}));return ss(a,n,i)},e.prototype.servers=function(e){var t=void 0===e?void 0:hr({},e);return this.getServers(t).map((function(e){return e.server.instance}))},e.prototype.methods=function(e){return e="string"===typeof e?{name:e}:hr({},e),this.getMethods(e)},e.prototype.methodsForInstance=function(e){return this.getMethodsForInstance(e)},e.prototype.methodAdded=function(e){return this.repo.onMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.repo.onMethodRemoved(e)},e.prototype.serverAdded=function(e){return this.repo.onServerAdded(e)},e.prototype.serverRemoved=function(e){return this.repo.onServerRemoved((function(t,n){e(t,n)}))},e.prototype.serverMethodAdded=function(e){return this.repo.onServerMethodAdded((function(t,n){e({server:t,method:n})}))},e.prototype.serverMethodRemoved=function(e){return this.repo.onServerMethodRemoved((function(t,n){e({server:t,method:n})}))},e.prototype.invoke=function(e,t,n,i,r,o){return pr(this,void 0,void 0,(function(){var s,a=this;return fr(this,(function(c){return s=function(){return pr(a,void 0,void 0,(function(){var r,o,s,a,c,u,d,l,h,p,f,g,m=this;return fr(this,(function(v){switch(v.label){case 0:if(!(r="string"===typeof e?{name:e}:hr({},e)).name)return[2,Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.")];if(t||(t={}),n||(n="best"),"string"===typeof n&&"all"!==n&&"best"!==n&&"skipMine"!==n)return[2,Promise.reject(new Error('"'.concat(n,'" is not a valid target. Valid targets are "all" and "best".')))];if(i||(i={}),void 0===i.methodResponseTimeoutMs&&(i.methodResponseTimeoutMs=i.method_response_timeout,void 0===i.methodResponseTimeoutMs&&(i.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),void 0===i.waitTimeoutMs&&(i.waitTimeoutMs=i.wait_for_method_timeout,void 0===i.waitTimeoutMs&&(i.waitTimeoutMs=this.configuration.waitTimeoutMs)),void 0!==i.waitTimeoutMs&&"number"!==typeof i.waitTimeoutMs)return[2,Promise.reject(new Error('"'.concat(i.waitTimeoutMs,'" is not a valid number for "waitTimeoutMs" ')))];if("object"!==typeof t)return[2,Promise.reject(new Error("The method arguments must be an object. method: ".concat(r.name)))];if(0!==(o=this.getServerMethodsByFilterAndTarget(r,n)).length)return[3,4];v.label=1;case 1:return v.trys.push([1,3,,4]),[4,this.tryToAwaitForMethods(r,n,i)];case 2:return o=v.sent(),[3,4];case 3:return v.sent(),s=hr(hr({},r),{getServers:function(){return[]},supportsStreaming:!1,objectTypes:null!==(p=r.objectTypes)&&void 0!==p?p:[],flags:null!==(g=null===(f=r.flags)||void 0===f?void 0:f.metadata)&&void 0!==g?g:{}}),a={method:s,called_with:t,message:"Can not find a method matching ".concat(JSON.stringify(e)," with server filter ").concat(JSON.stringify(n)),executed_by:void 0,returned:void 0,status:void 0},[2,Promise.reject(a)];case 4:return c=i.methodResponseTimeoutMs,u=i,d=o.map((function(e){var n=Io(),i=e.methods[0],r=e.server,o=m.protocol.client.invoke(n,i,t,r,u);return Promise.race([o,as(c,o,{invocationId:n,message:"Invocation timeout (".concat(c," ms) reached for method name: ").concat(null===i||void 0===i?void 0:i.name,", target instance: ").concat(JSON.stringify(r.instance),", options: ").concat(JSON.stringify(u)),status:is.Error})])})),[4,Promise.all(d)];case 5:return l=v.sent(),h=this.getInvocationResultObj(l,r,t),l.every((function(e){return e.status===is.Error}))?[2,Promise.reject(h)]:[2,h]}}))}))},[2,ss(s(),r,o)]}))}))},e.prototype.getInvocationResultObj=function(e,t,n){var i=e.filter((function(e){return e.status===is.Success})).reduce((function(e,i){return e=gr(gr([],e,!0),[{executed_by:i.instance,returned:i.result,called_with:n,method:t,message:i.message,status:i.status}],!1)}),[]),r=e.filter((function(e){return e.status===is.Error})).reduce((function(e,i){return e=gr(gr([],e,!0),[{executed_by:i.instance,called_with:n,name:t.name,message:i.message}],!1)}),[]),o=e[0];return{method:t,called_with:n,returned:o.result,executed_by:o.instance,all_return_values:i,all_errors:r,message:o.message,status:o.status}},e.prototype.tryToAwaitForMethods=function(e,t,n){var i=this;return new Promise((function(r,o){if(0!==n.waitTimeoutMs)var s=0,a=setInterval((function(){s+=500;var c=i.getServerMethodsByFilterAndTarget(e,t);if(c.length>0)clearInterval(a),r(c);else if(s>=(n.waitTimeoutMs||1e4))return clearInterval(a),void o()}),500);else o()}))},e.prototype.filterByTarget=function(e,t){var n=this;if("string"!==typeof e){return(Array.isArray(e)?e:[e]).reduce((function(e,i){var r=t.filter((function(e){return n.instanceMatch(i,e.server.instance)}));return e.concat(r)}),[])}if("all"===e)return gr([],t,!0);if("best"===e){var i=t.find((function(e){return e.server.instance.isLocal}));if(i)return[i];if(void 0!==t[0])return[t[0]]}else if("skipMine"===e)return t.filter((function(e){return e.server.instance.peerId!==n.instance.peerId}));return[]},e.prototype.instanceMatch=function(e,t){return this.containsProps(e,t)},e.prototype.methodMatch=function(e,t){return this.containsProps(e,t)},e.prototype.containsProps=function(e,t){return Object.keys(e).filter((function(t){return void 0!==e[t]&&null!==e[t]&&"function"!==typeof e[t]&&"object_types"!==t&&"display_name"!==t&&"id"!==t&&"gatewayId"!==t&&"identifier"!==t&&"_"!==t[0]})).every((function(n){var i,r=e[n],o=t[n];switch(n){case"objectTypes":i=(r||[]).every((function(e){return(o||[]).includes(e)}));break;case"flags":i=ts(o||{},r||{});break;default:i=String(r).toLowerCase()===String(o).toLowerCase()}return i}))},e.prototype.getMethods=function(e){var t=this;return void 0===e?this.repo.getMethods():this.repo.getMethods().filter((function(n){return t.methodMatch(e,n)}))},e.prototype.getMethodsForInstance=function(e){var t=this,n=this.repo.getServers().filter((function(n){return t.instanceMatch(e,n.instance)}));if(0===n.length)return[];var i={};return 1===n.length?i=n[0].methods:n.forEach((function(e){Object.keys(e.methods).forEach((function(t){var n=e.methods[t];i[n.identifier]=n}))})),Object.keys(i).map((function(e){return i[e]}))},e.prototype.getServers=function(e){var t=this,n=this.repo.getServers();return void 0===e?n.map((function(e){return{server:e,methods:[]}})):n.reduce((function(n,i){var r=Object.values(i.methods).filter((function(n){return t.methodMatch(e,n)}));return r.length>0&&n.push({server:i,methods:r}),n}),[])},e.prototype.getServerMethodsByFilterAndTarget=function(e,t){var n=this.getServers(e);return this.filterByTarget(t,n)},e}(),us=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.subscription=n}return Object.defineProperty(e.prototype,"stream",{get:function(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instance",{get:function(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance},enumerable:!1,configurable:!0}),e.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},e.prototype.push=function(e){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,e)},e}(),ds=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.requestContext=n,this.arguments=n.arguments,this.instance=n.instance}return e.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},e.prototype.acceptOnBranch=function(e){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,e)},e.prototype.reject=function(e){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,e)},e}(),ls=function(){function e(e,t){var n=this;this.protocol=e,this.server=t,e.server.onSubRequest((function(e,t){return n.handleSubRequest(e,t)})),e.server.onSubAdded((function(e,t){return n.handleSubAdded(e,t)})),e.server.onSubRemoved((function(e,t){return n.handleSubRemoved(e,t)}))}return e.prototype.handleSubRequest=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionRequestHandler){var n=new ds(this.protocol,t,e);t.streamCallbacks.subscriptionRequestHandler(n)}},e.prototype.handleSubAdded=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionAddedHandler){var n=new us(this.protocol,t,e);t.streamCallbacks.subscriptionAddedHandler(n)}},e.prototype.handleSubRemoved=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionRemovedHandler){var n=new us(this.protocol,t,e);t.streamCallbacks.subscriptionRemovedHandler(n)}},e}(),hs=function(){function e(e,t,n){this.key=e,this.protocol=t,this.repoMethod=n}return e.prototype.subscriptions=function(){var e=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map((function(t){return new us(e.protocol,e.repoMethod,t)}))},e.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},e.prototype.push=function(e){this.protocol.server.pushData(this.repoMethod,e,[this.key])},e}(),ps=function(){function e(e,t,n){this._protocol=e,this._repoMethod=t,this._server=n,this.name=this._repoMethod.definition.name}return e.prototype.branches=function(e){var t=this,n=this._protocol.server.getBranchList(this._repoMethod);return e?n.indexOf(e)>-1?new hs(e,this._protocol,this._repoMethod):void 0:n.map((function(e){return new hs(e,t._protocol,t._repoMethod)}))},e.prototype.branch=function(e){return this.branches(e)},e.prototype.subscriptions=function(){var e=this;return this._protocol.server.getSubscriptionList(this._repoMethod).map((function(t){return new us(e._protocol,e._repoMethod,t)}))},Object.defineProperty(e.prototype,"definition",{get:function(){var e,t=this._repoMethod.definition;return{accepts:t.accepts,description:t.description,displayName:t.displayName,name:t.name,objectTypes:t.objectTypes,returns:t.returns,supportsStreaming:t.supportsStreaming,flags:null===(e=t.flags)||void 0===e?void 0:e.metadata}},enumerable:!1,configurable:!0}),e.prototype.close=function(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)},e.prototype.push=function(e,t){if("string"!==typeof t&&!Array.isArray(t)&&void 0!==t)throw new Error("invalid branches should be string or string array");if("object"!==typeof e)throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,e,t)},e.prototype.updateRepoMethod=function(e){this._repoMethod=e},e}(),fs=function(){function e(e,t){this.protocol=e,this.serverRepository=t,this.invocations=0,this.currentlyUnregistering={},this.streaming=new ls(e,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return e.prototype.createStream=function(e,t,n,i,r){var o=this,s=new Promise((function(n,i){if(e){var s;if(!(s="string"===typeof e?{name:""+e}:hr({},e)).name)return i("The \u201cname\u201d property is required for the \u201cstreamDefinition\u201d object and must be unique. Stream definition: ".concat(JSON.stringify(s)));if(o.serverRepository.getList().some((function(e){return e.definition.name===s.name})))return i('A stream with the name "'.concat(s.name,'" already exists! Please, provide a unique name for the stream.'));s.supportsStreaming=!0,t||(t={}),"function"!==typeof t.subscriptionRequestHandler&&(t.subscriptionRequestHandler=function(e){e.accept()});var a=o.serverRepository.add({definition:s,streamCallbacks:t,protocolState:{}});o.protocol.server.createStream(a).then((function(){var e;r?(e=r,r.updateRepoMethod(a)):e=new ps(o.protocol,a,o),a.stream=e,n(e)})).catch((function(e){a.repoId&&o.serverRepository.remove(a.repoId),i(e)}))}else i("The stream name must be unique! Please, provide either a unique string for a stream name to \u201cglue.interop.createStream()\u201d or a \u201cmethodDefinition\u201d object with a unique \u201cname\u201d property for the stream.")}));return ss(s,n,i)},e.prototype.register=function(e,t){var n=this;if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");if("function"!==typeof t)return Promise.reject("The second parameter must be a callback function. Method: ".concat("string"===typeof e?e:e.name));var i=function(e,i){return pr(n,void 0,void 0,(function(){var n,r,o;return fr(this,(function(s){switch(s.label){case 0:return s.trys.push([0,4,,5]),(n=t(e.args,e.instance))&&"function"===typeof n.then?[4,n]:[3,2];case 1:return r=s.sent(),i(void 0,r),[3,3];case 2:i(void 0,n),s.label=3;case 3:return[3,5];case 4:return o=s.sent(),i(null!==o&&void 0!==o?o:"",null!==o&&void 0!==o?o:""),[3,5];case 5:return[2]}}))}))};return i.userCallback=t,this.registerCore(e,i)},e.prototype.registerAsync=function(e,t){if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");if("function"!==typeof t)return Promise.reject("The second parameter must be a callback function. Method: ".concat("string"===typeof e?e:e.name));var n=function(e,n){try{var i=!1,r=function(e){i||n(void 0,e),i=!0},o=function(e){i||(e||(e=""),n(e,e)),i=!0},s=t(e.args,e.instance,r,o);s&&"function"===typeof s.then&&s.then(r).catch(o)}catch(a){n(a,void 0)}};return n.userCallbackAsync=t,this.registerCore(e,n)},e.prototype.unregister=function(e,t){return void 0===t&&(t=!1),pr(this,void 0,void 0,(function(){var n,i;return fr(this,(function(r){switch(r.label){case 0:return void 0===e?[2,Promise.reject("Please, provide either a unique string for a name or an object containing a \u201cname\u201d property.")]:"function"!==typeof e?[3,2]:[4,this.unregisterWithPredicate(e,t)];case 1:case 3:return r.sent(),[2];case 2:return void 0===(n="string"===typeof e?{name:e}:e).name?[2,Promise.reject("Method name is required. Cannot find a method if the method name is undefined!")]:(i=this.serverRepository.getList().find((function(e){return e.definition.name===n.name&&(e.definition.supportsStreaming||!1)===t})))?[4,this.removeMethodsOrStreams([i])]:[2,Promise.reject('Method with a name "'.concat(n.name,'" does not exist or is not registered by your application!'))]}}))}))},e.prototype.unregisterWithPredicate=function(e,t){return pr(this,void 0,void 0,(function(){var n;return fr(this,(function(i){switch(i.label){case 0:return(n=this.serverRepository.getList().filter((function(t){return e(t.definition)})).filter((function(e){return(e.definition.supportsStreaming||!1)===t})))&&0!==n.length?[4,this.removeMethodsOrStreams(n)]:[2,Promise.reject("Could not find a ".concat(t?"stream":"method"," matching the specified condition!"))];case 1:return i.sent(),[2]}}))}))},e.prototype.removeMethodsOrStreams=function(e){var t=this,n=[];return e.forEach((function(e){var i=t.protocol.server.unregister(e).then((function(){e.repoId&&t.serverRepository.remove(e.repoId)}));n.push(i),t.addAsCurrentlyUnregistering(e.definition.name,i)})),Promise.all(n)},e.prototype.addAsCurrentlyUnregistering=function(e,t){return pr(this,void 0,void 0,(function(){var n,i=this;return fr(this,(function(r){return n=new Promise((function(e){return setTimeout(e,5e3)})),this.currentlyUnregistering[e]=Promise.race([t,n]).then((function(){delete i.currentlyUnregistering[e]})),[2]}))}))},e.prototype.registerCore=function(e,t){return pr(this,void 0,void 0,(function(){var n,i,r,o=this;return fr(this,(function(s){switch(s.label){case 0:return(n="string"===typeof e?{name:""+e}:hr({},e)).name?(i=this.currentlyUnregistering[n.name])?[4,i]:[3,2]:[2,Promise.reject("Please, provide a (unique) string value for the \u201cname\u201d property in the \u201cmethodDefinition\u201d object: ".concat(JSON.stringify(e)))];case 1:s.sent(),s.label=2;case 2:return this.serverRepository.getList().some((function(e){return e.definition.name===n.name}))?[2,Promise.reject('A method with the name "'.concat(n.name,'" already exists! Please, provide a unique name for the method.'))]:n.supportsStreaming?[2,Promise.reject("When you create methods with \u201cglue.interop.register()\u201d or \u201cglue.interop.registerAsync()\u201d the property \u201csupportsStreaming\u201d cannot be \u201ctrue\u201d. If you want \u201c".concat(n.name,"\u201d to be a stream, please use the \u201cglue.interop.createStream()\u201d method."))]:(r=this.serverRepository.add({definition:n,theFunction:t,protocolState:{}}),[2,this.protocol.server.register(r).catch((function(e){throw(null===r||void 0===r?void 0:r.repoId)&&o.serverRepository.remove(r.repoId),e}))])}}))}))},e.prototype.onMethodInvoked=function(e,t,n){var i=this;e&&e.theFunction&&e.theFunction(n,(function(n,r){if(void 0!==n&&null!==n)if(n.message&&"string"===typeof n.message)n=n.message;else if("string"!==typeof n)try{n=JSON.stringify(n)}catch(o){n="un-stringifyable error in onMethodInvoked! Top level prop names: ".concat(Object.keys(n))}r?("object"!==typeof r||Array.isArray(r))&&(r={_value:r}):r={},i.protocol.server.methodInvocationResult(e,t,n,r)}))},e}(),gs=function(){function e(e,t,n){var i=this;this.wrapped={},this.wrapped.getMethods=function(){return e.methodsForInstance(this)},this.wrapped.getStreams=function(){return e.methodsForInstance(this).filter((function(e){return e.supportsStreaming}))},t&&this.refreshWrappedObject(t),n&&(n.loggedIn((function(){i.refresh(n)})),this.refresh(n))}return e.prototype.unwrap=function(){return this.wrapped},e.prototype.refresh=function(e){if(e){var t=null===e||void 0===e?void 0:e.resolvedIdentity,n=Object.assign({},null!==t&&void 0!==t?t:{},{peerId:null===e||void 0===e?void 0:e.peerId});this.refreshWrappedObject(n)}},e.prototype.refreshWrappedObject=function(e){var t,n,i,r,o=this;Object.keys(e).forEach((function(t){o.wrapped[t]=e[t]})),this.wrapped.user=e.user,this.wrapped.instance=e.instance,this.wrapped.application=null!==(t=e.application)&&void 0!==t?t:Io(),this.wrapped.applicationName=e.applicationName,this.wrapped.pid=null!==(i=null!==(n=e.pid)&&void 0!==n?n:e.process)&&void 0!==i?i:Math.floor(1e10*Math.random()),this.wrapped.machine=e.machine,this.wrapped.environment=e.environment,this.wrapped.region=e.region,this.wrapped.windowId=e.windowId,this.wrapped.isLocal=null===(r=e.isLocal)||void 0===r||r,this.wrapped.api=e.api,this.wrapped.service=e.service,this.wrapped.peerId=e.peerId},e}(),ms=function(e){return hr(hr({},e),{flags:e.flags.metadata||{}})},vs=function(){function e(e,t){this.logger=e,this.API=t,this.servers={},this.methodsCount={},this.callbacks=Ur();var n=this.API.instance.peerId;this.myServer={id:n,methods:{},instance:this.API.instance,wrapper:this.API.unwrappedInstance},this.servers[n]=this.myServer}return e.prototype.addServer=function(e,t){this.logger.debug("adding server ".concat(t));var n=this.servers[t];if(n)return n.id;var i=new gs(this.API,e),r={id:t,methods:{},instance:i.unwrap(),wrapper:i};return this.servers[t]=r,this.callbacks.execute("onServerAdded",r.instance),t},e.prototype.removeServerById=function(e,t){var n=this,i=this.servers[e];i?(this.logger.debug("removing server ".concat(e)),Object.keys(i.methods).forEach((function(t){n.removeServerMethod(e,t)})),delete this.servers[e],this.callbacks.execute("onServerRemoved",i.instance,t)):this.logger.warn("not aware of server ".concat(e,", my state ").concat(JSON.stringify(Object.keys(this.servers))))},e.prototype.addServerMethod=function(e,t){var n,i=this.servers[e];if(!i)throw new Error("server does not exists");if(!i.methods[t.id]){var r=this.createMethodIdentifier(t),o=this,s={identifier:r,gatewayId:t.id,name:t.name,displayName:t.display_name,description:t.description,version:t.version,objectTypes:t.object_types||[],accepts:t.input_signature,returns:t.result_signature,supportsStreaming:"undefined"!==typeof t.flags&&t.flags.streaming,flags:null!==(n=t.flags)&&void 0!==n?n:{},getServers:function(){return o.getServersByMethod(r)}};s.object_types=s.objectTypes,s.display_name=s.displayName,s.version=s.version,i.methods[t.id]=s;var a=ms(s);return this.methodsCount[r]||(this.methodsCount[r]=0,this.callbacks.execute("onMethodAdded",a)),this.methodsCount[r]=this.methodsCount[r]+1,this.callbacks.execute("onServerMethodAdded",i.instance,a),s}},e.prototype.removeServerMethod=function(e,t){var n=this.servers[e];if(!n)throw new Error("server does not exists");var i=n.methods[t];delete n.methods[t];var r=ms(i);this.methodsCount[i.identifier]=this.methodsCount[i.identifier]-1,0===this.methodsCount[i.identifier]&&this.callbacks.execute("onMethodRemoved",r),this.callbacks.execute("onServerMethodRemoved",n.instance,r)},e.prototype.getMethods=function(){return this.extractMethodsFromServers(Object.values(this.servers)).map(ms)},e.prototype.getServers=function(){return Object.values(this.servers).map(this.hideServerMethodSystemFlags)},e.prototype.onServerAdded=function(e){var t=this.callbacks.add("onServerAdded",e),n=this.getServers().map((function(e){return e.instance}));return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onMethodAdded=function(e){var t=this.callbacks.add("onMethodAdded",e),n=this.getMethods();return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onServerMethodAdded=function(e){var t=this.callbacks.add("onServerMethodAdded",e),n=!1,i=this.getServers();return setTimeout((function(){i.forEach((function(t){var i=t.methods;Object.keys(i).forEach((function(r){n||e(t.instance,i[r])}))}))}),0),function(){n=!0,t()}},e.prototype.onMethodRemoved=function(e){return this.callbacks.add("onMethodRemoved",e)},e.prototype.onServerRemoved=function(e){return this.callbacks.add("onServerRemoved",e)},e.prototype.onServerMethodRemoved=function(e){return this.callbacks.add("onServerMethodRemoved",e)},e.prototype.getServerById=function(e){return this.hideServerMethodSystemFlags(this.servers[e])},e.prototype.reset=function(){var e,t=this;Object.keys(this.servers).forEach((function(e){t.removeServerById(e,"reset")})),this.servers=((e={})[this.myServer.id]=this.myServer,e),this.methodsCount={}},e.prototype.createMethodIdentifier=function(e){var t,n,i=null!==(t=e.input_signature)&&void 0!==t?t:"",r=null!==(n=e.result_signature)&&void 0!==n?n:"";return(e.name+i+r).toLowerCase()},e.prototype.getServersByMethod=function(e){var t=[];return Object.values(this.servers).forEach((function(n){Object.values(n.methods).forEach((function(i){i.identifier===e&&t.push(n.instance)}))})),t},e.prototype.returnUnsubWithDelayedReplay=function(e,t,n){var i=!1;return setTimeout((function(){t.forEach((function(e){i||n(e)}))}),0),function(){i=!0,e()}},e.prototype.hideServerMethodSystemFlags=function(e){var t={};return Object.entries(e.methods).forEach((function(e){var n=e[0],i=e[1];t[n]=ms(i)})),hr(hr({},e),{methods:t})},e.prototype.extractMethodsFromServers=function(e){return Object.values(e).reduce((function(e,t){return gr(gr([],e,!0),Object.values(t.methods),!0)}),[])},e}(),ys=function(){function e(){this.nextId=0,this.methods=[]}return e.prototype.add=function(e){return e.repoId=String(this.nextId),this.nextId+=1,this.methods.push(e),e},e.prototype.remove=function(e){if("string"!==typeof e)return new TypeError("Expecting a string");this.methods=this.methods.filter((function(t){return t.repoId!==e}))},e.prototype.getById=function(e){if("string"===typeof e)return this.methods.find((function(t){return t.repoId===e}))},e.prototype.getList=function(){return this.methods.map((function(e){return e}))},e.prototype.length=function(){return this.methods.length},e.prototype.reset=function(){this.methods=[]},e}(),ws="onSubscriptionRequest",bs="onSubscriptionAdded",_s="onSubscriptionRemoved",Is=function(){function e(e,t,n){var i=this;this.session=e,this.repository=t,this.serverRepository=n,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=Ur(),this.nextStreamId=0,e.on("add-interest",(function(e){i.handleAddInterest(e)})),e.on("remove-interest",(function(e){i.handleRemoveInterest(e)}))}return e.prototype.acceptRequestOnBranch=function(e,t,n){if("string"!==typeof n&&(n=""),"object"!==typeof t.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(t.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var i=this.getStreamId(t,n),r=e.msg.subscription_id,o={id:r,arguments:e.arguments,instance:e.instance,branchKey:n,streamId:i,subscribeMsg:e.msg};t.protocolState.subscriptionsMap[r]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:r,stream_id:i}),this.callbacks.execute(bs,o,t)},e.prototype.rejectRequest=function(e,t,n){"string"!==typeof n&&(n=""),this.sendSubscriptionFailed("Subscription rejected by user. "+n,e.msg.subscription_id)},e.prototype.pushData=function(e,t,n){var i=this;if("object"===typeof e&&Array.isArray(e.protocolState.branchKeyToStreamIdMap)){if("object"!==typeof t)throw new Error("Invalid arguments. Data must be an object.");"string"===typeof n?n=[n]:(!Array.isArray(n)||n.length<=0)&&(n=[]),e.protocolState.branchKeyToStreamIdMap.filter((function(e){return!n||0===n.length||n.indexOf(e.key)>=0})).map((function(e){return e.streamId})).forEach((function(e){var n={type:"publish",stream_id:e,data:t};i.session.sendFireAndForget(n)}))}},e.prototype.pushDataToSingle=function(e,t,n){if("object"!==typeof n)throw new Error("Invalid arguments. Data must be an object.");var i={type:"post",subscription_id:t.id,data:n};this.session.sendFireAndForget(i)},e.prototype.closeSingleSubscription=function(e,t){e.protocolState.subscriptionsMap&&delete e.protocolState.subscriptionsMap[t.id];var n={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(n),t.instance,this.callbacks.execute(_s,t,e)},e.prototype.closeMultipleSubscriptions=function(e,t){var n=this;if("object"===typeof e&&"object"===typeof e.protocolState.subscriptionsMap&&e.protocolState.subscriptionsMap){var i=e.protocolState.subscriptionsMap,r=Object.keys(i).map((function(e){return i[e]}));"string"===typeof t&&(r=r.filter((function(e){return e.branchKey===t}))),r.forEach((function(e){delete i[e.id];var t={type:"drop-subscription",subscription_id:e.id,reason:"Server dropping all subscriptions on stream_id: "+e.streamId};n.session.sendFireAndForget(t)}))}},e.prototype.getSubscriptionList=function(e,t){if("object"!==typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var n=e.protocolState.subscriptionsMap,i=Object.keys(n).map((function(e){return n[e]}));return"string"!==typeof t?i:i.filter((function(e){return e.branchKey===t}))},e.prototype.getBranchList=function(e){if("object"!==typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var t=e.protocolState.subscriptionsMap,n=Object.keys(t).map((function(e){return t[e]})),i=[];return n.forEach((function(e){var t="";"object"===typeof e&&"string"===typeof e.branchKey&&(t=e.branchKey),-1===i.indexOf(t)&&i.push(t)})),i},e.prototype.onSubAdded=function(e){this.onSubscriptionLifetimeEvent(bs,e)},e.prototype.onSubRequest=function(e){this.onSubscriptionLifetimeEvent(ws,e)},e.prototype.onSubRemoved=function(e){this.onSubscriptionLifetimeEvent(_s,e)},e.prototype.handleRemoveInterest=function(e){var t=this.serverRepository.getById(e.method_id);if("string"===typeof e.subscription_id&&"object"===typeof t&&t.protocolState.subscriptionsMap&&"object"===typeof t.protocolState.subscriptionsMap[e.subscription_id]){var n=t.protocolState.subscriptionsMap[e.subscription_id];delete t.protocolState.subscriptionsMap[e.subscription_id],this.callbacks.execute(_s,n,t)}},e.prototype.onSubscriptionLifetimeEvent=function(e,t){this.callbacks.add(e,t)},e.prototype.getNextStreamId=function(){return this.nextStreamId+++""},e.prototype.handleAddInterest=function(e){var t=this.repository.getServerById(e.caller_id).instance,n={msg:e,arguments:e.arguments_kv||{},instance:t},i=this.serverRepository.getById(e.method_id);if(void 0!==i)i.protocolState.subscriptionsMap&&i.protocolState.subscriptionsMap[e.subscription_id]?this.sendSubscriptionFailed("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id):this.callbacks.execute(ws,n,i);else{var r="No method with id "+e.method_id+" on this server.";this.sendSubscriptionFailed(r,e.subscription_id)}},e.prototype.sendSubscriptionFailed=function(e,t){var n={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:e,request_id:t};this.session.sendFireAndForget(n)},e.prototype.getStreamId=function(e,t){if("string"!==typeof t&&(t=""),!e.protocolState.branchKeyToStreamIdMap)throw new Error("streaming ".concat(e.definition.name," method without protocol state"));var n=e.protocolState.branchKeyToStreamIdMap.filter((function(e){return e.key===t}))[0],i=n?n.streamId:void 0;return"string"===typeof i&&""!==i||(i=this.getNextStreamId(),e.protocolState.branchKeyToStreamIdMap.push({key:t,streamId:i})),i},e}(),Cs=function(){function e(e,t,n,i){var r=this;this.session=e,this.clientRepository=t,this.serverRepository=n,this.logger=i,this.callbacks=Ur(),this.streaming=new Is(e,t,n),this.session.on("invoke",(function(e){return r.handleInvokeMessage(e)}))}return e.prototype.createStream=function(e){return e.protocolState.subscriptionsMap={},e.protocolState.branchKeyToStreamIdMap=[],this.register(e,!0)},e.prototype.register=function(e,t){var n,i=this,r=e.definition,o=Object.assign({},{metadata:null!==(n=r.flags)&&void 0!==n?n:{}},{streaming:t||!1}),s={type:"register",methods:[{id:e.repoId,name:r.name,display_name:r.displayName,description:r.description,version:r.version,flags:o,object_types:r.objectTypes||r.object_types,input_signature:r.accepts,result_signature:r.returns,restrictions:void 0}]};return this.session.send(s,{methodId:e.repoId}).then((function(){i.logger.debug("registered method "+e.definition.name+" with id "+e.repoId)})).catch((function(t){throw i.logger.warn("failed to register method ".concat(e.definition.name," with id ").concat(e.repoId," - ").concat(JSON.stringify(t))),t}))},e.prototype.onInvoked=function(e){this.callbacks.add("onInvoked",e)},e.prototype.methodInvocationResult=function(e,t,n,i){var r;r=n||""===n?{type:"error",request_id:t,reason_uri:"agm.errors.client_error",reason:n,context:i,peer_id:void 0}:{type:"yield",invocation_id:t,peer_id:this.session.peerId,result:i,request_id:void 0},this.session.sendFireAndForget(r)},e.prototype.unregister=function(e){return pr(this,void 0,void 0,(function(){var t;return fr(this,(function(n){switch(n.label){case 0:return t={type:"unregister",methods:[e.repoId]},[4,this.session.send(t)];case 1:return n.sent(),[2]}}))}))},e.prototype.getBranchList=function(e){return this.streaming.getBranchList(e)},e.prototype.getSubscriptionList=function(e,t){return this.streaming.getSubscriptionList(e,t)},e.prototype.closeAllSubscriptions=function(e,t){this.streaming.closeMultipleSubscriptions(e,t)},e.prototype.pushData=function(e,t,n){this.streaming.pushData(e,t,n)},e.prototype.pushDataToSingle=function(e,t,n){this.streaming.pushDataToSingle(e,t,n)},e.prototype.closeSingleSubscription=function(e,t){this.streaming.closeSingleSubscription(e,t)},e.prototype.acceptRequestOnBranch=function(e,t,n){this.streaming.acceptRequestOnBranch(e,t,n)},e.prototype.rejectRequest=function(e,t,n){this.streaming.rejectRequest(e,t,n)},e.prototype.onSubRequest=function(e){this.streaming.onSubRequest(e)},e.prototype.onSubAdded=function(e){this.streaming.onSubAdded(e)},e.prototype.onSubRemoved=function(e){this.streaming.onSubRemoved(e)},e.prototype.handleInvokeMessage=function(e){var t=e.invocation_id,n=e.caller_id,i=e.method_id,r=e.arguments_kv,o=this.serverRepository.getList().filter((function(e){return e.repoId===i}))[0];if(void 0!==o){var s={args:r,instance:this.clientRepository.getServerById(n).instance};this.callbacks.execute("onInvoked",o,t,s)}},e}(),Ss=function(){function e(e,t){this.repository=e,this.subscriptionData=t}return Object.defineProperty(e.prototype,"requestArguments",{get:function(){return this.subscriptionData.params.arguments||{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"servers",{get:function(){var e=this;return this.subscriptionData.trackedServers.filter((function(e){return e.subscriptionId})).map((function(t){return e.repository.getServerById(t.serverId).instance}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverInstance",{get:function(){return this.servers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stream",{get:function(){return this.subscriptionData.method},enumerable:!1,configurable:!0}),e.prototype.onData=function(e){if("function"!==typeof e)throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(e),1===this.subscriptionData.handlers.onData.length&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach((function(t){e(t)}))},e.prototype.onClosed=function(e){if("function"!==typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(e)},e.prototype.onFailed=function(e){},e.prototype.onConnected=function(e){if("function"!==typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(e)},e.prototype.close=function(){this.subscriptionData.close()},e.prototype.setNewSubscription=function(e){this.subscriptionData=e},e}(),ks=function(){function e(e){this.config=e,this.cache=[],this.timeoutIds=[]}return e.prototype.add=function(e){var t=this,n=Io();this.cache.push({id:n,element:e});var i=setTimeout((function(){var e=t.cache.findIndex((function(e){return e.id===n}));e<0||t.cache.splice(e,1)}),this.config.ELEMENT_TTL_MS);this.timeoutIds.push(i)},e.prototype.flush=function(){var e=this.cache.map((function(e){return e.element}));return this.timeoutIds.forEach((function(e){return clearInterval(e)})),this.cache=[],this.timeoutIds=[],e},e}(),xs="awaitingAccept",Ts="subscribed",As="Subscription failed.",Es="ClientInitiated",Ps=function(){function e(e,t,n){var i=this;this.session=e,this.repository=t,this.logger=n,this.subscriptionsList={},this.timedCache=new ks({ELEMENT_TTL_MS:1e4}),this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(e){var t=e._tag,n=t.subLocalKey,r=i.subscriptionsList[n];if("object"===typeof r&&(r.trackedServers=r.trackedServers.filter((function(e){return e.serverId!==t.serverId})),r.trackedServers.length<=0)){if(clearTimeout(r.timeoutId),r.status===xs){var o="string"===typeof e.reason&&""!==e.reason?' Publisher said "'+e.reason+'".':" No reason given.",s="object"===typeof r.params.arguments?JSON.stringify(r.params.arguments):"{}";r.error({message:"Subscription rejected."+o+" Called with:"+s,called_with:r.params.arguments,method:r.method})}else r.status===Ts&&i.callOnClosedHandlers(r);delete i.subscriptionsList[n]}},this.handleSubscribed=function(e){var t=e._tag.subLocalKey,n=i.subscriptionsList[t];if("object"===typeof n){var r=e._tag.serverId,o=n.trackedServers.filter((function(e){return e.serverId===r}))[0];if("object"===typeof o){o.subscriptionId=e.subscription_id,i.subscriptionIdToLocalKeyMap[e.subscription_id]=t;var s=n.status===xs;if(n.status=Ts,s){var a=!1,c=n.subscription;c?(c.setNewSubscription(n),n.success(c),a=!0):(c=new Ss(i.repository,n),n.subscription=c,n.success(c));for(var u=0,d=n.handlers.onConnected;u<d.length;u++){var l=d[u];try{l(c.serverInstance,a)}catch(h){}}}}}},this.handleEventData=function(e){var t=i.subscriptionIdToLocalKeyMap[e.subscription_id];if("undefined"!==typeof t){var n=i.subscriptionsList[t];if("object"===typeof n){var r=n.trackedServers.filter((function(t){return t.subscriptionId===e.subscription_id}));if(1===r.length){var o=e.oob,s=r[0].serverId,a=function(){return{data:e.data,server:i.repository.getServerById(s).instance,requestArguments:n.params.arguments,message:void 0,private:o}},c=n.handlers.onData,u=n.queued.data;c.length>0?c.forEach((function(e){"function"===typeof e&&e(a())})):u.push(a())}}}},this.handleSubscriptionCancelled=function(e){var t=i.subscriptionIdToLocalKeyMap[e.subscription_id];if("undefined"!==typeof t){var n=i.subscriptionsList[t];if("object"===typeof n){var r=n.trackedServers.length-1;n.trackedServers=n.trackedServers.filter((function(t){return t.subscriptionId!==e.subscription_id||(n.queued.closers.push(t.serverId),!1)})),n.trackedServers.length===r&&(n.trackedServers.length<=0&&(i.timedCache.add(n),clearTimeout(n.timeoutId),i.callOnClosedHandlers(n),delete i.subscriptionsList[t]),delete i.subscriptionIdToLocalKeyMap[e.subscription_id])}}},e.on("subscribed",this.handleSubscribed),e.on("event",this.handleEventData),e.on("subscription-cancelled",this.handleSubscriptionCancelled)}return e.prototype.subscribe=function(e,t,n,i,r,o){var s=this;if(0!==n.length){var a=this.getNextSubscriptionLocalKey(),c=this.registerSubscription(a,e,t,i,r,t.methodResponseTimeout||1e4,o);"object"===typeof c?n.forEach((function(n){var i=n.server.id,r=n.methods.find((function(t){return t.name===e.name}));if(r){c.trackedServers.push({serverId:i,subscriptionId:void 0});var o={type:"subscribe",server_id:i,method_id:r.gatewayId,arguments_kv:t.arguments};s.session.send(o,{serverId:i,subLocalKey:a}).then((function(e){return s.handleSubscribed(e)})).catch((function(e){return s.handleErrorSubscribing(e)}))}else s.logger.error("can not find method ".concat(e.name," for target ").concat(n.server.id))})):r({method:e,called_with:t.arguments,message:As+" Unable to register the user callbacks."})}else r({method:e,called_with:t.arguments,message:As+" No available servers matched the target params."})},e.prototype.drainSubscriptions=function(){var e=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},e},e.prototype.drainSubscriptionsCache=function(){return this.timedCache.flush()},e.prototype.getNextSubscriptionLocalKey=function(){var e=this.nextSubLocalKey;return this.nextSubLocalKey+=1,e},e.prototype.registerSubscription=function(e,t,n,i,r,o,s){var a=this,c={localKey:e,status:xs,method:t,params:n,success:i,error:r,trackedServers:[],handlers:{onData:(null===s||void 0===s?void 0:s.handlers.onData)||[],onClosed:(null===s||void 0===s?void 0:s.handlers.onClosed)||[],onConnected:(null===s||void 0===s?void 0:s.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:function(){return a.closeSubscription(e)},subscription:null===s||void 0===s?void 0:s.subscription};return s||(n.onData&&c.handlers.onData.push(n.onData),n.onClosed&&c.handlers.onClosed.push(n.onClosed),n.onConnected&&c.handlers.onConnected.push(n.onConnected)),this.subscriptionsList[e]=c,c.timeoutId=setTimeout((function(){if(void 0!==a.subscriptionsList[e]){var i=a.subscriptionsList[e];i.status===xs?(r({method:t,called_with:n.arguments,message:As+" Subscription attempt timed out after "+o+" ms."}),delete a.subscriptionsList[e]):i.status===Ts&&i.trackedServers.length>0&&(i.trackedServers=i.trackedServers.filter((function(e){return"undefined"!==typeof e.subscriptionId})),delete i.timeoutId,i.trackedServers.length<=0&&(a.callOnClosedHandlers(i),delete a.subscriptionsList[e]))}}),o),c},e.prototype.callOnClosedHandlers=function(e,t){var n,i=e.queued.closers.length,r=i>0?e.queued.closers[i-1]:null;void 0!==r&&"string"===typeof r&&(n=this.repository.getServerById(r).instance),e.handlers.onClosed.forEach((function(i){"function"===typeof i&&i({message:t||"ServerInitiated",requestArguments:e.params.arguments||{},server:n,stream:e.method})}))},e.prototype.closeSubscription=function(e){var t=this,n=this.subscriptionsList[e];"object"===typeof n&&(n.trackedServers.forEach((function(e){"undefined"!==typeof e.subscriptionId&&(n.queued.closers.push(e.serverId),t.session.sendFireAndForget({type:"unsubscribe",subscription_id:e.subscriptionId,reason_uri:"",reason:Es}),delete t.subscriptionIdToLocalKeyMap[e.subscriptionId])})),n.trackedServers=[],this.callOnClosedHandlers(n,Es),delete this.subscriptionsList[e])},e}(),Ms=function(){function e(e,t,n){var i=this;this.session=e,this.repository=t,this.logger=n,e.on("peer-added",(function(e){return i.handlePeerAdded(e)})),e.on("peer-removed",(function(e){return i.handlePeerRemoved(e)})),e.on("methods-added",(function(e){return i.handleMethodsAddedMessage(e)})),e.on("methods-removed",(function(e){return i.handleMethodsRemovedMessage(e)})),this.streaming=new Ps(e,t,n)}return e.prototype.subscribe=function(e,t,n,i,r,o){this.streaming.subscribe(e,t,n,i,r,o)},e.prototype.invoke=function(e,t,n,i){var r=this,o=i.id,s={type:"call",server_id:o,method_id:t.gatewayId,arguments_kv:n};return this.session.send(s,{invocationId:e,serverId:o}).then((function(e){return r.handleResultMessage(e)})).catch((function(e){return r.handleInvocationError(e)}))},e.prototype.drainSubscriptions=function(){return this.streaming.drainSubscriptions()},e.prototype.drainSubscriptionsCache=function(){return this.streaming.drainSubscriptionsCache()},e.prototype.handlePeerAdded=function(e){var t=e.new_peer_id,n=e.identity,i=!e.meta||e.meta.local,r=Number(n.process),o={machine:n.machine,pid:isNaN(r)?n.process:r,instance:n.instance,application:n.application,applicationName:n.applicationName,environment:n.environment,region:n.region,user:n.user,windowId:n.windowId,peerId:t,api:n.api,isLocal:i};this.repository.addServer(o,t)},e.prototype.handlePeerRemoved=function(e){var t=e.removed_id,n=e.reason;this.repository.removeServerById(t,n)},e.prototype.handleMethodsAddedMessage=function(e){var t=this,n=e.server_id;e.methods.forEach((function(e){t.repository.addServerMethod(n,e)}))},e.prototype.handleMethodsRemovedMessage=function(e){var t=this,n=e.server_id,i=e.methods,r=this.repository.getServerById(n);Object.keys(r.methods).forEach((function(e){var o=r.methods[e];i.indexOf(o.gatewayId)>-1&&t.repository.removeServerMethod(n,e)}))},e.prototype.handleResultMessage=function(e){var t=e._tag.invocationId,n=e.result,i=e._tag.serverId;return{invocationId:t,result:n,instance:this.repository.getServerById(i).instance,status:is.Success,message:""}},e.prototype.handleInvocationError=function(e){if(this.logger.debug("handle invocation error ".concat(JSON.stringify(e))),"_tag"in e){var t=e._tag.invocationId,n=e._tag.serverId,i=this.repository.getServerById(n),r=e.reason;return{invocationId:t,result:e.context,instance:i.instance,status:is.Error,message:r}}return{invocationId:"",message:e.message,status:is.Error,error:e}},e}();function Rs(e,t,n,i,r,o){var s,a=r.logger.subLogger("gw3-protocol"),c=new Promise((function(e){s=e})),u=t.domain("agm",["subscribed"]),d=new Cs(u,n,i,a.subLogger("server")),l=new Ms(u,n,a.subLogger("client"));return u.onJoined((function(r){n.addServer(e,t.peerId),r?function(){return pr(this,void 0,void 0,(function(){var e,t,n,r,s,c,u,d,h,p,f;return fr(this,(function(g){switch(g.label){case 0:for(a.info("reconnected - will replay registered methods and subscriptions"),l.drainSubscriptionsCache().forEach((function(e){var t=e.method,n=Object.assign({},e.params);a.info("trying to soft-re-subscribe to method ".concat(t.name,", with params: ").concat(JSON.stringify(n))),o.client.subscribe(t,n,void 0,void 0,e).then((function(){return a.info("soft-subscribing to method ".concat(t.name," DONE"))})).catch((function(e){return a.warn("subscribing to method ".concat(t.name," failed: ").concat(JSON.stringify(e),"}"))}))})),e=[],t=l.drainSubscriptions(),n=function(t){var n=t.method,i=Object.assign({},t.params);a.info("trying to re-subscribe to method ".concat(n.name,", with params: ").concat(JSON.stringify(i))),e.push(o.client.subscribe(n,i,void 0,void 0,t).then((function(){return a.info("subscribing to method ".concat(n.name," DONE"))})))},r=0,s=t;r<s.length;r++)c=s[r],n(c);for(u=i.getList(),i.reset(),d=function(t){var n=t.definition;a.info("re-publishing method ".concat(n.name)),t.stream?e.push(o.server.createStream(n,t.streamCallbacks,void 0,void 0,t.stream).then((function(){return a.info("subscribing to method ".concat(n.name," DONE"))}))):t.theFunction&&t.theFunction.userCallback?e.push(o.register(n,t.theFunction.userCallback).then((function(){return a.info("subscribing to method ".concat(n.name," DONE"))}))):t.theFunction&&t.theFunction.userCallbackAsync&&e.push(o.registerAsync(n,t.theFunction.userCallbackAsync).then((function(){return a.info("subscribing to method ".concat(n.name," DONE"))}))),a.info("re-publishing method ".concat(n.name," DONE"))},h=0,p=u;h<p.length;h++)f=p[h],d(f);return[4,Promise.all(e)];case 1:return g.sent(),a.info("Interop is re-announced"),[2]}}))}))}().then((function(){return t.setLibReAnnounced({name:"interop"})})).catch((function(e){return a.warn("Error while re-announcing interop: ".concat(JSON.stringify(e)))})):s&&(s({client:l,server:d}),s=void 0)})),u.onLeft((function(){n.reset()})),u.join(),c}var Ns=function(){function e(e){var t=this;if("undefined"===typeof e)throw new Error("configuration is required");if("undefined"===typeof e.connection)throw new Error("configuration.connections is required");var n,i=e.connection;if("number"!==typeof e.methodResponseTimeout&&(e.methodResponseTimeout=3e4),"number"!==typeof e.waitTimeoutMs&&(e.waitTimeoutMs=3e4),this.unwrappedInstance=new gs(this,void 0,i),this.instance=this.unwrappedInstance.unwrap(),this.clientRepository=new vs(e.logger.subLogger("cRep"),this),this.serverRepository=new ys,3!==i.protocolVersion)throw new Error("protocol ".concat(i.protocolVersion," not supported"));n=Rs(this.instance,i,this.clientRepository,this.serverRepository,e,this),this.readyPromise=n.then((function(n){return t.protocol=n,t.client=new cs(t.protocol,t.clientRepository,t.instance,e),t.server=new fs(t.protocol,t.serverRepository),t}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.serverRemoved=function(e){return this.client.serverRemoved(e)},e.prototype.serverAdded=function(e){return this.client.serverAdded(e)},e.prototype.serverMethodRemoved=function(e){return this.client.serverMethodRemoved(e)},e.prototype.serverMethodAdded=function(e){return this.client.serverMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.client.methodRemoved(e)},e.prototype.methodAdded=function(e){return this.client.methodAdded(e)},e.prototype.methodsForInstance=function(e){return this.client.methodsForInstance(e)},e.prototype.methods=function(e){return this.client.methods(e)},e.prototype.servers=function(e){return this.client.servers(e)},e.prototype.subscribe=function(e,t,n,i){return this.client.subscribe(e,t,n,i)},e.prototype.createStream=function(e,t,n,i){return this.server.createStream(e,t,n,i)},e.prototype.unregister=function(e){return this.server.unregister(e)},e.prototype.registerAsync=function(e,t){return this.server.registerAsync(e,t)},e.prototype.register=function(e,t){return this.server.register(e,t)},e.prototype.invoke=function(e,t,n,i,r,o){return this.client.invoke(e,t,n,i,r,o)},e.prototype.waitForMethod=function(e){var t=new Hr,n=this.client.methodAdded((function(i){i.name===e&&(n(),t.resolve(i))}));return t.promise},e}(),Os=["subscribed","success"],js=function(){function e(e,t){var n=this;this.publish=function(e,t,i){var r=i||{},o=r.routingKey,s=r.target,a=n.removeEmptyValues({type:"publish",topic:e,data:t,peer_id:n.peerId,routing_key:o,target_identity:s});n.session.send(a)},this.subscribe=function(e,t,i){return new Promise((function(r,o){var s=i||{},a=s.routingKey,c=s.target,u=n.removeEmptyValues({type:"subscribe",topic:e,peer_id:n.peerId,routing_key:a,source:c});n.session.send(u).then((function(i){var o=i.subscription_id;n.subscriptions.push({subscription_id:o,topic:e,callback:t,source:c}),r({unsubscribe:function(){return n.session.send({type:"unsubscribe",subscription_id:o,peer_id:n.peerId}),n.subscriptions=n.subscriptions.filter((function(e){return e.subscription_id!==o})),Promise.resolve()}})})).catch((function(e){return o(e)}))}))},this.watchOnEvent=function(){n.session.on("event",(function(e){var t=e.data,i=e.subscription_id,r=e["publisher-identity"],o=n.subscriptions.find((function(e){return e.subscription_id===i}));o&&(o.source?n.keysMatch(o.source,r)&&o.callback(t,o.topic,r):o.callback(t,o.topic,r))}))},this.connection=e,this.logger=t,this.peerId=e.peerId,this.subscriptions=[],this.session=e.domain("bus",Os),this.readyPromise=this.session.join(),this.readyPromise.then((function(){n.watchOnEvent()}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.removeEmptyValues=function(e){var t={};return Object.keys(e).forEach((function(n){void 0!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t},e.prototype.keysMatch=function(e,t){var n=Object.keys(e),i=!0;return n.forEach((function(n){e[n]!==t[n]&&(i=!1)})),i},e}(),Ds=function(e,t){var n,i,r,o,s,a,c,u,d,l="object"===typeof window?null!==(n=window.iodesktop)&&void 0!==n?n:window.glue42gd:void 0,h="object"===typeof window&&null!==(i=window.gdPreloadPromise)&&void 0!==i?i:Promise.resolve(),p=Vr("glue"),f=function(e,t,n){var i,r,o,s,a;if(Gr.isNode()){var c={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}._GD_STARTING_CONTEXT_;if(c)try{a=JSON.parse(c)}catch(f){}}function u(){if(e.application)return e.application;if(n)return n.applicationName;if("undefined"!==typeof window&&"undefined"!==typeof window.glue42electron)return window.glue42electron.application;var t=Io();return Gr.isNode()?a?a.applicationConfig.name:"NodeJS"+t:"undefined"!==typeof window&&"undefined"!==typeof document?document.title+" (".concat(t,")"):t}var d=function(){var i,r,o,s,c,d,l,h,p,f,g,m=e.gateway,v=null!==(i=null===m||void 0===m?void 0:m.protocolVersion)&&void 0!==i?i:3,y=null===m||void 0===m?void 0:m.reconnectInterval,w=null===m||void 0===m?void 0:m.reconnectAttempts,b=null===m||void 0===m?void 0:m.ws,_=null===m||void 0===m?void 0:m.sharedWorker,I=null===m||void 0===m?void 0:m.inproc,C=null!==(r=null===m||void 0===m?void 0:m.webPlatform)&&void 0!==r?r:void 0;n&&(b=n.gwURL),Gr.isNode()&&a&&a.gwURL&&(b=a.gwURL),b||_||I||(b="ws://localhost:8385");var S=u(),k=S;"undefined"!==typeof n?(h=n.windowId,p=n.pid,n.env&&(f=n.env.env,g=n.env.region),k=null!==(o=n.application)&&void 0!==o?o:"glue-app",l=n.appInstanceId):Gr.isNode()?(p=process.pid,a&&(f=a.env,g=a.region,l=a.instanceId)):"undefined"!==typeof(null===window||void 0===window?void 0:window.glue42electron)&&(h=null===window||void 0===window?void 0:window.glue42electron.instanceId,p=null===window||void 0===window?void 0:window.glue42electron.pid,f=null===window||void 0===window?void 0:window.glue42electron.env,g=null===window||void 0===window?void 0:window.glue42electron.region,k=null!==(s=null===window||void 0===window?void 0:window.glue42electron.application)&&void 0!==s?s:"glue-app",l=null===window||void 0===window?void 0:window.glue42electron.instanceId);var x=null!==(d=null===(c=e.gateway)||void 0===c?void 0:c.replaySpecs)&&void 0!==d?d:[];x.push(zo);var T={application:k,applicationName:S,windowId:h,instance:l,process:p,region:g,environment:f,api:t.version||Vo};return e.identity&&(T=Object.assign(T,e.identity)),{identity:T,reconnectInterval:y,ws:b,sharedWorker:_,webPlatform:C,inproc:I,protocolVersion:v,reconnectAttempts:w,replaySpecs:x}}(),l=u();if("undefined"!==typeof window){var h=window,p=h.htmlContainer?"".concat(h.htmlContainer.containerName,".").concat(h.htmlContainer.application):null===(i=null===h||void 0===h?void 0:h.glue42gd)||void 0===i?void 0:i.application;p&&(l=p)}return{bus:null!==(r=e.bus)&&void 0!==r&&r,application:l,auth:function(){var t,n,i;return"string"===typeof e.auth?{token:e.auth}:e.auth?e.auth:Gr.isNode()&&a&&a.gwToken?{gatewayToken:a.gwToken}:(null===(t=e.gateway)||void 0===t?void 0:t.webPlatform)||(null===(n=e.gateway)||void 0===n?void 0:n.inproc)||(null===(i=e.gateway)||void 0===i?void 0:i.sharedWorker)?{username:"glue42",password:"glue42"}:void 0}(),logger:function(){var t,i,r,o=e.logger,s="warn";return o||(o=s),n&&(r=n.consoleLogLevel),"string"===typeof o?{console:null!==r&&void 0!==r?r:o,publish:s}:{console:null!==(t=null!==r&&void 0!==r?r:o.console)&&void 0!==t?t:s,publish:null!==(i=o.publish)&&void 0!==i?i:s}}(),connection:d,metrics:null===(o=e.metrics)||void 0===o||o,contexts:"undefined"===typeof e.contexts||"boolean"===typeof e.contexts&&e.contexts?{reAnnounceKnownContexts:!0}:"object"===typeof e.contexts&&Object.assign({},{reAnnounceKnownContexts:!0},e.contexts),version:t.version||Vo,libs:null!==(s=t.libs)&&void 0!==s?s:[],customLogger:e.customLogger}}(e=e||{},t=t||{},l),g={};function m(e,t,n){(d=s.canPublish("trace"))&&s.trace("registering ".concat(e," module"));var i=function(){t.initTime=n.stop(),t.initEndTime=n.endTime,t.marks=n.marks,d&&s.trace("".concat(e," is ready - ").concat(n.endTime-n.startTime))};t.initStartTime=n.startTime,t.ready?t.ready().then((function(){i()})):i(),Array.isArray(e)||(e=[e]),e.forEach((function(e){g[e]=t,Ds[e]=t}))}function v(){var e,t,n,i,o,c=Vr("metrics"),u=f.metrics,d=null===l||void 0===l?void 0:l.getMetricsPublishingEnabled,h=f.connection.identity,p=d||function(){return!0},g=null!==(e="boolean"!==typeof u&&u.disableAutoAppSystem)&&void 0!==e&&e;return m("metrics",a=Dr({connection:u?r:void 0,logger:s.subLogger("metrics"),canUpdateMetric:p,system:"Glue42",service:null!==(n=null!==(t=null===h||void 0===h?void 0:h.service)&&void 0!==t?t:null===l||void 0===l?void 0:l.applicationName)&&void 0!==n?n:f.application,instance:null!==(o=null!==(i=null===h||void 0===h?void 0:h.instance)&&void 0!==i?i:null===h||void 0===h?void 0:h.windowId)&&void 0!==o?o:Io(),disableAutoAppSystem:g,pagePerformanceMetrics:"boolean"!==typeof u?null===u||void 0===u?void 0:u.pagePerformanceMetrics:void 0}),c),Promise.resolve()}function y(){var e=Vr("interop"),t={connection:r,logger:s.subLogger("interop")};return o=new Ns(t),Mo.Interop=o,m(["interop","agm"],o,e),Promise.resolve()}function w(){var e=f.activities&&3===r.protocolVersion;if(f.contexts||e){var t=Vr("contexts");return m("contexts",c=new os({connection:r,logger:s.subLogger("contexts"),trackAllContexts:"object"===typeof f.contexts&&f.contexts.trackAllContexts,reAnnounceKnownContexts:"object"===typeof f.contexts&&f.contexts.reAnnounceKnownContexts}),t),c}var n=r.replayer;n&&n.drain(zo.name)}function b(){return pr(this,void 0,void 0,(function(){var e;return fr(this,(function(t){return f.bus?(e=Vr("bus"),m("bus",u=new js(r,s.subLogger("bus")),e),[2,Promise.resolve()]):[2,Promise.resolve()]}))}))}function _(e){try{return e.forEach((function(e){!function(e,t){var n=Vr(e),i=t(g);i&&m(e,i,n)}(e.name,e.create)})),Promise.resolve()}catch(t){return Promise.reject(t)}}return h.then((function(){var e,t=Vr("logger");return(s=new Mo("".concat(null===(e=f.connection.identity)||void 0===e?void 0:e.application),void 0,f.customLogger)).consoleLevel(f.logger.console),s.publishLevel(f.logger.publish),s.canPublish("debug")&&s.debug("initializing glue..."),m("logger",s,t),Promise.resolve(void 0)})).then((function(){var e=Vr("connection");r=new Eo(f.connection,s.subLogger("connection"));var t=Promise.resolve(f.auth);return f.connection&&!f.auth&&(l?t=l.getGWToken().then((function(e){return{gatewayToken:e}})):"undefined"!==typeof window&&(null===window||void 0===window?void 0:window.glue42electron)?"string"===typeof window.glue42electron.gwToken&&(t=Promise.resolve({gatewayToken:window.glue42electron.gwToken})):t=Promise.reject("You need to provide auth information")),t.then((function(t){var n;if(e.mark("auth-promise-resolved"),"[object Object]"!==Object.prototype.toString.call(t))throw new Error("Invalid auth object - "+JSON.stringify(t));return n=t,r.login(n)})).then((function(){return m("connection",r,e),f})).catch((function(e){throw r&&r.logout(),e}))})).then((function(){return Promise.all([v(),y(),w(),b()])})).then((function(){return o.readyPromise})).then((function(){return function(){return pr(this,void 0,void 0,(function(){var t,n,i;return fr(this,(function(r){switch(r.label){case 0:if(t="T42.ACS.RegisterInstance",!Gr.isNode()||"undefined"!==typeof{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}._GD_STARTING_CONTEXT_||"undefined"===typeof(null===e||void 0===e?void 0:e.application))return[3,4];if(!(o.methods({name:t}).length>0))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,o.invoke(t,{appName:null===e||void 0===e?void 0:e.application,pid:process.pid})];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),i=n,s.error("Cannot register as an instance: ".concat(JSON.stringify(i.message))),[3,4];case 4:return[2]}}))}))}()})).then((function(){return _(f.libs||[])})).then((function(){var e=Object.keys(g).map((function(e){var t=g[e];return t.ready?t.ready():Promise.resolve()}));return Promise.all(e)})).then((function(){var n={coreVersion:Vo,version:f.version};p.stop();var i={feedback:function(e){o&&o.invoke("T42.ACS.Feedback",e,"best")},info:n,logger:s,interop:o,agm:o,connection:r,metrics:a,contexts:c,bus:u,version:f.version,userConfig:e,done:function(){return null===s||void 0===s||s.info("done called by user..."),r.logout()}};if(i.performance={get glueVer(){return f.version},get glueConfig(){return JSON.stringify(e)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var e=zr;return Object.keys(e).map((function(t){var n=e[t];return{name:t,duration:n.endTime-n.startTime,marks:n.marks,startTime:n.startTime,endTime:n.endTime}}))}},Object.keys(g).forEach((function(e){var t=g[e];i[e]=t})),i.config={},Object.keys(f).forEach((function(e){i.config[e]=f[e]})),t&&t.extOptions&&Object.keys(t.extOptions).forEach((function(e){i.config[e]=null===t||void 0===t?void 0:t.extOptions[e]})),(null===t||void 0===t?void 0:t.enrichGlue)&&t.enrichGlue(i),l&&l.updatePerfData&&l.updatePerfData(i.performance),i.agm){var d=function(e,t,n){return function(){return i.logger.warn("glue.js - 'glue.agm.".concat(t,"' method is deprecated, use 'glue.interop.").concat(n,"' instead.")),e.apply(i.agm,arguments)}},h=i.agm;h.method_added=d(i.agm.methodAdded,"method_added","methodAdded"),h.method_removed=d(i.agm.methodRemoved,"method_removed","methodRemoved"),h.server_added=d(i.agm.serverAdded,"server_added","serverAdded"),h.server_method_aded=d(i.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),h.server_method_removed=d(i.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return i})).catch((function(e){return Promise.reject({err:e,libs:g})}))};"undefined"!==typeof window&&(window.IOConnectCore=Ds),Ds.version=Vo,Ds.default=Ds;const Fs=(Ws=Ds,e=>l(void 0,void 0,void 0,(function*(){if(window.glue42gd||window.iodesktop)return(e=>{var t,n,i;const r={windows:!0,layouts:"full",appManager:"full",channels:!0,libraries:null!==(t=null===e||void 0===e?void 0:e.libraries)&&void 0!==t?t:[],logger:null!==(i=null===(n=null===e||void 0===e?void 0:e.systemLogger)||void 0===n?void 0:n.level)&&void 0!==i?i:"warn"};return window.glue42gd,window.Glue(r)})(e);const t=new cr,n=(e=>{var t,n,i;const r=!!(null===(n=null===(t=null===e||void 0===e?void 0:e.gateway)||void 0===t?void 0:t.webPlatform)||void 0===n?void 0:n.port),o=Object.assign({},h,e,{isPlatformInternal:r});return o.systemLogger&&(o.logger=null!==(i=o.systemLogger.level)&&void 0!==i?i:"info"),o})(e);(()=>{const e=window.glue42core||window.iobrowser;if(e&&e.webStarted)throw new Error("IoConnect Browser has already been started for this application.");e?e.webStarted=!0:window.iobrowser={webStarted:!0}})();const i=yield(r=()=>Ws(n,{version:ur}),o=3e4,s="Glue Web initialization timed out, because core didn't resolve",new Promise(((e,t)=>{let n=!0;const i=setTimeout((()=>{if(!n)return;n=!1;const e=s||"Promise timeout hit: ".concat(o);t(e)}),o);r().then((t=>{n&&(n=!1,clearTimeout(i),e(t))})).catch((e=>{n&&(n=!1,clearTimeout(i),t(e))}))})));var r,o,s;const a=i.logger.subLogger("web.main.controller");return t.defineGlue(i),t.sessionController.configure({windowId:i.interop.instance.instance}),yield t.preferredConnectionController.start(n),yield t.bridge.start(t.controllers),t.defineConfig(n),a.trace("the bridge has been started, initializing all controllers"),yield Promise.all(Object.values(t.controllers).map((e=>e.start(i,t)))),a.trace("all controllers reported started, starting all additional libraries"),yield Promise.all(n.libraries.map((e=>e(i,n)))),a.trace("all libraries were started"),t.eventsDispatcher.start(i),a.trace("start event dispatched, glue is ready, returning it"),i})));var Ws;if("undefined"!==typeof window){const e=window;e.IOBrowser=Fs,delete e.GlueCore,delete e.IOConnectCore}const Ls=window.glue42gd||window.glue42core,Us=window.iodesktop||window.iobrowser;Ls||Us||(window.iobrowser={webStarted:!1}),Fs.version=ur;var qs=n(664),Bs=n.n(qs);function Gs(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}const Hs=["interop","appManager","intents"],zs=["myInstance","applications","application","instances","onInstanceStarted","onInstanceStopped","onAppAdded","onAppRemoved"];var Vs=function(e){return{ok:!0,result:e}},Js=function(e){return{ok:!1,error:e}},Ks=function(e,t,n){return!1===t.ok?t:!1===n.ok?n:Vs(e(t.result,n.result))},$s=function(e,t){return!0===t.ok?t:Js(e(t.error))},Qs=function(){return Qs=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Qs.apply(this,arguments)};function Ys(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if(typeof e!==typeof t)return!1;if("object"===typeof e){if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!Ys(e[n],t[n]))return!1;return!0}var i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(n=0;n<i.length;n++){if(!t.hasOwnProperty(i[n]))return!1;if(!Ys(e[i[n]],t[i[n]]))return!1}return!0}}var Xs=function(e){return Array.isArray(e)},Zs=function(e){return"object"===typeof e&&null!==e&&!Xs(e)},ea=function(e,t){return"expected "+e+", got "+function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}}(t)},ta=function(e){return e.map((function(e){return"string"===typeof e?"."+e:"["+e+"]"})).join("")},na=function(e,t){var n=t.at,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(t,["at"]);return Qs({at:e+(n||"")},i)},ia=function(){function e(t){var n=this;this.decode=t,this.run=function(e){return $s((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),n.decode(e))},this.runPromise=function(e){return!0===(t=n.run(e)).ok?Promise.resolve(t.result):Promise.reject(t.error);var t},this.runWithException=function(e){return function(e){if(!0===e.ok)return e.result;throw e.error}(n.run(e))},this.map=function(t){return new e((function(e){return function(e,t){return!0===t.ok?Vs(e(t.result)):t}(t,n.decode(e))}))},this.andThen=function(t){return new e((function(e){return function(e,t){return!0===t.ok?e(t.result):t}((function(n){return t(n).decode(e)}),n.decode(e))}))},this.where=function(t,i){return n.andThen((function(n){return t(n)?e.succeed(n):e.fail(i)}))}}return e.string=function(){return new e((function(e){return"string"===typeof e?Vs(e):Js({message:ea("a string",e)})}))},e.number=function(){return new e((function(e){return"number"===typeof e?Vs(e):Js({message:ea("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"===typeof e?Vs(e):Js({message:ea("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return Ys(e,t)?Vs(t):Js({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(Zs(e)&&t){var n={};for(var i in t)if(t.hasOwnProperty(i)){var r=t[i].decode(e[i]);if(!0!==r.ok)return void 0===e[i]?Js({message:"the key '"+i+"' is required but was not present"}):Js(na("."+i,r.error));void 0!==r.result&&(n[i]=r.result)}return Vs(n)}return Zs(e)?Vs(e):Js({message:ea("an object",e)})}))},e.array=function(t){return new e((function(e){if(Xs(e)&&t){return e.reduce((function(e,n,i){return Ks((function(e,t){return e.concat([t])}),e,function(e,n){return $s((function(e){return na("["+n+"]",e)}),t.decode(e))}(n,i))}),Vs([]))}return Xs(e)?Vs(e):Js({message:ea("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(Xs(e)){if(e.length!==t.length)return Js({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var n=[],i=0;i<t.length;i++){var r=t[i].decode(e[i]);if(!r.ok)return Js(na("["+i+"]",r.error));n[i]=r.result}return Vs(n)}return Js({message:ea("a tuple of length "+t.length,e)})}))},e.union=function(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.oneOf.apply(e,[t,n].concat(i))},e.intersection=function(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return new e((function(e){return[t,n].concat(i).reduce((function(t,n){return Ks(Object.assign,t,n.decode(e))}),Vs({}))}))},e.anyJson=function(){return new e((function(e){return Vs(e)}))},e.unknownJson=function(){return new e((function(e){return Vs(e)}))},e.dict=function(t){return new e((function(e){if(Zs(e)){var n={};for(var i in e)if(e.hasOwnProperty(i)){var r=t.decode(e[i]);if(!0!==r.ok)return Js(na("."+i,r.error));n[i]=r.result}return Vs(n)}return Js({message:ea("an object",e)})}))},e.optional=function(t){return new e((function(e){return void 0===e||null===e?Vs(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new e((function(e){for(var n=[],i=0;i<t.length;i++){var r=t[i].decode(e);if(!0===r.ok)return r;n[i]=r.error}var o=n.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return Js({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},e.withDefault=function(t,n){return new e((function(e){return Vs(function(e,t){return!0===t.ok?t.result:e}(t,n.decode(e)))}))},e.valueAt=function(t,n){return new e((function(e){for(var i=e,r=0;r<t.length;r++){if(void 0===i)return Js({at:ta(t.slice(0,r+1)),message:"path does not exist"});if("string"===typeof t[r]&&!Zs(i))return Js({at:ta(t.slice(0,r+1)),message:ea("an object",i)});if("number"===typeof t[r]&&!Xs(i))return Js({at:ta(t.slice(0,r+1)),message:ea("an array",i)});i=i[t[r]]}return $s((function(e){return void 0===i?{at:ta(t),message:"path does not exist"}:na(ta(t),e)}),n.decode(i))}))},e.succeed=function(t){return new e((function(e){return Vs(t)}))},e.fail=function(t){return new e((function(e){return Js({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),ra=ia.string,oa=ia.number,sa=ia.boolean,aa=ia.anyJson;ia.unknownJson;var ca=ia.constant,ua=ia.object,da=ia.array;ia.tuple,ia.dict;var la=ia.optional,ha=ia.oneOf;ia.union,ia.intersection,ia.withDefault,ia.valueAt,ia.succeed,ia.fail,ia.lazy;const pa=ra().where((e=>e.length>0),"Expected a non-empty string"),fa=oa().where((e=>e>=0),"Expected a non-negative number"),ga=ha(ca("top"),ca("left"),ca("right"),ca("bottom")),ma=la(ua({top:la(oa()),left:la(oa()),width:la(fa),height:la(fa),context:la(aa()),relativeTo:la(pa),relativeDirection:la(ga),windowId:la(pa)})),va=ha(ca("startNew"),ca("reuse"),ua({app:la(pa),instance:la(pa)})),ya=ua({type:la(pa),data:la(ua())}),wa=ua({applicationName:pa,applicationTitle:la(ra()),applicationDescription:la(ra()),applicationIcon:la(ra()),type:ha(ca("app"),ca("instance")),displayName:la(ra()),contextTypes:la(da(pa)),instanceId:la(ra()),instanceTitle:la(ra()),resultType:la(ra())}),ba=ha(pa,ua({intent:pa,target:la(va),context:la(ya),options:la(ma),handlers:la(da(wa))})),_a=ua({title:la(pa),openResolver:la(sa()),timeout:la(oa()),intent:la(pa),contextTypes:la(da(pa)),resultType:la(pa)}),Ia=ua({callerId:pa,methodName:pa,intent:la(ba),handlerFilter:la(_a)}),Ca=ua({applicationName:ra(),applicationIcon:la(ra()),instanceId:la(ra()),applicationTitle:la(ra())});class Sa{initialize(e){return Gs(this,void 0,void 0,(function*(){const{ok:t,error:n}=(e=>{const t=Object.keys(e),n=Hs.filter((e=>!t.includes(e)));if(n.length)return{ok:!1,error:"Glue is missing the following API".concat(n.length>1?"s":"",": ").concat(n.join(", "))};const i=Object.keys(e.appManager),r=zs.filter((e=>!i.includes(e)));return r.length?{ok:!1,error:'Glue is not initialized with { "appManager: "full" }. Missing props: '.concat(r.join(", "))}:{ok:!0}})(e);if(!t)return this.announceInitFailure(n);this.glue=e;const i=yield this.glue.windows.my().getContext();yield this.validateStartupContext(i),this._intent=i.intent,this._callerId=i.callerId,this._methodName=i.methodName,this._handlerFilter=i.handlerFilter,this._resolvingMethod=i.handlerFilter?"filterHandlers":"raise"}))}get intent(){return this._intent}get resolvingMethod(){return this._resolvingMethod}get handlerFilter(){return this._handlerFilter}getTitle(){return"filterHandlers"===this.resolvingMethod?this.handlerFilter.title:"Choose an app to ".concat(this.getIntentName())}sendInteropMethodResponse(e){return Gs(this,void 0,void 0,(function*(){const t="raise"===this.resolvingMethod?yield this.getIntentHandlerForRaise(e):yield this.getIntentHandlerForFilterHandlers(e);if(!t)throw new Error("There's no such existing intent handler: ".concat(JSON.stringify(e)));const n=this.isMethodRegistered();if(this.isInstanceStillRunning())return n?this.glue.interop.invoke(this._methodName,{intent:this.getIntentName(),handler:t},{instance:this._callerId}):this.waitForResponseMethodAdded(t);this.glue.windows.my().close()}))}subscribeForServerMethodAdded(e){return this.glue.interop.serverMethodAdded((t=>{let{server:n,method:i}=t;this.checkIfInstanceIntentHandler(n,i)&&this.buildAddedIntentHandler(n.applicationName,n.instance).then((t=>{t&&e(t)}))}))}subscribeForServerMethodRemoved(e){return this.glue.interop.serverMethodRemoved((t=>{let{server:n,method:i}=t;if(!this.checkIfInstanceIntentHandler(n,i))return;const r=this.buildRemovedIntentHandler({instance:n});e(r)}))}subscribeOnAppAdded(e){return this.glue.appManager.onAppAdded((t=>{this.checkIfAppIntentHandler(t,"added").then((e=>{if(e)return this.buildAddedIntentHandler(t.name)})).then((t=>{t&&e(t)}))}))}subscribeOnAppRemoved(e){return this.glue.appManager.onAppRemoved((t=>{this.checkIfAppIntentHandler(t,"removed").then((e=>{if(e)return this.buildRemovedIntentHandler({app:t})})).then((t=>{t&&e(t)}))}))}getIntentName(){return"object"===typeof this.intent?this.intent.intent:this.intent}waitForResponseMethodAdded(e){return new Promise(((t,n)=>{const i=this.glue.interop.serverMethodAdded((r=>{let{server:o,method:s}=r;o.instance===this._callerId&&s.name===this._methodName&&this.glue.interop.invoke(this._methodName,{intent:this.intent,handler:e},{instance:this._callerId}).then((e=>{t(e)})).catch((e=>{n(e)})).finally((()=>{i&&i()}))}))}))}checkIfAppIntentHandler(e,t){return Gs(this,void 0,void 0,(function*(){if("raise"===this.resolvingMethod&&"object"===typeof this.intent&&this.intent.handlers)return this.checkIfAppInPassedHandlers(e);const n=window.glue42core||window.iobrowser;return n&&n.webStarted?this.checkInBrowserIfAppShouldShow(e,t):!!window.glue42gd&&this.checkInDesktopIfAppShouldShow(e)}))}checkIfInstanceIntentHandler(e,t){if("filterHandlers"===this.resolvingMethod)return this.checkIfValidIntentMethodWithHandlerFilter(t);return!!this.isMethodIsForPassedIntent(t.name,this.getIntentName())&&!("object"===typeof this.intent&&this.intent.handlers&&!this.checkIfInstanceInPassedHandlers(e))}checkIfValidIntentMethodWithHandlerFilter(e){var t,n,i;if((null===(t=this.handlerFilter)||void 0===t?void 0:t.intent)&&!this.isMethodIsForPassedIntent(e.name,this.handlerFilter.intent))return!1;const r=e.flags.intent;return!!(!(null===(n=this.handlerFilter)||void 0===n?void 0:n.resultType)||r&&r.resultType&&r.resultType===this.handlerFilter.resultType)&&!((null===(i=this.handlerFilter)||void 0===i?void 0:i.contextTypes)&&!(r&&r.contextTypes&&r.contextTypes.length&&this.handlerFilter.contextTypes.every((e=>r.contextTypes.includes(e)))))}checkIfAppInPassedHandlers(e){var t;const n=null===(t=this.intent.handlers)||void 0===t?void 0:t.filter((t=>t.applicationName===e.name));if(!(null===n||void 0===n?void 0:n.length))return!1;if("startNew"===this.intent.target)return!!n.find((e=>"app"===e.type));if("reuse"===this.intent.target){return!n.find((e=>"instance"===e.type))}return!!n.find((e=>"app"===e.type))}checkInBrowserIfAppShouldShow(e,t){var n,i,r;return Gs(this,void 0,void 0,(function*(){if("filterHandlers"===this.resolvingMethod)return this.isThereValidIntentHandlerByFilter(e.userProperties.intents);const o=this.getIntentName();if("removed"===t)return!!(null===(n=e.userProperties.intents)||void 0===n?void 0:n.find((e=>e.name===o)));if("object"===typeof this.intent&&(!this.intent.target||"reuse"===this.intent.target)){const t=null===(i=e.userProperties.intents)||void 0===i?void 0:i.find((e=>e.name===o));if(!t)return!1;const n=(yield this.glue.intents.find(o)).find((e=>e.name===o));return!!n&&!n.handlers.find((t=>t.applicationName===e.name&&"instance"===t.type&&t.instanceId))}return!!(null===(r=e.userProperties.intents)||void 0===r?void 0:r.find((e=>e.name===o)))}))}checkInDesktopIfAppShouldShow(e){return Gs(this,void 0,void 0,(function*(){if("filterHandlers"===this.resolvingMethod){const t=(yield this.glue.intents.all()).map((t=>{const n=t.handlers.filter((t=>t.applicationName===e.name&&"app"===t.type));if(n.length)return t.handlers=n,t})).filter((e=>e&&e.handlers.length));return!!t.length&&this.isThereValidIntentHandlerByFilter(t)}const t=this.getIntentName(),n=(yield this.glue.intents.find(t)).find((e=>e.name===t));if(!n)return!1;if("object"===typeof this.intent&&(!this.intent.target||"reuse"===this.intent.target)){const t=n.handlers.filter((t=>t.applicationName===e.name));if(!t.length)return!1;return!t.some((e=>e.instanceId))}return!!n.handlers.find((t=>t.applicationName===e.name))}))}checkIfInstanceInPassedHandlers(e){var t;return!!(null===(t=this.intent.handlers)||void 0===t?void 0:t.find((t=>t.applicationName===e.application&&e.instance===t.instanceId)))}isThereValidIntentHandlerByFilter(e){return null===e||void 0===e?void 0:e.some((e=>{var t,n,i,r;if((!(null===(t=this.handlerFilter)||void 0===t?void 0:t.intent)||this.handlerFilter.intent===e.name)&&(!(null===(n=this.handlerFilter)||void 0===n?void 0:n.resultType)||(null===(i=this.handlerFilter)||void 0===i?void 0:i.resultType)===e.resultType)&&(!(null===(r=this.handlerFilter)||void 0===r?void 0:r.contextTypes)||e.contexts&&this.handlerFilter.contextTypes.every((t=>{var n;return null===(n=e.contexts)||void 0===n?void 0:n.includes(t)}))))return!0}))}buildAddedIntentHandler(e,t){return Gs(this,void 0,void 0,(function*(){const n=this.glue.appManager.application(e),i=this.glue.interop.servers().find((e=>e.instance===t));if(n||i)return n?{applicationName:"no-app-window"!==n.name?n.name:(null===i||void 0===i?void 0:i.applicationName)||(null===i||void 0===i?void 0:i.application)||"",applicationTitle:i?yield this.getHandlerTitle(i):n.title||t,applicationIcon:null===n||void 0===n?void 0:n.icon,instanceId:t}:{applicationName:i.applicationName||i.application||i.instance||"",applicationTitle:yield this.getHandlerTitle(i),applicationIcon:"",instanceId:t}}))}buildRemovedIntentHandler(e){let{instance:t,app:n}=e;return t?{applicationName:t.applicationName||t.application||"",instanceId:t.instance||t.windowId}:{applicationName:n.name,applicationTitle:n.title,applicationIcon:n.icon}}getHandlerTitle(e){return Gs(this,void 0,void 0,(function*(){if(!e.windowId)return e.applicationName||e.application||e.instance||"";const t=this.glue.windows.findById(e.windowId),n=e.applicationName||e.application||e.instance||"";if(!t)return n;return(yield t.getTitle())||n}))}getIntentHandlerForRaise(e){return Gs(this,void 0,void 0,(function*(){const t=this.getIntentName(),n=(yield this.glue.intents.find(t)).find((e=>e.name===t));if(!n)throw new Error("Intent with name ".concat(t," does not exist"));return this.findHandlerByFilter({instanceId:e.instanceId,applicationName:e.applicationName},n.handlers)}))}getIntentHandlerForFilterHandlers(e){return Gs(this,void 0,void 0,(function*(){const t=(yield this.glue.intents.all()).map((e=>e.handlers)).flat(1);return this.findHandlerByFilter({instanceId:e.instanceId,applicationName:e.applicationName},t)}))}findHandlerByFilter(e,t){return e.instanceId?t.find((t=>t.instanceId===e.instanceId)):e.applicationName?t.find((t=>t.applicationName===e.applicationName)):void 0}isMethodRegistered(){return!!this.glue.interop.methods(this._methodName).length}isInstanceStillRunning(){return!!this.glue.interop.servers().find((e=>e.instance===this._callerId))}isMethodIsForPassedIntent(e,t){return"".concat("Tick42.FDC3.Intents.").concat(t)===e}validateStartupContext(e){return Gs(this,void 0,void 0,(function*(){const t=Ia.run(e);if(!t.ok){const i=(n=t.error,"".concat(n.message," at ").concat(n.at," for input: ").concat(JSON.stringify(n.input)));return this.announceInitFailure(i,e)}var n;const i="Invalid startup context: ".concat(JSON.stringify(e));if(!e.intent&&!e.handlerFilter)return this.announceInitFailure("".concat(i,". Either 'intent' or 'handlerFilter' should be present."),e);if(!e.handlerFilter)return;const{intent:r,resultType:o,contextTypes:s}=e.handlerFilter;return Object.keys(e.handlerFilter).length&&(r||o||s&&s.length)?void 0:this.announceInitFailure("Invalid startup context: ".concat(JSON.stringify(e),". Provide at least one filter criteria of the following: 'contextTypes' | 'intent' | 'resultType'"),e)}))}announceInitFailure(e,t){return new Promise(((n,i)=>{this.glue&&this.glue.interop&&t&&t.methodName&&"string"===typeof t.methodName&&t.callerId&&"string"===typeof t.callerId||i(e),this.glue.interop.invoke(t.methodName,{error:e},{instance:t.callerId}).then((()=>n())).catch((()=>i()))}))}}class ka{constructor(e){this.glueController=e}toApi(){const e={intent:this.glueController.intent,handlerFilter:this.glueController.handlerFilter,version:"2.1.0",getTitle:this.getTitle.bind(this),sendResponse:this.sendResponse.bind(this),onHandlerAdded:this.onHandlerAdded.bind(this),onHandlerRemoved:this.onHandlerRemoved.bind(this)};return Object.freeze(e)}getTitle(){return this.glueController.getTitle()}sendResponse(e){return Gs(this,void 0,void 0,(function*(){const t=Ca.runWithException(e);if(!t.applicationName&&!t.instanceId)throw new Error("Handler must have either applicationName or instanceId property");return this.glueController.sendInteropMethodResponse(t)}))}onHandlerAdded(e){if("raise"===this.glueController.resolvingMethod&&"startNew"===this.glueController.intent.target)return this.glueController.subscribeOnAppAdded(e);const t=this.glueController.subscribeOnAppAdded(e),n=this.glueController.subscribeForServerMethodAdded(e);return()=>{t(),n()}}onHandlerRemoved(e){if("raise"===this.glueController.resolvingMethod&&"object"===typeof this.glueController.intent&&"startNew"===this.glueController.intent.target)return this.glueController.subscribeOnAppRemoved(e);const t=this.glueController.subscribeOnAppRemoved(e),n=this.glueController.subscribeForServerMethodRemoved(e);return()=>{t(),n()}}}class xa{get intentsResolver(){return this._intentsResolver||(this._intentsResolver=new ka(this.glueController).toApi()),this._intentsResolver}get glueController(){return this._glueController||(this._glueController=new Sa),this._glueController}}const Ta=e=>Gs(void 0,void 0,void 0,(function*(){const t=new xa;try{yield t.glueController.initialize(e)}catch(n){throw new Error("The Intents Resolver API did not initialized successfully. Error: ".concat(JSON.stringify(n)))}e.intents.resolver=t.intentsResolver,Object.freeze(e.intents)}));"undefined"!==typeof window&&(window.IOConnectIntentsResolver=Ta);t.createRoot(document.getElementById("root")).render((0,a.jsx)(s,{settings:{browser:{config:{libraries:[Ta],appManager:"full",intents:{enableIntentsResolverUI:!1}},factory:Fs},desktop:{config:{libraries:[Ta],appManager:"full",intents:{enableIntentsResolverUI:!1}},factory:Bs()}},children:(0,a.jsx)(c,{})})),u()})()})();
//# sourceMappingURL=main.3f836378.js.map